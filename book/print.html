<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Glean - Cross-platform Telemetry library</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="../shared/glean.css">
        
        <link rel="stylesheet" href="../shared/mermaid.css">
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Glean</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guides</li><li class="chapter-item expanded "><a href="user/adding-glean-to-your-project.html"><strong aria-hidden="true">1.</strong> Adding Glean to your project</a></li><li class="chapter-item expanded "><a href="user/metrics/adding-new-metrics.html"><strong aria-hidden="true">2.</strong> Metrics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="user/metrics/adding-new-metrics.html"><strong aria-hidden="true">2.1.</strong> Adding new metrics</a></li><li class="chapter-item expanded "><a href="user/metrics/testing-metrics.html"><strong aria-hidden="true">2.2.</strong> Testing metrics</a></li><li class="chapter-item expanded "><a href="user/metrics/error-reporting.html"><strong aria-hidden="true">2.3.</strong> Error reporting</a></li><li class="chapter-item expanded "><a href="user/collected-metrics/metrics.html"><strong aria-hidden="true">2.4.</strong> Metrics collected by the Glean SDK</a></li></ol></li><li class="chapter-item expanded "><a href="user/pings/index.html"><strong aria-hidden="true">3.</strong> Pings</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="user/pings/ping-schedules-and-timings.html"><strong aria-hidden="true">3.1.</strong> Ping schedules and timings overview</a></li><li class="chapter-item expanded "><a href="user/pings/baseline.html"><strong aria-hidden="true">3.2.</strong> Baseline Ping</a></li><li class="chapter-item expanded "><a href="user/pings/deletion_request.html"><strong aria-hidden="true">3.3.</strong> Deletion Request Ping</a></li><li class="chapter-item expanded "><a href="user/pings/metrics.html"><strong aria-hidden="true">3.4.</strong> Metrics Ping</a></li><li class="chapter-item expanded "><a href="user/pings/events.html"><strong aria-hidden="true">3.5.</strong> Events Ping</a></li><li class="chapter-item expanded "><a href="user/pings/custom.html"><strong aria-hidden="true">3.6.</strong> Custom Pings</a></li><li class="chapter-item expanded "><a href="user/pings/testing-custom-pings.html"><strong aria-hidden="true">3.7.</strong> Testing custom pings</a></li></ol></li><li class="chapter-item expanded "><a href="user/experiments-api.html"><strong aria-hidden="true">4.</strong> Using the experiments API</a></li><li class="chapter-item expanded "><a href="user/debugging/index.html"><strong aria-hidden="true">5.</strong> Debugging products using Glean</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="user/debugging/debug-ping-view.html"><strong aria-hidden="true">5.1.</strong> Glean Debug Ping View</a></li><li class="chapter-item expanded "><a href="user/debugging/android.html"><strong aria-hidden="true">5.2.</strong> Android</a></li><li class="chapter-item expanded "><a href="user/debugging/ios.html"><strong aria-hidden="true">5.3.</strong> iOS</a></li><li class="chapter-item expanded "><a href="user/debugging/python.html"><strong aria-hidden="true">5.4.</strong> Python</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">API Reference</li><li class="chapter-item expanded "><a href="reference/yaml/index.html"><strong aria-hidden="true">6.</strong> YAML Format</a></li><li class="chapter-item expanded "><a href="reference/general/index.html"><strong aria-hidden="true">7.</strong> General</a></li><li class="chapter-item expanded "><a href="reference/metrics/index.html"><strong aria-hidden="true">8.</strong> Metric types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="reference/metrics/boolean.html"><strong aria-hidden="true">8.1.</strong> Boolean</a></li><li class="chapter-item expanded "><a href="reference/metrics/labeled_booleans.html"><strong aria-hidden="true">8.2.</strong> Labeled Booleans</a></li><li class="chapter-item expanded "><a href="reference/metrics/counter.html"><strong aria-hidden="true">8.3.</strong> Counter</a></li><li class="chapter-item expanded "><a href="reference/metrics/labeled_counters.html"><strong aria-hidden="true">8.4.</strong> Labeled Counters</a></li><li class="chapter-item expanded "><a href="reference/metrics/string.html"><strong aria-hidden="true">8.5.</strong> String</a></li><li class="chapter-item expanded "><a href="reference/metrics/labeled_strings.html"><strong aria-hidden="true">8.6.</strong> Labeled Strings</a></li><li class="chapter-item expanded "><a href="reference/metrics/string_list.html"><strong aria-hidden="true">8.7.</strong> String List</a></li><li class="chapter-item expanded "><a href="reference/metrics/timespan.html"><strong aria-hidden="true">8.8.</strong> Timespan</a></li><li class="chapter-item expanded "><a href="reference/metrics/timing_distribution.html"><strong aria-hidden="true">8.9.</strong> Timing Distribution</a></li><li class="chapter-item expanded "><a href="reference/metrics/memory_distribution.html"><strong aria-hidden="true">8.10.</strong> Memory Distribution</a></li><li class="chapter-item expanded "><a href="reference/metrics/uuid.html"><strong aria-hidden="true">8.11.</strong> UUID</a></li><li class="chapter-item expanded "><a href="reference/metrics/datetime.html"><strong aria-hidden="true">8.12.</strong> Datetime</a></li><li class="chapter-item expanded "><a href="reference/metrics/event.html"><strong aria-hidden="true">8.13.</strong> Event</a></li><li class="chapter-item expanded "><a href="reference/metrics/custom_distribution.html"><strong aria-hidden="true">8.14.</strong> Custom Distribution</a></li><li class="chapter-item expanded "><a href="reference/metrics/quantity.html"><strong aria-hidden="true">8.15.</strong> Quantity</a></li><li class="chapter-item expanded "><a href="reference/metrics/rate.html"><strong aria-hidden="true">8.16.</strong> Rate</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Language Bindings Information</li><li class="chapter-item expanded "><a href="language-bindings/android/index.html"><strong aria-hidden="true">9.</strong> Android</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="language-bindings/android/android-build-configuration-options.html"><strong aria-hidden="true">9.1.</strong> Android build configuration options</a></li><li class="chapter-item expanded "><a href="language-bindings/android/android-offline-builds.html"><strong aria-hidden="true">9.2.</strong> Android offline builds</a></li><li class="chapter-item expanded "><a href="language-bindings/android/instrument-android-crashes-example.html"><strong aria-hidden="true">9.3.</strong> Instrumenting Android crashes with the Glean SDK</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Appendix</li><li class="chapter-item expanded "><a href="appendix/glossary.html"><strong aria-hidden="true">10.</strong> Glossary</a></li><li class="chapter-item expanded "><a href="appendix/changelog.html"><strong aria-hidden="true">11.</strong> Changelog</a></li><li class="chapter-item expanded "><a href="appendix/twig.html"><strong aria-hidden="true">12.</strong> This Week in Glean</a></li><li class="chapter-item expanded "><a href="appendix/contribution-guidelines.html"><strong aria-hidden="true">13.</strong> Contribution Guidelines</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Glean - Cross-platform Telemetry library</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/mozilla/glean" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p>Glean is a modern approach for a telemetry library
and is part of the <a href="https://docs.telemetry.mozilla.org/concepts/glean/glean.html">Glean project</a>.</p>
<p><img src="glean.jpeg" alt="Glean logo" /></p>
<p>There are two implementations of Glean, with support for 5 different programming languages in total.
Both implementations strive to contain the same features with similar, but idiomatic APIs.</p>
<p>Unless clearly stated otherwise, regard the text in this book as valid for both clients
and all the supported programming languages and environments.</p>
<h3><a class="header" href="#a-hrefhttpsgithubcommozillagleanthe-glean-sdka" id="a-hrefhttpsgithubcommozillagleanthe-glean-sdka"><a href="https://github.com/mozilla/glean">The Glean SDK</a></a></h3>
<p>The Glean SDK is an implementation of Glean in Rust, with language bindings for <strong>Kotlin</strong>,
<strong>Python</strong>, <strong>Rust</strong> and <strong>Swift</strong>.</p>
<p>For development documentation on the <code>Glean SDK</code>,
refer to <a href="../dev/index.html">the Glean SDK development book</a>.</p>
<p>To report issues or request changes on the Glean SDK,
file a bug in <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Data+Platform+and+Tools&amp;component=Glean%3A+SDK&amp;priority=P3&amp;status_whiteboard=%5Btelemetry%3Aglean-rs%3Am%3F%5D">Bugzilla in Data Platform &amp; Tools :: Glean: SDK</a>.</p>
<h3><a class="header" href="#a-hrefhttpsgithubcommozillagleanjsgleanjsa" id="a-hrefhttpsgithubcommozillagleanjsgleanjsa"><a href="https://github.com/mozilla/glean.js">Glean.js</a></a></h3>
<p>Glean.js is an implementation of Glean in <strong>Javascript</strong>. Currently, it only has support
for usage in web extensions.</p>
<p>For development documentation on <code>Glean.js</code>,
refer to <a href="https://github.com/mozilla/glean.js/tree/main/docs">the Glean.js development documentation</a>.</p>
<p>To report issues or request changes on Glean.js,
file a bug in <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Data+Platform+and+Tools&amp;component=Glean.js&amp;priority=P4&amp;status_whiteboard=%5Btelemetry%3Aglean-js%3Am%3F%5D">Bugzilla in Data Platform &amp; Tools :: Glean.js</a>.</p>
<blockquote>
<p><strong>Note</strong> Glean.js is still in development and does not provide all the features the Glean SDK does.
Feature parity will be worked on after initial validation. Do not hesitate to <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Data+Platform+and+Tools&amp;component=Glean.js&amp;priority=P4&amp;status_whiteboard=%5Btelemetry%3Aglean-js%3Am%3F%5D">file a bug</a>
if you want to use Glean.js and is missing some key Glean feature.</p>
</blockquote>
<h2><a class="header" href="#sections" id="sections">Sections</a></h2>
<h3><a class="header" href="#a-hrefuseradding-glean-to-your-projecthtmluser-guidesa" id="a-hrefuseradding-glean-to-your-projecthtmluser-guidesa"><a href="./user/adding-glean-to-your-project.html">User Guides</a></a></h3>
<p>This section of the book contains mostly step-by-step guides and essays detailing how to
achieve specific tasks with Glean.</p>
<p>It contains guides on the first steps of integrating Glean into your project,
choosing the right metric type for you, debugging products that use Glean and
Glean's built-in error reporting mechanism.</p>
<p>If you want to start using Glean to report data, this is the section you should read.</p>
<h3><a class="header" href="#a-hrefreferenceyamlindexhtmlapi-referencea" id="a-hrefreferenceyamlindexhtmlapi-referencea"><a href="./reference/yaml/index.html">API Reference</a></a></h3>
<p>This section of the book contains reference pages for Glean’s user facing APIs.</p>
<p>If you are looking for information a specific Glean API, this is the section you should check out.</p>
<h3><a class="header" href="#a-hreflanguage-bindingsandroidindexhtmllanguage-binding-informationa" id="a-hreflanguage-bindingsandroidindexhtmllanguage-binding-informationa"><a href="./language-bindings/android/index.html">Language Binding Information</a></a></h3>
<p>This section contains guides and essays regarding specific usage information
and possibilities in each of Glean's language bindings.</p>
<p>Check out this section for information on the language binding you are using.</p>
<h3><a class="header" href="#appendix" id="appendix">Appendix</a></h3>
<h4><a class="header" href="#a-hrefappendixglossaryhtmlglossarya" id="a-hrefappendixglossaryhtmlglossarya"><a href="./appendix/glossary.html">Glossary</a></a></h4>
<p>In this book we use a lot of Glean specific terminology. In the glossary, we go through
many of the terms used throughout this book and describe exactly what we mean when we use them.</p>
<h4><a class="header" href="#a-hrefappendixchangeloghtmlchangeloga" id="a-hrefappendixchangeloghtmlchangeloga"><a href="./appendix/changelog.html">Changelog</a></a></h4>
<p>This section contains detailed notes about changes in Glean, per release.</p>
<h4><a class="header" href="#a-hrefappendixtwightmlthis-week-in-gleana" id="a-hrefappendixtwightmlthis-week-in-gleana"><a href="./appendix/twig.html">This Week in Glean</a></a></h4>
<p>“This Week in Glean” is a series of blog posts that the Glean Team at Mozilla is using to try
to communicate better about our work. They could be release notes, documentation, hopes, dreams,
or whatever: so long as it is inspired by Glean.</p>
<h2><a class="header" href="#contact" id="contact">Contact</a></h2>
<p>To contact the Glean team you can:</p>
<ul>
<li>Find us in the <a href="https://chat.mozilla.org/#/room/#glean:mozilla.org">#glean channel on chat.mozilla.org</a>.</li>
<li>Send an email to <em>glean-team@mozilla.com</em>.</li>
<li>The Glean SDK team is: <em>:janerik</em>, <em>:dexter</em>, <em>:travis</em>, <em>:mdroettboom</em>, <em>:gfritzsche</em>, <em>:chutten</em>, <em>:brizental</em>.</li>
</ul>
<h2><a class="header" href="#license" id="license">License</a></h2>
<p>Glean.js and the Glean SDK Source Code is subject to the terms of the Mozilla Public License v2.0.
You can obtain a copy of the MPL at <a href="https://mozilla.org/MPL/2.0/">https://mozilla.org/MPL/2.0/</a>.</p>
<h1><a class="header" href="#adding-glean-to-your-project" id="adding-glean-to-your-project">Adding Glean to your project</a></h1>
<h2><a class="header" href="#glean-integration-checklist" id="glean-integration-checklist">Glean integration checklist</a></h2>
<p>The Glean integration checklist can help to ensure your Glean SDK-using product is meeting all of the recommended guidelines.</p>
<p>Products (applications or libraries) using the Glean SDK to collect telemetry <strong>must</strong>:</p>
<ol>
<li>
<p><a href="user/adding-glean-to-your-project.html#integrating-with-your-project">Integrate the Glean SDK into the build system</a>. Since the Glean SDK does some code generation for your metrics at build time, this requires a few more steps than just adding a library.</p>
</li>
<li>
<p>Include the markdown-formatted documentation generated from the <code>metrics.yaml</code> and <code>pings.yaml</code> files in the project's documentation.</p>
</li>
<li>
<p>Go through <a href="https://wiki.mozilla.org/Firefox/Data_Collection">data review process</a> for all newly collected data.</p>
</li>
<li>
<p>Ensure that telemetry coming from automated testing or continuous integration is either not sent to the telemetry server or <a href="user/debugging/index.html#available-debugging-features">tagged with the <code>automation</code> tag using the <code>sourceTag</code> feature</a>.</p>
</li>
<li>
<p><a href="https://bugzilla.mozilla.org/enter_bug.cgi?assigned_to=nobody%40mozilla.org&amp;bug_ignored=0&amp;bug_severity=--&amp;bug_status=NEW&amp;bug_type=task&amp;cf_fx_iteration=---&amp;cf_fx_points=---&amp;comment=Application%20friendly%20name%3A%20my_app_name%0D%0AApplication%20ID%3A%20org.mozilla.my_app_id%0D%0ADescription%3A%20Brief%20description%20of%20your%20application%0D%0AGit%20Repository%20URL%3A%20https%3A%2F%2Fgithub.com%2Fmozilla%2Fmy_app_name%0D%0ALocations%20of%20%60metrics.yaml%60%20files%20%28can%20be%20many%29%3A%0D%0A%20%20-%20src%2Fmetrics.yaml%0D%0ALocations%20of%20%60pings.yaml%60%20files%20%28can%20be%20many%29%3A%0D%0A%20-%20src%2Fpings.yaml%0D%0ADependencies%2A%3A%0D%0A%20-%20org.mozilla.components%3Aservice-glean%0D%0ARetention%20Days%3A%20N%2A%2A%0D%0A%0D%0A%0D%0A%2A%20Dependencies%20can%20be%20found%20%5Bin%20the%20Glean%20repositories%5D%28https%3A%2F%2Fprobeinfo.telemetry.mozilla.org%2Fglean%2Frepositories%29.%20Each%20dependency%20must%20be%20listed%20explicitly.%20For%20example%2C%20the%20default%20Glean%20probes%20will%20only%20be%20included%20if%20glean%20itself%20is%20a%20dependency.%0D%0A%0D%0A%2A%2A%20Number%20of%20days%20that%20raw%20data%20will%20be%20retained.%20A%20good%20default%20is%20180.%0D%0A%0D%0AIf%20you%20need%20new%20dependencies%2C%20please%20file%20new%20bugs%20for%20them%2C%20separately%20from%20this%20one.%20For%20any%20questions%2C%20ask%20in%20the%20%23glean%20channel.&amp;component=General&amp;contenttypemethod=list&amp;contenttypeselection=text%2Fplain&amp;defined_groups=1&amp;filed_via=standard_form&amp;flag_type-4=X&amp;flag_type-607=X&amp;flag_type-800=X&amp;flag_type-803=X&amp;flag_type-936=X&amp;form_name=enter_bug&amp;maketemplate=Remember%20values%20as%20bookmarkable%20template&amp;needinfo_from=fbertsch%40mozilla.com%2C%20&amp;op_sys=Unspecified&amp;priority=--&amp;product=Data%20Platform%20and%20Tools&amp;rep_platform=Unspecified&amp;short_desc=Enable%20new%20Glean%20App%20my_app_name&amp;target_milestone=---&amp;version=unspecified">File a data engineering bug</a> to enable your product's application id.</p>
</li>
</ol>
<p>Additionally, applications (but not libraries) <strong>must</strong>:</p>
<ol start="6">
<li>Provide a way for users to turn data collection off (e.g. providing settings to control <code>Glean.setUploadEnabled()</code>). The exact method used is application-specific.</li>
</ol>
<h2><a class="header" href="#usage" id="usage">Usage</a></h2>
<h3><a class="header" href="#integrating-with-your-project" id="integrating-with-your-project">Integrating with your project</a></h3>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<h4><a class="header" href="#setting-up-the-dependency" id="setting-up-the-dependency">Setting up the dependency</a></h4>
<p>The Glean SDK is published on <a href="https://maven.mozilla.org/">maven.mozilla.org</a>.
To use it, you need to add the following to your project's top-level build file,
in the <code>allprojects</code> block (see e.g. <a href="https://github.com/mozilla/glean/blob/main/build.gradle">Glean SDK's own <code>build.gradle</code></a>):</p>
<pre><code class="language-Groovy">repositories {
    maven {
       url &quot;https://maven.mozilla.org/maven2&quot;
    }
}
</code></pre>
<p>Each module that uses Glean SDK needs to specify it in its build file, in the <code>dependencies</code> block.
Add this to your Gradle configuration:</p>
<pre><code class="language-Groovy">implementation &quot;org.mozilla.components:service-glean:{latest-version}&quot;
</code></pre>
<blockquote>
<p><strong>Important:</strong> the <code>{latest-version}</code> placeholder in the above link should be replaced with the version of Android Components used by the project.</p>
</blockquote>
<p>The Glean SDK is released as part of <a href="https://github.com/mozilla-mobile/android-components">android-components</a>.  Therefore, it follows android-components' versions.
The <a href="https://github.com/mozilla-mobile/android-components/releases/">android-components release page</a> can be used to determine the latest version.</p>
<p>For example, if version <em>33.0.0</em> is used, then the include directive becomes:</p>
<pre><code class="language-Groovy">implementation &quot;org.mozilla.components:service-glean:33.0.0&quot;
</code></pre>
<blockquote>
<p><strong>Size impact on the application APK</strong>: the Glean SDK APK ships binary libraries for all the supported platforms. Each library file measures about 600KB. If the final APK size of the consuming project is a concern, please enable <a href="https://developer.android.com/studio/build/configure-apk-splits#configure-abi-split">ABI splits</a>.</p>
</blockquote>
</div>
<div data-lang="Swift" class="tab">
<h4><a class="header" href="#requirements" id="requirements">Requirements</a></h4>
<ul>
<li>Python &gt;= 3.6.</li>
</ul>
<h4><a class="header" href="#setting-up-the-dependency-1" id="setting-up-the-dependency-1">Setting up the dependency</a></h4>
<p>The Glean SDK can be consumed through <a href="https://github.com/Carthage/Carthage">Carthage</a>, a dependency manager for macOS and iOS.
For consuming the latest version of the Glean SDK, add the following line to your <code>Cartfile</code>:</p>
<pre><code>github &quot;mozilla/glean&quot; &quot;{latest-version}&quot;
</code></pre>
<blockquote>
<p><strong>Important:</strong> the <code>{latest-version}</code> placeholder should be replaced with the version number of the latest Glean SDK release.
You can find the version number on the <a href="https://github.com/mozilla/glean/releases/latest">release page</a>.</p>
</blockquote>
<p>Then check out and build the new dependency:</p>
<pre><code>carthage update --platform iOS
</code></pre>
<h4><a class="header" href="#integrating-with-the-build-system" id="integrating-with-the-build-system">Integrating with the build system</a></h4>
<p>For integration with the build system you can follow the <a href="https://github.com/Carthage/Carthage#quick-start">Carthage Quick Start steps</a>.</p>
<ol>
<li>
<p>After building the dependency one drag the built <code>.framework</code> binaries from <code>Carthage/Build/iOS</code> into your application's Xcode project.</p>
</li>
<li>
<p>On your application targets' Build Phases settings tab, click the <code>+</code> icon and choose <code>New Run Script Phase</code>.
If you already use Carthage for other dependencies, extend the existing step.
Create a Run Script in which you specify your shell (ex: <code>/bin/sh</code>), add the following contents to the script area below the shell:</p>
<pre><code>/usr/local/bin/carthage copy-frameworks
</code></pre>
</li>
<li>
<p>Add the path to the Glean framework under &quot;Input Files&quot;:</p>
<pre><code>$(SRCROOT)/Carthage/Build/iOS/Glean.framework
</code></pre>
</li>
<li>
<p>Add the paths to the copied framework to the &quot;Output Files&quot;:</p>
<pre><code>$(BUILT_PRODUCTS_DIR)/$(FRAMEWORKS_FOLDER_PATH)/Glean.framework
</code></pre>
</li>
</ol>
<h4><a class="header" href="#combined-usage-with-application-services" id="combined-usage-with-application-services">Combined usage with application-services</a></h4>
<p>If your application uses both the Glean SDK and <a href="https://github.com/mozilla/application-services">application-services</a>
you can use a combined release to reduce the memory usage and startup time impact.</p>
<p>In your <code>Cartfile</code> require only <code>application-services</code>, e.g.:</p>
<pre><code>github &quot;mozilla/application-services&quot; ~&gt; &quot;{latest-version}&quot;
</code></pre>
<blockquote>
<p><strong>Important:</strong> the <code>{latest-version}</code> placeholder should be replaced with the version number of the latest application-services release.
You can find the version number on the <a href="https://github.com/mozilla/application-services/releases/latest">release page</a>.</p>
</blockquote>
<p>Then check out and build the new dependency:</p>
<pre><code>carthage update --platform iOS
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>We recommend using a virtual environment for your work to isolate the dependencies for your project. There are many popular abstractions on top of virtual environments in the Python ecosystem which can help manage your project dependencies.</p>
<p>The Glean SDK Python bindings currently have <a href="https://pypi.org/project/glean-sdk/#files">prebuilt wheels on PyPI for Windows (i686 and x86_64), Linux/glibc (x86_64) and macOS (x86_64)</a>.
For other platforms, including *BSD or Linux distributions that don't use glibc, such as Alpine Linux, the <code>glean_sdk</code> package will be built from source on your machine.
This requires that Cargo and Rust are already installed.
The easiest way to do this is through <a href="https://rustup.rs/">rustup</a>.</p>
<p>Once you have your virtual environment set up and activated, you can install the Glean SDK into it using:</p>
<pre><code class="language-bash">$ python -m pip install glean_sdk
</code></pre>
<p>The Glean SDK Python bindings make extensive use of type annotations to catch type related errors at build time. We highly recommend adding <a href="https://mypy-lang.org">mypy</a> to your continuous integration workflow to catch errors related to type mismatches early.</p>
</div>
<div data-lang="C#" class="tab">
<p>TODO. To be implemented in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1643568">bug 1643568</a>.</p>
</div>
</div>
</div>
<h3><a class="header" href="#adding-new-metrics" id="adding-new-metrics">Adding new metrics</a></h3>
<p>All metrics that your project collects must be defined in a <code>metrics.yaml</code> file.</p>
<p>To learn more, see <a href="user/adding-new-metrics.html">adding new metrics</a>.
See the <a href="user/metric-parameters.html">metric parameters</a> documentation which provides reference information about the contents of that file.</p>
<blockquote>
<p><strong>Important</strong>: as stated <a href="user/adding-glean-to-your-project.html#glean-integration-checklist">before</a>, any new data collection requires documentation and data-review.
This is also required for any new metric automatically collected by the Glean SDK.</p>
</blockquote>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>In order for the Glean SDK to generate an API for your metrics, two Gradle plugins must be included in your build:</p>
<ul>
<li>The <a href="https://github.com/mozilla/glean/tree/main/gradle-plugin/">Glean Gradle plugin</a></li>
<li>JetBrains' <a href="https://github.com/JetBrains/gradle-python-envs/">Python envs plugin</a></li>
</ul>
<p>The Glean Gradle plugin is distributed through Mozilla's Maven, so we need to tell your build where to look for it by adding the following to the top of your <code>build.gradle</code>:</p>
<pre><code>buildscript {
    repositories {
        // Include the next clause if you are tracking snapshots of android components
        maven {
            url &quot;https://snapshots.maven.mozilla.org/maven2&quot;
        }
        maven {
            url &quot;https://maven.mozilla.org/maven2&quot;
        }

        dependencies {
            classpath &quot;org.mozilla.components:tooling-glean-gradle:{android-components-version}&quot;
        }
    }
}
</code></pre>
<blockquote>
<p><strong>Important:</strong> as above, the <code>{android-components-version}</code> placeholder in the above link should be replaced with the version number of android components used in your project.</p>
</blockquote>
<p>The JetBrains Python plugin is distributed in the Gradle plugin repository, so it can be included with:</p>
<pre><code class="language-Groovy">plugins {
    id &quot;com.jetbrains.python.envs&quot; version &quot;0.0.26&quot;
}
</code></pre>
<p>Right before the end of the same file, we need to apply the Glean Gradle plugin.
Set any <a href="user/android/android-build-configuration-options.html">additional parameters</a> to control the behavior of the Glean Gradle plugin before calling <code>apply plugin</code>.</p>
<pre><code class="language-Groovy">// Optionally, set any parameters to send to the plugin.
ext.gleanGenerateMarkdownDocs = true
apply plugin: &quot;org.mozilla.telemetry.glean-gradle-plugin&quot;
</code></pre>
<blockquote>
<p><strong>Note:</strong> Earlier versions of Glean used a Gradle script (<code>sdk_generator.gradle</code>) rather than a Gradle plugin. Its use is deprecated and projects should be updated to use the Gradle plugin as described above.</p>
</blockquote>
<blockquote>
<p><strong>Note:</strong> The Glean Gradle plugin has limited support for <a href="user/android/android-offline-builds.html">offline builds</a> of applications that use the Glean SDK.</p>
</blockquote>
</div>
<div data-lang="Swift" class="tab">
<p>The <code>metrics.yaml</code> file is parsed at build time and Swift code is generated.
Add a new <code>metrics.yaml</code> file to your Xcode project.</p>
<p>Follow these steps to automatically run the parser at build time:</p>
<ol>
<li>
<p>Download the <code>sdk_generator.sh</code> script from the Glean repository:</p>
<pre><code>https://raw.githubusercontent.com/mozilla/glean/{latest-release}/glean-core/ios/sdk_generator.sh
</code></pre>
<blockquote>
<p><strong>Important:</strong> as above, the <code>{latest-version}</code> placeholder should be replaced with the version number of Glean SDK release used in this project.</p>
</blockquote>
</li>
<li>
<p>Add the <code>sdk_generator.sh</code> file to your Xcode project.</p>
</li>
<li>
<p>On your application targets' Build Phases settings tab, click the <code>+</code> icon and choose <code>New Run Script Phase</code>.
Create a Run Script in which you specify your shell (ex: <code>/bin/sh</code>), add the following contents to the script area below the shell:</p>
<pre><code>bash $PWD/sdk_generator.sh
</code></pre>
<blockquote>
<p><strong>Note:</strong> If you are using the combined release of application-services and the Glean SDK you need to set the namespace to <code>MozillaAppServices</code>, e.g.:</p>
<pre><code>bash $PWD/sdk_generator.sh --glean-namespace MozillaAppServices
</code></pre>
</blockquote>
</li>
<li>
<p>Add the path to your <code>metrics.yaml</code> and (optionally) <code>pings.yaml</code> under &quot;Input files&quot;:</p>
<pre><code>$(SRCROOT)/{project-name}/metrics.yaml
$(SRCROOT)/{project-name}/pings.yaml
</code></pre>
</li>
<li>
<p>Add the path to the generated code file to the &quot;Output Files&quot;:</p>
<pre><code>$(SRCROOT)/{project-name}/Generated/Metrics.swift
</code></pre>
<blockquote>
<p><strong>Important</strong>: The parser now generates a single file called <code>Metrics.swift</code> (since Glean v31.0.0).</p>
</blockquote>
</li>
<li>
<p>If you are using Git, add the following lines to your <code>.gitignore</code> file:</p>
<pre><code>.venv/
{project-name}/Generated
</code></pre>
<p>This will ignore files that are generated at build time by the <code>sdk_generator.sh</code> script.
They don't need to be kept in version control, as they can be re-generated from your <code>metrics.yaml</code> and <code>pings.yaml</code> files.</p>
</li>
</ol>
<blockquote>
<p><strong>Important information about Glean and embedded extensions:</strong> Metric collection is a no-op in <a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/ExtensionOverview.html#//apple_ref/doc/uid/TP40014214-CH2-SW2">application extensions</a> and Glean will not run. Since extensions run in a separate sandbox and process from the application, Glean would run in an extension as if it were a completely separate application with different client ids and storage. This complicates things because Glean doesn’t know or care about other processes. Because of this, Glean is purposefully prevented from running in an application extension and if metrics need to be collected from extensions, it's up to the integrating application to pass the information to the base application to record in Glean.</p>
</blockquote>
</div>
<div data-lang="Python" class="tab">
<p>For Python, the <code>metrics.yaml</code> file must be available and loaded at runtime.</p>
<p>If your project is a script (i.e. just Python files in a directory), you can load the <code>metrics.yaml</code> using:</p>
<pre><code class="language-Python">from glean import load_metrics

metrics = load_metrics(&quot;metrics.yaml&quot;)

# Use a metric on the returned object
metrics.your_category.your_metric.set(&quot;value&quot;)
</code></pre>
<p>If your project is a distributable Python package, you need to include the <code>metrics.yaml</code> file using <a href="https://setuptools.readthedocs.io/en/latest/setuptools.html#including-data-files">one of the myriad ways to include data in a Python package</a> and then use <a href="https://setuptools.readthedocs.io/en/latest/pkg_resources.html#resource-extraction"><code>pkg_resources.resource_filename()</code></a> to get the filename at runtime.</p>
<pre><code class="language-Python">from glean import load_metrics
from pkg_resources import resource_filename

metrics = load_metrics(resource_filename(__name__, &quot;metrics.yaml&quot;))

# Use a metric on the returned object
metrics.your_category.your_metric.set(&quot;value&quot;)
</code></pre>
<h3><a class="header" href="#automation-steps" id="automation-steps">Automation steps</a></h3>
<h4><a class="header" href="#documentation" id="documentation">Documentation</a></h4>
<p>The documentation for your application or library's metrics and pings are written in <code>metrics.yaml</code> and <code>pings.yaml</code>. However, you should also provide human-readable markdown files based on this information, and this is a requirement for Mozilla projects using the Glean SDK. For other languages and platforms, this transformation is done automatically as part of the build. However, for Python the integration to automatically generate docs is an additional step.</p>
<p>The Glean SDK provides a commandline tool for automatically generating markdown documentation from your <code>metrics.yaml</code> and <code>pings.yaml</code> files. To perform that translation, run <code>glean_parser</code>'s <code>translate</code> command:</p>
<pre><code class="language-sh">python3 -m glean_parser translate -f markdown -o docs metrics.yaml pings.yaml
</code></pre>
<p>To get more help about the commandline options:</p>
<pre><code class="language-sh">python3 -m glean_parser translate --help
</code></pre>
<p>We recommend integrating this step into your project's documentation build. The details of that integration is left to you, since it depends on the documentation tool being used and how your project is set up.</p>
<h4><a class="header" href="#metrics-linting" id="metrics-linting">Metrics linting</a></h4>
<p>Glean includes a &quot;linter&quot; for <code>metrics.yaml</code> and <code>pings.yaml</code> files called the <code>glinter</code> that catches a number of common mistakes in these files.</p>
<p>As part of your continuous integration, you should run the following on your <code>metrics.yaml</code> and <code>pings.yaml</code> files:</p>
<pre><code class="language-sh">python3 -m glean_parser glinter metrics.yaml pings.yaml
</code></pre>
</div>
<div data-lang="C#" class="tab">
<p>A new build target needs to be added to the project <code>csproj</code> file in order to generate the metrics and pings APIs from the registry files (e.g. <code>metrics.yaml</code>, <code>pings.yaml</code>).</p>
<pre><code class="language-xml">&lt;Project&gt;
  &lt;!-- ... other directives ... --&gt;

  &lt;Target Name=&quot;GleanIntegration&quot; BeforeTargets=&quot;CoreCompile&quot;&gt;
    &lt;ItemGroup&gt;
      &lt;!--
        Note that the two files are not required: Glean will work just fine
        with just the 'metrics.yaml'. A 'pings.yaml' is only required if custom
        pings are defined.
        Please also note that more than one metrics file can be added.
      --&gt;
      &lt;GleanRegistryFiles Include=&quot;metrics.yaml&quot; /&gt;
      &lt;GleanRegistryFiles Include=&quot;pings.yaml&quot; /&gt;
    &lt;/ItemGroup&gt;
    &lt;!-- This is what actually runs the parser. --&gt;
    &lt;GleanParser RegistryFiles=&quot;@(GleanRegistryFiles)&quot; OutputPath=&quot;$(IntermediateOutputPath)Glean&quot; Namespace=&quot;csharp.GleanMetrics&quot; /&gt;

    &lt;!--
      And this adds the generated files to the project, so that they can be found by
      the compiler and Intellisense.
    --&gt;
    &lt;ItemGroup&gt;
      &lt;Compile Include=&quot;$(IntermediateOutputPath)Glean\**\*.cs&quot; /&gt;
    &lt;/ItemGroup&gt;
  &lt;/Target&gt;
&lt;/Project&gt;
</code></pre>
<p>This is using the Python 3 interpreter found in <code>PATH</code> under the hood. The <code>GLEAN_PYTHON</code> environment variable can be used to provide the location of the Python 3 interpreter.</p>
</div>
</div>
</div>
<h3><a class="header" href="#adding-custom-pings" id="adding-custom-pings">Adding custom pings</a></h3>
<p>Please refer to the <a href="user/pings/custom.html">custom pings documentation</a>.</p>
<blockquote>
<p><strong>Important</strong>: as stated <a href="user/adding-glean-to-your-project.html#glean-integration-checklist">before</a>, any new data collection requires documentation and data-review.
This is also required for any new metric automatically collected by the Glean SDK.</p>
</blockquote>
<h3><a class="header" href="#parallelism" id="parallelism">Parallelism</a></h3>
<p>All of the Glean SDK's target languages use a separate worker thread to do most of its work, including any I/O. This thread is fully managed by the Glean SDK as an implementation detail. Therefore, users should feel free to use the Glean SDK wherever it is most convenient, without worrying about the performance impact of updating metrics and sending pings.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Python" class="tab">
Since the Glean SDK performs disk and networking I/O, it tries to do as much of its work as possible on separate threads and processes.
Since there are complex trade-offs and corner cases to support Python parallelism, it is hard to design a one-size-fits-all approach.
<h4><a class="header" href="#default-behavior" id="default-behavior">Default behavior</a></h4>
<p>When using the Python bindings, most of the Glean SDK's work is done on a separate thread, managed by the Glean SDK itself.
The Glean SDK releases the Global Interpreter Lock (GIL) for most of its operations, therefore your application's threads should not be in contention with the Glean SDK's worker thread.</p>
<p>The Glean SDK installs an <a href="https://docs.python.org/3/library/atexit.html"><code>atexit</code> handler</a> so that its worker thread can cleanly finish when your application exits.
This handler will wait up to 30 seconds for any pending work to complete.</p>
<p>By default, ping uploading is performed in a separate child process. This process will continue to upload any pending pings even after the main process shuts down. This is important for commandline tools where you want to return control to the shell as soon as possible and not be delayed by network connectivity.</p>
<h4><a class="header" href="#cases-where-subprocesses-arent-possible" id="cases-where-subprocesses-arent-possible">Cases where subprocesses aren't possible</a></h4>
<p>The default approach may not work with applications built using <a href="https://www.pyinstaller.org/"><code>PyInstaller</code></a> or similar tools which bundle an application together with a Python interpreter making it impossible to spawn new subprocesses of that interpreter. For these cases, there is an option to ensure that ping uploading occurs in the main process. To do this, set the <code>allow_multiprocessing</code> parameter on the <code>glean.Configuration</code> object to <code>False</code>.</p>
<h4><a class="header" href="#using-the-multiprocessing-module" id="using-the-multiprocessing-module">Using the <code>multiprocessing</code> module</a></h4>
<p>Additionally, the default approach does not work if your application uses the <code>multiprocessing</code> module for parallelism.
The Glean SDK can not wait to finish its work in a <code>multiprocessing</code> subprocess, since <code>atexit</code> handlers are not supported in that context.<br />
Therefore, if the Glean SDK detects that it is running in a <code>multiprocessing</code> subprocess, all of its work that would normally run on a worker thread will run on the main thread.
In practice, this should not be a performance issue: since the work is already in a subprocess, it will not block the main process of your application.</p>
</div>
</div>
</div>
<h3><a class="header" href="#testing-metrics" id="testing-metrics">Testing metrics</a></h3>
<p>In order to make testing metrics easier 'out of the box', all metrics include a set of test API functions in order to facilitate unit testing.  These include functions to test whether a value has been stored, and functions to retrieve the stored value for validation.  For more information, please refer to <a href="user/testing-metrics.html">Unit testing Glean metrics</a>.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/adding-glean-to-your-project.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#adding-new-metrics-1" id="adding-new-metrics-1">Adding new metrics</a></h1>
<h2><a class="header" href="#table-of-contents" id="table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#process-overview">Process overview</a></li>
<li><a href="user/metrics/adding-new-metrics.html#choosing-a-metric-type">Choosing a metric type</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#is-it-a-single-measurement">Is it a single measurement?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#are-you-counting-things">Are you counting things?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#are-you-measuring-time">Are you measuring time?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#do-you-need-to-know-the-order-of-events-relative-to-other-events">Do you need to know the order of events relative to other events?</a></li>
</ul>
</li>
<li><a href="user/metrics/adding-new-metrics.html#for-how-long-do-you-need-to-collect-this-data">For how long do you need to collect this data?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#when-should-the-glean-sdk-automatically-clear-the-measurement">When should the Glean SDK automatically clear the measurement?</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#a-lifetime-example">A lifetime example</a></li>
<li><a href="user/metrics/adding-new-metrics.html#what-if-none-of-these-lifetimes-are-appropriate">What if none of these lifetimes are appropriate?</a></li>
</ul>
</li>
<li><a href="user/metrics/adding-new-metrics.html#what-should-this-new-metric-be-called">What should this new metric be called?</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#reuse-names-from-other-applications">Reuse names from other applications</a></li>
<li><a href="user/metrics/adding-new-metrics.html#make-names-unique-within-an-application">Make names unique within an application</a></li>
<li><a href="user/metrics/adding-new-metrics.html#be-as-specific-as-possible">Be as specific as possible</a></li>
</ul>
</li>
<li><a href="user/metrics/adding-new-metrics.html#what-if-none-of-these-metric-types-is-the-right-fit">What if none of these metric types is the right fit?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#how-do-i-make-sure-my-metric-is-working">How do I make sure my metric is working?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#adding-the-metric-to-the-metricsyaml-file">Adding the metric to the <code>metrics.yaml</code> file</a></li>
<li><a href="user/metrics/adding-new-metrics.html#using-the-metric-from-your-code">Using the metric from your code</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#capitalization">Capitalization</a></li>
</ul>
</li>
</ul>
<h2><a class="header" href="#process-overview" id="process-overview">Process overview</a></h2>
<p>When adding a new metric, the process is:</p>
<ul>
<li>Consider the question you are trying to answer with this data, and choose the <a href="user/metrics/../../reference/metrics/index.html">metric type</a> and parameters to use.</li>
<li>Add a new entry to <a href="user/metrics/adding-new-metrics.html#adding-the-metric-to-the-metricsyaml-file"><code>metrics.yaml</code></a>.</li>
<li>Add code to your project to record into the metric by calling the Glean SDK.</li>
</ul>
<blockquote>
<p><strong>Important</strong>: Any new data collection requires documentation and <a href="https://wiki.mozilla.org/Firefox/Data_Collection">data-review</a>. This is also required for any new metric automatically collected by the Glean SDK.</p>
</blockquote>
<h2><a class="header" href="#choosing-a-metric-type" id="choosing-a-metric-type">Choosing a metric type</a></h2>
<p>The following is a set of questions to ask about the data being collected to help better determine which metric type to use.</p>
<h3><a class="header" href="#is-it-a-single-measurement" id="is-it-a-single-measurement">Is it a single measurement?</a></h3>
<p>If the value is true or false, use a <a href="user/metrics/../../reference/metrics/boolean.html">boolean metric</a>.</p>
<p>If the value is a string, use a <a href="user/metrics/../../reference/metrics/string.html">string metric</a>. For example, to record the name of the default search engine.</p>
<blockquote>
<p><strong>Beware:</strong> string metrics are exceedingly general, and you are probably best served by selecting the most specific metric for the job, since you'll get better error checking and richer analysis tools for free. For example, avoid storing a number in a string metric --- you probably want a [counter metric]../..(/reference/metrics/counter.html) instead.</p>
</blockquote>
<p>If you need to store multiple string values in a metric, use a <a href="user/metrics/../../reference/metrics/string_list.html">string list metric</a>. For example, you may want to record the list of other Mozilla products installed on the device.</p>
<!-- TODO: If you do know the list of values you might store and you just want to record their presence, consider using a [labeled boolean](../../reference/metrics/labeled_boolean.html) instead. -->
<!-- If you have a related set of metrics that you want to record strings for, and you don't know the things the strings relate to at build time, use a [labeled string metric](../../reference/metrics/labeled_strings.html). -->
<p>For all of the metric types in this section that measure single values, it is especially important to consider how the lifetime of the value relates to the ping it is being sent in. Since these metrics don't perform any aggregation on the client side, when a ping containing the metric is submitted, it will contain only the &quot;last known&quot; value for the metric, potentially resulting in <strong>data loss</strong>.  There is further discussion of <a href="user/metrics/adding-new-metrics.html#when-should-the-glean-sdk-automatically-clear-the-measurement">metric lifetimes</a> below.</p>
<h3><a class="header" href="#are-you-counting-things" id="are-you-counting-things">Are you counting things?</a></h3>
<p>If you want to know how many times something happened, use a <a href="user/metrics/../../reference/metrics/counter.html">counter metric</a>.  If you are counting a group of related things, or you don't know what all of the things to count are at build time, use a <a href="user/metrics/../../reference/metrics/labeled_counters.html">labeled counter metric</a>.</p>
<p>If you need to know how many times something happened relative to the number of times something else happened,
use a <a href="user/metrics/../../reference/metrics/rate.html">rate metric</a>.</p>
<p>If you need to know when the things being counted happened relative to other things, consider using an <a href="user/metrics/../../reference/metrics/event.html">event</a>.</p>
<h3><a class="header" href="#are-you-measuring-time" id="are-you-measuring-time">Are you measuring time?</a></h3>
<p>If you need to record an absolute time, use a <a href="user/metrics/../../reference/metrics/datetime.html">datetime metric</a>. Datetimes are recorded in the user's local time, according to their device's real time clock, along with a timezone offset from UTC. Datetime metrics allow specifying the resolution they are collected at, and to stay <a href="https://www.mozilla.org/en-US/about/policy/lean-data/stay-lean/">lean</a>, they should only be collected at the minimum resolution required to answer your question.</p>
<p>If you need to record how long something takes you have a few options.</p>
<p>If you need to measure the total time spent doing a particular task, look to the <a href="user/metrics/../../reference/metrics/timespan.html">timespan metric</a>. Timespan metrics allow specifying the resolution they are collected at, and to stay <a href="https://www.mozilla.org/en-US/about/policy/lean-data/stay-lean/">lean</a>, they should only be collected at the minimum resolution required to answer your question.
Note that this metric should only be used to measure time on a single thread. If multiple overlapping timespans are measured for the same metric, an invalid state error is recorded.</p>
<p>If you need to measure the relative occurrences of many timings, use a <a href="user/metrics/../../reference/metrics/timing_distribution.html">timing distribution</a>. It builds a histogram of timing measurements, and is safe to record multiple concurrent timespans on different threads.</p>
<p>If you need to know the time between multiple distinct actions that aren't a simple &quot;begin&quot; and &quot;end&quot; pair, consider using an <a href="user/metrics/../../reference/metrics/event.html">event</a>.</p>
<h3><a class="header" href="#do-you-need-to-know-the-order-of-events-relative-to-other-events" id="do-you-need-to-know-the-order-of-events-relative-to-other-events">Do you need to know the order of events relative to other events?</a></h3>
<p>If you need to know the order of actions relative to other actions, such as, the user performed tasks A, B, and then C, and this is meaningfully different from the user performing tasks A, C and then B, (in other words, the order is meaningful beyond just the <em>fact</em> that a set of tasks were performed), use an <a href="user/metrics/../../reference/metrics/event.html">event metric</a>.</p>
<blockquote>
<p><strong>Important:</strong> events are the most expensive metric type to record, transmit, store and analyze, so they should be used sparingly, and only when none of the other metric types are sufficient for answering your question.</p>
</blockquote>
<h2><a class="header" href="#for-how-long-do-you-need-to-collect-this-data" id="for-how-long-do-you-need-to-collect-this-data">For how long do you need to collect this data?</a></h2>
<p>Think carefully about how long the metric will be needed, and set the <code>expires</code> parameter to disable the metric at the earliest possible time.
This is an important component of Mozilla's <a href="https://www.mozilla.org/en-US/about/policy/lean-data/stay-lean/">lean data practices</a>.</p>
<p>When the metric passes its expiration date (determined at build time), it will automatically stop collecting data.</p>
<p>When a metric's expiration is within in 14 days, emails will be sent from <code>telemetry-alerts@mozilla.com</code> to the <code>notification_emails</code> addresses associated with the metric.
At that time, the metric should be removed, which involves removing it from the <code>metrics.yaml</code> file and removing uses of it in the source code.
Removing a metric does not affect the availability of data already collected by the pipeline.</p>
<p>If the metric is still needed after its expiration date, it should go back for <a href="https://wiki.mozilla.org/Firefox/Data_Collection">another round of data review</a> to have its expiration date extended.</p>
<blockquote>
<p><strong>Important:</strong> Ensure that telemetry alerts are received and are reviewed in a timely manner. Expired metrics don't record any data, extending or removing a metric should be done in time. Consider adding both a group email address and an individual who is responsible for this metric to the <code>notification_emails</code> list.</p>
</blockquote>
<h2><a class="header" href="#when-should-the-glean-sdk-automatically-clear-the-measurement" id="when-should-the-glean-sdk-automatically-clear-the-measurement">When should the Glean SDK automatically clear the measurement?</a></h2>
<p>The <code>lifetime</code> parameter of a metric defines when its value will be cleared. There are three lifetime options available:</p>
<ul>
<li><code>ping</code> (default): The metric is cleared each time it is submitted in the ping. This is the most common case, and should be used for metrics that are highly dynamic, such as things computed in response to the user's interaction with the application.</li>
<li><code>application</code>: The metric is related to an application run, and is cleared after the application restarts and any Glean-owned ping, due at startup, is submitted. This should be used for things that are constant during the run of an application, such as the operating system version. In practice, these metrics are generally set during application startup. A common mistake---using the ping lifetime for these type of metrics---means that they will only be included in the first ping sent during a particular run of the application.</li>
<li><code>user</code>: <strong>Reach out to the Glean team before using this.</strong>. The metric is part of the user's profile and will live as long as the profile lives. This is often not the best choice unless the metric records a value that <em>really</em> needs to be persisted for the full lifetime of the user profile, e.g. an identifier like the <code>client_id</code>, the day the product was first executed. It is rare to use this lifetime outside of some metrics that are built in to the Glean SDK.</li>
</ul>
<p>While lifetimes are important to understand for all metric types, they are particularly important for the metric types that record single values and don't aggregate on the client (<code>boolean</code>, <code>string</code>, <code>labeled_string</code>, <code>string_list</code>, <code>datetime</code> and <code>uuid</code>), since these metrics will send the &quot;last known&quot; value and missing the earlier values could be a form of unintended data loss.</p>
<h3><a class="header" href="#a-lifetime-example" id="a-lifetime-example">A lifetime example</a></h3>
<p>Let's work through an example to see how these lifetimes play out in practice. Let's suppose we have a user preference, &quot;turbo mode&quot;, which defaults to <code>false</code>, but the user can turn it to <code>true</code> at any time.  We want to know when this flag is <code>true</code> so we can measure its affect on other metrics in the same ping.  In the following diagram, we look at a time period that sends 4 pings across two separate runs of the application. We assume here, that like the Glean SDK's built-in <a href="user/metrics/../pings/metrics.html">metrics ping</a>, the developer writing the metric isn't in control of when the ping is submitted.</p>
<p>In this diagram, the ping measurement windows are represented as rectangles, but the moment the ping is &quot;submitted&quot; is represented by its right edge. The user changes the &quot;turbo mode&quot; setting from <code>false</code> to <code>true</code> in the first run, and then toggles it again twice in the second run.</p>
<p><img src="user/metrics/metric-lifetime-timeline.svg" alt="Metric lifetime timeline" /></p>
<ul>
<li>
<p><strong>A. Ping lifetime, set on change</strong>: The value isn't included in Ping 1, because Glean doesn't know about it yet.  It is included in the first ping after being recorded (Ping 2), which causes it to be cleared.</p>
</li>
<li>
<p><strong>B. Ping lifetime, set on init and change</strong>: The default value is included in Ping 1, and the changed value is included in Ping 2, which causes it to be cleared.  It therefore misses Ping 3, but when the application is started, it is recorded again and it is included in Ping 4.  However, this causes it to be cleared again and it is not in Ping 5.</p>
</li>
<li>
<p><strong>C. Application lifetime, set on change</strong>: The value isn't included in Ping 1, because Glean doesn't know about it yet. After the value is changed, it is included in Pings 2 and 3, but then due to application restart it is cleared, so it is not included until the value is manually toggled again.</p>
</li>
<li>
<p><strong>D. Application, set on init and change</strong>: The default value is included in Ping 1, and the changed value is included in Pings 2 and 3. Even though the application startup causes it to be cleared, it is set again, and all subsequent pings also have the value.</p>
</li>
<li>
<p><strong>E. User, set on change</strong>: The default value is missing from Ping 1, but since <code>user</code> lifetime metrics aren't cleared unless the user profile is reset (e.g. on Android, when the product is uninstalled), it is included in all subsequent pings.</p>
</li>
<li>
<p><strong>F. User, set on init and change</strong>: Since <code>user</code> lifetime metrics aren't cleared unless the user profile is reset, it is included in all subsequent pings.  This would be true even if the &quot;turbo mode&quot; preference were never changed again.</p>
</li>
</ul>
<p>Note that for all of the metric configurations, the toggle of the preference off and on during Ping 4 is completely missed.  If you need to create a ping containing one, and only one, value for this metric, consider using a <a href="user/metrics/../pings/custom.html">custom ping</a> to create a ping whose lifetime matches the lifetime of the value.</p>
<h3><a class="header" href="#what-if-none-of-these-lifetimes-are-appropriate" id="what-if-none-of-these-lifetimes-are-appropriate">What if none of these lifetimes are appropriate?</a></h3>
<p>If the timing at which the metric is sent in the ping needs to closely match the timing of the metrics value, the best option is to use a <a href="user/metrics/../pings/custom.html">custom ping</a> to manually control when pings are sent.</p>
<p>This is especially useful when metrics need to be tightly related to one another, for example when you need to measure the distribution of frame paint times when a particular rendering backend is in use.  If these metrics were in different pings, with different measurement windows, it is much harder to do that kind of reasoning with much certainty.</p>
<h2><a class="header" href="#what-should-this-new-metric-be-called" id="what-should-this-new-metric-be-called">What should this new metric be called?</a></h2>
<p>Metric names have a maximum length of 30 characters.</p>
<h3><a class="header" href="#reuse-names-from-other-applications" id="reuse-names-from-other-applications">Reuse names from other applications</a></h3>
<p>There's a lot of value using the same name for analogous metrics collected across different products. For example, BigQuery makes it simple to join columns with the same name across multiple tables. Therefore, we encourage you to investigate if a similar metric is already being collected by another product. If it is, there may be an opportunity for code reuse across these products, and if all the projects are using the Glean SDK, it's easy for libraries to send their own metrics. If sharing the code doesn't make sense, at a minimum we recommend using the same metric name for similar actions and concepts whenever possible.</p>
<h3><a class="header" href="#make-names-unique-within-an-application" id="make-names-unique-within-an-application">Make names unique within an application</a></h3>
<p>Metric identifiers (the combination of a metric's category and name) must be unique across all metrics that are sent by a single application.
This includes not only the metrics defined in the app's <code>metrics.yaml</code>, but the <code>metrics.yaml</code> of any Glean SDK-using library that the application uses, including the Glean SDK itself.
Therefore, care should be taken to name things specifically enough so as to avoid namespace collisions.
In practice, this generally involves thinking carefully about the <code>category</code> of the metric, more than the <code>name</code>.</p>
<blockquote>
<p><strong>Note:</strong> Duplicate metric identifiers are not currently detected at build time. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1578383">bug 1578383</a> for progress on that.
However, the <a href="https://github.com/mozilla/probe-scraper">probe_scraper</a> process, which runs nightly, will detect duplicate metrics and e-mail the <code>notification_emails</code> associated with the given metrics.</p>
</blockquote>
<h3><a class="header" href="#be-as-specific-as-possible" id="be-as-specific-as-possible">Be as specific as possible</a></h3>
<p>More broadly, you should choose the names of metrics to be as specific as possible.
It is not necessary to put the type of the metric in the category or name, since this information is retained in other ways through the entire end-to-end system.</p>
<p>For example, if defining a set of events related to search, put them in a category called <code>search</code>, rather than just <code>events</code> or <code>search_events</code>. The <code>events</code> word here would be redundant.</p>
<h2><a class="header" href="#what-if-none-of-these-metric-types-is-the-right-fit" id="what-if-none-of-these-metric-types-is-the-right-fit">What if none of these metric types is the right fit?</a></h2>
<p>The current set of metrics the Glean SDK supports is based on known common use cases, but new use cases are discovered all the time.</p>
<p>Please reach out to us on <a href="https://chat.mozilla.org/#/room/#glean:mozilla.org">#glean:mozilla.org</a>. If you think you need a new metric type, we <a href="user/metrics/../../reference/metrics/index.html#adding-or-changing-metric-types">have a process for that</a>.</p>
<h2><a class="header" href="#how-do-i-make-sure-my-metric-is-working" id="how-do-i-make-sure-my-metric-is-working">How do I make sure my metric is working?</a></h2>
<p>The Glean SDK has rich support for writing unit tests involving metrics. Writing a good unit test is a large topic, but in general, you should write unit tests for all new telemetry that does the following:</p>
<ul>
<li>
<p>Performs the operation being measured.</p>
</li>
<li>
<p>Asserts that metrics contain the expected data, using the <code>testGetValue</code> API on the metric.</p>
</li>
<li>
<p>Where applicable, asserts that no errors are recorded, such as when values are out of range, using the <code>testGetNumRecordedErrors</code> API.</p>
</li>
</ul>
<p>In addition to unit tests, it is good practice to validate the incoming data for the new metric on a pre-release channel to make sure things are working as expected.</p>
<!--
TODO: This will be a good place to talk about the product telemetry health
dashboard when that's ready
-->
<h2><a class="header" href="#adding-the-metric-to-the-metricsyaml-file" id="adding-the-metric-to-the-metricsyaml-file">Adding the metric to the <code>metrics.yaml</code> file</a></h2>
<p>The <a href="https://mozilla.github.io/glean_parser/metrics-yaml.html"><code>metrics.yaml</code> file</a> defines the metrics your application or library will send.
They are organized into categories.
The overall organization is:</p>
<pre><code class="language-YAML"># Required to indicate this is a `metrics.yaml` file
$schema: moz://mozilla.org/schemas/glean/../../reference/metrics/2-0-0

toolbar:
  click:
    type: event
    description: |
      Event to record toolbar clicks.
    notification_emails:
      - CHANGE-ME@example.com
    bugs:
      - https://bugzilla.mozilla.org/123456789/
    data_reviews:
      - http://example.com/path/to/data-review
    expires: 2019-06-01  # &lt;-- Update to a date in the future

  double_click:
    ...
</code></pre>
<p>Categories can have <code>.</code> characters to provide extra structure, for example <code>category.subcategory</code>, as long as the total length doesn't exceed 40 characters.</p>
<p>Metric names have a maximum length of 30 characters.</p>
<p>The details of the metric parameters are described in <a href="user/metrics/../../reference/yaml/index.html">metric parameters</a>.</p>
<p>The <code>metrics.yaml</code> file is used to generate code in the target language (e.g. Kotlin, Swift, ...) that becomes the public API to access your application's metrics.</p>
<h2><a class="header" href="#using-the-metric-from-your-code" id="using-the-metric-from-your-code">Using the metric from your code</a></h2>
<p>The <a href="user/metrics/../../reference/metrics/index.html">reference documentation for each metric type</a> goes into detail about using each metric type from your code.</p>
<p>Note that all Glean metrics are write-only. Outside of unit tests, it is impossible to retrieve a value from the Glean SDK's database.
While this may seem limiting, this is required to:</p>
<ul>
<li>enforce the semantics of certain metric types (e.g. that Counters can only be incremented).</li>
<li>ensure the lifetime of the metric (when it is cleared or reset) is correctly handled.</li>
</ul>
<h3><a class="header" href="#capitalization" id="capitalization">Capitalization</a></h3>
<p>One thing to note is that we try to adhere to the coding conventions of each language wherever possible, to the metric name in the <code>metrics.yaml</code> (which is in <code>snake_case</code>) may be changed to some other case convention, such as <code>camelCase</code>, when used from code.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>Category and metric names in the <code>metrics.yaml</code> are in <code>snake_case</code>,
but given the Kotlin coding standards defined by <a href="https://github.com/pinterest/ktlint">ktlint</a>,
these identifiers must be <code>camelCase</code> in Kotlin.
For example, the metric defined in the <code>metrics.yaml</code> as:</p>
<pre><code class="language-YAML">views:
  login_opened:
    ...
</code></pre>
<p>is accessible in Kotlin as:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Views
GleanMetrics.Views.loginOpened...
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<p>Category and metric names in the <code>metrics.yaml</code> are in <code>snake_case</code>,
but given the Swift coding standards defined by <a href="https://github.com/realm/SwiftLint">swiftlint</a>,
these identifiers must be <code>camelCase</code> in Swift.
For example, the metric defined in the <code>metrics.yaml</code> as:</p>
<pre><code class="language-YAML">views:
  login_opened:
    ...
</code></pre>
<p>is accessible in Kotlin as:</p>
<pre><code class="language-Swift">GleanMetrics.Views.loginOpened...
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>Category and metric names in the <code>metrics.yaml</code> are in <code>snake_case</code>, which matches the <a href="https://www.python.org/dev/peps/pep-0008/">PEP8</a> standard, so no translation is needed for Python.</p>
</div>
<div data-lang="C#" class="tab">
<p>TODO. To be implemented in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1643568">this bug</a>.</p>
</div>
</div>
</div>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/metrics/adding-new-metrics.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#adding-new-metrics-2" id="adding-new-metrics-2">Adding new metrics</a></h1>
<h2><a class="header" href="#table-of-contents-1" id="table-of-contents-1">Table of Contents</a></h2>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#process-overview">Process overview</a></li>
<li><a href="user/metrics/adding-new-metrics.html#choosing-a-metric-type">Choosing a metric type</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#is-it-a-single-measurement">Is it a single measurement?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#are-you-counting-things">Are you counting things?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#are-you-measuring-time">Are you measuring time?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#do-you-need-to-know-the-order-of-events-relative-to-other-events">Do you need to know the order of events relative to other events?</a></li>
</ul>
</li>
<li><a href="user/metrics/adding-new-metrics.html#for-how-long-do-you-need-to-collect-this-data">For how long do you need to collect this data?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#when-should-the-glean-sdk-automatically-clear-the-measurement">When should the Glean SDK automatically clear the measurement?</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#a-lifetime-example">A lifetime example</a></li>
<li><a href="user/metrics/adding-new-metrics.html#what-if-none-of-these-lifetimes-are-appropriate">What if none of these lifetimes are appropriate?</a></li>
</ul>
</li>
<li><a href="user/metrics/adding-new-metrics.html#what-should-this-new-metric-be-called">What should this new metric be called?</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#reuse-names-from-other-applications">Reuse names from other applications</a></li>
<li><a href="user/metrics/adding-new-metrics.html#make-names-unique-within-an-application">Make names unique within an application</a></li>
<li><a href="user/metrics/adding-new-metrics.html#be-as-specific-as-possible">Be as specific as possible</a></li>
</ul>
</li>
<li><a href="user/metrics/adding-new-metrics.html#what-if-none-of-these-metric-types-is-the-right-fit">What if none of these metric types is the right fit?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#how-do-i-make-sure-my-metric-is-working">How do I make sure my metric is working?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#adding-the-metric-to-the-metricsyaml-file">Adding the metric to the <code>metrics.yaml</code> file</a></li>
<li><a href="user/metrics/adding-new-metrics.html#using-the-metric-from-your-code">Using the metric from your code</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#capitalization">Capitalization</a></li>
</ul>
</li>
</ul>
<h2><a class="header" href="#process-overview-1" id="process-overview-1">Process overview</a></h2>
<p>When adding a new metric, the process is:</p>
<ul>
<li>Consider the question you are trying to answer with this data, and choose the <a href="user/metrics/../../reference/metrics/index.html">metric type</a> and parameters to use.</li>
<li>Add a new entry to <a href="user/metrics/adding-new-metrics.html#adding-the-metric-to-the-metricsyaml-file"><code>metrics.yaml</code></a>.</li>
<li>Add code to your project to record into the metric by calling the Glean SDK.</li>
</ul>
<blockquote>
<p><strong>Important</strong>: Any new data collection requires documentation and <a href="https://wiki.mozilla.org/Firefox/Data_Collection">data-review</a>. This is also required for any new metric automatically collected by the Glean SDK.</p>
</blockquote>
<h2><a class="header" href="#choosing-a-metric-type-1" id="choosing-a-metric-type-1">Choosing a metric type</a></h2>
<p>The following is a set of questions to ask about the data being collected to help better determine which metric type to use.</p>
<h3><a class="header" href="#is-it-a-single-measurement-1" id="is-it-a-single-measurement-1">Is it a single measurement?</a></h3>
<p>If the value is true or false, use a <a href="user/metrics/../../reference/metrics/boolean.html">boolean metric</a>.</p>
<p>If the value is a string, use a <a href="user/metrics/../../reference/metrics/string.html">string metric</a>. For example, to record the name of the default search engine.</p>
<blockquote>
<p><strong>Beware:</strong> string metrics are exceedingly general, and you are probably best served by selecting the most specific metric for the job, since you'll get better error checking and richer analysis tools for free. For example, avoid storing a number in a string metric --- you probably want a [counter metric]../..(/reference/metrics/counter.html) instead.</p>
</blockquote>
<p>If you need to store multiple string values in a metric, use a <a href="user/metrics/../../reference/metrics/string_list.html">string list metric</a>. For example, you may want to record the list of other Mozilla products installed on the device.</p>
<!-- TODO: If you do know the list of values you might store and you just want to record their presence, consider using a [labeled boolean](../../reference/metrics/labeled_boolean.html) instead. -->
<!-- If you have a related set of metrics that you want to record strings for, and you don't know the things the strings relate to at build time, use a [labeled string metric](../../reference/metrics/labeled_strings.html). -->
<p>For all of the metric types in this section that measure single values, it is especially important to consider how the lifetime of the value relates to the ping it is being sent in. Since these metrics don't perform any aggregation on the client side, when a ping containing the metric is submitted, it will contain only the &quot;last known&quot; value for the metric, potentially resulting in <strong>data loss</strong>.  There is further discussion of <a href="user/metrics/adding-new-metrics.html#when-should-the-glean-sdk-automatically-clear-the-measurement">metric lifetimes</a> below.</p>
<h3><a class="header" href="#are-you-counting-things-1" id="are-you-counting-things-1">Are you counting things?</a></h3>
<p>If you want to know how many times something happened, use a <a href="user/metrics/../../reference/metrics/counter.html">counter metric</a>.  If you are counting a group of related things, or you don't know what all of the things to count are at build time, use a <a href="user/metrics/../../reference/metrics/labeled_counters.html">labeled counter metric</a>.</p>
<p>If you need to know how many times something happened relative to the number of times something else happened,
use a <a href="user/metrics/../../reference/metrics/rate.html">rate metric</a>.</p>
<p>If you need to know when the things being counted happened relative to other things, consider using an <a href="user/metrics/../../reference/metrics/event.html">event</a>.</p>
<h3><a class="header" href="#are-you-measuring-time-1" id="are-you-measuring-time-1">Are you measuring time?</a></h3>
<p>If you need to record an absolute time, use a <a href="user/metrics/../../reference/metrics/datetime.html">datetime metric</a>. Datetimes are recorded in the user's local time, according to their device's real time clock, along with a timezone offset from UTC. Datetime metrics allow specifying the resolution they are collected at, and to stay <a href="https://www.mozilla.org/en-US/about/policy/lean-data/stay-lean/">lean</a>, they should only be collected at the minimum resolution required to answer your question.</p>
<p>If you need to record how long something takes you have a few options.</p>
<p>If you need to measure the total time spent doing a particular task, look to the <a href="user/metrics/../../reference/metrics/timespan.html">timespan metric</a>. Timespan metrics allow specifying the resolution they are collected at, and to stay <a href="https://www.mozilla.org/en-US/about/policy/lean-data/stay-lean/">lean</a>, they should only be collected at the minimum resolution required to answer your question.
Note that this metric should only be used to measure time on a single thread. If multiple overlapping timespans are measured for the same metric, an invalid state error is recorded.</p>
<p>If you need to measure the relative occurrences of many timings, use a <a href="user/metrics/../../reference/metrics/timing_distribution.html">timing distribution</a>. It builds a histogram of timing measurements, and is safe to record multiple concurrent timespans on different threads.</p>
<p>If you need to know the time between multiple distinct actions that aren't a simple &quot;begin&quot; and &quot;end&quot; pair, consider using an <a href="user/metrics/../../reference/metrics/event.html">event</a>.</p>
<h3><a class="header" href="#do-you-need-to-know-the-order-of-events-relative-to-other-events-1" id="do-you-need-to-know-the-order-of-events-relative-to-other-events-1">Do you need to know the order of events relative to other events?</a></h3>
<p>If you need to know the order of actions relative to other actions, such as, the user performed tasks A, B, and then C, and this is meaningfully different from the user performing tasks A, C and then B, (in other words, the order is meaningful beyond just the <em>fact</em> that a set of tasks were performed), use an <a href="user/metrics/../../reference/metrics/event.html">event metric</a>.</p>
<blockquote>
<p><strong>Important:</strong> events are the most expensive metric type to record, transmit, store and analyze, so they should be used sparingly, and only when none of the other metric types are sufficient for answering your question.</p>
</blockquote>
<h2><a class="header" href="#for-how-long-do-you-need-to-collect-this-data-1" id="for-how-long-do-you-need-to-collect-this-data-1">For how long do you need to collect this data?</a></h2>
<p>Think carefully about how long the metric will be needed, and set the <code>expires</code> parameter to disable the metric at the earliest possible time.
This is an important component of Mozilla's <a href="https://www.mozilla.org/en-US/about/policy/lean-data/stay-lean/">lean data practices</a>.</p>
<p>When the metric passes its expiration date (determined at build time), it will automatically stop collecting data.</p>
<p>When a metric's expiration is within in 14 days, emails will be sent from <code>telemetry-alerts@mozilla.com</code> to the <code>notification_emails</code> addresses associated with the metric.
At that time, the metric should be removed, which involves removing it from the <code>metrics.yaml</code> file and removing uses of it in the source code.
Removing a metric does not affect the availability of data already collected by the pipeline.</p>
<p>If the metric is still needed after its expiration date, it should go back for <a href="https://wiki.mozilla.org/Firefox/Data_Collection">another round of data review</a> to have its expiration date extended.</p>
<blockquote>
<p><strong>Important:</strong> Ensure that telemetry alerts are received and are reviewed in a timely manner. Expired metrics don't record any data, extending or removing a metric should be done in time. Consider adding both a group email address and an individual who is responsible for this metric to the <code>notification_emails</code> list.</p>
</blockquote>
<h2><a class="header" href="#when-should-the-glean-sdk-automatically-clear-the-measurement-1" id="when-should-the-glean-sdk-automatically-clear-the-measurement-1">When should the Glean SDK automatically clear the measurement?</a></h2>
<p>The <code>lifetime</code> parameter of a metric defines when its value will be cleared. There are three lifetime options available:</p>
<ul>
<li><code>ping</code> (default): The metric is cleared each time it is submitted in the ping. This is the most common case, and should be used for metrics that are highly dynamic, such as things computed in response to the user's interaction with the application.</li>
<li><code>application</code>: The metric is related to an application run, and is cleared after the application restarts and any Glean-owned ping, due at startup, is submitted. This should be used for things that are constant during the run of an application, such as the operating system version. In practice, these metrics are generally set during application startup. A common mistake---using the ping lifetime for these type of metrics---means that they will only be included in the first ping sent during a particular run of the application.</li>
<li><code>user</code>: <strong>Reach out to the Glean team before using this.</strong>. The metric is part of the user's profile and will live as long as the profile lives. This is often not the best choice unless the metric records a value that <em>really</em> needs to be persisted for the full lifetime of the user profile, e.g. an identifier like the <code>client_id</code>, the day the product was first executed. It is rare to use this lifetime outside of some metrics that are built in to the Glean SDK.</li>
</ul>
<p>While lifetimes are important to understand for all metric types, they are particularly important for the metric types that record single values and don't aggregate on the client (<code>boolean</code>, <code>string</code>, <code>labeled_string</code>, <code>string_list</code>, <code>datetime</code> and <code>uuid</code>), since these metrics will send the &quot;last known&quot; value and missing the earlier values could be a form of unintended data loss.</p>
<h3><a class="header" href="#a-lifetime-example-1" id="a-lifetime-example-1">A lifetime example</a></h3>
<p>Let's work through an example to see how these lifetimes play out in practice. Let's suppose we have a user preference, &quot;turbo mode&quot;, which defaults to <code>false</code>, but the user can turn it to <code>true</code> at any time.  We want to know when this flag is <code>true</code> so we can measure its affect on other metrics in the same ping.  In the following diagram, we look at a time period that sends 4 pings across two separate runs of the application. We assume here, that like the Glean SDK's built-in <a href="user/metrics/../pings/metrics.html">metrics ping</a>, the developer writing the metric isn't in control of when the ping is submitted.</p>
<p>In this diagram, the ping measurement windows are represented as rectangles, but the moment the ping is &quot;submitted&quot; is represented by its right edge. The user changes the &quot;turbo mode&quot; setting from <code>false</code> to <code>true</code> in the first run, and then toggles it again twice in the second run.</p>
<p><img src="user/metrics/metric-lifetime-timeline.svg" alt="Metric lifetime timeline" /></p>
<ul>
<li>
<p><strong>A. Ping lifetime, set on change</strong>: The value isn't included in Ping 1, because Glean doesn't know about it yet.  It is included in the first ping after being recorded (Ping 2), which causes it to be cleared.</p>
</li>
<li>
<p><strong>B. Ping lifetime, set on init and change</strong>: The default value is included in Ping 1, and the changed value is included in Ping 2, which causes it to be cleared.  It therefore misses Ping 3, but when the application is started, it is recorded again and it is included in Ping 4.  However, this causes it to be cleared again and it is not in Ping 5.</p>
</li>
<li>
<p><strong>C. Application lifetime, set on change</strong>: The value isn't included in Ping 1, because Glean doesn't know about it yet. After the value is changed, it is included in Pings 2 and 3, but then due to application restart it is cleared, so it is not included until the value is manually toggled again.</p>
</li>
<li>
<p><strong>D. Application, set on init and change</strong>: The default value is included in Ping 1, and the changed value is included in Pings 2 and 3. Even though the application startup causes it to be cleared, it is set again, and all subsequent pings also have the value.</p>
</li>
<li>
<p><strong>E. User, set on change</strong>: The default value is missing from Ping 1, but since <code>user</code> lifetime metrics aren't cleared unless the user profile is reset (e.g. on Android, when the product is uninstalled), it is included in all subsequent pings.</p>
</li>
<li>
<p><strong>F. User, set on init and change</strong>: Since <code>user</code> lifetime metrics aren't cleared unless the user profile is reset, it is included in all subsequent pings.  This would be true even if the &quot;turbo mode&quot; preference were never changed again.</p>
</li>
</ul>
<p>Note that for all of the metric configurations, the toggle of the preference off and on during Ping 4 is completely missed.  If you need to create a ping containing one, and only one, value for this metric, consider using a <a href="user/metrics/../pings/custom.html">custom ping</a> to create a ping whose lifetime matches the lifetime of the value.</p>
<h3><a class="header" href="#what-if-none-of-these-lifetimes-are-appropriate-1" id="what-if-none-of-these-lifetimes-are-appropriate-1">What if none of these lifetimes are appropriate?</a></h3>
<p>If the timing at which the metric is sent in the ping needs to closely match the timing of the metrics value, the best option is to use a <a href="user/metrics/../pings/custom.html">custom ping</a> to manually control when pings are sent.</p>
<p>This is especially useful when metrics need to be tightly related to one another, for example when you need to measure the distribution of frame paint times when a particular rendering backend is in use.  If these metrics were in different pings, with different measurement windows, it is much harder to do that kind of reasoning with much certainty.</p>
<h2><a class="header" href="#what-should-this-new-metric-be-called-1" id="what-should-this-new-metric-be-called-1">What should this new metric be called?</a></h2>
<p>Metric names have a maximum length of 30 characters.</p>
<h3><a class="header" href="#reuse-names-from-other-applications-1" id="reuse-names-from-other-applications-1">Reuse names from other applications</a></h3>
<p>There's a lot of value using the same name for analogous metrics collected across different products. For example, BigQuery makes it simple to join columns with the same name across multiple tables. Therefore, we encourage you to investigate if a similar metric is already being collected by another product. If it is, there may be an opportunity for code reuse across these products, and if all the projects are using the Glean SDK, it's easy for libraries to send their own metrics. If sharing the code doesn't make sense, at a minimum we recommend using the same metric name for similar actions and concepts whenever possible.</p>
<h3><a class="header" href="#make-names-unique-within-an-application-1" id="make-names-unique-within-an-application-1">Make names unique within an application</a></h3>
<p>Metric identifiers (the combination of a metric's category and name) must be unique across all metrics that are sent by a single application.
This includes not only the metrics defined in the app's <code>metrics.yaml</code>, but the <code>metrics.yaml</code> of any Glean SDK-using library that the application uses, including the Glean SDK itself.
Therefore, care should be taken to name things specifically enough so as to avoid namespace collisions.
In practice, this generally involves thinking carefully about the <code>category</code> of the metric, more than the <code>name</code>.</p>
<blockquote>
<p><strong>Note:</strong> Duplicate metric identifiers are not currently detected at build time. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1578383">bug 1578383</a> for progress on that.
However, the <a href="https://github.com/mozilla/probe-scraper">probe_scraper</a> process, which runs nightly, will detect duplicate metrics and e-mail the <code>notification_emails</code> associated with the given metrics.</p>
</blockquote>
<h3><a class="header" href="#be-as-specific-as-possible-1" id="be-as-specific-as-possible-1">Be as specific as possible</a></h3>
<p>More broadly, you should choose the names of metrics to be as specific as possible.
It is not necessary to put the type of the metric in the category or name, since this information is retained in other ways through the entire end-to-end system.</p>
<p>For example, if defining a set of events related to search, put them in a category called <code>search</code>, rather than just <code>events</code> or <code>search_events</code>. The <code>events</code> word here would be redundant.</p>
<h2><a class="header" href="#what-if-none-of-these-metric-types-is-the-right-fit-1" id="what-if-none-of-these-metric-types-is-the-right-fit-1">What if none of these metric types is the right fit?</a></h2>
<p>The current set of metrics the Glean SDK supports is based on known common use cases, but new use cases are discovered all the time.</p>
<p>Please reach out to us on <a href="https://chat.mozilla.org/#/room/#glean:mozilla.org">#glean:mozilla.org</a>. If you think you need a new metric type, we <a href="user/metrics/../../reference/metrics/index.html#adding-or-changing-metric-types">have a process for that</a>.</p>
<h2><a class="header" href="#how-do-i-make-sure-my-metric-is-working-1" id="how-do-i-make-sure-my-metric-is-working-1">How do I make sure my metric is working?</a></h2>
<p>The Glean SDK has rich support for writing unit tests involving metrics. Writing a good unit test is a large topic, but in general, you should write unit tests for all new telemetry that does the following:</p>
<ul>
<li>
<p>Performs the operation being measured.</p>
</li>
<li>
<p>Asserts that metrics contain the expected data, using the <code>testGetValue</code> API on the metric.</p>
</li>
<li>
<p>Where applicable, asserts that no errors are recorded, such as when values are out of range, using the <code>testGetNumRecordedErrors</code> API.</p>
</li>
</ul>
<p>In addition to unit tests, it is good practice to validate the incoming data for the new metric on a pre-release channel to make sure things are working as expected.</p>
<!--
TODO: This will be a good place to talk about the product telemetry health
dashboard when that's ready
-->
<h2><a class="header" href="#adding-the-metric-to-the-metricsyaml-file-1" id="adding-the-metric-to-the-metricsyaml-file-1">Adding the metric to the <code>metrics.yaml</code> file</a></h2>
<p>The <a href="https://mozilla.github.io/glean_parser/metrics-yaml.html"><code>metrics.yaml</code> file</a> defines the metrics your application or library will send.
They are organized into categories.
The overall organization is:</p>
<pre><code class="language-YAML"># Required to indicate this is a `metrics.yaml` file
$schema: moz://mozilla.org/schemas/glean/../../reference/metrics/2-0-0

toolbar:
  click:
    type: event
    description: |
      Event to record toolbar clicks.
    notification_emails:
      - CHANGE-ME@example.com
    bugs:
      - https://bugzilla.mozilla.org/123456789/
    data_reviews:
      - http://example.com/path/to/data-review
    expires: 2019-06-01  # &lt;-- Update to a date in the future

  double_click:
    ...
</code></pre>
<p>Categories can have <code>.</code> characters to provide extra structure, for example <code>category.subcategory</code>, as long as the total length doesn't exceed 40 characters.</p>
<p>Metric names have a maximum length of 30 characters.</p>
<p>The details of the metric parameters are described in <a href="user/metrics/../../reference/yaml/index.html">metric parameters</a>.</p>
<p>The <code>metrics.yaml</code> file is used to generate code in the target language (e.g. Kotlin, Swift, ...) that becomes the public API to access your application's metrics.</p>
<h2><a class="header" href="#using-the-metric-from-your-code-1" id="using-the-metric-from-your-code-1">Using the metric from your code</a></h2>
<p>The <a href="user/metrics/../../reference/metrics/index.html">reference documentation for each metric type</a> goes into detail about using each metric type from your code.</p>
<p>Note that all Glean metrics are write-only. Outside of unit tests, it is impossible to retrieve a value from the Glean SDK's database.
While this may seem limiting, this is required to:</p>
<ul>
<li>enforce the semantics of certain metric types (e.g. that Counters can only be incremented).</li>
<li>ensure the lifetime of the metric (when it is cleared or reset) is correctly handled.</li>
</ul>
<h3><a class="header" href="#capitalization-1" id="capitalization-1">Capitalization</a></h3>
<p>One thing to note is that we try to adhere to the coding conventions of each language wherever possible, to the metric name in the <code>metrics.yaml</code> (which is in <code>snake_case</code>) may be changed to some other case convention, such as <code>camelCase</code>, when used from code.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>Category and metric names in the <code>metrics.yaml</code> are in <code>snake_case</code>,
but given the Kotlin coding standards defined by <a href="https://github.com/pinterest/ktlint">ktlint</a>,
these identifiers must be <code>camelCase</code> in Kotlin.
For example, the metric defined in the <code>metrics.yaml</code> as:</p>
<pre><code class="language-YAML">views:
  login_opened:
    ...
</code></pre>
<p>is accessible in Kotlin as:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Views
GleanMetrics.Views.loginOpened...
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<p>Category and metric names in the <code>metrics.yaml</code> are in <code>snake_case</code>,
but given the Swift coding standards defined by <a href="https://github.com/realm/SwiftLint">swiftlint</a>,
these identifiers must be <code>camelCase</code> in Swift.
For example, the metric defined in the <code>metrics.yaml</code> as:</p>
<pre><code class="language-YAML">views:
  login_opened:
    ...
</code></pre>
<p>is accessible in Kotlin as:</p>
<pre><code class="language-Swift">GleanMetrics.Views.loginOpened...
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>Category and metric names in the <code>metrics.yaml</code> are in <code>snake_case</code>, which matches the <a href="https://www.python.org/dev/peps/pep-0008/">PEP8</a> standard, so no translation is needed for Python.</p>
</div>
<div data-lang="C#" class="tab">
<p>TODO. To be implemented in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1643568">this bug</a>.</p>
</div>
</div>
</div>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/metrics/adding-new-metrics.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#unit-testing-glean-metrics" id="unit-testing-glean-metrics">Unit testing Glean metrics</a></h1>
<p>In order to support unit testing inside of client applications using the Glean SDK, a set of testing API functions have been included.
The intent is to make the Glean SDK easier to test 'out of the box' in any client application it may be used in.
These functions expose a way to inspect and validate recorded metric values within the client application but are restricted to test code only through visibility annotations
(<code>@VisibleForTesting(otherwise = VisibleForTesting.NONE)</code> for Kotlin, <code>internal</code> methods for Swift).
(Outside of a testing context, Glean APIs are otherwise write-only so that it can enforce semantics and constraints about data).</p>
<p>To encourage using the testing API, it is also possible to <a href="user/metrics/testing-metrics.html#generating-testing-coverage-reports">generate testing coverage reports</a> to show which metrics in your project are tested.</p>
<h2><a class="header" href="#general-test-api-method-semantics" id="general-test-api-method-semantics">General test API method semantics</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>Using the Glean SDK's unit testing API requires adding <a href="http://robolectric.org/">Robolectric 4.0 or later</a> as a testing dependency. In Gradle, this can be done by declaring a <code>testImplementation</code> dependency:</p>
<pre><code class="language-groovy">dependencies {
    testImplementation &quot;org.robolectric:robolectric:4.3.1&quot;
}
</code></pre>
<p>In order to prevent issues with async calls when unit testing the Glean SDK,
it is important to put the Glean SDK into testing mode by applying the JUnit <code>GleanTestRule</code> to your test class.
When the Glean SDK is in testing mode, it enables uploading and clears the recorded metrics at the beginning of each test run.
The rule can be used as shown below:</p>
<pre><code class="language-kotlin">@RunWith(AndroidJUnit4::class)
class ActivityCollectingDataTest {
    // Apply the GleanTestRule to set up a disposable Glean instance.
    // Please note that this clears the Glean data across tests.
    @get:Rule
    val gleanRule = GleanTestRule(ApplicationProvider.getApplicationContext())

    @Test
    fun checkCollectedData() {
      // The Glean SDK testing API can be called here.
    }
}
</code></pre>
<p>This will ensure that metrics are done recording when the other test functions are used.</p>
<p>To check if a value exists (i.e. it has been recorded), there is a <code>testHasValue()</code> function on each of the metric instances:</p>
<pre><code class="language-kotlin">assertTrue(GleanMetrics.Search.defaultSearchEngineUrl.testHasValue())
</code></pre>
<p>To check the actual values, there is a <code>testGetValue()</code> function on each of the metric instances.
It is important to check that the values are recorded as expected, since many of the metric types may truncate or error-correct the value.
This function will return a datatype appropriate to the specific type of the metric it is being used with:</p>
<pre><code class="language-kotlin">assertEquals(&quot;https://example.com/search?&quot;, GleanMetrics.Search.defaultSearchEngineUrl.testGetValue())
</code></pre>
<p>Note that each of these functions has its visibility limited to the scope of unit tests by making use of the <code>@VisibleForTesting</code> annotation,
so the IDE should complain if you attempt to use them inside of client code.</p>
</div>
<div data-lang="Swift" class="tab">
<blockquote>
<p><strong>NOTE</strong>: There's no automatic test rule for Glean tests implemented.</p>
</blockquote>
<p>In order to prevent issues with async calls when unit testing the Glean SDK, it is important to put the Glean SDK into testing mode.
When the Glean SDK is in testing mode, it enables uploading and clears the recorded metrics at the beginning of each test run.</p>
<p>Activate it by resetting Glean in your test's setup:</p>
<pre><code class="language-swift">@testable import Glean
import XCTest

class GleanUsageTests: XCTestCase {
    override func setUp() {
        Glean.shared.resetGlean(clearStores: true)
    }

    // ...
}
</code></pre>
<p>This will ensure that metrics are done recording when the other test functions are used.</p>
<p>To check if a value exists (i.e. it has been recorded), there is a <code>testHasValue()</code> function on each of the metric instances:</p>
<pre><code class="language-Swift">XCTAssertTrue(GleanMetrics.Search.defaultSearchEngineUrl.testHasValue())
</code></pre>
<p>To check the actual values, there is a <code>testGetValue()</code> function on each of the metric instances.
It is important to check that the values are recorded as expected, since many of the metric types may truncate or error-correct the value.
This function will return a datatype appropriate to the specific type of the metric it is being used with:</p>
<pre><code class="language-Swift">XCTAssertEqual(&quot;https://example.com/search?&quot;, try GleanMetrics.Search.defaultSearchEngineUrl.testGetValue())
</code></pre>
<p>Note that each of these functions is marked as <code>internal</code>, you need to import <code>Glean</code> explicitly in test mode:</p>
<pre><code class="language-Swift">@testable import Glean
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>It is generally a good practice to &quot;reset&quot; the Glean SDK prior to every unit test that uses the Glean SDK, to prevent side effects of one unit test impacting others.
The Glean SDK contains a helper function <code>glean.testing.reset_glean()</code> for this purpose.
It has two required arguments: the application ID, and the application version.
Each reset of the Glean SDK will create a new temporary directory for Glean to store its data in.
This temporary directory is automatically cleaned up the next time the Glean SDK is reset or when the testing framework finishes.</p>
<p>The instructions below assume you are using <a href="https://pypi.org/project/pytest/">pytest</a> as the test runner.
Other test-running libraries have similar features, but are different in the details.</p>
<p>Create a file <code>conftest.py</code> at the root of your test directory, and add the following to reset Glean at the start of every test in your suite:</p>
<pre><code class="language-python">import pytest
from glean import testing

@pytest.fixture(name=&quot;reset_glean&quot;, scope=&quot;function&quot;, autouse=True)
def fixture_reset_glean():
    testing.reset_glean(application_id=&quot;my-app-id&quot;, application_version=&quot;0.1.0&quot;)
</code></pre>
<p>To check if a value exists (i.e. it has been recorded), there is a <code>test_has_value()</code> function on each of the metric instances:</p>
<pre><code class="language-python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# ...

assert metrics.search.search_engine_url.test_has_value()
</code></pre>
<p>To check the actual values, there is a <code>test_get_value()</code> function on each of the metric instances.
It is important to check that the values are recorded as expected, since many of the metric types may truncate or error-correct the value.
This function will return a datatype appropriate to the specific type of the metric it is being used with:</p>
<pre><code class="language-python">assert (
    &quot;https://example.com/search?&quot; ==
    metrics.search.default_search_engine_url.test_get_value()
)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<p>TODO. To be implemented in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1648448">bug 1648448</a>.</p>
</div>
</div>
</div>
<h2><a class="header" href="#testing-metrics-for-custom-pings" id="testing-metrics-for-custom-pings">Testing metrics for custom pings</a></h2>
<p>In order to test metrics where the metric is included in more than one ping, the test functions take an optional <code>pingName</code> argument (<code>ping_name</code> in Python).
This is the name of the ping that the metric is being sent in, such as <code>&quot;events&quot;</code> for the <a href="user/metrics/../pings/events.html"><code>events</code> ping</a>,
or <code>&quot;metrics&quot;</code> for the <a href="user/metrics/../pings/metrics.html"><code>metrics</code> ping</a>.
This could also be a custom ping name that the metric is being sent in.
In most cases you should not have to supply the ping name to the test function and can just use the default which is the &quot;default&quot; ping that this metric is sent in.
You should only need to provide a <code>pingName</code> if the metric is being sent in more than one ping in order to identify the correct metric store.</p>
<p>You can call the <code>testHasValue()</code> and <code>testGetValue()</code> functions with <code>pingName</code> like this:</p>
<pre><code class="language-kotlin">GleanMetrics.Foo.uriCount.testHasValue(&quot;customPing&quot;)
GleanMetrics.Foo.uriCount.testGetValue(&quot;customPing&quot;)
</code></pre>
<h2><a class="header" href="#example-of-using-the-test-api" id="example-of-using-the-test-api">Example of using the test API</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>Here is a longer example to better illustrate the intended use of the test API:</p>
<pre><code class="language-kotlin">// Record a metric value with extra to validate against
GleanMetrics.BrowserEngagement.click.record(
    mapOf(
        BrowserEngagement.clickKeys.font to &quot;Courier&quot;
    )
)

// Record more events without extras attached
BrowserEngagement.click.record()
BrowserEngagement.click.record()

// Check if we collected any events into the 'click' metric
assertTrue(BrowserEngagement.click.testHasValue())

// Retrieve a snapshot of the recorded events
val events = BrowserEngagement.click.testGetValue()

// Check if we collected all 3 events in the snapshot
assertEquals(3, events.size)

// Check extra key/value for first event in the list
assertEquals(&quot;Courier&quot;, events.elementAt(0).extra[&quot;font&quot;])
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<p>Here is a longer example to better illustrate the intended use of the test API:</p>
<pre><code class="language-Swift">// Record a metric value with extra to validate against
GleanMetrics.BrowserEngagement.click.record([.font: &quot;Courier&quot;])

// Record more events without extras attached
BrowserEngagement.click.record()
BrowserEngagement.click.record()

// Check if we collected any events into the 'click' metric
XCTAssertTrue(BrowserEngagement.click.testHasValue())

// Retrieve a snapshot of the recorded events
let events = try! BrowserEngagement.click.testGetValue()

// Check if we collected all 3 events in the snapshot
XCTAssertEqual(3, events.count)

// Check extra key/value for first event in the list
XCTAssertEqual(&quot;Courier&quot;, events[0].extra?[&quot;font&quot;])
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>Here is a longer example to better illustrate the intended use of the test API:</p>
<pre><code class="language-python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Record a metric value with extra to validate against
metrics.url.visit.add(1)

# Check if we collected any events into the 'click' metric
assert metrics.url.visit.test_has_value()

# Retrieve a snapshot of the recorded events
assert 1 == metrics.url.visit.test_get_value()
</code></pre>
</div>
<div data-lang="C#" class="tab">
<p>TODO. To be implemented in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1648448">bug 1648448</a>.</p>
</div>
</div>
</div>
<h2><a class="header" href="#generating-testing-coverage-reports" id="generating-testing-coverage-reports">Generating testing coverage reports</a></h2>
<p>Glean can generate coverage reports to track which metrics are tested in your unit test suite.</p>
<p>There are three steps to integrate it into your continuous integration workflow: recording coverage, post-processing the results, and uploading the results.</p>
<h3><a class="header" href="#recording-coverage" id="recording-coverage">Recording coverage</a></h3>
<p>Glean testing coverage is enabled by setting the <code>GLEAN_TEST_COVERAGE</code> environment variable to the name of a file to store results.
It is good practice to set it to the absolute path to a file, since some testing harnesses (such as <code>cargo test</code>) may change the current working directory.</p>
<pre><code class="language-bash">GLEAN_TEST_COVERAGE=$(realpath glean_coverage.txt) make test
</code></pre>
<h3><a class="header" href="#post-processing-the-results" id="post-processing-the-results">Post-processing the results</a></h3>
<p>A post-processing step is required to convert the raw output in the file specified by <code>GLEAN_TEST_COVERAGE</code> into usable output for coverage reporting tools. Currently, the only coverage reporting tool supported is <a href="https://codecov.io">codecov.io</a>.</p>
<p>This post-processor is available in the <code>coverage</code> subcommand in the <a href="https://github.com/mozilla/glean_parser"><code>glean_parser</code></a> tool.</p>
<p>For some build systems, <code>glean_parser</code> is already installed for you by the build system integration at the following locations:</p>
<ul>
<li>On Android/Gradle, <code>$GRADLE_HOME/glean/bootstrap-4.5.11/Miniconda3/bin/glean_parser</code></li>
<li>On iOS/Carthage, <code>$PROJECT_ROOT/.venv/bin/glean_parser</code></li>
<li>For other systems, install <code>glean_parser</code> using <code>pip install glean_parser</code></li>
</ul>
<p>The <code>glean_parser coverage</code> command requires the following parameters:</p>
<ul>
<li><code>-f</code>: The output format to produce, for example <code>codecovio</code> to produce <a href="https://codecov.io">codecov.io</a>'s custom format.</li>
<li><code>-o</code>: The path to the output file, for example <code>codecov.json</code>.</li>
<li><code>-c</code>: The input raw coverage file. <code>glean_coverage.txt</code> in the example above.</li>
<li>A list of the <code>metrics.yaml</code> files in your repository.</li>
</ul>
<p>For example, to produce output for <a href="https://codecov.io">codecov.io</a>:</p>
<pre><code class="language-bash">glean_parser coverage -f codecovio -o glean_coverage.json -c glean_coverage.txt app/metrics.yaml
</code></pre>
<p>In this example, the <code>glean_coverage.json</code> file is now ready for uploading to codecov.io.</p>
<h3><a class="header" href="#uploading-coverage" id="uploading-coverage">Uploading coverage</a></h3>
<p>If using <code>codecov.io</code>, the uploader doesn't send coverage results for YAML files by default. Pass the <code>-X yaml</code> option to the uploader to make sure they are included:</p>
<pre><code class="language-bash">bash &lt;(curl -s https://codecov.io/bash) -X yaml
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/metrics/testing-metrics.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#error-reporting" id="error-reporting">Error reporting</a></h1>
<p>The Glean SDK records the number of errors that occur when metrics are passed invalid data or are otherwise used incorrectly.
This information is reported back in special labeled counter metrics in the <code>glean.error</code> category.
Error metrics are included in the same pings as the metric that caused the error.
Additionally, error metrics are always sent in the <a href="user/metrics/../pings/metrics.html"><code>metrics</code> ping</a> ping.</p>
<p>The following categories of errors are recorded:</p>
<ul>
<li><code>invalid_value</code>: The metric value was invalid.</li>
<li><code>invalid_label</code>: The label on a labeled metric was invalid.</li>
<li><code>invalid_state</code>: The metric caught an invalid state while recording.</li>
<li><code>invalid_overflow</code>: The metric value to be recorded overflows the metric-specific upper range.</li>
</ul>
<p>For example, if you had a string metric and passed it a string that was too long:</p>
<pre><code class="language-Kotlin">MyMetrics.stringMetric.set(&quot;this_string_is_longer_than_the_limit_for_string_metrics&quot;)
</code></pre>
<p>The following error metric counter would be incremented:</p>
<pre><code class="language-Kotlin">Glean.error.invalidOverflow[&quot;my_metrics.string_metric&quot;].add(1)
</code></pre>
<p>Resulting in the following keys in the ping:</p>
<pre><code class="language-json">{
  &quot;metrics&quot;: {
    &quot;labeled_counter&quot;: {
      &quot;glean.error.invalid_overflow&quot;: {
        &quot;my_metrics.string_metric&quot;: 1
      }
    }
  }
}
</code></pre>
<p>If you have a debug build of the Glean SDK, details about the errors being recorded are included in the logs. This detailed information is not included in Glean pings.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/metrics/error-reporting.md">Edit this file on GitHub.</a></footer><!-- AUTOGENERATED BY glean_parser.  DO NOT EDIT. -->
<h1><a class="header" href="#metrics" id="metrics">Metrics</a></h1>
<p>This document enumerates the metrics collected by this project using the <a href="https://mozilla.github.io/glean/book/index.html">Glean SDK</a>.
This project may depend on other projects which also collect metrics.
This means you might have to go searching through the dependency tree to get a full picture of everything collected by this project.</p>
<h1><a class="header" href="#pings" id="pings">Pings</a></h1>
<ul>
<li><a href="user/collected-metrics/metrics.html#all-pings">all-pings</a></li>
<li><a href="user/collected-metrics/metrics.html#baseline">baseline</a></li>
<li><a href="user/collected-metrics/metrics.html#deletion-request">deletion-request</a></li>
<li><a href="user/collected-metrics/metrics.html#metrics">metrics</a></li>
</ul>
<h2><a class="header" href="#all-pings" id="all-pings">all-pings</a></h2>
<p>These metrics are sent in every ping.</p>
<p>All Glean pings contain built-in metrics in the <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-ping_info-section"><code>ping_info</code></a> and <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-client_info-section"><code>client_info</code></a> sections.</p>
<p>In addition to those built-in metrics, the following metrics are added to the ping:</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Data reviews</th><th>Extras</th><th>Expiration</th><th><a href="https://wiki.mozilla.org/Firefox/Data_Collection">Data Sensitivity</a></th></tr></thead><tbody>
<tr><td>glean.error.invalid_label</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/labeled_counters.html">labeled_counter</a></td><td>Counts the number of times a metric was set with an invalid label. The labels are the <code>category.name</code> identifier of the metric.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1499761#c5">Bug 1499761</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.error.invalid_overflow</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/labeled_counters.html">labeled_counter</a></td><td>Counts the number of times a metric was set a value that overflowed. The labels are the <code>category.name</code> identifier of the metric.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1591912#c3">Bug 1591912</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.error.invalid_state</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/labeled_counters.html">labeled_counter</a></td><td>Counts the number of times a timing metric was used incorrectly. The labels are the <code>category.name</code> identifier of the metric.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1499761#c5">Bug 1499761</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.error.invalid_value</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/labeled_counters.html">labeled_counter</a></td><td>Counts the number of times a metric was set to an invalid value. The labels are the <code>category.name</code> identifier of the metric.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1499761#c5">Bug 1499761</a></td><td></td><td>never</td><td>1</td></tr>
</tbody></table>
<h2><a class="header" href="#baseline" id="baseline">baseline</a></h2>
<p>This is a built-in ping that is assembled out of the box by the Glean SDK.</p>
<p>See the Glean SDK documentation for the <a href="https://mozilla.github.io/glean/book/user/pings/baseline.html"><code>baseline</code> ping</a>.</p>
<p>This ping is sent if empty.</p>
<p>This ping includes the <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-client_info-section">client id</a>.</p>
<p><strong>Data reviews for this ping:</strong></p>
<ul>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1512938#c3">https://bugzilla.mozilla.org/show_bug.cgi?id=1512938#c3</a></li>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1599877#c25">https://bugzilla.mozilla.org/show_bug.cgi?id=1599877#c25</a></li>
</ul>
<p><strong>Bugs related to this ping:</strong></p>
<ul>
<li><a href="https://bugzilla.mozilla.org/1512938">https://bugzilla.mozilla.org/1512938</a></li>
<li><a href="https://bugzilla.mozilla.org/1599877">https://bugzilla.mozilla.org/1599877</a></li>
</ul>
<p><strong>Reasons this ping may be sent:</strong></p>
<ul>
<li>
<p><code>active</code>: The ping was submitted when the application became active again, which
includes when the application starts. In earlier versions, this was called
<code>foreground</code>.</p>
<pre><code>*Note*: this ping will not contain the `glean.baseline.duration` metric.
</code></pre>
</li>
<li>
<p><code>dirty_startup</code>: The ping was submitted at startup, because the application process was
killed before the Glean SDK had the chance to generate this ping, before
becoming inactive, in the last session.</p>
<pre><code>*Note*: this ping will not contain the `glean.baseline.duration` metric.
</code></pre>
</li>
<li>
<p><code>inactive</code>: The ping was submitted when becoming inactive. In earlier versions, this
was called <code>background</code>.</p>
</li>
</ul>
<p>All Glean pings contain built-in metrics in the <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-ping_info-section"><code>ping_info</code></a> and <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-client_info-section"><code>client_info</code></a> sections.</p>
<p>In addition to those built-in metrics, the following metrics are added to the ping:</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Data reviews</th><th>Extras</th><th>Expiration</th><th><a href="https://wiki.mozilla.org/Firefox/Data_Collection">Data Sensitivity</a></th></tr></thead><tbody>
<tr><td>glean.baseline.duration</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/timespan.html">timespan</a></td><td>The duration of the last foreground session.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1512938#c3">Bug 1512938</a></td><td></td><td>never</td><td>1, 2</td></tr>
<tr><td>glean.validation.first_run_hour</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/datetime.html">datetime</a></td><td>The hour of the first run of the application.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1680783#c5">Bug 1680783</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.validation.pings_submitted</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/labeled_counters.html">labeled_counter</a></td><td>A count of the pings submitted, by ping type.  This metric appears in both the metrics and baseline pings.  - On the metrics ping, the counts include the number of pings sent since   the last metrics ping (including the last metrics ping) - On the baseline ping, the counts include the number of pings send since   the last baseline ping (including the last baseline ping)</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1586764#c3">Bug 1586764</a></td><td></td><td>never</td><td>1</td></tr>
</tbody></table>
<h2><a class="header" href="#deletion-request" id="deletion-request">deletion-request</a></h2>
<p>This is a built-in ping that is assembled out of the box by the Glean SDK.</p>
<p>See the Glean SDK documentation for the <a href="https://mozilla.github.io/glean/book/user/pings/deletion-request.html"><code>deletion-request</code> ping</a>.</p>
<p>This ping is sent if empty.</p>
<p>This ping includes the <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-client_info-section">client id</a>.</p>
<p><strong>Data reviews for this ping:</strong></p>
<ul>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1587095#c6">https://bugzilla.mozilla.org/show_bug.cgi?id=1587095#c6</a></li>
</ul>
<p><strong>Bugs related to this ping:</strong></p>
<ul>
<li><a href="https://bugzilla.mozilla.org/1587095">https://bugzilla.mozilla.org/1587095</a></li>
</ul>
<p>All Glean pings contain built-in metrics in the <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-ping_info-section"><code>ping_info</code></a> and <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-client_info-section"><code>client_info</code></a> sections.</p>
<p>This ping contains no metrics.</p>
<h2><a class="header" href="#metrics-1" id="metrics-1">metrics</a></h2>
<p>This is a built-in ping that is assembled out of the box by the Glean SDK.</p>
<p>See the Glean SDK documentation for the <a href="https://mozilla.github.io/glean/book/user/pings/metrics.html"><code>metrics</code> ping</a>.</p>
<p>This ping includes the <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-client_info-section">client id</a>.</p>
<p><strong>Data reviews for this ping:</strong></p>
<ul>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1512938#c3">https://bugzilla.mozilla.org/show_bug.cgi?id=1512938#c3</a></li>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557048#c13">https://bugzilla.mozilla.org/show_bug.cgi?id=1557048#c13</a></li>
</ul>
<p><strong>Bugs related to this ping:</strong></p>
<ul>
<li><a href="https://bugzilla.mozilla.org/1512938">https://bugzilla.mozilla.org/1512938</a></li>
</ul>
<p><strong>Reasons this ping may be sent:</strong></p>
<ul>
<li>
<p><code>overdue</code>: The last ping wasn't submitted on the current calendar day, but it's after
4am, so this ping submitted immediately</p>
</li>
<li>
<p><code>reschedule</code>: A ping was just submitted. This ping was rescheduled for the next calendar
day at 4am.</p>
</li>
<li>
<p><code>today</code>: The last ping wasn't submitted on the current calendar day, but it is
still before 4am, so schedule to send this ping on the current calendar
day at 4am.</p>
</li>
<li>
<p><code>tomorrow</code>: The last ping was already submitted on the current calendar day, so
schedule this ping for the next calendar day at 4am.</p>
</li>
<li>
<p><code>upgrade</code>: This ping was submitted at startup because the application was just
upgraded.</p>
</li>
</ul>
<p>All Glean pings contain built-in metrics in the <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-ping_info-section"><code>ping_info</code></a> and <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-client_info-section"><code>client_info</code></a> sections.</p>
<p>In addition to those built-in metrics, the following metrics are added to the ping:</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Data reviews</th><th>Extras</th><th>Expiration</th><th><a href="https://wiki.mozilla.org/Firefox/Data_Collection">Data Sensitivity</a></th></tr></thead><tbody>
<tr><td>glean.database.size</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/memory_distribution.html">memory_distribution</a></td><td>The size of the database file at startup.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1656589#c7">Bug 1656589</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.error.io</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/counter.html">counter</a></td><td>The number of times we encountered an IO error when writing a pending ping to disk.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1686233#c2">Bug 1686233</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.error.preinit_tasks_overflow</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/counter.html">counter</a></td><td>The number of tasks queued in the pre-initialization buffer. Only sent if the buffer overflows.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1609482#c3">Bug 1609482</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.time.invalid_timezone_offset</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/counter.html">counter</a></td><td>Counts the number of times we encountered an invalid timezone offset when trying to get the current time. A timezone offset is invalid if it is outside [-24h, +24h]. If invalid a UTC offset is used (+0h).</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1611770#c9">Bug 1611770</a></td><td></td><td>2021-06-30</td><td>1</td></tr>
<tr><td>glean.upload.deleted_pings_after_quota_hit</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/counter.html">counter</a></td><td>The number of pings deleted after the quota for the size of the pending pings directory or number of files is hit. Since quota is only calculated for the pending pings directory, and deletion request ping live in a different directory, deletion request pings are never deleted.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1601550#c3">Bug 1601550</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.upload.discarded_exceeding_pings_size</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/memory_distribution.html">memory_distribution</a></td><td>The size of pings that exceeded the maximum ping size allowed for upload.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1597761#c10">Bug 1597761</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.upload.pending_pings</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/counter.html">counter</a></td><td>The total number of pending pings at startup. This does not include deletion-request pings.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1665041#c23">Bug 1665041</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.upload.pending_pings_directory_size</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/memory_distribution.html">memory_distribution</a></td><td>The size of the pending pings directory upon initialization of Glean. This does not include the size of the deletion request pings directory.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1601550#c3">Bug 1601550</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.upload.ping_upload_failure</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/labeled_counters.html">labeled_counter</a></td><td>Counts the number of ping upload failures, by type of failure. This includes failures for all ping types, though the counts appear in the next successfully sent <code>metrics</code> ping.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1589124#c1">Bug 1589124</a></td><td><ul><li>status_code_4xx</li><li>status_code_5xx</li><li>status_code_unknown</li><li>unrecoverable</li><li>recoverable</li></ul></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td>never</td><td>1</td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td>glean.validation.first_run_hour</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/datetime.html">datetime</a></td><td>The hour of the first run of the application.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1680783#c5">Bug 1680783</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.validation.foreground_count</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/counter.html">counter</a></td><td>On mobile, the number of times the application went to foreground.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1683707#c2">Bug 1683707</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.validation.pings_submitted</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/labeled_counters.html">labeled_counter</a></td><td>A count of the pings submitted, by ping type.  This metric appears in both the metrics and baseline pings.  - On the metrics ping, the counts include the number of pings sent since   the last metrics ping (including the last metrics ping) - On the baseline ping, the counts include the number of pings send since   the last baseline ping (including the last baseline ping)</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1586764#c3">Bug 1586764</a></td><td></td><td>never</td><td>1</td></tr>
</tbody></table>
<p>Data categories are <a href="https://wiki.mozilla.org/Firefox/Data_Collection">defined here</a>.</p>
<!-- AUTOGENERATED BY glean_parser.  DO NOT EDIT. -->
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/collected-metrics/metrics.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#glean-pings" id="glean-pings">Glean Pings</a></h1>
<p>A ping is a bundle of related metrics, gathered in a payload to be transmitted.
The ping payload will be encoded in JSON format and contains one or more of the <a href="user/pings/index.html#ping-sections">common sections</a> with shared information data.</p>
<p>If data collection is enabled, the Glean SDK provides a set of built-in pings that are assembled out of the box without any developer intervention.  The following is a list of these built-in pings:</p>
<ul>
<li><a href="user/pings/baseline.html"><code>baseline</code> ping</a>: A small ping sent every time the application goes to foreground and background. Going to foreground also includes when the application starts.</li>
<li><a href="user/pings/metrics.html"><code>metrics</code> ping</a>: The default ping for metrics. Sent approximately daily.</li>
<li><a href="user/pings/events.html"><code>events</code> ping</a>: The default ping for events. Sent every time the application goes to background or a certain number of events is reached.</li>
<li><a href="user/pings/deletion_request.html"><code>deletion-request</code> ping</a>: Sent when the user disables telemetry in order to request a deletion of their data.</li>
</ul>
<p>Applications can also define and send their own <a href="user/pings/custom.html">custom pings</a> when the schedules of these pings is not suitable.</p>
<p>There is also a <a href="user/pings/ping-schedules-and-timings.html">high-level overview</a> of how the <code>metrics</code> and <code>baseline</code> pings relate and the timings they record.</p>
<h2><a class="header" href="#ping-sections" id="ping-sections">Ping sections</a></h2>
<p>Every ping has the following keys at the top-level:</p>
<ul>
<li>
<p>The <a href="user/pings/index.html#the-ping_info-section"><code>ping_info</code> section</a> contains core metadata that is included in <strong>every</strong> ping.</p>
</li>
<li>
<p>The <a href="user/pings/index.html#the-client_info-section"><code>client_info</code> section</a> contains information that identifies the client.
It is included in most pings (including all built-in pings), but may be excluded from pings where we don't want to connect client information with the other metrics in the ping.</p>
</li>
<li>
<p>The <code>metrics</code> section contains the submitted values for all metric types except for <a href="user/pings/../metrics/event.html">events</a>.
It has keys for each of the metric types, under which is data for each metric.</p>
</li>
<li>
<p>The <code>events</code> section contains the events recorded in the ping.</p>
</li>
</ul>
<p>See the <a href="user/pings/../../../dev/core/internal/payload.html">payload documentation</a> for more details for each metric type in the <code>metrics</code> and <code>events</code> section.</p>
<h3><a class="header" href="#the-ping_info-section" id="the-ping_info-section">The <code>ping_info</code> section</a></h3>
<p>The following fields are included in the <code>ping_info</code> section, for every ping.
Optional fields are marked accordingly.</p>
<table><thead><tr><th>Field name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>seq</code></td><td>Counter</td><td>A running counter of the number of times pings of this type have been sent</td></tr>
<tr><td><code>experiments</code></td><td>Object</td><td><em>Optional</em>. A dictionary of <a href="user/pings/index.html#the-experiments-object">active experiments</a></td></tr>
<tr><td><code>start_time</code></td><td>Datetime</td><td>The time of the start of collection of the data in the ping, in local time and with minute precision, including timezone information.</td></tr>
<tr><td><code>end_time</code></td><td>Datetime</td><td>The time of the end of collection of the data in the ping, in local time and with minute precision, including timezone information. This is also the time this ping was generated and is likely well before ping transmission time.</td></tr>
<tr><td><code>reason</code></td><td>String</td><td><em>Optional</em>. The reason the ping was submitted. The specific set of values and their meanings are defined for each metric type in the <code>reasons</code> field in the <code>pings.yaml</code> file.</td></tr>
</tbody></table>
<p>All the metrics surviving application restarts (e.g. <code>seq</code>, ...) are removed once the application using the Glean SDK is uninstalled.</p>
<h4><a class="header" href="#the-experiments-object" id="the-experiments-object">The <code>experiments</code> object</a></h4>
<p>This object (included in the <a href="user/pings/index.html#the-ping_info-section"><code>ping_info</code> section</a>) contains experiment annotations keyed by the experiment <code>id</code>. Each annotation contains the experiment <code>branch</code> the client is enrolled in and may contain a string to string map with additional data in the <code>extra</code> key. Both the <code>id</code> and <code>branch</code> are truncated to 30 characters.
See <a href="user/pings/../experiments-api.html">Using the Experiments API</a> on how to record experiments data.</p>
<pre><code class="language-json">{
  &quot;&lt;id&gt;&quot;: {
    &quot;branch&quot;: &quot;branch-id&quot;,
    &quot;extra&quot;: {
      &quot;some-key&quot;: &quot;a-value&quot;
    }
  }
}
</code></pre>
<h3><a class="header" href="#the-client_info-section" id="the-client_info-section">The <code>client_info</code> section</a></h3>
<p>The following fields are included in the <code>client_info</code> section.
Optional fields are marked accordingly.</p>
<table><thead><tr><th>Field name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>app_build</code></td><td>String</td><td>The build identifier generated by the CI system (e.g. &quot;1234/A&quot;). For language bindings that provide automatic detection for this value, (e.g. Android/Kotlin), in the unlikely event that the build identifier can not be retrieved from the OS, it is set to <code>inaccessible</code>. For other language bindings, if the value was not provided through configuration, this metric gets set to <code>Unknown</code>.</td></tr>
<tr><td><code>app_channel</code></td><td>String</td><td><em>Optional</em> The product-provided release channel (e.g. &quot;beta&quot;)</td></tr>
<tr><td><code>app_display_version</code></td><td>String</td><td>The user-visible version string (e.g. &quot;1.0.3&quot;). The meaning of the string (e.g. whether semver or a git hash) is application-specific. In the unlikely event this value can not be obtained from the OS, it is set to &quot;inaccessible&quot;. If it is accessible, but not set by the application, it is set to &quot;Unknown&quot;.</td></tr>
<tr><td><code>architecture</code></td><td>String</td><td>The architecture of the device (e.g. &quot;arm&quot;, &quot;x86&quot;)</td></tr>
<tr><td><code>client_id</code></td><td>UUID</td><td><em>Optional</em> A UUID identifying a profile and allowing user-oriented correlation of data</td></tr>
<tr><td><code>device_manufacturer</code></td><td>String</td><td><em>Optional</em> The manufacturer of the device</td></tr>
<tr><td><code>device_model</code></td><td>String</td><td><em>Optional</em> The model name of the device. On Android, this is <a href="https://developer.android.com/reference/android/os/Build.html#MODEL"><code>Build.MODEL</code></a>, the user-visible name of the device.</td></tr>
<tr><td><code>first_run_date</code></td><td>Datetime</td><td>The date of the first run of the application, in local time and with day precision, including timezone information.</td></tr>
<tr><td><code>os</code></td><td>String</td><td>The name of the operating system (e.g. &quot;linux&quot;, &quot;Android&quot;, &quot;ios&quot;)</td></tr>
<tr><td><code>os_version</code></td><td>String</td><td>The user-visible version of the operating system (e.g. &quot;1.2.3&quot;)</td></tr>
<tr><td><code>android_sdk_version</code></td><td>String</td><td><em>Optional</em>. The Android specific SDK version of the software running on this hardware device (e.g. &quot;23&quot;)</td></tr>
<tr><td><code>telemetry_sdk_build</code></td><td>String</td><td>The version of the Glean SDK</td></tr>
<tr><td><code>locale</code></td><td>String</td><td><em>Optional</em>. The locale of the application during initialization (e.g. &quot;es-ES&quot;). If the locale can't be determined on the system, the value is &quot;und&quot;, to indicate &quot;undetermined&quot;.</td></tr>
</tbody></table>
<p>All the metrics surviving application restarts (e.g. <code>client_id</code>, ...) are removed once the application using the Glean SDK is uninstalled.</p>
<h2><a class="header" href="#ping-submission" id="ping-submission">Ping submission</a></h2>
<p>The pings that the Glean SDK generates are submitted to the Mozilla servers at specific paths, in order to provide additional metadata without the need to unpack the ping payload.</p>
<p>A typical submission URL looks like</p>
<p><code>&quot;&lt;server-address&gt;/submit/&lt;application-id&gt;/&lt;doc-type&gt;/&lt;glean-schema-version&gt;/&lt;document-id&gt;&quot;</code></p>
<p>where:</p>
<ul>
<li><code>&lt;server-address&gt;</code>: the address of the server that receives the pings;</li>
<li><code>&lt;application-id&gt;</code>: a unique application id, automatically detected by the Glean SDK; this is the value returned by <a href="http://developer.android.com/reference/android/content/Context.html#getPackageName()"><code>Context.getPackageName()</code></a>;</li>
<li><code>&lt;doc-type&gt;</code>: the name of the ping; this can be one of the pings available out of the box with the Glean SDK, or a custom ping;</li>
<li><code>&lt;glean-schema-version&gt;</code>: the version of the Glean ping schema;</li>
<li><code>&lt;document-id&gt;</code>: a unique identifier for this ping.</li>
</ul>
<h3><a class="header" href="#limitations" id="limitations">Limitations</a></h3>
<p>To keep resource usage in check, the Glean SDK enforces some limitations on ping uploading and ping storage.</p>
<ul>
<li><strong>Rate limiting</strong>: only up to 10 ping submissions every 60 seconds are allowed. There are no exposed methods to change these rate limiting defaults yet, follow <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1647630">Bug 1647630</a> for updates.</li>
<li><strong>Request body size limiting</strong>: the body of a ping request may have up to 1MB. Pings that exceed this size are discarded and don't get uploaded. Size and number of discarded pings are recorded on the internal Glean metric <a href="user/pings/../collected-metrics/metrics.html#metrics-1"><code>glean.upload.discarded_exceeding_pings_size</code></a>.</li>
<li><strong>Storage quota</strong>: Pending pings are stored on disk. The storage directory is scanned every time Glean is initialized and upon scanning Glean checks its size. If this directory exceeds a size of 10MB or 250 pending ping files, pings are deleted to get the directory back to an accepted size. Pings are deleted oldest first, until the directory size is below the quota.
The number of deleted pings due to exceeding storage quota is recorded on the metric <a href="user/pings/../collected-metrics/metrics.html#metrics-1"><code>glean.upload.deleted_pings_after_quota_hit</code></a> and the size of the pending pings directory is recorded (regardless on whether quota has been reached) on the metric <a href="user/pings/../collected-metrics/metrics.html#metrics-1"><code>glean.upload.pending_pings_directory_size</code></a>
<strong>Note</strong> Deletion request pings are stored in a different directory, are not subject to this limitation and never get deleted.</li>
</ul>
<h3><a class="header" href="#submitted-headers" id="submitted-headers">Submitted headers</a></h3>
<p>A pre-defined set of headers is additionally sent along with the submitted ping:</p>
<table><thead><tr><th>Header</th><th>Value</th><th>Description</th></tr></thead><tbody>
<tr><td><code>Content-Type</code></td><td><code>application/json; charset=utf-8</code></td><td>Describes the data sent to the server</td></tr>
<tr><td><code>User-Agent</code></td><td>Defaults to e.g. <code>Glean/0.40.0 (Kotlin on Android)</code>, where <code>0.40.0</code> is the Glean SDK version number and <code>Kotlin on Android</code> is the name of the language used by the binding that sent the request plus the name of the platform it is running on.</td><td>Describes the application sending the ping using the Glean SDK</td></tr>
<tr><td><code>Date</code></td><td>e.g. <code>Mon, 23 Jan 2019 10:10:10 GMT+00:00</code></td><td>Submission date/time in GMT/UTC+0 offset</td></tr>
<tr><td><code>X-Client-Type</code></td><td><code>Glean</code></td><td>Custom header to support handling of Glean pings in the legacy pipeline</td></tr>
<tr><td><code>X-Client-Version</code></td><td>e.g. <code>0.40.0</code></td><td>The Glean SDK version, sent as a custom header to support handling of Glean pings in the legacy pipeline</td></tr>
<tr><td><code>X-Debug-ID</code></td><td><em>Optional</em>, e.g. <code>test-tag</code></td><td>Debug header attached to Glean pings when using the <a href="user/pings/../../user/debugging/index.html">debug tools</a></td></tr>
<tr><td><code>X-Source-Tags</code></td><td><em>Optional</em>, e.g. <code>automation, perf</code></td><td>A list of tags to associate with the ping, useful for clustering pings at analysis time, for example to tell data generated from CI from other data.</td></tr>
</tbody></table>
<h2><a class="header" href="#defining-foreground-and-background-state" id="defining-foreground-and-background-state">Defining foreground and background state</a></h2>
<p>These docs refer to application 'foreground' and 'background' state in several places.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<h3><a class="header" href="#foreground" id="foreground">Foreground</a></h3>
<p>For Android, this specifically means the activity becomes visible to the user, it has entered the <code>Started</code> state, and the system invokes the <a href="https://developer.android.com/reference/android/app/Activity.html#onStart()"><code>onStart()</code></a> callback.</p>
<h3><a class="header" href="#background" id="background">Background</a></h3>
<p>This specifically means when the activity is no longer visible to the user, it has entered the <code>Stopped</code> state, and the system invokes the <a href="https://developer.android.com/reference/android/app/Activity.html#onStop()"><code>onStop()</code></a> callback.</p>
<p>This may occur, if the user uses <code>Overview</code> button to change to another app, the user presses the <code>Back</code> button and
navigates to a previous application or the home screen, or if the user presses the <code>Home</code> button to return to the
home screen.  This can also occur if the user navigates away from the application through some notification or
other means.</p>
<p>The system may also call <code>onStop()</code> when the activity has finished running, and is about to be terminated.</p>
</div>
<div data-lang="Swift" class="tab">
<h3><a class="header" href="#foreground-1" id="foreground-1">Foreground</a></h3>
<p>For iOS, the Glean SDK attaches to the <a href="https://developer.apple.com/documentation/uikit/uiapplication/1622944-willenterforegroundnotification"><code>willEnterForegroundNotification</code></a>.
This notification is posted by the OS shortly before an app leaves the background state on its way to becoming the active app.</p>
<h3><a class="header" href="#background-1" id="background-1">Background</a></h3>
<p>For iOS, this specifically means when the app is no longer visible to the user, or when the <code>UIApplicationDelegate</code>
receives the <a href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1622997-applicationdidenterbackground"><code>applicationDidEnterBackground</code></a> event.</p>
<p>This may occur if the user opens the task switcher to change to another app, or if the user presses the <code>Home</code> button
to show the home screen.  This can also occur if the user navigates away from the app through a notification or other
means.</p>
<blockquote>
<p><strong>Note:</strong> Glean does not currently support <a href="https://developer.apple.com/documentation/uikit/app_and_environment/managing_your_app_s_life_cycle">Scene based lifecycle events</a> that were introduced in iOS 13.</p>
</blockquote>
</div>
</div>
</div>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/index.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#ping-schedules-and-timings-overview" id="ping-schedules-and-timings-overview">Ping schedules and timings overview</a></h1>
<p>Full reference details about the <a href="user/pings/metrics.html"><code>metrics</code></a> and <a href="user/pings/baseline.html"><code>baseline</code></a> ping schedules are detailed elsewhere.</p>
<p>The following diagram shows a typical timeline of a mobile application, when pings are sent and what timing-related information is included.</p>
<p><img src="user/pings/ping_timing.svg" alt="ping timeline diagram" /></p>
<p>There are two distinct runs of the application, where the OS shutdown the application at the end of Run 1, and the user started it up again at the beginning of Run 2.</p>
<p>There are three distinct foreground sessions, where the application was visible on the screen and the user was able to interact with it.</p>
<p>The rectangles for the <code>baseline</code> and <code>metrics</code> pings represent the measurement windows of those pings, which always start exactly at the end of the preceding ping.  The <code>ping_info.start_time</code> and <code>ping_info.end_time</code> metrics included in these pings correspond to these beginning and the end of their measurement windows.</p>
<p>The <code>baseline.duration</code> metric (included only in <code>baseline</code> pings) corresponds to amount of time the application spent on the foreground, which, since measurement window always extend to the next ping, is not always the same thing as the <code>baseline</code> ping's measurement window.</p>
<p>The <code>submission_timestamp</code> is the time the ping was received at the telemetry endpoint, added by the ingestion pipeline.  It is not exactly the same as <code>ping_info.end_time</code>, since there may be various networking and system latencies both on the client and in the ingestion pipeline (represented by the dotted horizontal line, not to scale).  Also of note is that <code>start_time</code>/<code>end_time</code> are measured using the client's real-time clock in its local timezone, which is not a fully reliable source of time.</p>
<p>The &quot;Baseline 4&quot; ping illustrates an important corner case. When &quot;Session 2&quot; ended, the OS also shut down the entire process, and the Glean SDK did not have an opportunity to send a <code>baseline</code> ping immediately.  In this case, it is sent at the next available opportunity when the application starts up again in &quot;Run 2&quot;.  This <code>baseline</code> ping is annotated with the reason code <code>dirty_startup</code>.</p>
<p>The &quot;Metrics 2&quot; ping likewise illustrates another important corner case. &quot;Metrics 1&quot; was able to be sent at the target time of 04:00 (local device time) because the application was currently running.  However, the next time 04:00 came around, the application was not active, so the Glean SDK was unable to send a <code>metrics</code> ping.  It is sent at the next available opportunity, when the application starts up again in &quot;Run 2&quot;.  This <code>metrics</code> ping is annotated with the reason code <code>overdue</code>.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/ping-schedules-and-timings.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#the-baseline-ping" id="the-baseline-ping">The <code>baseline</code> ping</a></h1>
<h2><a class="header" href="#description" id="description">Description</a></h2>
<p>This ping is intended to provide metrics that are managed by the Glean SDK itself, and not explicitly set by the application or included in the application's <code>metrics.yaml</code> file.</p>
<blockquote>
<p><strong>Note:</strong> As the <code>baseline</code> ping was specifically designed for mobile operating systems, it is not sent when using the Glean Python bindings.</p>
</blockquote>
<h2><a class="header" href="#scheduling" id="scheduling">Scheduling</a></h2>
<p>The <code>baseline</code> ping is automatically submitted with a <code>reason: active</code> when the application becomes active (on mobile it means getting to <a href="user/pings/index.html#defining-foreground-and-background-state">foreground</a>).  These baseline pings do not contain <code>duration</code>.</p>
<p>The <code>baseline</code> ping is automatically submitted with a <code>reason: inactive</code> when the application becomes inactive (on mobile it means getting to <a href="user/pings/index.html#defining-foreground-and-background-state">background</a>).
If no <code>baseline</code> ping is triggered when becoming inactive (e.g. the process is abruptly killed) a <code>baseline</code> ping with reason <code>dirty_startup</code> will be submitted on the next application startup. This only happens from the second application start onward.</p>
<p>See also the <a href="user/pings/ping-schedules-and-timings.html">ping schedules and timing overview</a>.</p>
<h2><a class="header" href="#contents" id="contents">Contents</a></h2>
<p>The <code>baseline</code> ping also includes the common <a href="user/pings/index.html#ping-sections">ping sections</a> found in all pings.</p>
<p>It also includes a number of <a href="user/pings/../collected-metrics/metrics.html#baseline">metrics defined in the Glean SDK itself</a>.</p>
<h3><a class="header" href="#querying-ping-contents" id="querying-ping-contents">Querying ping contents</a></h3>
<p>A quick note about querying ping contents (i.e. for <a href="https://sql.telemetry.mozilla.org">sql.telemetry.mozilla.org</a>):  Each metric in the baseline ping is organized by its metric type, and uses a namespace of <code>glean.baseline</code>. For instance, in order to select <code>duration</code> you would use <code>metrics.timespan['glean.baseline.duration']</code>. If you were trying to select a String based metric such as <code>os</code>, then you would use <code>metrics.string['glean.baseline.os']</code></p>
<h2><a class="header" href="#example-baseline-ping" id="example-baseline-ping">Example baseline ping</a></h2>
<pre><code class="language-json">{
  &quot;ping_info&quot;: {
    &quot;experiments&quot;: {
      &quot;third_party_library&quot;: {
        &quot;branch&quot;: &quot;enabled&quot;
      }
    },
    &quot;seq&quot;: 0,
    &quot;start_time&quot;: &quot;2019-03-29T09:50-04:00&quot;,
    &quot;end_time&quot;: &quot;2019-03-29T09:53-04:00&quot;,
    &quot;reason&quot;: &quot;foreground&quot;
  },
  &quot;client_info&quot;: {
    &quot;telemetry_sdk_build&quot;: &quot;0.49.0&quot;,
    &quot;first_run_date&quot;: &quot;2019-03-29-04:00&quot;,
    &quot;os&quot;: &quot;Android&quot;,
    &quot;android_sdk_version&quot;: &quot;27&quot;,
    &quot;os_version&quot;: &quot;8.1.0&quot;,
    &quot;device_manufacturer&quot;: &quot;Google&quot;,
    &quot;device_model&quot;: &quot;Android SDK built for x86&quot;,
    &quot;architecture&quot;: &quot;x86&quot;,
    &quot;app_build&quot;: &quot;1&quot;,
    &quot;app_display_version&quot;: &quot;1.0&quot;,
    &quot;client_id&quot;: &quot;35dab852-74db-43f4-8aa0-88884211e545&quot;
  },
  &quot;metrics&quot;: {
    &quot;timespan&quot;: {
      &quot;glean.baseline.duration&quot;: {
        &quot;value&quot;: 52,
        &quot;time_unit&quot;: &quot;second&quot;
      }
    }
  }
}
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/baseline.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#the-deletion-request-ping" id="the-deletion-request-ping">The <code>deletion-request</code> ping</a></h1>
<h2><a class="header" href="#description-1" id="description-1">Description</a></h2>
<p>This ping is submitted when a user opts out of sending technical and interaction data.</p>
<p>This ping contains the client id.</p>
<p>This ping is intended to communicate to the Data Pipeline that the user wishes to have their reported Telemetry data deleted.
As such it attempts to send itself at the moment the user opts out of data collection, and continues to try and send itself.</p>
<blockquote>
<p><strong>Note:</strong> It is possible to send secondary ids in the deletion request ping.  For instance, if the application is migrating
from legacy telemetry to Glean, the legacy client ids can be added to the deletion request ping by creating a <code>metrics.yaml</code>
entry for the id to be added with a <code>send_in_pings</code> value of <code>deletion_request</code>.</p>
<p>An example <code>metrics.yaml</code> entry might look like this:</p>
<pre><code>legacy_client_id:
   type: uuid
   description:
     A UUID uniquely identifying the legacy client.
   send_in_pings:
     - deletion_request
   ...
</code></pre>
</blockquote>
<h2><a class="header" href="#scheduling-1" id="scheduling-1">Scheduling</a></h2>
<p>The <code>deletion-request</code> ping is automatically submitted when upload is disabled in Glean.
If upload fails, it is retried after Glean is initialized.</p>
<h2><a class="header" href="#contents-1" id="contents-1">Contents</a></h2>
<p>The <code>deletion-request</code> does not contain additional metrics aside from secondary ids that have been added.</p>
<h2><a class="header" href="#example-deletion-request-ping" id="example-deletion-request-ping">Example <code>deletion-request</code> ping</a></h2>
<pre><code class="language-json">{
  &quot;ping_info&quot;: {
    &quot;seq&quot;: 0,
    &quot;start_time&quot;: &quot;2019-12-06T09:50-04:00&quot;,
    &quot;end_time&quot;: &quot;2019-12-06T09:53-04:00&quot;
  },
  &quot;client_info&quot;: {
    &quot;telemetry_sdk_build&quot;: &quot;22.0.0&quot;,
    &quot;first_run_date&quot;: &quot;2019-03-29-04:00&quot;,
    &quot;os&quot;: &quot;Android&quot;,
    &quot;android_sdk_version&quot;: &quot;28&quot;,
    &quot;os_version&quot;: &quot;9&quot;,
    &quot;device_manufacturer&quot;: &quot;Google&quot;,
    &quot;device_model&quot;: &quot;Android SDK built for x86&quot;,
    &quot;architecture&quot;: &quot;x86&quot;,
    &quot;app_build&quot;: &quot;1&quot;,
    &quot;app_display_version&quot;: &quot;1.0&quot;,
    &quot;client_id&quot;: &quot;35dab852-74db-43f4-8aa0-88884211e545&quot;
  },
  &quot;metrics&quot;: {
    &quot;uuid&quot;: {
      &quot;legacy_client_id&quot;: &quot;5faffa6d-6147-4d22-a93e-c1dbd6e06171&quot;
    }
  }
}
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/deletion_request.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#the-metrics-ping" id="the-metrics-ping">The <code>metrics</code> ping</a></h1>
<h2><a class="header" href="#description-2" id="description-2">Description</a></h2>
<p>The <code>metrics</code> ping is intended for all of the metrics that are explicitly set by the application or are included in the application's <code>metrics.yaml</code> file (except events). 
The reported data is tied to the ping's <em>measurement window</em>, which is the time between the collection of two <code>metrics</code> pings. 
Ideally, this window is expected to be about 24 hours, given that the collection is scheduled daily at 04:00. 
However, the metrics ping is only submitted while the application is actually running, so in practice, it may not meet the 04:00 target very frequently.
Data in the <a href="user/pings/index.html#the-ping_info-section"><code>ping_info</code></a> section of the ping can be used to infer the length of this window and the reason that triggered the ping to be submitted.
If the application crashes, unsent recorded metrics are sent along with the next <code>metrics</code> ping.</p>
<p>Additionally, it is undesirable to mix metric recording from different versions of the application. Therefore, if a version upgrade is detected, the <code>metrics</code> ping is collected immediately before further metrics from the new version are recorded.</p>
<blockquote>
<p><strong>Note:</strong> As the <code>metrics</code> ping was specifically designed for mobile operating systems, it is not sent when using the Glean Python bindings.</p>
</blockquote>
<h2><a class="header" href="#scheduling-2" id="scheduling-2">Scheduling</a></h2>
<p>The desired behavior is to collect the ping at the first available opportunity after 04:00 local time on a new calendar day, but given constraints of the platform, it can only be submitted while the application is running. 
This breaks down into three scenarios:</p>
<ol>
<li>the application was just installed;</li>
<li>the application was just upgraded (the version of the app is different from the last time the app was run);</li>
<li>the application was just started (after a crash or a long inactivity period);</li>
<li>the application was running at 04:00.</li>
</ol>
<p>In the first case, since the application was just installed, if the due time for the current calendar day has passed, a <code>metrics</code> ping is immediately generated and scheduled for sending (reason code <code>overdue</code>). Otherwise, if the due time for the current calendar day has not passed, a ping collection is scheduled for that time (reason code <code>today</code>). </p>
<p>In the second case, if a version change is detected at startup, the metrics ping is immediately submitted so that metrics from one version are not aggregated with metrics from another version (reason code <code>upgrade</code>).</p>
<p>In the third case, if the <code>metrics</code> ping was not already collected on the current calendar day, and it is before 04:00, a collection is scheduled for 04:00 on the current calendar day (reason code <code>today</code>).
If it is after 04:00, a new collection is scheduled immediately (reason code <code>overdue</code>).
Lastly, if a ping was already collected on the current calendar day, the next one is scheduled for collecting at 04:00 on the next calendar day (reason code <code>tomorrow</code>).</p>
<p>In the fourth and last case, the application is running during a scheduled ping collection time.
The next ping is scheduled for 04:00 the next calendar day (reason code <code>reschedule</code>).</p>
<p>More <a href="user/pings/metrics.html#scheduling-examples">scheduling examples</a> are included below.</p>
<p>See also the <a href="user/pings/ping-schedules-and-timings.html">ping schedules and timing overview</a>.</p>
<h2><a class="header" href="#contents-2" id="contents-2">Contents</a></h2>
<p>The <code>metrics</code> ping contains all of the metrics defined in <code>metrics.yaml</code> (except events) that don't specify a ping or where <code>default</code> is specified in their <a href="https://mozilla.github.io/glean_parser/metrics-yaml.html#send-in-pings"><code>send in pings</code></a> property.</p>
<p>Additionally, error metrics in the <code>glean.error</code> category are included in the <code>metrics</code> ping.</p>
<p>The <code>metrics</code> ping shall also include the common <a href="user/pings/index.html#the-ping_info-section"><code>ping_info</code></a> and <a href="user/pings/index.html#the-client_info-section">'client_info'</a> sections.  It also includes a number of <a href="user/pings/../collected-metrics/metrics.html#metrics-1">metrics defined in the Glean SDK itself</a>.</p>
<h3><a class="header" href="#querying-ping-contents-1" id="querying-ping-contents-1">Querying ping contents</a></h3>
<p>Information about query ping contents is available in <a href="https://docs.telemetry.mozilla.org/concepts/glean/accessing_glean_data.html">Accessing Glean data</a> in the Firefox data docs.</p>
<h2><a class="header" href="#scheduling-examples" id="scheduling-examples">Scheduling Examples</a></h2>
<h3><a class="header" href="#crossing-due-time-with-the-application-closed" id="crossing-due-time-with-the-application-closed">Crossing due time with the application closed</a></h3>
<ol>
<li>
<p>The application is opened on Feb 7 on 15:00, closed on 15:05.</p>
<ul>
<li>Glean records one metric A (say startup time in ms) during this measurement window MW1.</li>
</ul>
</li>
<li>
<p>The application is opened again on Feb 8 on 17:00.</p>
</li>
</ol>
<ul>
<li>
<p>Glean notes that we passed local 04:00 since MW1.</p>
</li>
<li>
<p>Glean closes MW1, with:</p>
<ul>
<li><code>start_time=Feb7/15:00</code>;</li>
<li><code>end_time=Feb8/17:00</code>.</li>
</ul>
</li>
<li>
<p>Glean records metric A again, into MW2, which has a start_time of Feb8/17:00.</p>
</li>
</ul>
<h3><a class="header" href="#crossing-due-time-and-changing-timezones" id="crossing-due-time-and-changing-timezones">Crossing due time and changing timezones</a></h3>
<ol>
<li>
<p>The application is opened on Feb 7 on 15:00 in timezone UTC, closed on 15:05.</p>
<ul>
<li>Glean records one metric A (say startup time in ms) during this measurement window MW1.</li>
</ul>
</li>
<li>
<p>The application is opened again on Feb 8 on 17:00 in timezone UTC+1.</p>
<ul>
<li>
<p>Glean notes that we passed local 04:00 UTC+1 since MW1.</p>
</li>
<li>
<p>Glean closes MW1, with:</p>
<ul>
<li><code>start_time=Feb7/15:00/UTC</code>;</li>
<li><code>end_time=Feb8/17:00/UTC+1</code>.</li>
</ul>
</li>
<li>
<p>Glean records metric A again, into MW2.</p>
</li>
</ul>
</li>
</ol>
<h3><a class="header" href="#the-application-doesnt-run-in-a-week" id="the-application-doesnt-run-in-a-week">The application doesn’t run in a week</a></h3>
<ol>
<li>
<p>The application is opened on Feb 7 on 15:00 in timezone UTC, closed on 15:05.</p>
<ul>
<li>Glean records one metric A (say startup time in ms) during this measurement window MW1.</li>
</ul>
</li>
<li>
<p>The application is opened again on Feb 16 on 17:00 in timezone UTC.</p>
<ul>
<li>
<p>Glean notes that we passed local 04:00 UTC since MW1.</p>
</li>
<li>
<p>Glean closes MW1, with:</p>
<ul>
<li><code>start_time=Feb7/15:00/UTC</code>;</li>
<li><code>end_time=Feb16/17:00/UTC</code>.</li>
</ul>
</li>
<li>
<p>Glean records metric A again, into MW2.</p>
</li>
</ul>
</li>
</ol>
<h3><a class="header" href="#the-application-doesnt-run-for-a-week-and-when-its-finally-re-opened-the-timezone-has-changed" id="the-application-doesnt-run-for-a-week-and-when-its-finally-re-opened-the-timezone-has-changed">The application doesn’t run for a week, and when it’s finally re-opened the timezone has changed</a></h3>
<ol>
<li>
<p>The application is opened on Feb 7 on 15:00 in timezone UTC, closed on 15:05.</p>
<ul>
<li>Glean records one metric A (say startup time in ms) during this measurement window MW1.</li>
</ul>
</li>
<li>
<p>The application is opened again on Feb 16 on 17:00 in timezone UTC+1.</p>
<ul>
<li>
<p>Glean notes that we passed local 04:00 UTC+1 since MW1.</p>
</li>
<li>
<p>Glean closes MW1, with:</p>
<ul>
<li><code>start_time=Feb7/15:00/UTC</code></li>
<li><code>end_time=Feb16/17:00/UTC+1</code>.</li>
</ul>
</li>
<li>
<p>Glean records metric A again, into MW2.</p>
</li>
</ul>
</li>
</ol>
<h3><a class="header" href="#the-user-changes-timezone-in-an-extreme-enough-fashion-that-they-cross-0400-twice-on-the-same-date" id="the-user-changes-timezone-in-an-extreme-enough-fashion-that-they-cross-0400-twice-on-the-same-date">The user changes timezone in an extreme enough fashion that they cross 04:00 twice on the same date</a></h3>
<ol>
<li>
<p>The application is opened on Feb 7 at 15:00 in timezone UTC+11, closed at 15:05.</p>
<ul>
<li>Glean records one metric A (say startup time in ms) during this measurement window MW1.</li>
</ul>
</li>
<li>
<p>The application is opened again on Feb 8 at 04:30 in timezone UTC+11.</p>
<ul>
<li>
<p>Glean notes that we passed local 04:00 UTC+11.</p>
</li>
<li>
<p>Glean closes MW1, with:</p>
<ul>
<li><code>start_time=Feb7/15:00/UTC+11</code>;</li>
<li><code>end_time=Feb8/04:30/UTC+11</code>.</li>
</ul>
</li>
<li>
<p>Glean records metric A again, into MW2.</p>
</li>
</ul>
</li>
<li>
<p>The user changes to timezone UTC-10 and opens the application at Feb 7 at 22:00 in timezone UTC-10</p>
<ul>
<li>Glean records metric A again, into MW2 (not MW1, which was already sent).</li>
</ul>
</li>
<li>
<p>The user opens the application at Feb 8 05:00 in timezone UTC-10</p>
<ul>
<li>Glean notes that we have not yet passed local 04:00 on Feb 9</li>
<li>Measurement window MW2 remains the current measurement window</li>
</ul>
</li>
<li>
<p>The user opens the application at Feb 9 07:00 in timezone UTC-10</p>
<ul>
<li>
<p>Glean notes that we have passed local 04:00 on Feb 9</p>
</li>
<li>
<p>Glean closes MW2 with:</p>
<ul>
<li><code>start_time=Feb8/04:30/UTC+11</code>;</li>
<li><code>end_time=Feb9/19:00/UTC-10</code>.</li>
</ul>
</li>
<li>
<p>Glean records metric A again, into MW3.</p>
</li>
</ul>
</li>
</ol>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/metrics.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#the-events-ping" id="the-events-ping">The <code>events</code> ping</a></h1>
<h2><a class="header" href="#description-3" id="description-3">Description</a></h2>
<p>The events ping's purpose is to transport all of the event metric information.
If the application crashes, an <code>events</code> ping is generated next time the application starts with events that were not sent before the crash.</p>
<h2><a class="header" href="#scheduling-3" id="scheduling-3">Scheduling</a></h2>
<p>The <code>events</code> ping is collected under the following circumstances:</p>
<ol>
<li>
<p>Normally, it is collected when the application becomes inactive (on mobile, this means going to <a href="user/pings/index.html#defining-foreground-and-background-state">background</a>), if there are any recorded events to send.</p>
</li>
<li>
<p>When the queue of events exceeds <code>Glean.configuration.maxEvents</code> (default 500).</p>
</li>
<li>
<p>If there are any unsent events found on disk when starting the application. It would be impossible to coordinate the timestamps across a reboot, so it's best to just collect all events from the previous run into their own ping, and start over.</p>
</li>
</ol>
<p>All of these cases are handled automatically, with no intervention or configuration required by the application.</p>
<blockquote>
<p><strong>Note:</strong> Since the Python bindings don't have a concept of &quot;going to background&quot;, case (1) above does not apply.</p>
</blockquote>
<h2><a class="header" href="#contents-3" id="contents-3">Contents</a></h2>
<p>At the top-level, this ping contains the following keys:</p>
<ul>
<li>
<p><code>ping_info</code>: The information <a href="user/pings/index.html#the-ping_info-section">common to all pings</a>.</p>
</li>
<li>
<p><code>events</code>: An array of all of the events that have occurred since the last time the <code>events</code> ping was sent.</p>
</li>
</ul>
<p>Each entry in the <code>events</code> array is an object with the following properties:</p>
<ul>
<li>
<p><code>&quot;timestamp&quot;</code>: The milliseconds relative to the first event in the ping.</p>
</li>
<li>
<p><code>&quot;category&quot;</code>: The category of the event, as defined by its location in the <code>metrics.yaml</code> file.</p>
</li>
<li>
<p><code>&quot;name&quot;</code>: The name of the event, as defined in the <code>metrics.yaml</code> file.</p>
</li>
<li>
<p><code>&quot;extra&quot;</code> (optional): A mapping of strings to strings providing additional data about the event. The keys are restricted to 40 characters and values in this map will never exceed 100 characters.</p>
</li>
</ul>
<h3><a class="header" href="#example-event-json" id="example-event-json">Example event JSON</a></h3>
<pre><code class="language-json">{
  &quot;ping_info&quot;: {
    &quot;experiments&quot;: {
      &quot;third_party_library&quot;: {
        &quot;branch&quot;: &quot;enabled&quot;
      }
    },
    &quot;seq&quot;: 0,
    &quot;start_time&quot;: &quot;2019-03-29T09:50-04:00&quot;,
    &quot;end_time&quot;: &quot;2019-03-29T10:02-04:00&quot;
  },
  &quot;client_info&quot;: {
    &quot;telemetry_sdk_build&quot;: &quot;0.49.0&quot;,
    &quot;first_run_date&quot;: &quot;2019-03-29-04:00&quot;,
    &quot;os&quot;: &quot;Android&quot;,
    &quot;android_sdk_version&quot;: &quot;27&quot;,
    &quot;os_version&quot;: &quot;8.1.0&quot;,
    &quot;device_manufacturer&quot;: &quot;Google&quot;,
    &quot;device_model&quot;: &quot;Android SDK built for x86&quot;,
    &quot;architecture&quot;: &quot;x86&quot;,
    &quot;app_build&quot;: &quot;1&quot;,
    &quot;app_display_version&quot;: &quot;1.0&quot;,
    &quot;client_id&quot;: &quot;35dab852-74db-43f4-8aa0-88884211e545&quot;
  },
  &quot;events&quot;: [
    {
      &quot;timestamp&quot;: 123456789,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;,
      &quot;extra&quot;: {
        &quot;metadata1&quot;: &quot;extra&quot;,
        &quot;metadata2&quot;: &quot;more_extra&quot;
      }
    },
    {
      &quot;timestamp&quot;: 123456791,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;
    }
  ]
}
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/events.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#custom-pings" id="custom-pings">Custom pings</a></h1>
<p>Applications can define metrics that are sent in custom pings. Unlike the built-in pings, custom pings are sent explicitly by the application.</p>
<p>This is useful when the scheduling of the built-in pings (<a href="user/pings/metrics.html">metrics</a>, <a href="user/pings/baseline.html">baseline</a> and <a href="user/pings/events.html">events</a>) are not appropriate for your data.  Since the timing of the submission of custom pings is handled by the application, the measurement window is under the application's control.</p>
<p>This is especially useful when metrics need to be tightly related to one another, for example when you need to measure the distribution of frame paint times when a particular rendering backend is in use.  If these metrics were in different pings, with different measurement windows, it is much harder to do that kind of reasoning with much certainty.</p>
<h2><a class="header" href="#defining-a-custom-ping" id="defining-a-custom-ping">Defining a custom ping</a></h2>
<p>Custom pings must be defined in a <a href="https://mozilla.github.io/glean_parser/pings-yaml.html"><code>pings.yaml</code> file</a>, which is in the same directory alongside your app's <code>metrics.yaml</code> file.</p>
<p>Ping names are limited to lowercase letters from the <a href="https://en.wikipedia.org/wiki/ISO_basic_Latin_alphabet">ISO basic Latin alphabet</a>
and hyphens and a maximum of 30 characters.</p>
<p>Each ping has the following parameters:</p>
<ul>
<li><code>description</code> (required): A textual description describing the purpose of the ping. It may contain <a href="https://www.markdownguide.org/basic-syntax/">markdown syntax</a>.</li>
<li><code>include_client_id</code> (required): A boolean indicating whether to include the
<code>client_id</code> in the <a href="user/pings/index.html#the-client_info-section"><code>client_info</code> section</a>).</li>
<li><code>send_if_empty</code> (optional, default: false): A boolean indicating if the ping is sent if it contains no metric data.</li>
<li><code>reasons</code> (optional, default: <code>{}</code>): The reasons that this ping may be sent. The keys are the reason codes, and the values are a textual description of each reason. The ping payload will (optionally) contain one of these reasons in the <code>ping_info.reason</code> field.</li>
</ul>
<p>In addition to these parameters, pings also support the parameters related to data review and expiration defined in <a href="user/pings/../metric-parameters.html">common metric parameters</a>: <code>description</code>, <code>notification_emails</code>, <code>bugs</code>, and <code>data_reviews</code>.</p>
<p>For example, to define a custom ping called <code>search</code> specifically for search information:</p>
<pre><code class="language-YAML"># Required to indicate this is a `pings.yaml` file
$schema: moz://mozilla.org/schemas/glean/pings/2-0-0

search:
  description: &gt;
    A ping to record search data.
  include_client_id: false
  notification_emails:
    - CHANGE-ME@example.com
  bugs:
    - http://bugzilla.mozilla.org/123456789/
  data_reviews:
    - http://example.com/path/to/data-review
</code></pre>
<blockquote>
<p>Note: the names <code>baseline</code>, <code>metrics</code>, <code>events</code>, <code>deletion-request</code> and <code>all-pings</code> are reserved and may not be used as the name of a custom ping.</p>
</blockquote>
<h2><a class="header" href="#loading-custom-ping-metadata-into-your-application-or-library" id="loading-custom-ping-metadata-into-your-application-or-library">Loading custom ping metadata into your application or library</a></h2>
<p>The Glean SDK build generates code from <code>pings.yaml</code> in a <code>Pings</code> object, which must be instantiated so Glean can send pings by name.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>In Kotlin, this object must be registered with the Glean SDK from your startup code before calling <code>Glean.initialize</code>
(such as in your application's <code>onCreate</code> method or a function called from that method).</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Pings

override fun onCreate() {
    Glean.registerPings(Pings)

    Glean.initialize(applicationContext, uploadEnabled = true)
}
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<p>In Swift, this object must be registered with the Glean SDK from your startup code before calling <code>Glean.shared.initialize</code>
(such as in your application's <code>UIApplicationDelegate</code> <a href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1622921-application"><code>application(_:didFinishLaunchingWithOptions:)</code></a> method or a function called from that method).</p>
<pre><code class="language-swift">import Glean

@UIApplicationMain
class AppDelegate: UIResponder, UIApplicationDelegate {
    func application(_: UIApplication, didFinishLaunchingWithOptions _: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool {
        Glean.shared.registerPings(GleanMetrics.Pings)

        Glean.shared.initialize(uploadEnabled = true)
    }
}
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>For Python, the <code>pings.yaml</code> file must be available and loaded at runtime.</p>
<p>If your project is a script (i.e. just Python files in a directory), you can load the <code>pings.yaml</code> before calling <code>Glean.initialize</code> using:</p>
<pre><code class="language-python">from glean import load_pings

pings = load_pings(&quot;pings.yaml&quot;)

Glean.initialize(
    application_id=&quot;my-app-id&quot;,
    application_version=&quot;0.1.0&quot;,
    upload_enabled=True,
)
</code></pre>
<p>If your project is a distributable Python package, you need to include the <code>pings.yaml</code> file using <a href="https://setuptools.readthedocs.io/en/latest/setuptools.html#including-data-files">one of the myriad ways to include data in a Python package</a> and then use <a href="https://setuptools.readthedocs.io/en/latest/pkg_resources.html#resource-extraction"><code>pkg_resources.resource_filename()</code></a> to get the filename at runtime.</p>
<pre><code class="language-Python">from glean import load_pings
from pkg_resources import resource_filename

pings = load_pings(resource_filename(__name__, &quot;pings.yaml&quot;))
</code></pre>
</div>
<div data-lang="C#" class="tab">
<p>In C#, this object must be registered with the Glean SDK from your startup code (such as in your application's <code>Main</code> method or a function called from that method).</p>
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Pings;

...

class Program
{
    static void Main(string[] args)
    {
        ...
        Glean.RegisterPings(Pings);
        ...
    }
}
</code></pre>
</div>
</div>
</div>
<h2><a class="header" href="#sending-metrics-in-a-custom-ping" id="sending-metrics-in-a-custom-ping">Sending metrics in a custom ping</a></h2>
<p>To send a metric on a custom ping, you add the custom ping's name to the <code>send_in_pings</code> parameter in the <code>metrics.yaml</code> file.</p>
<p>For example, to define a new metric to record the default search engine, which is sent in a custom ping called <code>search</code>, put <code>search</code> in the <code>send_in_pings</code> parameter.  Note that it is an error to specify a ping in <code>send_in_pings</code> that does not also have an entry in <code>pings.yaml</code>.</p>
<pre><code class="language-YAML">search.default:
  name:
    type: string
    description: &gt;
      The name of the default search engine.
    send_in_pings:
      - search
</code></pre>
<p>If this metric should also be sent in the default ping for the given metric type, you can add the special value <code>default</code> to <code>send_in_pings</code>:</p>
<pre><code class="language-YAML">    send_in_pings:
      - search
      - default
</code></pre>
<h2><a class="header" href="#submitting-a-custom-ping" id="submitting-a-custom-ping">Submitting a custom ping</a></h2>
<p>To collect and queue a custom ping for eventual uploading, call the <code>submit</code> method on the <code>PingType</code> object that the Glean SDK generated for your ping.</p>
<p>By default, if the ping doesn't currently have any events or metrics set, <code>submit</code> will do nothing.  However, if the <code>send_if_empty</code> flag is set to true in the ping definition, it will always be submitted.</p>
<p>For example, to submit the custom ping defined above:</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-kotlin">import org.mozilla.yourApplication.GleanMetrics.Pings
Pings.search.submit(
    GleanMetrics.Pings.searchReasonCodes.performed
)
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-swift">import Glean

GleanMetrics.Pings.shared.search.submit(
    reason: .performed
)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_pings

pings = load_pings(&quot;pings.yaml&quot;)

pings.search.submit(pings.search_reason_codes.PERFORMED)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Pings;

Pings.search.Submit(
    GleanMetrics.Pings.searchReasonCodes.performed
);
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean::Pings;

pings::search.submit(pings::SearchReasonCodes::Performed);
</code></pre>
</div>
</div>
</div>
<p>If none of the metrics for the ping contain data the ping is not sent (unless <code>send_if_empty</code> is set to true in the definition file)</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/custom.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#unit-testing-glean-custom-pings-for-android" id="unit-testing-glean-custom-pings-for-android">Unit testing Glean custom pings for Android</a></h1>
<p>Applications defining <a href="user/pings/custom.html">custom pings</a> can use use the strategy defined in this document to test these pings in unit tests.</p>
<h2><a class="header" href="#general-testing-strategy" id="general-testing-strategy">General testing strategy</a></h2>
<p>The schedule of custom pings depends on the specific application implementation, since it is up to the SDK user to define the ping semantics. This makes writing unit tests for custom pings a bit more involved.</p>
<p>One possible strategy could be to wrap the Glean SDK API call to send the ping in a function that can be mocked in the unit test. This would allow for checking the status and the values of the metrics contained in the ping at the time in which the application would have sent it.</p>
<h2><a class="header" href="#example-testing-of-a-custom-ping" id="example-testing-of-a-custom-ping">Example testing of a custom ping</a></h2>
<p>Let us start by defining a custom ping with a sample metric in it. Here is the <code>pings.yaml</code> file:</p>
<pre><code class="language-yaml">$schema: moz://mozilla.org/schemas/glean/pings/2-0-0

my-custom-ping:
  description: &gt;
    This ping is intended to showcase the recommended testing strategy for
    custom pings.
  include_client_id: false
  bugs:
    - https://bugzilla.mozilla.org/1556985/
  data_reviews:
    - https://bugzilla.mozilla.org/show_bug.cgi?id=1556985
  notification_emails:
    - custom-ping-owner@example.com

</code></pre>
<p>And here is the <code>metrics.yaml</code></p>
<pre><code class="language-yaml">$schema: moz://mozilla.org/schemas/glean/metrics/2-0-0

custom_ping_data:
  sample_string:
    type: string
    lifetime: ping
    description: &gt;
      A sample string metric for demonstrating unit tests for custom pings.
    send_in_pings:
      - my-custom-ping
    bugs:
      - https://bugzilla.mozilla.org/1556985/
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1556985
    notification_emails:
      - custom-ping-owner@example.com
    expires: &quot;2019-10-01&quot;
</code></pre>
<p>A potential usage of the Glean SDK generated API could be the following:</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-kotlin">import my.component.GleanMetrics.Pings
import my.component.GleanMetrics.CustomPingData

class MyCustomPingScheduler {
  /**
   * HERE ONLY TO KEEP THE EXAMPLE SIMPLE.
   *
   * A function that consumes the Glean SDK generated metrics API to
   * record some data. It doesn't really need to be in a function, nor
   * in this class. The Glean SDK API can be called when the data is
   * generated.
   */
  fun addSomeData() {
    // Record some sample data.
    CustomPingData.sampleString.set(&quot;test-data&quot;)
  }

  /**
   * Called to implement the ping scheduling logic for 'my_custom_ping'.
   */
  fun schedulePing() {
    // ... some scheduling logic that will end up calling the function below.
    submitPing()
  }

  /**
   * Internal function to only be overridden in tests. This
   * calls the Glean SDK API to send custom pings.
   */
  @VisibleForTesting(otherwise = VisibleForTesting.NONE)
  internal fun submitPing() {
    Pings.MyCustomPing.submit()
  }
}
</code></pre>
<p>The following unit test intercepts the <code>MyCustomPingScheduler.submitPing()</code> call in order to perform the validation on the data.
This specific example uses Mockito, but any other framework would work.</p>
<pre><code class="language-kotlin">// Metrics and pings definitions.
import my.component.GleanMetrics.Pings
import my.component.GleanMetrics.CustomPingData

// Mockito imports for using spies.
import org.mockito.Mockito.spy
import org.mockito.Mockito.`when`

@RunWith(AndroidJUnit4::class)
class MyCustomPingSchedulerTest {
    // Apply the GleanTestRule to set up a disposable Glean instance.
    // Please note that this clears the Glean data across tests.
    @get:Rule
    val gleanRule = GleanTestRule(ApplicationProvider.getApplicationContext())

    @Test
    fun `verify custom ping metrics`() {
      val scheduler = spy(MyCustomPingScheduler())
      doAnswer {
        // Here we validate the content that goes into the ping.
        assertTrue(CustomPingData.sampleString.testHasValue())
        assertEquals(&quot;test-data&quot;, CustomPingData.sampleString.testGetValue())

        // We want to intercept this call, but we also want to make sure the
        // real Glean API is called in order to clear the ping store and to provide
        // consistent behaviour with respect to the application.
        it.callRealMethod()
      }.`when`(scheduler).submitPing()

      scheduler.addSomeData()
      scheduler.schedulePing()
    }
}
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-swift">import Foundation
import Glean

// Use typealiases to simplify usage.
// This can be placed anywhere in your code to be available in all files.
typealias CustomPingData = GleanMetrics.CustomPingData
typealias Pings = GleanMetrics.Pings

class MyCustomPingScheduler {
    /**
     * HERE ONLY TO KEEP THE EXAMPLE SIMPLE.
     *
     * A function that consumes the Glean SDK generated metrics API to
     * record some data. It doesn't really need to be in a function, nor
     * in this class. The Glean SDK API can be called when the data is
     * generated.
     */
    func addSomeData() {
       // Record some sample data.
       CustomPingData.sampleString.set(&quot;test-data&quot;)
    }

    /**
     * Called to implement the ping scheduling logic for 'my_custom_ping'.
     */
    func schedulePing() {
        // ... some scheduling logic that will end up calling the function below.
        submitPing()
    }

    /**
     * Internal function to only be overridden in tests. This
     * calls the Glean SDK API to send custom pings.
     */
    internal func submitPing() {
        Pings.shared.myCustomPing.submit()
    }
}
</code></pre>
<p>The following unit test intercepts the <code>MyCustomPingScheduler.submitPing()</code> call in order to perform the validation on the data.
This example uses a manual mock implementation, but you could use a framework for that.</p>
<pre><code class="language-swift">@testable import YourApplication
import Glean
import XCTest

class MyCustomPingSchedulerMock: MyCustomPingScheduler {
    var submitWasCalled = false

    deinit {
        XCTAssertTrue(submitWasCalled, &quot;submitPing should have been called once&quot;)
    }

    override func submitPing() {
        submitWasCalled = true

        XCTAssertTrue(CustomPingData.os.testHasValue())
        XCTAssertEqual(&quot;test-data&quot;, try! CustomPingData.os.testGetValue())

        super.submitPing()
    }
}

class MyCustomPingSchedulerTests: XCTestCase {
    override func setUp() {
        Glean.shared.resetGlean(clearStores: true)
    }

    func testCustomPingMetrics() {
        let scheduler = MyCustomPingSchedulerMock()
        scheduler.addSomeData()
        scheduler.schedulePing()
    }
}
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-python">import glean

metrics = glean.load_metrics(&quot;metrics.yaml&quot;)
pings = glean.load_pings(&quot;pings.yaml&quot;)


class MyCustomPingScheduler:
    def add_some_data(self):
        &quot;&quot;&quot;
        HERE ONLY TO KEEP THE EXAMPLE SIMPLE.

        A function that consumes the Glean SDK generated metrics API to
        record some data. It doesn't really need to be in a function, nor
        in this class. The Glean SDK API can be called when the data is
        generated.
        &quot;&quot;&quot;
        # Record some sample data.
        metrics.custom_ping_data.sample_string.set(&quot;test-data&quot;)

    def schedule_ping(self):
        &quot;&quot;&quot;
        Called to implement the ping scheduling logic for 'my_custom_ping'.
        &quot;&quot;&quot;
        # ... some scheduling logic that will end up calling the function below.
        self._submit_ping()

    def _submit_ping(self):
        &quot;&quot;&quot;
        Internal function to only be overridden in tests.
        &quot;&quot;&quot;
        pings.my_custom_ping.submit()
</code></pre>
<p>The following unit test intercepts the <code>MyCustomPingScheduler._submit_ping()</code> call in order to perform the validation on the data.</p>
<pre><code class="language-python">from unittest.mock import MagicMock

from glean import testing

import custom_ping_scheduler


# This will be run before every test in the entire test suite
def pytest_runtest_setup(item):
    testing.reset_glean(application_id=&quot;my-app&quot;, application_version=&quot;0.0.1&quot;)


def test_verify_custom_ping_metrics():
    scheduler = custom_ping_scheduler.MyCustomPingScheduler()

    original_submit_ping = scheduler._submit_ping

    def _submit_ping(self):
        # Here we validate the content that goes into the ping.
        assert (
            custom_ping_scheduler.metrics.custom_ping_data.sample_string.test_has_value()
        )
        assert (
            &quot;test-data&quot;
            == custom_ping_scheduler.metrics.custom_ping_data.sample_string.test_get_value()
        )

        # We want to intercept this call, but we also want to make sure the
        # real Glean API is called in order to clear the ping strong and to
        # provide consistent behavior with respect to the application.
        original_submit_ping(self)

    scheduler._submit_ping = MagicMock(_submit_ping)

    scheduler.add_some_data()
    scheduler.schedule_ping()
</code></pre>
</div>
<div data-lang="C#" class="tab">
<p>TODO. To be implemented in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1648446">bug 1648446</a>.</p>
</div>
</div>
</div>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/testing-custom-pings.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#using-the-experiments-api" id="using-the-experiments-api">Using the experiments API</a></h1>
<p>The Glean SDK supports tagging all its pings with experiments annotations. The annotations are useful to report that experiments were active at the time the measurement were collected. The annotations are reported in the optional <code>experiments</code> entry in the <a href="user/pings/index.html"><code>ping_info</code> section</a> of all the Glean SDK pings.</p>
<blockquote>
<p><strong>Important</strong>: the experiment annotations set through this API are not persisted by the Glean SDK.
The application or consuming library is responsible for setting the relevant experiment annotations at each run.</p>
</blockquote>
<h2><a class="header" href="#api" id="api">API</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">// Annotate Glean pings with experiments data.
Glean.setExperimentActive(
  experimentId = &quot;blue-button-effective&quot;,
  branch = &quot;branch-with-blue-button&quot;,
  extra: mapOf(
    &quot;buttonLabel&quot; to &quot;test&quot;
  )
)
// After the experiment terminates, the annotation
// can be removed.
Glean.setExperimentInactive(&quot;blue-button-effective&quot;)
</code></pre>
<blockquote>
<p><strong>Important</strong>: Experiment IDs and branches don't need to be pre-defined in the Glean SDK registry files.
Please also note that the <code>extra</code> map is a non-nested arbitrary <code>String</code> to <code>String</code> map. It also has limits on the size of the keys and values defined below.</p>
</blockquote>
<p>There are test APIs available too:</p>
<pre><code class="language-Kotlin">// Was the experiment annotated in Glean pings?
assertTrue(Glean.testIsExperimentActive(&quot;blue-button-effective&quot;))
// Was the correct branch reported?
assertEquals(
  &quot;branch-with-blue-button&quot;, Glean.testGetExperimentData(&quot;blue-button-effective&quot;)?.branch
)
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">// Annotate Glean pings with experiments data.
Glean.shared.setExperimentActive(
  experimentId: &quot;blue-button-effective&quot;,
  branch: &quot;branch-with-blue-button&quot;,
  extra: [&quot;buttonLabel&quot;: &quot;test&quot;]
)
// After the experiment terminates, the annotation
// can be removed.
Glean.shared.setExperimentInactive(experimentId: &quot;blue-button-effective&quot;)
</code></pre>
<blockquote>
<p><strong>Important</strong>: Experiment IDs and branch don't need to be pre-defined in the Glean SDK registry files.
Please also note that the <code>extra</code> is a non-nested <code>Dictionary</code> of type <code>[String: String]</code>.</p>
</blockquote>
<p>There are test APIs available too:</p>
<pre><code class="language-Swift">// Was the experiment annotated in Glean pings?
XCTAssertTrue(Glean.shared.testIsExperimentActive(experimentId: &quot;blue-button-effective&quot;))
// Was the correct branch reported?
XCTAssertEqual(
  &quot;branch-with-blue-button&quot;,
  Glean.testGetExperimentData(experimentId: &quot;blue-button-effective&quot;)?.branch
)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import Glean

# Annotate Glean pings with experiments data.
Glean.set_experiment_active(
  experiment_id=&quot;blue-button-effective&quot;,
  branch=&quot;branch-with-blue-button&quot;,
  extra={
    &quot;buttonLabel&quot;: &quot;test&quot;
  }
)

# After the experiment terminates, the annotation
# can be removed.
Glean.set_experiment_inactive(&quot;blue-button-effective&quot;)
</code></pre>
<blockquote>
<p><strong>Important</strong>: Experiment IDs and branch don't need to be pre-defined in the Glean SDK registry files.
Please also note that the <code>extra</code> dict is non-nested arbitrary <code>str</code> to <code>str</code> mapping.</p>
</blockquote>
<p>There are test APIs available too:</p>
<pre><code class="language-Python">from glean import Glean

# Was the experiment annotated in Glean pings?
assert Glean.test_is_experiment_active(&quot;blue-button-effective&quot;)
# Was the correct branch reported?
assert (
    &quot;branch-with-blue-button&quot; ==
    Glean.test_get_experiment_data(&quot;blue-button-effective&quot;).branch
)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<pre><code class="language-C#">// Annotate Glean pings with experiments data.
GleanInstance.SetExperimentActive(
  experimentId: &quot;blue-button-effective&quot;,
  branch: &quot;branch-with-blue-button&quot;,
  extra: new Dictionary&lt;string, string&gt;() {
    { &quot;buttonLabel&quot;, &quot;test&quot;}
  }
);
// After the experiment terminates, the annotation
// can be removed.
GleanInstance.SetExperimentInactive(&quot;blue-button-effective&quot;);
</code></pre>
<blockquote>
<p><strong>Important</strong>: Experiment IDs and branches don't need to be pre-defined in the Glean SDK registry files.
Please also note that the <code>extra</code> map is a non-nested arbitrary <code>string</code> to <code>string</code> dictionary. It also has limits on the size of the keys and values defined below.</p>
</blockquote>
<p>There are test APIs available too:</p>
<pre><code class="language-C#">// Was the experiment annotated in Glean pings?
Assert.True(GleanInstance.TestIsExperimentActive(&quot;blue-button-effective&quot;));
// Was the correct branch reported?
Assert.Equal(
  &quot;branch-with-blue-button&quot;, GleanInstance.TestGetExperimentData(&quot;blue-button-effective&quot;).Branch
);
</code></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits" id="limits">Limits</a></h2>
<ul>
<li><code>experimentId</code>, <code>branch</code>, and the keys and values of the 'extra' field are fixed at a maximum length of 100 bytes. Longer strings used as ids, keys, or values are truncated to their respective maximum length. (Specifically, this is measured in the number of bytes when the string is encoded in UTF-8.)</li>
<li><code>extra</code> map is limited to 20 entries. If passed a map which contains more elements than this, it is truncated to 20 elements.  <strong>WARNING</strong> Which items are truncated is nondeterministic due to the unordered nature of maps and what's left may not necessarily be the first elements added.</li>
</ul>
<p><strong>NOTE:</strong> Any truncation that occurs when recording to the Experiments API will result in an <code>invalid_value</code> error being recorded. See <a href="user/error-reporting.html">Error Reporting</a> for more information about this type of error.</p>
<h2><a class="header" href="#reference" id="reference">Reference</a></h2>
<ul>
<li><a href="user/../../javadoc/glean/mozilla.telemetry.glean/-glean.html">Kotlin API docs</a>.</li>
<li><a href="user/../../python/glean/glean.html">Python API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/experiments-api.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#debugging-products-using-the-glean-sdk" id="debugging-products-using-the-glean-sdk">Debugging products using the Glean SDK</a></h1>
<h2><a class="header" href="#platform-specific-debugging" id="platform-specific-debugging">Platform-specific debugging</a></h2>
<ol>
<li><a href="user/debugging/android.html">Debugging Android applications using the Glean SDK</a></li>
<li><a href="user/debugging/ios.html">Debugging iOS applications using the Glean SDK</a></li>
<li><a href="user/debugging/python.html">Debugging Python applications using the Glean SDK</a></li>
</ol>
<h2><a class="header" href="#general-debugging-information" id="general-debugging-information">General debugging information</a></h2>
<h3><a class="header" href="#available-debugging-features" id="available-debugging-features">Available debugging features</a></h3>
<p>The Glean SDK has 4 available debugging features:</p>
<ul>
<li><code>logPings</code>: This is either <code>true</code> or <code>false</code> and will cause all subsequent pings that are submitted, to also be echoed to the device's log. Once enabled, the only way to disable this feature is to restart or manually reset the application.</li>
<li><code>debugViewTag</code>: This will tag all subsequent outgoing pings with the provided value, in order to identify them in the Glean Debug View. Once enabled, the only way to disable this feature is to restart or manually reset the application.</li>
<li><code>sourceTags</code>: This will tag all subsequent outgoing pings with a maximum of 5 comma-separated tags. Once enabled, the only way to disable this feature is to restart or manually reset the application.</li>
<li><code>sendPing</code>: This expects the name of a ping and forces its immediate collection and submission. <em>This feature is only available for Android and iOS</em>.</li>
</ul>
<p>Different platforms may have different ways to enable these features.</p>
<h3><a class="header" href="#enabling-debugging-features-through-environment-variables" id="enabling-debugging-features-through-environment-variables">Enabling debugging features through environment variables</a></h3>
<p>Some of the debugging features described above may be enabled using environment variables:</p>
<ul>
<li><code>logPings</code>: May be set by the <code>GLEAN_LOG_PINGS</code> environment variable. The accepted values are <code>true</code> or <code>false</code>. Any other value will be ignored.</li>
<li><code>debugViewTag</code>: May be set by the <code>GLEAN_DEBUG_VIEW_TAG</code> environment variable. Any valid HTTP header value is expected here (e.g. any value that matches the regex <code>[a-zA-Z0-9-]{1,20}</code>). Invalid values will be ignored.</li>
<li><code>sourceTags</code>: May be set by the <code>GLEAN_SOURCE_TAGS</code> environment variable. A comma-separated list of valid HTTP header values is expected here (e.g. any value that matches the regex <code>[a-zA-Z0-9-]{1,20}</code>). If any of the values in the list is invalid, all values will be ignored. The special value of <code>automation</code> is meant for tagging pings generated on automation: such pings will be specially handled on the pipeline (i.e. discarded from <a href="https://docs.telemetry.mozilla.org/cookbooks/bigquery/querying.html#table-layout-and-naming">non-live views</a>).</li>
</ul>
<p>These variables must be set at runtime, not at compile time. They will be checked upon Glean initialization.</p>
<p>Enabling debugging features using environment variables is available for all supported platforms.</p>
<blockquote>
<p><strong>Note</strong> Although it is technically possible to use the environment variables described here to enable debugging features in Android, the Glean team is not currently aware of a proper way to set environment variables in Android devices or emulators.</p>
</blockquote>
<h3><a class="header" href="#important-considerations-when-using-glean-sdk-debug-features" id="important-considerations-when-using-glean-sdk-debug-features">Important considerations when using Glean SDK debug features</a></h3>
<ul>
<li>
<p>Enabled features will persist until the application is closed or manually reset. When enabled by environment variables, the variables need to be cleared upon resetting for the feature to be disabled.</p>
</li>
<li>
<p>There are a couple different ways in which to send pings using the Glean SDK debug tools.</p>
<ol>
<li>You can tag pings using the debug tools and trigger them manually using the UI. This should always produce a ping with all required fields.</li>
<li>You can tag <em>and</em> send pings using the debug tools.  This has the side effect of potentially sending a ping which does not include all fields because <code>sendPing</code> triggers pings to be sent before certain application behaviors can occur which would record that information.  For example, <code>duration</code> is not calculated or included in a baseline ping sent with <code>sendPing</code> because it forces the ping to be sent before the <code>duration</code> metric has been recorded.  Keep in mind that there may be nothing to send, in which case no ping is generated.</li>
<li>You can trigger a command while the instrumented application is still running.  This is useful for toggling commands or for triggering pings that have schedules that are difficult to trigger manually.  This is especially useful if you need to trigger a ping submission after some activity within the application, such as with the metrics ping.</li>
</ol>
</li>
</ul>
<h3><a class="header" href="#glean-sdk-log-messages" id="glean-sdk-log-messages">Glean SDK Log messages</a></h3>
<p>The Glean SDK logs warnings and errors through the platform-specific logging frameworks.  See the platform-specific instructions for information on how to view the logs.</p>
<h3><a class="header" href="#implementation-details" id="implementation-details">Implementation details</a></h3>
<p>See <a href="user/debugging/../../../dev/core/internal/debug-pings.html">Debug Pings</a>.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/debugging/index.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#glean-debug-ping-view" id="glean-debug-ping-view">Glean Debug Ping View</a></h1>
<p>The <a href="https://debug-ping-preview.firebaseapp.com/">Glean Debug Ping View</a> enables you to easily see in real-time what data your application is sending.</p>
<p>This data is what actually arrives in our data pipeline, shown in a web
interface that is automatically updated when new data arrives. Any data sent from a Glean SDK-instrumented application usually shows up within 10 seconds,
updating the pages automatically. Pings are retained for 3 weeks.</p>
<h2><a class="header" href="#what-setup-is-needed-for-applications" id="what-setup-is-needed-for-applications">What setup is needed for applications?</a></h2>
<p>You need to tag each ping with a debugging tag. See the documentation on
<a href="user/debugging/./index.html">debugging</a> for information on how to do this for each platform and/or language.</p>
<h2><a class="header" href="#troubleshooting" id="troubleshooting">Troubleshooting</a></h2>
<p>If nothing is showing up on the dashboard, and you see <code>Glean must be enabled before sending pings.</code> in the logs, then the application has disabled Glean. Check with the application author on how to re-enable it.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/debugging/debug-ping-view.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#debugging-android-applications-using-the-glean-sdk" id="debugging-android-applications-using-the-glean-sdk">Debugging Android applications using the Glean SDK</a></h1>
<p>The Glean SDK exports the <code>GleanDebugActivity</code> that can be used to toggle debugging features on or off.
Users can invoke this special activity, at run-time, using the following <a href="https://developer.android.com/studio/command-line/adb"><code>adb</code></a> command:</p>
<p><code>adb shell am start -n [applicationId]/mozilla.telemetry.glean.debug.GleanDebugActivity [extra keys]</code></p>
<p>In the above:</p>
<ul>
<li>
<p><code>[applicationId]</code> is the product's application id as defined in the manifest file and/or build script. For the Glean sample application, this is <code>org.mozilla.samples.gleancore</code> for a release build and <code>org.mozilla.samples.gleancore.debug</code> for a debug build.</p>
</li>
<li>
<p><code>[extra keys]</code> is a list of extra keys to be passed to the debug activity. See the <a href="https://developer.android.com/studio/command-line/adb#IntentSpec">documentation</a> for the command line switches used to pass the extra keys.
These are the currently supported keys:</p>
</li>
</ul>
<table><thead><tr><th>key</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td><code>logPings</code></td><td>boolean (<code>--ez</code>)</td><td>If set to <code>true</code>, pings are dumped to logcat; defaults to <code>false</code></td></tr>
<tr><td><code>sendPing</code></td><td>string (<code>--es</code>)</td><td>Sends the ping with the given name immediately</td></tr>
<tr><td><code>debugViewTag</code></td><td>string (<code>--es</code>)</td><td>Tags all outgoing pings as debug pings to make them available for real-time validation, on the <a href="user/debugging/./debug-ping-view.html">Glean Debug View</a>. The value must match the pattern <code>[a-zA-Z0-9-]{1,20}</code>. <strong>Important</strong>: in older versions of the Glean SDK, this was named <code>tagPings</code></td></tr>
<tr><td><code>sourceTags</code></td><td>string array (<code>--esa</code>)</td><td>Tags outgoing pings with a maximum of 5 comma-separated tags. The tags must match the pattern <code>[a-zA-Z0-9-]{1,20}</code>. The <code>automation</code> tag is meant for tagging pings generated on automation: such pings will be specially handled on the pipeline (i.e. discarded from <a href="https://docs.telemetry.mozilla.org/cookbooks/bigquery/querying.html#table-layout-and-naming">non-live views</a>). Tags starting with <code>glean</code> are reserved for future use. Subsequent calls of this overwrite any previously stored tag</td></tr>
<tr><td><code>startNext</code></td><td>string (<code>--es</code>)</td><td>The name of an exported Android <code>Activity</code>, as defined in the product manifest file, to start right after the <code>GleanDebugActivity</code> completes. All the options provided are propagated to this next activity as well. When omitted, the default launcher activity for the product is started instead.</td></tr>
</tbody></table>
<p>All <a href="https://developer.android.com/studio/command-line/adb#am">the options</a> provided to start the activity are passed over to the main activity for the application to process.
This is useful if SDK users wants to debug telemetry while providing additional options to the product to enable specific behaviors.</p>
<blockquote>
<p><strong>Note:</strong> Due to limitations on Android logcat message size, pings larger than 4KB are broken into multiple log messages when using <code>logPings</code>.</p>
</blockquote>
<p>For example, to direct a release build of the Glean sample application to (1) dump pings to logcat, (2) tag the ping with the <code>test-metrics-ping</code> tag, and (3) send the &quot;metrics&quot; ping immediately, the following command can be used:</p>
<pre><code class="language-shell">adb shell am start -n org.mozilla.samples.gleancore/mozilla.telemetry.glean.debug.GleanDebugActivity \
  --ez logPings true \
  --es sendPing metrics \
  --es debugViewTag test-metrics-ping
</code></pre>
<p>The <code>logPings</code> command doesn't trigger ping submission and you won't see any output until a ping has been sent. You can use the <code>sendPing</code> command to force a ping to be sent, but it could be more desirable to trigger the pings submission on their normal schedule. For instance, the <code>baseline</code> and <code>events</code> pings can be triggered by moving the app out of the foreground and the <code>metrics</code> ping can be triggered normally if it is overdue for the current calendar day.</p>
<blockquote>
<p><strong>Note:</strong> The device or emulator must be connected to the internet for this to work. Otherwise the job that sends the pings won't be triggered.</p>
</blockquote>
<p>If no metrics have been collected, no pings will be sent <em>unless</em> <a href="user/debugging/../pings/custom.html#defining-a-custom-ping"><code>send_if_empty</code> is set on your ping</a>. See the <a href="user/debugging/../pings/index.html">ping documentation</a> for more information on ping scheduling to learn when pings are sent.</p>
<p>Options that are set using the <code>adb</code> flags are not immediately reset and will
persist until the application is closed or manually reset.</p>
<h3><a class="header" href="#glean-sdk-log-messages-1" id="glean-sdk-log-messages-1">Glean SDK Log messages</a></h3>
<p>When running a Glean SDK-powered app in the Android emulator or on a device connected to your computer via cable, there are several ways to read the log output.</p>
<h4><a class="header" href="#android-studio" id="android-studio">Android Studio</a></h4>
<p>Android Studio can show the logs of a connected emulator or device.
To display the log messages for an app:</p>
<ol>
<li>Run an app on your device.</li>
<li>Click <strong>View &gt; Tool Windows &gt; Logcat</strong> (or click <strong>Logcat</strong> in the tool window bar).</li>
</ol>
<p>The Logcat window will show all log messages and allows to filter those by the application ID.
Select the application ID of the product you're debugging.
You can also filter by <code>Glean</code> only.</p>
<p>More information can be found in the <a href="https://developer.android.com/studio/debug/am-logcat">View Logs with Logcat</a> help article.</p>
<h4><a class="header" href="#command-line" id="command-line">Command line</a></h4>
<p>On the command line you can show all of the log output using:</p>
<pre><code class="language-shell">adb logcat
</code></pre>
<p>This is the unfiltered output of all log messages.
You can match for <code>glean</code> using grep:</p>
<pre><code class="language-shell">adb logcat | grep -i glean
</code></pre>
<p>A simple way to filter for only the application that is being debugged is by using <a href="https://github.com/JakeWharton/pidcat">pidcat</a>, a wrapper around <code>adb</code>, which adds colors and proper filtering by application ID and log level.
Run it like this to filter for an application:</p>
<pre><code class="language-shell">pidcat [applicationId]
</code></pre>
<p>In the above <code>[applicationId]</code> is the product's application id as defined in the manifest file and/or build script. For the Glean sample application, this is <code>org.mozilla.samples.gleancore</code> for a release build and <code>org.mozilla.samples.gleancore.debug</code> for a debug build.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/debugging/android.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#enabling-debugging-features-in-ios-through-environment-variables" id="enabling-debugging-features-in-ios-through-environment-variables">Enabling debugging features in iOS through environment variables</a></h1>
<p>Debugging features in iOS can be enabled using environment variables.
For more information on the available features accessible through this method
and how to enable them, see <a href="user/debugging/./index.html">Enabling debugging features through environment variables</a>.</p>
<p>These environment variables must be set on the device that is running the application.</p>
<blockquote>
<p><strong>Note</strong> To set environment variables to the process running your app in an iOS device or emulator you need to edit the scheme for your app. In the Xcode IDE, you can use the shortcut <code>Cmd + &lt;</code> to open the scheme editor popup. The environment variables editor is under the <code>Arguments</code> tab on this popup.</p>
</blockquote>
<h1><a class="header" href="#debugging-ios-applications-using-the-glean-sdk" id="debugging-ios-applications-using-the-glean-sdk">Debugging iOS applications using the Glean SDK</a></h1>
<p>For debugging and validation purposes on iOS, the Glean SDK makes use of a custom URL scheme which is implemented <em>within the application</em> that is consuming the Glean SDK.  The Glean SDK provides some convenience functions to facilitate this, but it's up to the consuming application to enable this functionality.  Applications that enable this Glean SDK feature will be able to launch the application from a URL with the Glean debug commands embedded in the URL itself.</p>
<h3><a class="header" href="#available-commands-and-query-format" id="available-commands-and-query-format">Available commands and query format</a></h3>
<p>There are 4 available commands that you can use with the Glean SDK debug tools</p>
<ul>
<li><code>logPings</code>: This is either true or false and will cause pings that are submitted to also be echoed to the device's log</li>
<li><code>debugViewTag</code>: This command will tag outgoing pings with the provided value, in order to identify them in the Glean Debug View. Tags need to be string with upper and lower case letters, numbers and dashes, with a max length of 20 characters. <strong>Important</strong>: in older versions of the Glean SDK, this was named <code>tagPings</code>.</li>
<li><code>sourceTags</code>: This command tags outgoing pings with a maximum of 5 comma-separated tags. The tags must match the pattern <code>[a-zA-Z0-9-]{1,20}</code>. The <code>automation</code> tag is meant for tagging pings generated on automation: such pings will be specially handled on the pipeline (i.e. discarded from <a href="https://docs.telemetry.mozilla.org/cookbooks/bigquery/querying.html#table-layout-and-naming">non-live views</a>). Tags starting with <code>glean</code> are reserved for future use.</li>
<li><code>sendPing</code>: This command expects a string name of a ping to force immediate collection and submission of.</li>
</ul>
<p>The structure of the custom URL uses the following format:</p>
<p><code>&lt;protocol&gt;://glean?&lt;command 1&gt;=&lt;paramter 1&gt;&amp;&lt;command 2&gt;=&lt;parameter 2&gt; ...</code></p>
<p>Where:</p>
<ul>
<li><code>&lt;protocol&gt;</code> is the &quot;URL Scheme&quot; that has been added for your app (see Instrumenting the application below), such as <code>glean-sample-app</code>.</li>
<li>This is followed by <code>://</code> and then <code>glean</code> which is required for the Glean SDK to recognize the command is meant for it to process.</li>
<li>Following standard URL query format, the next character after <code>glean</code> is the <code>?</code> indicating the beginning of the query.</li>
<li>This is followed by one or more queries in the form of <code>&lt;command&gt;=&lt;parameter&gt;</code>, where the command is one of the commands listed above, followed by an <code>=</code> and then the value or parameter to be used with the command.</li>
</ul>
<p>There are a few things to consider when creating the custom URL:</p>
<ul>
<li>Invalid commands will log an error and cause the entire URL to be ignored.</li>
<li>Not all commands are required to be encoded in the URL, you can mix and match the commands that you need.</li>
<li>Multiple instances of commands are not allowed in the same URL and, if present, will cause the entire URL to be ignored.</li>
<li>The <code>logPings</code> command doesn't trigger ping submission and you won't see any output until a ping has been submitted. You can use the <code>sendPings</code> command to force a ping to be sent, but it could be more desirable to trigger the pings submission on their normal schedule. For instance, the <code>baseline</code> and <code>events</code> pings can be triggered by moving the app out of the foreground and the <code>metrics</code> ping can be triggered normally if it is overdue for the current calendar day. See the <a href="user/debugging/../pings/index.html">ping documentation</a> for more information on ping scheduling to learn when pings are sent.</li>
<li>Enabling debugging features through custom URLs overrides any debugging features set through environment variables.</li>
</ul>
<h3><a class="header" href="#instrumenting-the-application-for-glean-sdk-debug-functionality" id="instrumenting-the-application-for-glean-sdk-debug-functionality">Instrumenting the application for Glean SDK debug functionality</a></h3>
<p>In order to enable the debugging features in a Glean SDK consuming iOS application, it is necessary to add some information to the application's <code>Info.plist</code>, and add a line and possibly an override for a function in the <code>AppDelegate.swift</code>.</p>
<h4><a class="header" href="#register-custom-url-scheme-in-infoplist" id="register-custom-url-scheme-in-infoplist">Register custom URL scheme in <code>Info.plist</code></a></h4>
<blockquote>
<p><strong>Note:</strong> If your application already has a custom URL scheme implemented, there is no need to implement a second scheme, you can simply use that and skip to the next section about adding the convenience method.  If the app doesn't have a custom URL scheme implemented, then you will need to perform the following instructions to register your app to receive custom URLs.</p>
</blockquote>
<p>Find and open the application's <code>Info.plist</code> and right click any blank area and select <code>Add Row</code> to create a new key.</p>
<p>You will be prompted to select a key from a drop-down menu, scroll down to and select <code>URL types</code>.  This creates an array item, which can be expanded by clicking the triangle disclosure icon.</p>
<p>Select <code>Item 0</code>, click on it and click the disclosure icon to expand it and show the <code>URL identifier</code> line.  Double-click the value field and fill in your identifier, typically the same as the bundle ID.</p>
<p>Right-click on <code>Item 0</code> and select <code>Add Row</code> from the context menu.  In the dropdown menu, select <code>URL Schemes</code> to add the item.</p>
<p>Click on the disclosure icon of <code>URL Schemes</code> to expand the item, double-click the value field of <code>Item 0</code> and key in the value for your application's custom scheme.  For instance, the Glean sample app uses <code>glean-sample-app</code>, which allows for custom URLs to be crafted using that as a protocol, for example: <code>glean-sample-app://glean?logPings=true</code></p>
<h4><a class="header" href="#add-the-gleanhandlecustomurl-convenience-function-and-necessary-overrides" id="add-the-gleanhandlecustomurl-convenience-function-and-necessary-overrides">Add the <code>Glean.handleCustomUrl()</code> convenience function and necessary overrides</a></h4>
<p>In order to handle the incoming Glean SDK debug commands, it is necessary to implement the override in the application's <code>AppDelegate.swift</code> file.  Within that function, you can make use of the convenience function provided in Glean <code>handleCustomUrl(url: URL)</code>.</p>
<p>An example of a simple implementation of this would look like this:</p>
<pre><code class="language-Swift">func application(_: UIApplication,
                 open url: URL,
                 options _: [UIApplication.OpenURLOptionsKey: Any] = [:]) -&gt; Bool {
    // ...

    // This does nothing if the url isn't meant for Glean.
    Glean.shared.handleCustomUrl(url: url)

    // ...

    return true
}
</code></pre>
<p>If you need additional help setting up a custom URL scheme in your application, please refer to <a href="https://developer.apple.com/documentation/uikit/inter-process_communication/allowing_apps_and_websites_to_link_to_your_content/defining_a_custom_url_scheme_for_your_app">Apple's documentation</a>.</p>
<h3><a class="header" href="#invoking-the-glean-ios-debug-commands" id="invoking-the-glean-ios-debug-commands">Invoking the Glean-iOS debug commands</a></h3>
<p>Now that the app has the Glean SDK debug functionality enabled, there are a few ways in which we can invoke the debug commands.</p>
<h4><a class="header" href="#using-a-web-browser" id="using-a-web-browser">Using a web browser</a></h4>
<p>Perhaps the simplest way to invoke the Glean SDK debug functionality is to open a web browser and type/paste the custom URL into the address bar.  This is especially useful on an actual device because there isn't a good way to launch from the command line and process the URL for an actual device.</p>
<p>Using the glean-sample-app as an example: to activate ping logging, tag the pings to go to the Glean Debug View, and force the <code>events</code> ping to be sent, enter the following URL in a web browser on the iOS device:</p>
<pre><code class="language-shell">glean-sample-app://glean?logPings=true&amp;debugViewTag=My-ping-tag&amp;sendPing=events
</code></pre>
<p>This should cause iOS to prompt you with a dialog asking if you want to open the URL in the Glean Sample App, and if you select &quot;Okay&quot; then it will launch (or resume if it's already running) the application with the indicated commands and parameters and immediately force the collection and submission of the events ping.</p>
<blockquote>
<p><strong>Note:</strong> This method does not work if the browser you are using to input the command is the same application you are attempting to pass the Glean debug commands to.  So, you couldn't use Firefox for iOS to trigger commands within Firefox for iOS.</p>
</blockquote>
<p>It is also possible to encode the URL into a 2D barcode or QR code and launch the app via the camera app.  After scanning the encoded URL, the dialog prompting to launch the app should appear as if the URL were entered into the browser address bar.</p>
<h4><a class="header" href="#using-the-command-line" id="using-the-command-line">Using the command line</a></h4>
<p>This method is useful for testing via the Simulator, which typically requires a Mac with Xcode installed, including the Xcode command line tools.  In order to perform the same command as above with using the browser to input the URL, you can use the following command in the command line terminal of the Mac:</p>
<pre><code class="language-shell">xcrun simctl openurl booted &quot;glean-sample-app://glean?logPings=true&amp;debugViewTag=My-ping-tag&amp;sendPing=events&quot;
</code></pre>
<p>This will launch the simulator and again prompt the user with a dialog box asking if you want to open the URL in the Glean Sample App (or whichever app you are instrumenting and testing).</p>
<h3><a class="header" href="#glean-log-messages" id="glean-log-messages">Glean log messages</a></h3>
<p>The Glean SDK integrates with the <a href="https://developer.apple.com/documentation/os/logging/">unified logging system</a> available on iOS.
There are various ways to retrieve log information, see the <a href="https://developer.apple.com/documentation/os/logging/viewing_log_messages">official documentation</a>.</p>
<p>If debugging in the simulator, the logging messages can be seen in the console window within Xcode.</p>
<p>When running a Glean-powered app in the iOS Simulator or on a device connected to your computer via cable you can use <code>Console.app</code> to view the system log.
You can filter the logs with <code>category:glean</code> to only see logs from the Glean SDK.</p>
<p>You can also use the command line utility <code>log</code> to stream the log output.
Run the following in a shell:</p>
<pre><code>log stream --predicate 'category contains &quot;glean&quot;'
</code></pre>
<p>See <a href="https://developer.apple.com/library/archive/qa/qa1747/_index.html">Diagnosing Issues Using Crash Reports and Device Logs</a> for more information about debugging deployed iOS apps.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/debugging/ios.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#debugging-python-applications-using-the-glean-sdk" id="debugging-python-applications-using-the-glean-sdk">Debugging Python applications using the Glean SDK</a></h1>
<p>Debugging features in Python can be enabled using environment variables.
For more information on the available features and how to enable them,
see <a href="user/debugging/./index.html">Enabling debugging features through environment variables</a>.</p>
<h2><a class="header" href="#sending-pings" id="sending-pings">Sending pings</a></h2>
<p>Unlike other platforms, Python doesn't expose convenience methods to send pings on demand.</p>
<p>In case that is necessary, calling the <code>submit</code> function for a given ping,
such as <code>pings.custom_ping.submit()</code>, will send it.</p>
<h2><a class="header" href="#logging-pings" id="logging-pings">Logging pings</a></h2>
<p>If the <code>GLEAN_LOG_PINGS</code> environment variable is set to <code>true</code>, pings are
logged to the console on <code>DEBUG</code> level whenever they are submitted.</p>
<p>Make sure that when you configure logging in your application, you set the level
for the Python logging library to <code>DEBUG</code> or higher. Otherwise pings won't be
logged even if <code>GLEAN_LOG_PINGS</code> is set to <code>true</code>.</p>
<p>You can set the logging level for the Python logging to <code>DEBUG</code> as follows:</p>
<pre><code class="language-python">import logging

logging.basicConfig(level=logging.DEBUG)
</code></pre>
<p>All log messages from the Glean SDK are on the <code>glean</code> logger, so if you need to control it independently, you can set a level for just the Glean SDK (but note that the global Python logging level also needs to be set as above):</p>
<pre><code class="language-python">logging.getLogger(&quot;glean&quot;).setLevel(logging.DEBUG)
</code></pre>
<p>See the <a href="https://docs.python.org/3.8/library/logging.html">Python logging documentation</a> for more information.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/debugging/python.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#metric-parameters" id="metric-parameters">Metric parameters</a></h1>
<h2><a class="header" href="#required-metric-parameters" id="required-metric-parameters">Required metric parameters</a></h2>
<ul>
<li><code>type</code>: <strong>Required.</strong>  Specifies the type of a metric, like &quot;counter&quot; or &quot;event&quot;. This defines which operations are valid for the metric, how it is stored and how data analysis tooling displays it. See the list of <a href="reference/yaml/../metrics/index.html">supported metric types</a>.</li>
</ul>
<blockquote>
<p><strong>Important</strong>: Once a metric is released in a product, its <code>type</code> should not be changed. If any data was collected locally with the older <code>type</code>, and hasn't yet been sent in a ping, recording data with the new <code>type</code> may cause any old persisted data to be lost for that metric. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1621757#c1">this comment</a> for an extended explanation of the different scenarios.</p>
</blockquote>
<ul>
<li>
<p><code>description</code>: <strong>Required.</strong> A textual description of the metric for humans. It should describe what the metric does, what it means for analysts, and its edge cases or any other helpful information.</p>
<p>The description field may contain <a href="https://www.markdownguide.org/basic-syntax/">markdown syntax</a>.</p>
</li>
<li>
<p><code>notification_emails</code>: <strong>Required.</strong> A list of email addresses to notify for important events with the metric or when people with context or ownership for the metric need to be contacted.
For example when a metric's expiration is within in 14 days, emails will be sent from <code>telemetry-alerts@mozilla.com</code> to the <code>notification_emails</code> addresses associated with the metric.
Consider adding both a group email address and an individual who is responsible for this metric.</p>
</li>
<li>
<p><code>bugs</code>: <strong>Required.</strong> A list of bugs (e.g. Bugzilla or GitHub) that are relevant to this metric. For example, bugs that track its original implementation or later changes to it.</p>
<p>Each entry should be the full URL to the bug in an issue tracker. The use of numbers alone is deprecated and will be an error in the future.</p>
</li>
<li>
<p><code>data_reviews</code>: <strong>Required.</strong> A list of URIs to any data collection reviews <em>responses</em> relevant to the metric.</p>
</li>
<li>
<p><code>expires</code>: <strong>Required.</strong> When the metric is set to expire. After a metric expires, an application will no longer collect or send data related to it. May be one of the following values:</p>
<ul>
<li><code>&lt;build date&gt;</code>: An ISO date <code>yyyy-mm-dd</code> in UTC on which the metric expires. For example, <code>2019-03-13</code>. This date is checked at build time. Except in special cases, this form should be used so that the metric automatically &quot;sunsets&quot; after a period of time.
Emails will be sent to the <code>notification_emails</code> addresses when the metric is about to expire.
Generally, when a metric is no longer needed, it should simply be removed. This does not affect the availability of data already collected by the pipeline.</li>
<li><code>never</code>: This metric never expires.</li>
<li><code>expired</code>: This metric is manually expired.</li>
</ul>
</li>
</ul>
<h2><a class="header" href="#optional-metric-parameters" id="optional-metric-parameters">Optional metric parameters</a></h2>
<ul>
<li>
<p><code>lifetime</code>: Defines the lifetime of the metric. Different lifetimes affect when the metrics value is reset.</p>
<ul>
<li><code>ping</code> (default): The metric is cleared each time it is submitted in the ping. This is the most common case, and should be used for metrics that are highly dynamic, such as things computed in response to the user's interaction with the application.</li>
<li><code>application</code>: The metric is related to an application run, and is cleared after the application restarts and any Glean-owned ping, due at startup, is submitted. This should be used for things that are constant during the run of an application, such as the operating system version. In practice, these metrics are generally set during application startup. A common mistake---using the ping lifetime for these type of metrics---means that they will only be included in the first ping sent during a particular run of the application.</li>
<li><code>user</code>: <strong>Reach out to the Glean team before using this.</strong>. The metric is part of the user's profile and will live as long as the profile lives. This is often not the best choice unless the metric records a value that <em>really</em> needs to be persisted for the full lifetime of the user profile, e.g. an identifier like the <code>client_id</code>, the day the product was first executed. It is rare to use this lifetime outside of some metrics that are built in to the Glean SDK.</li>
</ul>
</li>
<li>
<p><code>send_in_pings</code>: Defines which pings the metric should be sent on. If not specified, the metric is sent on the &quot;default ping&quot;, which is the <code>events</code> ping for events and the <code>metrics</code> ping for everything else. Most metrics don't need to specify this unless they are sent on <a href="reference/yaml/../../user/pings/custom.html">custom pings</a>.</p>
</li>
<li>
<p><code>disabled</code>: (default: <code>false</code>) Data collection for this metric is disabled.
This is useful when you want to temporarily disable the collection for a specific metric without removing references to it in your source code.
Generally, when a metric is no longer needed, it should simply be removed. This does not affect the availability of data already collected by the pipeline.</p>
</li>
<li>
<p><code>version</code>: (default: 0) The version of the metric. A monotonically increasing integer value. This should be bumped if the metric changes in a backward-incompatible way.</p>
</li>
<li>
<p><code>data_sensitivity</code>: (default: []) A list of data sensitivity categories that the metric falls under. There are four data collection categories related to data sensitivity <a href="https://wiki.mozilla.org/Firefox/Data_Collection">defined in Mozilla's data collection review process</a>:</p>
<ul>
<li>
<p><strong>Category 1: Technical Data:</strong> (<code>technical</code>) Information about the machine or Firefox itself. Examples include OS, available memory, crashes and errors, outcome of automated processes like updates, safe browsing, activation, version #s, and build id. This also includes compatibility information about features and APIs used by websites, add-ons, and other 3rd-party software that interact with Firefox during usage.</p>
</li>
<li>
<p><strong>Category 2: Interaction Data:</strong> (<code>interaction</code>) Information about the user’s direct engagement with Firefox. Examples include how many tabs, add-ons, or windows a user has open; uses of specific Firefox features; session length, scrolls and clicks; and the status of discrete user preferences.</p>
</li>
<li>
<p><strong>Category 3: Web activity data:</strong> (<code>web_activity</code>) Information about user web browsing that could be considered sensitive. Examples include users’ specific web browsing history; general information about their web browsing history (such as TLDs or categories of webpages visited over time); and potentially certain types of interaction data about specific webpages visited.</p>
</li>
<li>
<p><strong>Category 4: Highly sensitive data:</strong> (<code>highly_sensitive</code>) Information that directly identifies a person, or if combined with other data could identify a person. Examples include e-mail, usernames, identifiers such as google ad id, apple id, Firefox account, city or country (unless small ones are explicitly filtered out), or certain cookies. It may be embedded within specific website content, such as memory contents, dumps, captures of screen data, or DOM data.</p>
</li>
</ul>
</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/yaml/index.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#the-general-api" id="the-general-api">The General API</a></h1>
<p>The Glean SDK has a minimal API available on its top-level <code>Glean</code> object.
This API allows one to enable and disable upload, register <a href="reference/general/../../user/pings/custom.html">custom pings</a> and set <a href="reference/general/../../user/experiments-api.html">experiment data</a>.</p>
<blockquote>
<p><strong>Important:</strong> The Glean SDK should only be initialized from the main application, not individual libraries.</p>
</blockquote>
<p>If you are adding Glean SDK support to a library, you can safely skip this section.</p>
<h2><a class="header" href="#the-api" id="the-api">The API</a></h2>
<p>The Glean SDK provides a general API that supports the following operations. See below for language-specific details.</p>
<table><thead><tr><th>Operation</th><th>Description</th><th>Notes</th></tr></thead><tbody>
<tr><td><code>initialize</code></td><td>Configure and initialize the Glean SDK.</td><td><a href="reference/general/index.html#initializing-the-glean-sdk">Initializing the Glean SDK</a></td></tr>
<tr><td><code>setUploadEnabled</code></td><td>Enable or disable Glean collection and upload.</td><td><a href="reference/general/index.html#enabling-and-disabling-metrics">Enabling and disabling Metrics</a></td></tr>
<tr><td><code>registerPings</code></td><td>Register custom pings generated from <code>pings.yaml</code>.</td><td><a href="reference/general/../../user/pings/custom.html">Custom pings</a></td></tr>
<tr><td><code>setExperimentActive</code></td><td>Indicate that an experiment is running.</td><td><a href="reference/general/../../user/experiments-api.html">Using the Experiments API</a></td></tr>
<tr><td><code>setExperimentInactive</code></td><td>Indicate that an experiment is no longer running..</td><td><a href="reference/general/../../user/experiments-api.html">Using the Experiments API</a></td></tr>
</tbody></table>
<h2><a class="header" href="#initializing-the-glean-sdk" id="initializing-the-glean-sdk">Initializing the Glean SDK</a></h2>
<p>The following steps are required for applications using the Glean SDK, but not libraries.</p>
<blockquote>
<p><strong>Note</strong>: The <code>initialize</code> function <em>must</em> be called, even if telemetry upload is disabled.
Glean needs to perform maintenance tasks even when telemetry is disabled, and because Glean
does this as part of its initialization, it is <em>required</em> to always call the <code>initialize</code>
function. Otherwise, Glean won't be able to clean up collected data, disable queuing of pre-init
tasks, or perform other required operations.</p>
<p>This does not apply to special builds where telemetry is disabled at build time. In that case, it is acceptable to not call <code>initialize</code> at all.</p>
</blockquote>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<blockquote>
<p><strong>Note</strong>: The Glean SDK does not support use across multiple processes, and must only be initialized on the application's main process. Initializing in other processes is a no-op.
Additionally, Glean must be initialized on the main (UI) thread of the applications main process. Failure to do so will throw an <code>IllegalThreadStateException</code>.</p>
</blockquote>
<p>An excellent place to initialize Glean is within the <code>onCreate</code> method of the class that extends Android's <code>Application</code> class.</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.GleanBuildInfo
import org.mozilla.yourApplication.GleanMetrics.Pings

class SampleApplication : Application() {

    override fun onCreate() {
        super.onCreate()

        // If you have custom pings in your application, you must register them
        // using the following command. This command should be omitted for
        // applications not using custom pings.
        Glean.registerPings(Pings)

        // Initialize the Glean library.
        Glean.initialize(
            applicationContext,
            // Here, `settings()` is a method to get user preferences, specific to
            // your application and not part of the Glean SDK API.
            uploadEnabled = settings().isTelemetryEnabled,
            buildInfo = GleanBuildInfo.buildInfo
        )
    }
}
</code></pre>
<p>Once initialized, if <code>uploadEnabled</code> is true, the Glean SDK will automatically start collecting <a href="reference/general/../../user/pings/metrics.html">baseline metrics</a> and sending its <a href="reference/general/../../user/pings/index.html">pings</a>, according to their respective schedules.
If <code>uploadEnabled</code> is false, any persisted metrics, events and pings (other than <code>first_run_date</code> and <code>first_run_hour</code>) are cleared, and subsequent calls to record metrics will be no-ops.</p>
<p>The Glean SDK should be initialized as soon as possible, and importantly, before any other libraries in the application start using Glean.
Library code should never call <code>Glean.initialize</code>, since it should be called exactly once per application.</p>
<blockquote>
<p><strong>Note</strong>: if the application has the concept of release channels and knows which channel it is on at run-time, then it can provide the Glean SDK with this information by setting it as part of the <code>Configuration</code> object parameter of the <code>Glean.initialize</code> method. For example:</p>
</blockquote>
<pre><code class="language-Kotlin">Glean.initialize(
    applicationContext,
    uploadEnabled = setting().isTelemetryEnabled,
    configuration = Configuration(channel = &quot;beta&quot;),
    buildInfo = GleanBuildInfo.buildInfo
)
</code></pre>
<blockquote>
<p><strong>Note</strong>: When the Glean SDK is consumed through Android Components, it is required to configure an HTTP client to be used for upload.
For example:</p>
</blockquote>
<pre><code class="language-Kotlin">// Requires `org.mozilla.components:concept-fetch`
import mozilla.components.concept.fetch.Client
// Requires `org.mozilla.components:lib-fetch-httpurlconnection`.
// This can be replaced by other implementations, e.g. `lib-fetch-okhttp`
// or an implementation from `browser-engine-gecko`.
import mozilla.components.lib.fetch.httpurlconnection.HttpURLConnectionClient

import mozilla.components.service.glean.config.Configuration
import mozilla.components.service.glean.net.ConceptFetchHttpUploader

val httpClient = ConceptFetchHttpUploader(lazy { HttpURLConnectionClient() as Client })
val config = Configuration(httpClient = httpClient)
Glean.initialize(
    context,
    uploadEnabled = true,
    configuration = config,
    buildInfo = GleanBuildInfo.buildInfo
)
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<blockquote>
<p><strong>Note</strong>: The Glean SDK does not support use across multiple processes, and must only be initialized on the application's main process.</p>
</blockquote>
<p>An excellent place to initialize Glean is within the <code>application(_:)</code> method of the class that extends the <code>UIApplicationDelegate</code> class.</p>
<pre><code class="language-Swift">import Glean
import UIKit

@UIApplicationMain
class AppDelegate: UIResponder, UIApplicationDelegate {
    func application(_: UIApplication, didFinishLaunchingWithOptions _: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool {
        // If you have custom pings in your application, you must register them
        // using the following command. This command should be omitted for
        // applications not using custom pings.
        Glean.shared.registerPings(GleanMetrics.Pings)

        // Initialize the Glean library.
        Glean.shared.initialize(
            // Here, `Settings` is a method to get user preferences specific to
            // your application, and not part of the Glean SDK API.
            uploadEnabled = Settings.isTelemetryEnabled
        )
    }
}
</code></pre>
<p>Once initialized, if <code>uploadEnabled</code> is true, the Glean SDK will automatically start collecting <a href="reference/general/../../user/pings/metrics.html">baseline metrics</a> and sending its <a href="reference/general/../../user/pings/index.html">pings</a>, according to their respective schedules.
If <code>uploadEnabled</code> is false, any persisted metrics, events and pings (other than <code>first_run_date</code> and <code>first_run_hour</code>) are cleared, and subsequent calls to record metrics will be no-ops.</p>
<p>The Glean SDK should be initialized as soon as possible, and importantly, before any other libraries in the application start using Glean.
Library code should never call <code>Glean.shared.initialize</code>, since it should be called exactly once per application.</p>
<blockquote>
<p><strong>Note</strong>: if the application has the concept of release channels and knows which channel it is on at run-time,
then it can provide the Glean SDK with this information by setting it as part of the <code>Configuration</code> object parameter of the <code>Glean.shared.initialize</code> method. For example:</p>
</blockquote>
<pre><code class="language-Swift">Glean.shared.initialize(Configuration(channel: &quot;beta&quot;))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>The main control for the Glean SDK is on the <code>glean.Glean</code> singleton.</p>
<p>The Glean SDK should be initialized as soon as possible, and importantly, before any other libraries in the application start using Glean.
Library code should never call <code>Glean.initialize</code>, since it should be called exactly once per application.</p>
<pre><code class="language-python">from glean import Glean

Glean.initialize(
    application_id=&quot;my-app-id&quot;,
    application_version=&quot;0.1.0&quot;,
    upload_enabled=True,
)
</code></pre>
<p>Once initialized, if <code>upload_enabled</code> is true, the Glean SDK will automatically start collecting <a href="reference/general/../../user/pings/metrics.html">baseline metrics</a>.
If <code>upload_enabled</code> is false, any persisted metrics, events and pings (other than <code>first_run_date</code> and <code>first_run_hour</code>) are cleared, and subsequent calls to record metrics will be no-ops.</p>
<p>Additional configuration is available on the <code>glean.Configuration</code> object, which can be passed into <code>Glean.initialize()</code>.</p>
<p>Unlike Android and Swift, the Python bindings do not automatically send any pings.
See the <a href="reference/general/../../user/pings/custom.html">custom pings documentation</a> about adding custom pings and sending them.</p>
</div>
<div data-lang="C#" class="tab">
<p>The main control for the Glean SDK is on the <code>GleanInstance</code> singleton.</p>
<p>The Glean SDK should be initialized as soon as possible, and importantly, before any other libraries in the application start using Glean.
Library code should never call <code>Glean.initialize</code>, since it should be called exactly once per application.</p>
<pre><code class="language-C#">using static Mozilla.Glean.Glean;

GleanInstance.Initialize(
    applicationId: &quot;my.app.id&quot;,
    applicationVersion: &quot;0.1.1&quot;,
    uploadEnabled: true,
    configuration: new Configuration(),
    dataDir: gleanDataDir
    );
</code></pre>
</div>
</div>
</div>
<h2><a class="header" href="#behavior-when-uninitialized" id="behavior-when-uninitialized">Behavior when uninitialized</a></h2>
<p>Metric recording that happens before the Glean SDK is initialized is queued and applied at initialization.
To avoid unbounded memory growth the queue is bounded (currently to a maximum of 100 tasks), and further recordings are dropped.
The number of recordings dropped, if any, is recorded in the <code>glean.error.preinit_tasks_overflow</code> metric.</p>
<p>Custom ping submission will not fail before initialization.
Collection and upload of the custom ping is delayed until the Glean SDK is initialized.
Built-in pings are only available after initialization.</p>
<h2><a class="header" href="#enabling-and-disabling-metrics" id="enabling-and-disabling-metrics">Enabling and disabling metrics</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p><code>Glean.setUploadEnabled()</code> should be called in response to the user enabling or disabling telemetry.</p>
<p><strong>Note</strong>:
If called before <code>Glean.initialize()</code> the call to <code>Glean.setUploadEnabled()</code> will be ignored.
Set the initial state using <code>uploadEnabled</code> on <code>Glean.initialize()</code>.</p>
</div>
<div data-lang="Swift" class="tab">
<p><code>Glean.shared.setUploadEnabled()</code> should be called in response to the user enabling or disabling telemetry.</p>
<p><strong>Note</strong>:
If called before <code>Glean.shared.initialize()</code> the call to <code>Glean.shared.setUploadEnabled()</code> will be ignored.
Set the initial state using <code>uploadEnabled</code> on <code>Glean.shared.initialize()</code>.</p>
</div>
<div data-lang="Python" class="tab">
<p><code>Glean.set_upload_enabled()</code> should be called in response to the user enabling or disabling telemetry.</p>
<p><strong>Note</strong>:
If called before <code>Glean.initialize()</code> the call to <code>Glean.set_upload_enabled()</code> will be ignored.
Set the initial state using <code>upload_enabled</code> on <code>Glean.initialize()</code>.</p>
</div>
<div data-lang="C#" class="tab">
<p><code>GleanInstance.SetUploadEnabled()</code> should be called in response to the user enabling or disabling telemetry.</p>
<p><strong>Note</strong>:
If called before <code>GleanInstance.initialize()</code> the call to <code>GleanInstance.SetUploadEnabled()</code> will be ignored.
Set the initial state using <code>uploadEnabled</code> on <code>GleanInstance.initialize()</code>.</p>
</div>
</div>
</div>
<p>The application should provide some form of user interface to call this method.</p>
<p>When going from enabled to disabled, all pending events, metrics and pings are cleared, except for <a href="reference/general/../../user/pings/index.html#the-client_info-section"><code>first_run_date</code> and <code>first_run_hour</code></a>.
When re-enabling, core Glean metrics will be recomputed at that time.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/general/index.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#metrics-2" id="metrics-2">Metrics</a></h1>
<blockquote>
<p><strong>Not sure which metric type to use?</strong> These docs contain a <a href="reference/metrics/../../user/metrics/adding-new-metrics.html#choosing-a-metric-type">series of questions</a> that can help. Reference information about each metric type is linked below.</p>
</blockquote>
<p>The parameters available that apply to any metric type are in the <a href="reference/metrics/../yaml/index.html">metric parameters page</a>.</p>
<p>There are different metrics to choose from, depending on what you want to achieve:</p>
<ul>
<li>
<p><a href="reference/metrics/boolean.html">Boolean</a>: Records a single truth value, for example &quot;is a11y enabled?&quot;</p>
</li>
<li>
<p><a href="reference/metrics/labeled_booleans.html">Labeled boolean</a>: Records truth values for a set of labels, for example &quot;which a11y features are enabled?&quot;</p>
</li>
<li>
<p><a href="reference/metrics/counter.html">Counter</a>: Used to count how often something happens, for example, how often a certain button was pressed.</p>
</li>
<li>
<p><a href="reference/metrics/labeled_counters.html">Labeled counter</a>: Used to count how often something happens, for example which kind of crash occurred (<code>&quot;uncaught_exception&quot;</code> or <code>&quot;native_code_crash&quot;</code>).</p>
</li>
<li>
<p><a href="reference/metrics/string.html">String</a>: Records a single Unicode string value, for example the name of the OS.</p>
</li>
<li>
<p><a href="reference/metrics/labeled_strings.html">Labeled strings</a>: Records multiple Unicode string values, for example to record which kind of error occurred in different stages of a login process.</p>
</li>
<li>
<p><a href="reference/metrics/string_list.html">String List</a>: Records a list of Unicode string values, for example the list of enabled search engines.</p>
</li>
<li>
<p><a href="reference/metrics/timespan.html">Timespan</a>: Used to measure how much time is spent in a single task.</p>
</li>
<li>
<p><a href="reference/metrics/timing_distribution.html">Timing Distribution</a>: Used to record the distribution of multiple time measurements.</p>
</li>
<li>
<p><a href="reference/metrics/memory_distribution.html">Memory Distribution</a>: Used to record the distribution of memory sizes.</p>
</li>
<li>
<p><a href="reference/metrics/uuid.html">UUID</a>: Used to record universally unique identifiers (UUIDs), such as a client ID.</p>
</li>
<li>
<p><a href="reference/metrics/datetime.html">Datetime</a>: Used to record an absolute date and time, such as the time the user first ran the application.</p>
</li>
<li>
<p><a href="reference/metrics/event.html">Events</a>: Records events e.g. individual occurrences of user actions, say every time a view was open and from where.</p>
</li>
<li>
<p><a href="reference/metrics/quantity.html">Quantity</a>: Used to record a single non-negative integer value. For example, the width of the display in pixels.</p>
</li>
<li>
<p><a href="reference/metrics/rate.html">Rate</a>: Used to record the rate something happens relative to some other thing.
For example, the number of HTTP connections that experienced an error relative to the number of total HTTP connections made.</p>
</li>
<li>
<p><a href="reference/metrics/custom_distribution.html">Custom Distribution</a>: Used to record the distribution of a value that needs fine-grained control of how the histogram buckets are computed.  <strong>Custom distributions are only available for values that come from Gecko.</strong></p>
</li>
</ul>
<h2><a class="header" href="#labeled-metrics" id="labeled-metrics">Labeled metrics</a></h2>
<p>There are two types of metrics listed above - <em>labeled</em> and <em>unlabeled</em> metrics. If a metric is <em>labeled</em>, it means that for a single metric entry you define in <code>metrics.yaml</code>, you can record into multiple metrics under the same name, each of the same type and identified by a different string label.</p>
<p>This is useful when you need to break down metrics by a label known at build time or run time. For example:</p>
<ul>
<li>
<p>When you want to count a different set of sub-views that users interact with, you could use <code>viewCount[&quot;view1&quot;].add()</code> and <code>viewCount[&quot;view2&quot;].add()</code>.</p>
</li>
<li>
<p>When you want to count errors that might occur for a feature, you could use <code>errorCount[errorName].add()</code>.</p>
</li>
</ul>
<p>Labeled metrics come in two forms:</p>
<ul>
<li>
<p><strong>Static labels</strong>: The labels are specified at build time in the <code>metrics.yaml</code> file, in the <code>labels</code> parameter.
If a label that isn't part of this set is used at run time, it is converted to the special label <code>__other__</code>.
The number of static labels is limited to 100 per metric.</p>
</li>
<li>
<p><strong>Dynamic labels</strong>: The labels aren't known at build time, so are set at run time.
Only the first 16 labels seen by the Glean SDK will be tracked. After that, any additional labels are converted to the special label <code>__other__</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong>: Be careful with using arbitrary strings as labels and make sure they can't accidentally contain identifying data (like directory paths or user input).</p>
</blockquote>
<h3><a class="header" href="#label-format" id="label-format">Label format</a></h3>
<p>To ensure maximum support in database columns, labels must be made up of dot-separated identifiers with lowercase ASCII alphanumerics, containing underscores and dashes.</p>
<p>Specifically, they must conform to this regular expression:</p>
<pre><code>^[a-z_][a-z0-9_-]{0,29}(\\.[a-z_][a-z0-9_-]{0,29})*$
</code></pre>
<h2><a class="header" href="#adding-or-changing-metric-types" id="adding-or-changing-metric-types">Adding or changing metric types</a></h2>
<p>Glean has a <a href="https://wiki.mozilla.org/Glean/Adding_or_changing_Glean_metric_types">well-defined process</a> for requesting changes to existing metric types or suggesting the implementation of new metric types:</p>
<ol>
<li>Glean consumers need to file a bug in the <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Data%20Platform%20and%20Tools&amp;component=Glean%20Metric%20Types">Data platforms &amp; tools::Glean Metric Types</a> component, filling in the provided form;</li>
<li>The triage owner of the Bugzilla component prioritizes this within 6 business days and kicks off the <a href="https://wiki.mozilla.org/Glean/Adding_or_changing_Glean_metric_types#The_decision_making_process">decision making process</a>.</li>
<li>Once the decision process is completed, the bug is closed with a comment outlining the decision that was made.</li>
</ol>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/index.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#boolean" id="boolean">Boolean</a></h1>
<p>Booleans are used for simple flags, for example &quot;is a11y enabled&quot;?.</p>
<h2><a class="header" href="#configuration" id="configuration">Configuration</a></h2>
<p>Say you're adding a boolean to record whether a11y is enabled on the device. First you need to add an entry for the boolean to the <code>metrics.yaml</code> file:</p>
<pre><code class="language-YAML">flags:
  a11y_enabled:
    type: boolean
    description: &gt;
      Records whether a11y is enabled on the device.
    lifetime: application
    ...
</code></pre>
<h2><a class="header" href="#api-1" id="api-1">API</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Flags

Flags.a11yEnabled.set(System.isAccesibilityEnabled())
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Flags

// Was anything recorded?
assertTrue(Flags.a11yEnabled.testHasValue())
// Does it have the expected value?
assertTrue(Flags.a11yEnabled.testGetValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Flags;

Flags.INSTANCE.a11yEnabled.set(System.isAccessibilityEnabled());
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Flags;

// Was anything recorded?
assertTrue(Flags.INSTANCE.a11yEnabled.testHasValue());
// Does it have the expected value?
assertTrue(Flags.INSTANCE.a11yEnabled.testGetValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Flags.a11yEnabled.set(self.isAccessibilityEnabled)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssertTrue(Flags.a11yEnabled.testHasValue())
// Does the counter have the expected value?
XCTAssertTrue(try Flags.a11yEnabled.testGetValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.flags.a11y_enabled.set(is_accessibility_enabled())
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Python"># Was anything recorded?
assert metrics.flags.a11y_enabled.test_has_value()
# Does it have the expected value?
assert True is metrics.flags.a11y_enabled.test_get_value()
</code></pre>
</div>
<div data-lang="C#" class="tab">
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.FlagsOuter;

Flags.a11yEnabled.Set(System.IsAccessibilityEnabled());
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.FlagsOuter;

// Was anything recorded?
Assert.True(Flags.a11yEnabled.TestHasValue());
// Does it have the expected value?
Assert.True(Flags.a11yEnabled.TestGetValue());
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

flags::a11y_enabled.set(system.is_accessibility_enabled());
<span class="boring">}
</span></code></pre></pre>
<p>There are test APIs available too:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

// Was anything recorded?
assert!(flags::a11y_enabled.test_get_value(None).is_some());
// Does it have the expected value?
assert!(flags::a11y_enabled.test_get_value(None).unwrap());
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="C++" class="tab">
<blockquote>
<p><strong>Note</strong>: C++ APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::flags::a11y_enabled.Set(false);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

ASSERT_EQ(false, mozilla::glean::flags::a11y_enabled.TestGetValue().value());
</code></pre>
</div>
<div data-lang="JS" class="tab">
<blockquote>
<p><strong>Note</strong>: JS APIs are currently only available in Firefox Desktop.
General JavaScript support is coming soon via <a href="https://github.com/mozilla/glean.js/">the Glean.js project</a>.</p>
</blockquote>
<pre><code class="language-js">Glean.flags.a11yEnabled.set(false);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-js">Assert.equal(false, Glean.flags.a11yEnabled.testGetValue());
</code></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits-1" id="limits-1">Limits</a></h2>
<ul>
<li>None.</li>
</ul>
<h2><a class="header" href="#examples" id="examples">Examples</a></h2>
<ul>
<li>Is a11y enabled?</li>
</ul>
<h2><a class="header" href="#recorded-errors" id="recorded-errors">Recorded errors</a></h2>
<ul>
<li>None.</li>
</ul>
<h2><a class="header" href="#reference-1" id="reference-1">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-boolean-metric-type/index.html">Kotlin API docs</a></li>
<li><a href="reference/metrics/../../../swift/Classes/BooleanMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/boolean.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/boolean/struct.BooleanMetric.html">Rust API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/boolean.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#labeled-booleans" id="labeled-booleans">Labeled Booleans</a></h1>
<p>Labeled booleans are used to record different related boolean flags.</p>
<h2><a class="header" href="#configuration-1" id="configuration-1">Configuration</a></h2>
<p>For example, you may want to record a set of flags related to accessibility (a11y).</p>
<pre><code class="language-YAML">accessibility:
  features:
    type: labeled_boolean
    description: &gt;
      a11y features enabled on the device. ...
    labels:
      - screen_reader
      - high_contrast
    ...
</code></pre>
<blockquote>
<p><strong>Note:</strong> removing or changing labels, including their order in the registry file, is permitted. Avoid reusing labels that were removed in the past. It is best practice to add documentation about removed labels to the description field so that analysts will know of their existence and meaning in historical data. Special care must be taken when changing GeckoView metrics sent through the Glean SDK, as the index of the labels is used to report Gecko data through the Glean SDK.</p>
</blockquote>
<h2><a class="header" href="#api-2" id="api-2">API</a></h2>
<p>Now you can use the labeled boolean from the application's code:</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Accessibility
Accessibility.features[&quot;screen_reader&quot;].set(isScreenReaderEnabled())
Accessibility.features[&quot;high_contrast&quot;].set(isHighContrastEnabled())
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Accessibility
// Was anything recorded?
assertTrue(Accessibility.features[&quot;screen_reader&quot;].testHasValue())
assertTrue(Accessibility.features[&quot;high_contrast&quot;].testHasValue())
// Do the booleans have the expected values?
assertEquals(True, Accessibility.features[&quot;screen_reader&quot;].testGetValue())
assertEquals(False, Accessibility.features[&quot;high_contrast&quot;].testGetValue())
// Did we record any invalid labels?
assertEquals(0, Accessibility.features.testGetNumRecordedErrors(ErrorType.InvalidLabel))
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Accessibility.features[&quot;screen_reader&quot;].set(isScreenReaderEnabled())
Accessibility.features[&quot;high_contrast&quot;].set(isHighContrastEnabled())
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(Accessibility.features[&quot;screen_reader&quot;].testHasValue())
XCTAssert(Accessibility.features[&quot;high_contrast&quot;].testHasValue())
// Do the booleans have the expected values?
XCTAssertEqual(true, try Accessibility.features[&quot;screen_reader&quot;].testGetValue())
XCTAssertEqual(false, try Accessibility.features[&quot;high_contrast&quot;].testGetValue())
// Were there any invalid labels?
XCTAssertEqual(0, Accessibility.features.testGetNumRecordedErrors(.invalidLabel))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.accessibility.features[&quot;screen_reader&quot;].set(
    is_screen_reader_enabled()
)
metrics.accessibility.features[&quot;high_contrast&quot;].set(
    is_high_contrast_enabled()
)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Python"># Was anything recorded?
assert metrics.accessibility.features[&quot;screen_reader&quot;].test_has_value()
assert metrics.accessibility.features[&quot;high_contrast&quot;].test_has_value()
# Do the booleans have the expected values?
assert metrics.accessibility.features[&quot;screen_reader&quot;].test_get_value()
assert not metrics.accessibility.features[&quot;high_contrast&quot;].test_get_value()
# Did we record any invalid labels?
assert 0 == metrics.accessibility.features.test_get_num_recorded_errors(
    ErrorType.INVALID_LABEL
)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Accessibility;

Accessibility.features[&quot;screen_reader&quot;].Set(isScreenReaderEnabled());
Accessibility.features[&quot;high_contrast&quot;].Set(isHighContrastEnabled());
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Accessibility;
// Was anything recorded?
Assert.True(Accessibility.features[&quot;screen_reader&quot;].TestHasValue());
Assert.True(Accessibility.features[&quot;high_contrast&quot;].TestHasValue());
// Do the booleans have the expected values?
Assert.Equal(true, Accessibility.features[&quot;screen_reader&quot;].TestGetValue());
Assert.Equal(false, Accessibility.features[&quot;high_contrast&quot;].TestGetValue());
// Did we record any invalid labels?
Assert.Equal(0, Accessibility.features.TestGetNumRecordedErrors(ErrorType.InvalidLabel));
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

accessibility::features.get(&quot;screen_reader&quot;).set(is_screen_reader_enabled());
accessibility::features.get(&quot;high_contrast&quot;).set(is_high_contrast_enabled());
<span class="boring">}
</span></code></pre></pre>
<p>There are test APIs available too:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;

use glean_metrics;

// Was anything recorded?
assert!(accessibility::features.get(&quot;screen_reader&quot;).test_get_value(None).is_some());
assert!(accessibility::features.get(&quot;high_contrast&quot;).test_get_value(None).is_some());
// Do the booleans have the expected values?
assert!(accessibility::features.get(&quot;screen_reader&quot;).test_get_value(None).unwrap());
assert!(!accessibility::features.get(&quot;high_contrast&quot;).test_get_value(None).unwrap());
// Did we record any invalid labels?
assert_eq!(
  1,
  accessibility::features.test_get_num_recorded_errors(
    ErrorType::InvalidLabel
  )
);
<span class="boring">}
</span></code></pre></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits-2" id="limits-2">Limits</a></h2>
<ul>
<li>
<p>Labels must conform to the <a href="reference/metrics/index.html#label-format">label formatting regular expression</a>.</p>
</li>
<li>
<p>Labels support lowercase alphanumeric characters; they additionally allow for dots (<code>.</code>), underscores (<code>_</code>) and/or hyphens (<code>-</code>).</p>
</li>
<li>
<p>Each label must have a maximum of 60 bytes, when encoded as UTF-8.</p>
</li>
<li>
<p>If the labels are specified in the <code>metrics.yaml</code>, using any label not listed in that file will be replaced with the special value <code>__other__</code>.</p>
</li>
<li>
<p>The number of labels specified in the <code>metrics.yaml</code> is limited to 100.</p>
</li>
<li>
<p>If the labels aren't specified in the <code>metrics.yaml</code>, only 16 different dynamic labels may be used, after which the special value <code>__other__</code> will be used.</p>
</li>
</ul>
<h2><a class="header" href="#examples-1" id="examples-1">Examples</a></h2>
<ul>
<li>Record a related set of boolean flags.</li>
</ul>
<h2><a class="header" href="#recorded-errors-1" id="recorded-errors-1">Recorded Errors</a></h2>
<ul>
<li>
<p><code>invalid_label</code>: If the label contains invalid characters. Data is still recorded to the special label <code>__other__</code>.</p>
</li>
<li>
<p><code>invalid_label</code>: If the label exceeds the maximum number of allowed characters. Data is still recorded to the special label <code>__other__</code>.</p>
</li>
</ul>
<h2><a class="header" href="#reference-2" id="reference-2">Reference</a></h2>
<ul>
<li>Kotlin API docs <a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-labeled-metric-type/index.html"><code>LabeledMetricType</code></a>, <a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-boolean-metric-type/index.html"><code>BooleanMetricType</code></a></li>
<li>Swift API docs: <a href="reference/metrics/../../../swift/Classes/LabeledMetricType.html"><code>LabeledMetricType</code></a>, <a href="reference/metrics/../../../swift/Classes/BooleanMetricType.html"><code>BooleanMetricType</code></a></li>
<li>Python API docs: <a href="reference/metrics/../../../python/glean/metrics/labeled.html"><code>LabeledMetricBase</code></a>, <a href="reference/metrics/../../../python/glean/metrics/boolean.html"><code>BooleanMetricType</code></a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/labeled_booleans.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#counter" id="counter">Counter</a></h1>
<p>Used to count how often something happens, say how often a certain button was pressed.
A counter always starts from <code>0</code>.
Each time you record to a counter, its value is incremented.
Unless incremented by a positive value, a counter will not be reported in pings.</p>
<blockquote>
<p><strong>IMPORTANT:</strong> When using a counter metric, it is important to let the Glean metric do the counting. Using your own variable for counting and setting the counter yourself could be problematic because it will be difficult to reset the value at the exact moment that the value is sent in a ping. Instead, just use <code>counter.add</code> to increment the value and let Glean handle resetting the counter.</p>
</blockquote>
<p>If you find that you need to control the actual value sent in the ping, you may be measuring something, not just counting something, and a <a href="reference/metrics/quantity.html">Quantity metric</a> may be a better choice.</p>
<h2><a class="header" href="#configuration-2" id="configuration-2">Configuration</a></h2>
<p>Say you're adding a new counter for how often the refresh button is pressed. First you need to add an entry for the counter to the <code>metrics.yaml</code> file:</p>
<pre><code class="language-YAML">controls:
  refresh_pressed:
    type: counter
    description: &gt;
      Counts how often the refresh button is pressed.
    ...
</code></pre>
<h2><a class="header" href="#api-3" id="api-3">API</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Controls

Controls.refreshPressed.add() // Adds 1 to the counter.
Controls.refreshPressed.add(5) // Adds 5 to the counter.
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Controls

// Was anything recorded?
assertTrue(Controls.refreshPressed.testHasValue())
// Does the counter have the expected value?
assertEquals(6, Controls.refreshPressed.testGetValue())
// Did the counter record a negative value?
assertEquals(
    1, Controls.refreshPressed.testGetNumRecordedErrors(ErrorType.InvalidValue)
)
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Controls;

Controls.INSTANCE.refreshPressed.add(); // Adds 1 to the counter.
Controls.INSTANCE.refreshPressed.add(5); // Adds 5 to the counter.
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Controls;

// Was anything recorded?
assertTrue(Controls.INSTANCE.refreshPressed.testHasValue());
// Does the counter have the expected value?
assertEquals(6, Controls.INSTANCE.refreshPressed.testGetValue());
// Did the counter record a negative value?
assertEquals(
    1, Controls.INSTANCE.refreshPressed.testGetNumRecordedErrors(ErrorType.InvalidValue)
);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Controls.refreshPressed.add() // Adds 1 to the counter.
Controls.refreshPressed.add(5) // Adds 5 to the counter.
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(Controls.refreshPressed.testHasValue())
// Does the counter have the expected value?
XCTAssertEqual(6, try Controls.refreshPressed.testGetValue())
// Did the counter record a negative value?
XCTAssertEqual(1, Controls.refreshPressed.testGetNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.controls.refresh_pressed.add()  # Adds 1 to the counter.
metrics.controls.refresh_pressed.add(5) # Adds 5 to the counter.
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Python"># Was anything recorded?
assert metrics.controls.refresh_pressed.test_has_value()
# Does the counter have the expected value?
assert 6 == metrics.controls.refresh_pressed.test_get_value()
# Did the counter record a negative value?
from glean.testing import ErrorType
assert 1 == metrics.controls.refresh_pressed.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Controls;

Controls.refreshPressed.Add(); // Adds 1 to the counter.
Controls.refreshPressed.Add(5); // Adds 5 to the counter.
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Controls;

// Was anything recorded?
Assert.True(Controls.refreshPressed.TestHasValue());
// Does the counter have the expected value?
Assert.Equal(6, Controls.refreshPressed.TestGetValue());
// Did the counter record a negative value?
Assert.Equal(
    1, Controls.refreshPressed.TestGetNumRecordedErrors(ErrorType.InvalidValue)
);
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

controls::refresh_pressed.add(1); // Adds 1 to the counter.
controls::refresh_pressed.add(5); // Adds 5 to the counter.
<span class="boring">}
</span></code></pre></pre>
<p>There are test APIs available too:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;

use glean_metrics;

// Was anything recorded?
assert!(controls::refresh_pressed.test_get_value(None).is_some());
// Does the counter have the expected value?
assert_eq!(6, controls::refresh_pressed.test_get_value(None).unwrap());
// Did the counter record an negative value?
assert_eq!(
  1,
  controls::refresh_pressed.test_get_num_recorded_errors(
    ErrorType::InvalidValue
  )
);
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="C++" class="tab">
<blockquote>
<p><strong>Note</strong>: C++ APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::controls::refresh_pressed.Add(1);
mozilla::glean::controls::refresh_pressed.Add(5);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Does the counter have the expected value?
ASSERT_EQ(6, mozilla::glean::controls::refresh_pressed.TestGetValue().value());
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
<div data-lang="JS" class="tab">
<blockquote>
<p><strong>Note</strong>: JS APIs are currently only available in Firefox Desktop.
General JavaScript support is coming soon via <a href="https://github.com/mozilla/glean.js/">the Glean.js project</a>.</p>
</blockquote>
<pre><code class="language-js">Glean.controls.refreshPressed.add(1);
Glean.controls.refreshPressed.add(5);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-js">Assert.equal(6, Glean.controls.refreshPressed.testGetValue());
</code></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits-3" id="limits-3">Limits</a></h2>
<ul>
<li>Only increments, saturates at the largest value that can be represented as a 32-bit signed integer (<code>2147483647</code>).</li>
</ul>
<h2><a class="header" href="#examples-2" id="examples-2">Examples</a></h2>
<ul>
<li>How often was a certain button was pressed?</li>
</ul>
<h2><a class="header" href="#recorded-errors-2" id="recorded-errors-2">Recorded errors</a></h2>
<ul>
<li><code>invalid_value</code>: If the counter is incremented by <code>0</code> or a negative value.</li>
</ul>
<h2><a class="header" href="#reference-3" id="reference-3">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-counter-metric-type/index.html">Kotlin API docs</a></li>
<li><a href="reference/metrics/../../../swift/Classes/CounterMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/counter.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/counter/struct.CounterMetric.html">Rust API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/counter.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#labeled-counters" id="labeled-counters">Labeled Counters</a></h1>
<p>Labeled counters are used to record different related counts that should sum up to a total.</p>
<h2><a class="header" href="#configuration-3" id="configuration-3">Configuration</a></h2>
<p>For example, you may want to record a count of different types of crashes for your Android application, such as native code crashes and uncaught exceptions:</p>
<pre><code class="language-YAML">stability:
  crash_count:
    type: labeled_counter
    description: &gt;
      Counts the number of crashes that occur in the application. ...
    labels:
      - uncaught_exception
      - native_code_crash
    ...
</code></pre>
<blockquote>
<p><strong>Note:</strong> removing or changing labels, including their order in the registry file, is permitted. Avoid reusing labels that were removed in the past. It is best practice to add documentation about removed labels to the description field so that analysts will know of their existence and meaning in historical data. Special care must be taken when changing GeckoView metrics sent through the Glean SDK, as the index of the labels is used to report Gecko data through the Glean SDK.</p>
</blockquote>
<h2><a class="header" href="#api-4" id="api-4">API</a></h2>
<p>Now you can use the labeled counter from the application's code:</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Stability
Stability.crashCount[&quot;uncaught_exception&quot;].add() // Adds 1 to the &quot;uncaught_exception&quot; counter.
Stability.crashCount[&quot;native_code_crash&quot;].add(3) // Adds 3 to the &quot;native_code_crash&quot; counter.
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Stability
// Was anything recorded?
assertTrue(Stability.crashCount[&quot;uncaught_exception&quot;].testHasValue())
assertTrue(Stability.crashCount[&quot;native_code_crash&quot;].testHasValue())
// Do the counters have the expected values?
assertEquals(1, Stability.crashCount[&quot;uncaught_exception&quot;].testGetValue())
assertEquals(3, Stability.crashCount[&quot;native_code_crash&quot;].testGetValue())
// Were there any invalid labels?
assertEquals(0, Stability.crashCount.testGetNumRecordedErrors(ErrorType.InvalidLabel))
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Stability.crashCount[&quot;uncaught_exception&quot;].add() // Adds 1 to the &quot;uncaught_exception&quot; counter.
Stability.crashCount[&quot;native_code_crash&quot;].add(3) // Adds 3 to the &quot;native_code_crash&quot; counter.
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(Stability.crashCount[&quot;uncaught_exception&quot;].testHasValue())
XCTAssert(Stability.crashCount[&quot;native_code_crash&quot;].testHasValue())
// Do the counters have the expected values?
XCTAssertEqual(1, try Stability.crashCount[&quot;uncaught_exception&quot;].testGetValue())
XCTAssertEqual(3, try Stability.crashCount[&quot;native_code_crash&quot;].testGetValue())
// Were there any invalid labels?
XCTAssertEqual(0, Stability.crashCount.testGetNumRecordedErrors(.invalidLabel))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Adds 1 to the &quot;uncaught_exception&quot; counter.
metrics.stability.crash_count[&quot;uncaught_exception&quot;].add()
# Adds 3 to the &quot;native_code_crash&quot; counter.
metrics.stability.crash_count[&quot;native_code_crash&quot;].add(3)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Python"># Was anything recorded?
assert metrics.stability.crash_count[&quot;uncaught_exception&quot;].test_has_value()
assert metrics.stability.crash_count[&quot;native_code_crash&quot;].test_has_value()
# Do the counters have the expected values?
assert 1 == metrics.stability.crash_count[&quot;uncaught_exception&quot;].test_get_value()
assert 3 == metrics.stability.crash_count[&quot;native_code_crash&quot;].test_get_value()
# Were there any invalid labels?
assert 0 == metrics.stability.crash_count.test_get_num_recorded_errors(
    ErrorType.INVALID_LABEL
)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Stability;
Stability.crashCount[&quot;uncaught_exception&quot;].Add(); // Adds 1 to the &quot;uncaught_exception&quot; counter.
Stability.crashCount[&quot;native_code_crash&quot;].Add(3); // Adds 3 to the &quot;native_code_crash&quot; counter.
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Stability;
// Was anything recorded?
Assert.True(Stability.crashCount[&quot;uncaught_exception&quot;].TestHasValue());
Assert.True(Stability.crashCount[&quot;native_code_crash&quot;].TestHasValue());
// Do the counters have the expected values?
Assert.Equal(1, Stability.crashCount[&quot;uncaught_exception&quot;].TestGetValue());
Assert.Equal(3, Stability.crashCount[&quot;native_code_crash&quot;].TestGetValue());
// Were there any invalid labels?
Assert.Equal(0, Stability.crashCount.TestGetNumRecordedErrors(ErrorType.InvalidLabel));
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

stability::crash_count.get(&quot;uncaught_exception&quot;).add(1); // Adds 1 to the &quot;uncaught_exception&quot; counter.
stability::crash_count.get(&quot;native_code_crash&quot;).add(3); // Adds 3 to the &quot;native_code_crash&quot; counter.
<span class="boring">}
</span></code></pre></pre>
<p>There are test APIs available too:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;

use glean_metrics;
// Was anything recorded?
assert!(stability::crash_count.get(&quot;uncaught_exception&quot;).test_get_value().is_some());
assert!(stability::crash_count.get(&quot;native_code_crash&quot;).test_get_value().is_some());
// Do the counters have the expected values?
assert_eq!(1, stability::crash_count.get(&quot;uncaught_exception&quot;).test_get_value().unwrap());
assert_eq!(3, stability::crash_count.get(&quot;native_code_crash&quot;).test_get_value().unwrap());
// Were there any invalid labels?
assert_eq!(
  0,
  stability::crash_count.test_get_num_recorded_errors(
    ErrorType::InvalidLabel
  )
);
<span class="boring">}
</span></code></pre></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits-4" id="limits-4">Limits</a></h2>
<ul>
<li>
<p>Labels must conform to the <a href="reference/metrics/index.html#label-format">label formatting regular expression</a>.</p>
</li>
<li>
<p>Labels support lowercase alphanumeric characters; they additionally allow for dots (<code>.</code>), underscores (<code>_</code>) and/or hyphens (<code>-</code>).</p>
</li>
<li>
<p>Each label must have a maximum of 60 bytes, when encoded as UTF-8.</p>
</li>
<li>
<p>If the labels are specified in the <code>metrics.yaml</code>, using any label not listed in that file will be replaced with the special value <code>__other__</code>.</p>
</li>
<li>
<p>The number of labels specified in the <code>metrics.yaml</code> is limited to 100.</p>
</li>
<li>
<p>If the labels aren't specified in the <code>metrics.yaml</code>, only 16 different dynamic labels may be used, after which the special value <code>__other__</code> will be used.</p>
</li>
</ul>
<h2><a class="header" href="#examples-3" id="examples-3">Examples</a></h2>
<ul>
<li>Record the number of times different kinds of crashes occurred.</li>
</ul>
<h2><a class="header" href="#recorded-errors-3" id="recorded-errors-3">Recorded Errors</a></h2>
<ul>
<li>
<p><code>invalid_label</code>: If the label contains invalid characters. Data is still recorded to the special label <code>__other__</code>.</p>
</li>
<li>
<p><code>invalid_label</code>: If the label exceeds the maximum number of allowed characters. Data is still recorded to the special label <code>__other__</code>.</p>
</li>
</ul>
<h2><a class="header" href="#reference-4" id="reference-4">Reference</a></h2>
<ul>
<li>Kotlin API docs <a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-labeled-metric-type/index.html"><code>LabeledMetricType</code></a>, <a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-counter-metric-type/index.html"><code>CounterMetricType</code></a></li>
<li>Swift API docs: <a href="reference/metrics/../../../swift/Classes/LabeledMetricType.html"><code>LabeledMetricType</code></a>, <a href="reference/metrics/../../../swift/Classes/CounterMetricType.html"><code>CounterMetricType</code></a></li>
<li>Python API docs: <a href="reference/metrics/../../../python/glean/metrics/labeled.html"><code>LabeledMetricBase</code></a>, <a href="reference/metrics/../../../python/glean/metrics/counter.html"><code>CounterMetricType</code></a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/labeled_counters.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#strings" id="strings">Strings</a></h1>
<p>This allows recording a Unicode string value with arbitrary content.</p>
<blockquote>
<p><strong>Note</strong>: Be careful using arbitrary strings and make sure they can't accidentally contain identifying data (like directory paths or user input).</p>
</blockquote>
<blockquote>
<p><strong>Note</strong>: This is does not support recording JSON blobs - please get in contact with the Telemetry team if you're missing a type.</p>
</blockquote>
<h2><a class="header" href="#configuration-4" id="configuration-4">Configuration</a></h2>
<p>Say you're adding a metric to find out what the default search in a browser is. First you need to add an entry for the metric to the <code>metrics.yaml</code> file:</p>
<pre><code class="language-YAML">search.default:
  name:
    type: string
    description: &gt;
      The name of the default search engine.
    lifetime: application
    ...
</code></pre>
<h2><a class="header" href="#api-5" id="api-5">API</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.SearchDefault

// Record a value into the metric.
SearchDefault.name.set(&quot;duck duck go&quot;)
// If it changed later, you can record the new value:
SearchDefault.name.set(&quot;wikipedia&quot;)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.SearchDefault

// Was anything recorded?
assertTrue(SearchDefault.name.testHasValue())
// Does the string metric have the expected value?
// IMPORTANT: It may have been truncated -- see &quot;Limits&quot; below
assertEquals(&quot;wikipedia&quot;, SearchDefault.name.testGetValue())
// Was the string truncated, and an error reported?
assertEquals(1, SearchDefault.name.testGetNumRecordedErrors(ErrorType.InvalidValue))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.SearchDefault;

// Record a value into the metric.
SearchDefault.INSTANCE.name.set(&quot;duck duck go&quot;);
// If it changed later, you can record the new value:
SearchDefault.INSTANCE.name.set(&quot;wikipedia&quot;);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.SearchDefault

// Was anything recorded?
assertTrue(SearchDefault.INSTANCE.name.testHasValue());
// Does the string metric have the expected value?
// IMPORTANT: It may have been truncated -- see &quot;Limits&quot; below
assertEquals(&quot;wikipedia&quot;, SearchDefault.INSTANCE.name.testGetValue());
// Was the string truncated, and an error reported?
assertEquals(
    1,
    SearchDefault.INSTANCE.name.testGetNumRecordedErrors(
        ErrorType.InvalidValue
    )
);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">// Record a value into the metric.
SearchDefault.name.set(&quot;duck duck go&quot;)
// If it changed later, you can record the new value:
SearchDefault.name.set(&quot;wikipedia&quot;)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(SearchDefault.name.testHasValue())
// Does the string metric have the expected value?
// IMPORTANT: It may have been truncated -- see &quot;Limits&quot; below
XCTAssertEqual(&quot;wikipedia&quot;, try SearchDefault.name.testGetValue())
// Was the string truncated, and an error reported?
XCTAssertEqual(1, SearchDefault.name.testGetNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Record a value into the metric.
metrics.search_default.name.set(&quot;duck duck go&quot;)
# If it changed later, you can record the new value:
metrics.search_default.name.set(&quot;wikipedia&quot;)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Python"># Was anything recorded?
assert metrics.search_default.name.test_has_value()
# Does the string metric have the expected value?
# IMPORTANT: It may have been truncated -- see &quot;Limits&quot; below
assert &quot;wikipedia&quot; == metrics.search_default.name.test_get_value()
# Was the string truncated, and an error reported?
assert 1 == metrics.search_default.name.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.SearchDefault;

// Record a value into the metric.
SearchDefault.name.Set(&quot;duck duck go&quot;);
// If it changed later, you can record the new value:
SearchDefault.name.Set(&quot;wikipedia&quot;);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.SearchDefault;

// Was anything recorded?
Assert.True(SearchDefault.name.TestHasValue());
// Does the string metric have the expected value?
// IMPORTANT: It may have been truncated -- see &quot;Limits&quot; below
Assert.Equal(&quot;wikipedia&quot;, SearchDefault.name.TestGetValue());
// Was the string truncated, and an error reported?
Assert.Equal(
    1,
    SearchDefault.name.TestGetNumRecordedErrors(
        ErrorType.InvalidValue
    )
);
</code></pre>
</div>
<div data-lang="C++" class="tab">
<blockquote>
<p><strong>Note</strong>: C++ APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::search_default::name.Set(&quot;wikipedia&quot;_ns);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Does it have the expected value?
ASSERT_STREQ(
  &quot;wikipedia&quot;,
  mozilla::glean::search_default::name.TestGetValue().value().get()
);
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
<div data-lang="JS" class="tab">
<blockquote>
<p><strong>Note</strong>: JS APIs are currently only available in Firefox Desktop.
General JavaScript support is coming soon via <a href="https://github.com/mozilla/glean.js/">the Glean.js project</a>.</p>
</blockquote>
<pre><code class="language-js">Glean.searchDefault.name.set(&quot;wikipedia&quot;);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-js">Assert.equal(&quot;wikipedia&quot;, Glean.searchDefault.name.testGetValue());
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits-5" id="limits-5">Limits</a></h2>
<ul>
<li>Fixed maximum string length: 100. Longer strings are truncated. This is measured in the number of bytes when the string is encoded in UTF-8.</li>
</ul>
<h2><a class="header" href="#examples-4" id="examples-4">Examples</a></h2>
<ul>
<li>
<p>Record the operating system name with a value of <code>&quot;android&quot;</code>.</p>
</li>
<li>
<p>Recording the device model with a value of <code>&quot;SAMSUNG-SGH-I997&quot;</code>.</p>
</li>
</ul>
<h2><a class="header" href="#recorded-errors-4" id="recorded-errors-4">Recorded errors</a></h2>
<ul>
<li><code>invalid_overflow</code>: if the string is too long. (Prior to Glean 31.5.0, this recorded an <code>invalid_value</code>).</li>
</ul>
<h2><a class="header" href="#reference-5" id="reference-5">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-string-metric-type/index.html">Kotlin API docs</a>.</li>
<li><a href="reference/metrics/../../../swift/Classes/StringMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/string.html">Python API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/string.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#labeled-strings" id="labeled-strings">Labeled Strings</a></h1>
<p>Labeled strings record multiple Unicode string values, each under a different label.</p>
<h2><a class="header" href="#configuration-5" id="configuration-5">Configuration</a></h2>
<p>For example to record which kind of error occurred in different stages of a login process - <code>&quot;RuntimeException&quot;</code> in the <code>&quot;server_auth&quot;</code> stage or <code>&quot;invalid_string&quot;</code> in the <code>&quot;enter_email&quot;</code> stage:</p>
<pre><code class="language-YAML">login:
  errors_by_stage:
    type: labeled_string
    description: Records the error type, if any, that occur in different stages of the login process.
    labels:
      - server_auth
      - enter_email
    ...
</code></pre>
<h2><a class="header" href="#api-6" id="api-6">API</a></h2>
<p>Now you can use the labeled string from the application's code:</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Login

Login.errorsByStage[&quot;server_auth&quot;].set(&quot;Invalid password&quot;)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Login

// Was anything recorded?
assertTrue(Login.errorsByStage[&quot;server_auth&quot;].testHasValue())

// Were there any invalid labels?
assertEquals(0, Login.errorsByStage.testGetNumRecordedErrors(ErrorType.InvalidLabel))
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Login.errorsByStage[&quot;server_auth&quot;].set(&quot;Invalid password&quot;)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(Login.errorsByStage[&quot;server_auth&quot;].testHasValue())

// Were there any invalid labels?
XCTAssertEqual(0, Login.errorsByStage.testGetNumRecordedErrors(.invalidLabel))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.login.errors_by_stage[&quot;server_auth&quot;].set(&quot;Invalid password&quot;)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Python"># Was anything recorded?
assert metrics.login.errors_by_stage[&quot;server_auth&quot;].test_has_value()

# Were there any invalid labels?
assert 0 == metrics.login.errors_by_stage.test_get_num_recorded_errors(
    ErrorType.INVALID_LABEL
)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Login;

Login.errorsByStage[&quot;server_auth&quot;].Set(&quot;Invalid password&quot;);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Login;

// Was anything recorded?
Assert.True(Login.errorsByStage[&quot;server_auth&quot;].TestHasValue());

// Were there any invalid labels?
Assert.Equal(0, Login.errorsByStage.TestGetNumRecordedErrors(ErrorType.InvalidLabel));
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

login::errors_by_stage.get(&quot;server_auth&quot;).set(&quot;Invalid password&quot;);
<span class="boring">}
</span></code></pre></pre>
<p>There are test APIs available too:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;

use glean_metrics;

// Was anything recorded?
assert!(login::errors_by_stage.get(&quot;server_auth&quot;).test_get_value().is_sone());

// Were there any invalid labels?
assert_eq!(
  0,
  login::errors_by_stage.test_get_num_recorded_errors(
    ErrorType::InvalidLabel
  )
);
<span class="boring">}
</span></code></pre></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits-6" id="limits-6">Limits</a></h2>
<ul>
<li>
<p>Labels must conform to the <a href="reference/metrics/index.html#label-format">label formatting regular expression</a>.</p>
</li>
<li>
<p>Labels support lowercase alphanumeric characters; they additionally allow for dots (<code>.</code>), underscores (<code>_</code>) and/or hyphens (<code>-</code>).</p>
</li>
<li>
<p>Each label must have a maximum of 60 bytes, when encoded as UTF-8.</p>
</li>
<li>
<p>If the labels are specified in the <code>metrics.yaml</code>, using any label not listed in that file will be replaced with the special value <code>__other__</code>.</p>
</li>
<li>
<p>The number of labels specified in the <code>metrics.yaml</code> is limited to 100.</p>
</li>
<li>
<p>If the labels aren't specified in the <code>metrics.yaml</code>, only 16 different dynamic labels may be used, after which the special value <code>__other__</code> will be used.</p>
</li>
</ul>
<h2><a class="header" href="#examples-5" id="examples-5">Examples</a></h2>
<ul>
<li>What kind of errors occurred at each step in the login process?</li>
</ul>
<h2><a class="header" href="#recorded-errors-5" id="recorded-errors-5">Recorded Errors</a></h2>
<ul>
<li>
<p><code>invalid_label</code>: If the label contains invalid characters. Data is still recorded to the special label <code>__other__</code>.</p>
</li>
<li>
<p><code>invalid_label</code>: If the label exceeds the maximum number of allowed characters. Data is still recorded to the special label <code>__other__</code>.</p>
</li>
</ul>
<h2><a class="header" href="#reference-6" id="reference-6">Reference</a></h2>
<ul>
<li>Kotlin API docs: <a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-labeled-metric-type/index.html"><code>LabeledMetricType</code></a>, <a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-string-metric-type/index.html"><code>StringMetricType</code></a></li>
<li>Swift API docs: <a href="reference/metrics/../../../swift/Classes/LabeledMetricType.html"><code>LabeledMetricType</code></a>, <a href="reference/metrics/../../../swift/Classes/StringMetricType.html"><code>StringMetricType</code></a></li>
<li>Python API docs: <a href="reference/metrics/../../../python/glean/metrics/labeled.html"><code>LabeledMetricBase</code></a>, <a href="reference/metrics/../../../python/glean/metrics/string.html"><code>StringMetricType</code></a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/labeled_strings.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#string-list" id="string-list">String List</a></h1>
<p>Strings lists are used for recording a list of Unicode string values, such as the names of the enabled search engines.</p>
<hr />
<p><em>Note:</em> Be careful using arbitrary strings and make sure they can't accidentally contain identifying data (like directory paths or user input).</p>
<hr />
<h2><a class="header" href="#configuration-6" id="configuration-6">Configuration</a></h2>
<p>First you need to add an entry for the counter to the <code>metrics.yaml</code> file:</p>
<pre><code class="language-YAML">search:
  engines:
    type: string_list
    description: &gt;
      Records the name of the enabled search engines.
    lifetime: application
    ...
</code></pre>
<h2><a class="header" href="#api-7" id="api-7">API</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Search

// Add them one at a time
engines.forEach {
  Search.engines.add(it)
}

// Set them in one go
Search.engines.set(engines)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Search

// Was anything recorded?
assertTrue(Search.engines.testHasValue())
// Does it have the expected value?
// IMPORTANT: It may have been truncated -- see &quot;Limits&quot; below
assertEquals(listOf(&quot;Google&quot;, &quot;DuckDuckGo&quot;), Search.engines.testGetValue())
// Were any of the values too long, and thus an error was recorded?
assertEquals(1, Search.engines.testGetNumRecordedErrors(ErrorType.InvalidValue))
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">// Add them one at a time
for engine in engines {
    Search.engines.add(engine)
}

// Set them in one go
Search.engines.set(engines)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(Search.engines.testHasValue())
// Does it have the expected value?
// IMPORTANT: It may have been truncated -- see &quot;Limits&quot; below
XCTAssertEqual([&quot;Google&quot;, &quot;DuckDuckGo&quot;], try Search.engines.testGetValue())
// Were any of the values too long, and thus an error was recorded?
XCTAssertEqual(1, Search.engines.testGetNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics

metrics = load_metrics(&quot;metrics.yaml&quot;)

# Add them one at a time
for engine in engines:
    metrics.search.engines.add(engine)

# Set them in one go
metrics.search.engines.set(engines)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Python"># Was anything recorded?
assert metrics.search.engines.test_has_value()
# Does it have the expected value?
# IMPORTANT: It may have been truncated -- see &quot;Limits&quot; below
assert [&quot;Google&quot;, &quot;DuckDuckGo&quot;] == metrics.search.engines.test_get_value()
# Were any of the values too long, and thus an error was recorded?
assert 1 == metrics.search.engines.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Search;

// Set a string array into the metric.
Search.engines.Set(new string[] { &quot;Google&quot;, &quot;DuckDuckGo&quot; });
// Add another string into the metric.
Search.engines.Add(&quot;Baidu&quot;);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Search;

// Was anything recorded?
Assert.True(Search.engines.TestHasValue());
// Does the string list metric have the expected value?
// IMPORTANT: It may have been truncated -- see &quot;Limits&quot; below
var snapshot = Search.engines.TestGetValue();
Assert.Equal(3, Search.engines.Length);
Assert.Equal(&quot;Google&quot;, Search.engines[0]);
Assert.Equal(&quot;DuckDuckGo&quot;, Search.engines[1]);
Assert.Equal(&quot;Baidu&quot;, Search.engines[2]);
// Was the string truncated, and an error reported?
Assert.Equal(
    1,
    Search.engines.TestGetNumRecordedErrors(
        ErrorType.InvalidValue
    )
);
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean_metrics;

// Add them one at a time
engines.iter().for_each(|x|
  search::engines.add(x)
);

// Set them in one go
search::engines.set(engines)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Rust">use glean::ErrorType;
use glean_metrics;

// Was anything recorded?
assert!(search::engines.test_get_value(None).is_some());
// Does it have the expected value?
// IMPORTANT: It may have been truncated -- see &quot;Limits&quot; below
assert_eq!(
    vec![&quot;Google&quot;.to_string(), &quot;DuckDuckGo&quot;.to_string()], 
    search::engines.test_get_value(None)
);
// Were any of the values too long, and thus an error was recorded?
assert_eq!(
    0, 
    search::engines.test_get_num_recorded_errors(ErrorType::InvalidValue)
);
</code></pre>
</div>
<div data-lang="C++" class="tab">
<blockquote>
<p><strong>Note</strong>: C++ APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::search::engines.Add(&quot;wikipedia&quot;_ns);
mozilla::glean::search::engines.Add(&quot;duck duck go&quot;_ns);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Does it have the expected values?
nsTArray&lt;nsCString&gt; list = mozilla::glean::search::engines.TestGetValue();
ASSERT_TRUE(list.Contains(&quot;wikipedia&quot;_ns));
ASSERT_TRUE(list.Constains(&quot;duck duck go&quot;_ns));
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
<div data-lang="JS" class="tab">
<blockquote>
<p><strong>Note</strong>: JS APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-js">Glean.search.engines.add(&quot;wikipedia&quot;);
Glean.search.engines.add(&quot;duck duck go&quot;);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-js">const engines = Glean.search.engines.testGetValue();
Assert.ok(engines.includes(&quot;wikipedia&quot;));
Assert.ok(engines.includes(&quot;duck duck go&quot;));
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits-7" id="limits-7">Limits</a></h2>
<ul>
<li>
<p>Fixed maximum string length: 50. Longer strings are truncated. This is measured in the number of bytes when the string is encoded in UTF-8.</p>
</li>
<li>
<p>Fixed maximum list length: 20 items. Additional strings are dropped.</p>
</li>
</ul>
<h2><a class="header" href="#examples-6" id="examples-6">Examples</a></h2>
<ul>
<li>The names of the enabled search engines.</li>
</ul>
<h2><a class="header" href="#recorded-errors-6" id="recorded-errors-6">Recorded errors</a></h2>
<ul>
<li>
<p><code>invalid_overflow</code>: if the string is too long. (Prior to Glean 31.5.0, this recorded an <code>invalid_value</code>).</p>
</li>
<li>
<p><code>invalid_value</code>: if the list is too long</p>
</li>
</ul>
<h2><a class="header" href="#reference-7" id="reference-7">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-string-list-metric-type/index.html">Kotlin API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/string_list.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/struct.StringListMetric.html">Rust API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/string_list.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#timespan" id="timespan">Timespan</a></h1>
<p>Timespans are used to make a measurement of how much time is spent in a particular task.</p>
<p>To measure the distribution of multiple timespans, see <a href="reference/metrics/timing_distribution.html">Timing Distributions</a>. To record absolute times, see <a href="reference/metrics/datetime.html">Datetimes</a>.</p>
<p>It is not recommended to use timespans in multiple threads, since calling <code>start</code> or <code>stop</code> out of order will be recorded as an <code>invalid_state</code> error.</p>
<h2><a class="header" href="#configuration-7" id="configuration-7">Configuration</a></h2>
<p>Timespans have a required <code>time_unit</code> parameter to specify the smallest unit of resolution that the timespan will record. The allowed values for <code>time_unit</code> are:</p>
<ul>
<li><code>nanosecond</code></li>
<li><code>microsecond</code></li>
<li><code>millisecond</code></li>
<li><code>second</code></li>
<li><code>minute</code></li>
<li><code>hour</code></li>
<li><code>day</code></li>
</ul>
<p>Consider the resolution that is required by your metric, and use the largest possible value that will provide useful information so as to not leak too much fine-grained information from the client. It is important to note that the value sent in the ping is truncated down to the nearest unit. Therefore, a measurement of 500 nanoseconds will be truncated to 0 microseconds.</p>
<p>Say you're adding a new timespan for the time spent logging into the app. First you need to add an entry for the counter to the <code>metrics.yaml</code> file:</p>
<pre><code class="language-YAML">auth:
  login_time:
    type: timespan
    description: &gt;
      Measures the time spent logging in.
    time_unit: millisecond
    ...
</code></pre>
<h2><a class="header" href="#api-8" id="api-8">API</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Auth

fun onShowLogin() {
    Auth.loginTime.start()
    // ...
}

fun onLogin() {
    Auth.loginTime.stop()
    // ...
}

fun onLoginCancel() {
    Auth.loginTime.cancel()
    // ...
}
</code></pre>
<p>For convenience one can measure the time of a function or block of code:</p>
<pre><code class="language-Kotlin">Auth.loginTime.measure {
    // Process login flow
}
</code></pre>
<p>The time reported in the telemetry ping will be timespan recorded during the lifetime of the ping.</p>
<p>There are test APIs available too:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Auth

// Was anything recorded?
assertTrue(Auth.loginTime.testHasValue())
// Does the timer have the expected value
assertTrue(Auth.loginTime.testGetValue() &gt; 0)
// Was the timing recorded incorrectly?
assertEquals(1, Auth.loginTime.testGetNumRecordedErrors(ErrorType.InvalidValue))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Auth;

void onShowLogin() {
    Auth.INSTANCE.loginTime.start();
    // ...
}

void onLogin() {
    Auth.INSTANCE.loginTime.stop();
    // ...
}

void onLoginCancel() {
    Auth.INSTANCE.loginTime.cancel();
    // ...
}
</code></pre>
<p>The time reported in the telemetry ping will be timespan recorded during the lifetime of the ping.</p>
<p>There are test APIs available too:</p>
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Auth;

// Was anything recorded?
assertTrue(Auth.INSTANCE.loginTime.testHasValue());
// Does the timer have the expected value
assertTrue(Auth.INSTANCE.loginTime.testGetValue() &gt; 0);
// Was the timing recorded incorrectly?
assertEquals(
    1,
    Auth.INSTANCE.loginTime.testGetNumRecordedErrors(
        ErrorType.InvalidValue
    )
);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">func onShowLogin() {
    Auth.loginTime.start()
    // ...
}

func onLogin() {
    Auth.loginTime.stop()
    // ...
}

func onLoginCancel() {
    Auth.loginTime.cancel()
    // ...
}
</code></pre>
<p>For convenience one can measure the time of a function or block of code:</p>
<pre><code class="language-Kotlin">Auth.loginTime.measure {
    // Process login flow
}
</code></pre>
<p>The time reported in the telemetry ping will be timespan recorded during the lifetime of the ping.</p>
<p>There are test APIs available too:</p>
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(Auth.loginTime.testHasValue())
// Does the timer have the expected value
XCTAssert(try Auth.loginTime.testGetValue() &gt; 0)
// Was the timing recorded incorrectly?
XCTAssertEqual(1, Auth.loginTime.testGetNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

def on_show_login():
    metrics.auth.login_time.start()
    # ...

def on_login():
    metrics.auth.login_time.stop()
    # ...

def on_login_cancel():
    metrics.auth.login_time.cancel()
    # ...
</code></pre>
<p>The Python bindings also have a context manager for measuring time:</p>
<pre><code class="language-Python">with metrics.auth.login_time.measure():
    # ... Do the login ...
</code></pre>
<p>The time reported in the telemetry ping will be timespan recorded during the lifetime of the ping.</p>
<p>There are test APIs available too:</p>
<pre><code class="language-Python"># Was anything recorded?
assert metrics.auth.login_time.test_has_value()
# Does the timer have the expected value
assert metrics.auth.login_time.test_get_value() &gt; 0
# Was the timing recorded incorrectly?
assert 1 == metrics.auth.local_time.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<pre><code class="language-csharp">using static Mozilla.YourApplication.GleanMetrics.Auth;

void OnShowLogin()
{
    Auth.loginTime.Start();
    // ...
}

void OnLogin()
{
    Auth.loginTime.Stop();
    // ...
}

void OnLoginCancel()
{
    Auth.loginTime.Cancel();
    // ...
}
</code></pre>
<p>The time reported in the telemetry ping will be timespan recorded during the lifetime of the ping.</p>
<p>There are test APIs available too:</p>
<pre><code class="language-csharp">using static Mozilla.YourApplication.GleanMetrics.Auth;

// Was anything recorded?
Assert.True(Auth.loginTime.TestHasValue());
// Does the timer have the expected value
Assert.True(Auth.loginTime.TestGetValue() &gt; 0);
// Was the timing recorded incorrectly?
Assert.Equals(1, Auth.loginTime.TestGetNumRecordedErrors(ErrorType.InvalidValue));
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn show_login() {
    metrics::auth::login_time.start();
    // ...
}

fn login() {
    metrics::auth::login_time.stop();
    // ...
}

fn login_cancel() {
    metrics::auth::login_time.cancel();
    // ...
}
<span class="boring">}
</span></code></pre></pre>
<p>The time reported in the telemetry ping will be timespan recorded during the lifetime of the ping.</p>
<p>There are test APIs available too:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use metrics::auth::login_time;

// Was anything recorded?
assert!(login_time.test_get_value().is_some());
assert!(login_time.test_get_value().unwrap() &gt; 0);
// Was the timing recorded incorrectly?
assert_eq!(1, login_time.test_get_num_recorded_errors(ErrorType::InvalidValue));
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="C++" class="tab">
<blockquote>
<p><strong>Note</strong>: C++ APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::auth::login_time.Start();
PR_Sleep(PR_MillisecondsToInterval(10));
mozilla::glean::auth::login_time.Stop();
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Does it have an expected values?
ASSERT_TRUE(mozilla::glean::auth::login_time.TestGetValue().value() &gt; 0);
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
<div data-lang="JS" class="tab">
<blockquote>
<p><strong>Note</strong>: JS APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-js">Glean.auth.loginTime.start();
await sleep(10);
Glean.auth.loginTime.stop();
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-js">Assert.ok(Glean.auth.loginTime.testGetValue() &gt; 0);
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
</div>
</div>
<h2><a class="header" href="#raw-api" id="raw-api">Raw API</a></h2>
<blockquote>
<p><strong>Note</strong>: The raw API was designed to support a specific set of use-cases.
Please consider using the higher level APIs listed above.</p>
</blockquote>
<p>It's possible to explicitly set the timespan value, in nanoseconds.
This API should only be used if your library or application requires recording times in a way that can not make use of <code>start</code>/<code>stop</code>/<code>cancel</code>.</p>
<p>The raw API will not overwrite a running timer or existing timespan value.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.HistorySync

val duration = SyncResult.status.syncs.took.toLong()
HistorySync.setRawNanos(duration)
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">let duration = SyncResult.status.syncs.took.toLong()
HistorySync.setRawNanos(duration)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">import org.mozilla.yourApplication.GleanMetrics.HistorySync

val duration = SyncResult.status.syncs.took.toLong()
HistorySync.setRawNanos(duration)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<p>TODO. To be implemented in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1648442">bug 1648442</a>.</p>
</div>
<div data-lang="Rust" class="tab">
<p>The raw API is not supported in Rust. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1680225">bug 1680225</a>.</p>
</div>
</div>
</div>
<h2><a class="header" href="#limits-8" id="limits-8">Limits</a></h2>
<ul>
<li>
<p>Timings are recorded in nanoseconds.</p>
<ul>
<li>
<p>On Android, the <a href="https://developer.android.com/reference/android/os/SystemClock.html#elapsedRealtimeNanos()"><code>SystemClock.elapsedRealtimeNanos()</code></a> function is used, so it is limited by the accuracy and performance of that timer. The time measurement includes time spent in sleep.</p>
</li>
<li>
<p>On iOS, the <a href="https://developer.apple.com/library/archive/documentation/Darwin/Conceptual/KernelProgramming/services/services.html"><code>mach_absolute_time</code></a> function is used,
so it is limited by the accuracy and performance of that timer.
The time measurement does not include time spent in sleep.</p>
</li>
<li>
<p>On Python 3.7 and later, <a href="https://docs.python.org/3/library/time.html#time.monotonic_ns"><code>time.monotonic_ns()</code></a> is used.  On earlier versions of Python, <a href="https://docs.python.org/3/library/time.html#time.monotonic"><code>time.monotonics()</code></a> is used, which is not guaranteed to have nanosecond resolution.</p>
</li>
<li>
<p>On other platforms it uses <a href="https://docs.rs/time/0.1.40/time/fn.precise_time_ns.html"><code>time::precise_time_ns</code></a>, which uses a high-resolution performance counter in nanoseconds provided by the underlying platform.</p>
</li>
</ul>
</li>
</ul>
<h2><a class="header" href="#examples-7" id="examples-7">Examples</a></h2>
<ul>
<li>How much time is spent rendering the UI?</li>
</ul>
<h2><a class="header" href="#recorded-errors-7" id="recorded-errors-7">Recorded errors</a></h2>
<ul>
<li><code>invalid_value</code>
<ul>
<li>If recording a negative timespan.</li>
</ul>
</li>
<li><code>invalid_state</code>
<ul>
<li>If starting a timer while a previous timer is running.</li>
<li>If stopping a timer while it is not running.</li>
<li>If trying to set a raw timespan while a timer is running.</li>
<li>If trying to record a timespan again while a previous value is still stored.</li>
</ul>
</li>
</ul>
<h2><a class="header" href="#reference-8" id="reference-8">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-timespan-metric-type/index.html">Kotlin API docs</a></li>
<li><a href="reference/metrics/../../../swift/Classes/TimespanMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/timespan.html">Python API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/timespan.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#timing-distribution" id="timing-distribution">Timing Distribution</a></h1>
<p>Timing distributions are used to accumulate and store time measurement, for analyzing distributions of the timing data.</p>
<p>To measure the distribution of single timespans, see <a href="reference/metrics/timespan.html">Timespans</a>. To record absolute times, see <a href="reference/metrics/datetime.html">Datetimes</a>.</p>
<p>Timing distributions are recorded in a histogram where the buckets have an exponential distribution, specifically with 8 buckets for every power of 2.
That is, the function from a value \( x \) to a bucket index is:</p>
<p>\[ \lfloor 8 \log_2(x) \rfloor \]</p>
<p>This makes them suitable for measuring timings on a number of time scales without any configuration.</p>
<blockquote>
<p><strong>Note</strong> Check out how this bucketing algorithm would behave on the <a href="reference/metrics/timing_distribution.html#simulator">Simulator</a></p>
</blockquote>
<p>Timings always span the full length between <code>start</code> and <code>stopAndAccumulate</code>.
If the Glean upload is disabled when calling <code>start</code>, the timer is still started.
If the Glean upload is disabled at the time <code>stopAndAccumulate</code> is called, nothing is recorded.</p>
<p>Multiple concurrent timespans in different threads may be measured at the same time.</p>
<p>Timings are always stored and sent in the payload as nanoseconds. However, the <code>time_unit</code> parameter
controls the minimum and maximum values that will recorded:</p>
<ul>
<li><code>nanosecond</code>: 1ns &lt;= x &lt;= 10 minutes</li>
<li><code>microsecond</code>: 1μs &lt;= x &lt;= ~6.94 days</li>
<li><code>millisecond</code>: 1ms &lt;= x &lt;= ~19 years</li>
</ul>
<p>Overflowing this range is considered an error and is reported through the error reporting mechanism. Underflowing this range is not an error and the value is silently truncated to the minimum value.</p>
<p>Additionally, when a metric comes from GeckoView (the <code>geckoview_datapoint</code> parameter is present), the <code>time_unit</code> parameter specifies the unit that the samples are in when passed to Glean. Glean will convert all of the incoming samples to nanoseconds internally.</p>
<h2><a class="header" href="#configuration-8" id="configuration-8">Configuration</a></h2>
<p>If you wanted to create a timing distribution to measure page load times, first you need to add an entry for it to the <code>metrics.yaml</code> file:</p>
<pre><code class="language-YAML">pages:
  page_load:
    type: timing_distribution
    description: &gt;
      Counts how long each page takes to load
    ...
</code></pre>
<h2><a class="header" href="#api-9" id="api-9">API</a></h2>
<p>Now you can use the timing distribution from the application's code.
Starting a timer returns a timer ID that needs to be used to stop or cancel the timer at a later point.
Multiple intervals can be measured concurrently.
For example, to measure page load time on a number of tabs that are loading at the same time, each tab object needs to store the running timer ID.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import mozilla.components.service.glean.GleanTimerId
import org.mozilla.yourApplication.GleanMetrics.Pages

val timerId : GleanTimerId

fun onPageStart(e: Event) {
    timerId = Pages.pageLoad.start()
}

fun onPageLoaded(e: Event) {
    Pages.pageLoad.stopAndAccumulate(timerId)
}
</code></pre>
<p>For convenience one can measure the time of a function or block of code:</p>
<pre><code class="language-Kotlin">Pages.pageLoad.measure {
    // Load a page
}
</code></pre>
<p>There are test APIs available too.  For convenience, properties <code>sum</code> and <code>count</code> are exposed to facilitate validating that data was recorded correctly.</p>
<p>Continuing the <code>pageLoad</code> example above, at this point the metric should have a <code>sum == 11</code> and a <code>count == 2</code>:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Pages

// Was anything recorded?
assertTrue(Pages.pageLoad.testHasValue())

// Get snapshot.
val snapshot = Pages.pageLoad.testGetValue()

// Usually you don't know the exact timing values, but how many should have been recorded.
assertEquals(1L, snapshot.count)

// Assert that no errors were recorded.
assertEquals(0, Pages.pageLoad.testGetNumRecordedErrors(ErrorType.InvalidValue))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import mozilla.components.service.glean.GleanTimerId;
import org.mozilla.yourApplication.GleanMetrics.Pages;

GleanTimerId timerId;

void onPageStart(Event e) {
    timerId = Pages.INSTANCE.pageLoad.start();
}

void onPageLoaded(Event e) {
    Pages.INSTANCE.pageLoad.stopAndAccumulate(timerId);
}
</code></pre>
<p>There are test APIs available too.  For convenience, properties <code>sum</code> and <code>count</code> are exposed to facilitate validating that data was recorded correctly.</p>
<p>Continuing the <code>pageLoad</code> example above, at this point the metric should have a <code>sum == 11</code> and a <code>count == 2</code>:</p>
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Pages;

// Was anything recorded?
assertTrue(pages.INSTANCE.pageLoad.testHasValue());

// Get snapshot.
DistributionData snapshot = pages.INSTANCE.pageLoad.testGetValue();

// Usually you don't know the exact timing values, but how many should have been recorded.
assertEquals(1L, snapshot.getCount);

// Assert that no errors were recorded.
assertEquals(
    0,
    pages.INSTANCE.pageLoad.testGetNumRecordedErrors(
        ErrorType.InvalidValue
    )
);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">import Glean

var timerId : GleanTimerId

func onPageStart() {
    timerId = Pages.pageLoad.start()
}

func onPageLoaded() {
    Pages.pageLoad.stopAndAccumulate(timerId)
}
</code></pre>
<p>For convenience one can measure the time of a function or block of code:</p>
<pre><code class="language-Swift">Pages.pageLoad.measure {
    // Load a page
}
</code></pre>
<p>There are test APIs available too.  For convenience, properties <code>sum</code> and <code>count</code> are exposed to facilitate validating that data was recorded correctly.</p>
<p>Continuing the <code>pageLoad</code> example above, at this point the metric should have a <code>sum == 11</code> and a <code>count == 2</code>:</p>
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(pages.pageLoad.testHasValue())

// Get snapshot.
let snapshot = try! pages.pageLoad.testGetValue()

// Usually you don't know the exact timing values, but how many should have been recorded.
XCTAssertEqual(1, snapshot.count)

// Assert that no errors were recorded.
XCTAssertEqual(0, pages.pageLoad.testGetNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

class PageHandler:
    def __init__(self):
        self.timer_id = None

    def on_page_start(self, event):
        # ...
        self.timer_id = metrics.pages.page_load.start()

    def on_page_loaded(self, event):
        # ...
        metrics.pages.page_load.stop_and_accumulate(self.timer_id)
</code></pre>
<p>The Python bindings also have a context manager for measuring time:</p>
<pre><code class="language-Python">with metrics.pages.page_load.measure():
    # Load a page ...
</code></pre>
<p>There are test APIs available too.  For convenience, properties <code>sum</code> and <code>count</code> are exposed to facilitate validating that data was recorded correctly.</p>
<p>Continuing the <code>page_load</code> example above, at this point the metric should have a <code>sum == 11</code> and a <code>count == 2</code>:</p>
<pre><code class="language-Python"># Was anything recorded?
assert metrics.pages.page_load.test_has_value()

# Get snapshot.
snapshot = metrics.pages.page_load.test_get_value()

# Usually you don't know the exact timing values, but how many should have been recorded.
assert 1 == snapshot.count

# Assert that no errors were recorded.
assert 0 == metrics.pages.page_load.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Pages;

var timerId;

void onPageStart(Event e) {
    timerId = Pages.pageLoad.Start();
}

void onPageLoaded(Event e) {
    Pages.pageLoad.StopAndAccumulate(timerId);
}
</code></pre>
<p>There are test APIs available too.  For convenience, properties <code>sum</code> and <code>count</code> are exposed to facilitate validating that data was recorded correctly.</p>
<p>Continuing the <code>pageLoad</code> example above, at this point the metric should have a <code>sum == 11</code> and a <code>count == 2</code>:</p>
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Pages;

// Was anything recorded?
Assert.True(Pages.pageLoad.TestHasValue());

// Get snapshot.
var snapshot = Pages.pageLoad.TestGetValue();

// Usually you don't know the exact timing values, but how many should have been recorded.
Assert.Equal(1, snapshot.Values.Count);

// Assert that no errors were recorded.
Assert.Equal(0, Pages.pageLoad.TestGetNumRecordedErrors(ErrorType.InvalidValue));
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

fn on_page_start() {
    self.timer_id = pages::page_load.start();
}

fn on_page_loaded() {
    pages::page_load.stop_and_accumulate(self.timer_id);
}
<span class="boring">}
</span></code></pre></pre>
<p>There are test APIs available too.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;
use glean_metrics;

// Was anything recorded?
assert!(pages::page_load.test_get_value(None).is_some());

// Assert no errors were recorded.
let errors = [
    ErrorType::InvalidValue,
    ErrorType::InvalidState,
    ErrorType::InvalidOverflow
];
for error in errors {
    assert_eq!(0, pages::page_load.test_get_num_recorded_errors(error));
}
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="C++" class="tab">
<blockquote>
<p><strong>Note</strong>: C++ APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

auto timerId = mozilla::glean::pages::page_load.Start();
PR_Sleep(PR_MillisecondsToInterval(10));
mozilla::glean::pages::page_load.StopAndAccumulate(timerId);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Does it have an expected values?
const data = mozilla::glean::pages::page_load.TestGetValue().value();
ASSERT_TRUE(data.sum &gt; 0);
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
<div data-lang="JS" class="tab">
<blockquote>
<p><strong>Note</strong>: JS APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-js">const timerId = Glean.pages.pageLoad.start();
await sleep(10);
Glean.pages.pageLoad.stopAndAccumulate(timerId);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-js">Assert.ok(Glean.pages.pageLoad.testGetValue().sum &gt; 0);
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits-9" id="limits-9">Limits</a></h2>
<ul>
<li>
<p>Timings are recorded in nanoseconds.</p>
<ul>
<li>
<p>On Android, the <a href="https://developer.android.com/reference/android/os/SystemClock.html#elapsedRealtimeNanos()"><code>SystemClock.elapsedRealtimeNanos()</code></a> function is used, so it is limited by the accuracy and performance of that timer. The time measurement includes time spent in sleep.</p>
</li>
<li>
<p>On iOS, the <a href="https://developer.apple.com/library/archive/documentation/Darwin/Conceptual/KernelProgramming/services/services.html"><code>mach_absolute_time</code></a> function is used,
so it is limited by the accuracy and performance of that timer.
The time measurement does not include time spent in sleep.</p>
</li>
<li>
<p>On Python 3.7 and later, <a href="https://docs.python.org/3/library/time.html#time.monotonic_ns"><code>time.monotonic_ns()</code></a> is used.  On earlier versions of Python, <a href="https://docs.python.org/3/library/time.html#time.monotonic"><code>time.monotonics()</code></a> is used, which is not guaranteed to have nanosecond resolution.</p>
</li>
<li>
<p>In Rust,
<a href="https://docs.rs/time/0.1.42/time/fn.precise_time_ns.html"><code>time::precise_time_ns()</code></a>
is used.</p>
</li>
</ul>
</li>
<li>
<p>The maximum timing value that will be recorded depends on the <code>time_unit</code> parameter:</p>
<ul>
<li><code>nanosecond</code>: 1ns &lt;= x &lt;= 10 minutes</li>
<li><code>microsecond</code>: 1μs &lt;= x &lt;= ~6.94 days</li>
<li><code>millisecond</code>: 1ms &lt;= x &lt;= ~19 years
Longer times will be truncated to the maximum value and an error will be recorded.</li>
</ul>
</li>
</ul>
<h2><a class="header" href="#examples-8" id="examples-8">Examples</a></h2>
<ul>
<li>How long does it take a page to load?</li>
</ul>
<h2><a class="header" href="#recorded-errors-8" id="recorded-errors-8">Recorded errors</a></h2>
<ul>
<li><code>invalid_value</code>: If recording a negative timespan.</li>
<li><code>invalid_state</code>: If a non-existing/stopped timer is stopped again.</li>
<li><code>invalid_overflow</code>: If recording a time longer than the maximum for the given unit.</li>
</ul>
<h2><a class="header" href="#reference-9" id="reference-9">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-timing-distribution-metric-type/index.html">Kotlin API docs</a></li>
<li><a href="reference/metrics/../../../swift/Classes/TimingDistributionMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/timing_distribution.html">Python API docs</a></li>
</ul>
<h2><a class="header" href="#simulator" id="simulator">Simulator</a></h2>
<div id="custom-data-modal-overlay">
    <div id="custom-data-modal">
        <p>Please, insert your custom data below as a JSON array.</p>
        <textarea rows="30"></textarea>
    </div>
</div>
<div id="simulator-container">
    <div id="histogram-chart-container">
        <div id="histogram-chart"></div>
        <p id="histogram-chart-legend"><p>
    </div>
    <div id="data-options">
        <h3><a class="header" href="#data-options" id="data-options">Data options</a></h3>
        <div class="input-group">
            <label for="normally-distributed">Generate normally distributed data</label>
            <input name="data-options" value="normally-distributed" id="normally-distributed" type="radio" />
        </div>
        <div class="input-group">
            <label for="log-normally-distributed">Generate log-normally distributed data</label>
            <input name="data-options" value="log-normally-distributed" id="log-normally-distributed" type="radio" checked />
        </div>
        <div class="input-group">
            <label for="uniformly-distributed">Generate uniformly distributed data</label>
            <input name="data-options" value="uniformly-distributed" id="uniformly-distributed" type="radio" />
        </div>
        <div class="input-group" id="custom-data-input-group">
            <label for="custom">Use custom data</label>
            <input name="data-options" value="custom" id="custom" type="radio" />
        </div>
    </div>
    <div id="histogram-props">
        <h3><a class="header" href="#properties" id="properties">Properties</a></h3>
        <div class="input-group hide">
            <label for="kind">Histogram type</label>
            <select id="kind" name="kind" disabled>
                <option value="functional" selected>Functional</option>
            </select>
        </div>
        <div class="input-group hide">
            <label for="log-base">Log base</label>
            <input id="log-base" name="log-base" type="number" value="2" disabled />
        </div>
        <div class="input-group hide">
            <label for="buckets-per-magnitude">Buckets per magnitude</label>
            <input id="buckets-per-magnitude" name="buckets-per-magnitude" type="number" value="8" disabled />
        </div>
        <div class="input-group hide">
            <label for="maximum-value">Maximum value</label>
            <input id="maximum-value" name="maximum-value" type="number" value="600000000000" disabled />
        </div>
        <div class="input-group">
            <label for="time-unit">Time unit (<code>time_unit</code>)</label>
            <select id="time-unit" name="time-unit">
                <option value="nanoseconds" selected>Nanoseconds</option>
                <option value="microseconds">Microseconds</option>
                <option value="milliseconds">Milliseconds</option>
            </select>
        </div>
    </div>
</div>
<blockquote>
<p><strong>Note</strong> The data <em>provided</em>, is assumed to be in the configured time unit. The data <em>recorded</em>, on the other hand, is always in <strong>nanoseconds</strong>.
This means that, if the configured time unit is not <code>nanoseconds</code>, the data will be transformed before being recorded. Notice this, by using the select field above to change the time unit and see the mean of the data recorded changing.</p>
</blockquote>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/timing_distribution.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#memory-distribution" id="memory-distribution">Memory Distribution</a></h1>
<p>Memory distributions are used to accumulate and store memory sizes.</p>
<p>Memory distributions are recorded in a histogram where the buckets have an exponential distribution, specifically with 16 buckets for every power of 2.
That is, the function from a value \( x \) to a bucket index is:</p>
<p>\[ \lfloor 16 \log_2(x) \rfloor \]</p>
<p>This makes them suitable for measuring memory sizes on a number of different scales without any configuration.</p>
<blockquote>
<p><strong>Note</strong> Check out how this bucketing algorithm would behave on the <a href="reference/metrics/memory_distribution.html#simulator">Simulator</a></p>
</blockquote>
<h2><a class="header" href="#configuration-9" id="configuration-9">Configuration</a></h2>
<p>Memory distributions have a required <code>memory_unit</code> parameter, which specifies
the unit the incoming memory size values are recorded in. The units are the
power-of-2 units, so &quot;kilobyte&quot; is more correctly a &quot;kibibyte&quot;.</p>
<pre><code>- kilobyte == 2^10 ==         1,024 bytes
- megabyte == 2^20 ==     1,048,576 bytes
- gigabyte == 2^30 == 1,073,741,824 bytes
</code></pre>
<p>If you wanted to create a memory distribution to measure the amount of heap memory allocated, first you need to add an entry for it to the <code>metrics.yaml</code> file:</p>
<pre><code class="language-YAML">memory:
  heap_allocated:
    type: memory_distribution
    description: &gt;
      The heap memory allocated
    memory_unit: kilobyte
    ...
</code></pre>
<h2><a class="header" href="#api-10" id="api-10">API</a></h2>
<p>Now you can use the memory distribution from the application's code.</p>
<blockquote>
<p><strong>Note</strong> The data <em>provided</em> to the <code>accumulate</code> method is in the configured memory unit specified in the <code>metrics.yaml</code> file. The data <em>recorded</em>, on the other hand, is always in <strong>bytes</strong>.</p>
</blockquote>
<p>For example, to measure the distribution of heap allocations:</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Memory

fun allocateMemory(nbytes: Int) {
    // ...
    Memory.heapAllocated.accumulate(nbytes / 1024)
}
</code></pre>
<p>There are test APIs available too.  For convenience, properties <code>sum</code> and <code>count</code> are exposed to facilitate validating that data was recorded correctly.</p>
<p>Continuing the <code>heapAllocated</code> example above, at this point the metric should have a <code>sum == 11</code> and a <code>count == 2</code>:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Memory

// Was anything recorded?
assertTrue(Memory.heapAllocated.testHasValue())

// Get snapshot
val snapshot = Memory.heapAllocated.testGetValue()

// Does the sum have the expected value?
assertEquals(11, snapshot.sum)

// Usually you don't know the exact memory values, but how many should have been recorded.
assertEquals(2L, snapshot.count)

// Did this record a negative value?
assertEquals(1, Memory.heapAllocated.testGetNumRecordedErrors(ErrorType.InvalidValue))
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">func allocateMemory(nbytes: UInt64) {
    // ...
    Memory.heapAllocated.accumulate(nbytes / 1024)
}
</code></pre>
<p>There are test APIs available too.  For convenience, properties <code>sum</code> and <code>count</code> are exposed to facilitate validating that data was recorded correctly.</p>
<p>Continuing the <code>heapAllocated</code> example above, at this point the metric should have a <code>sum == 11</code> and a <code>count == 2</code>:</p>
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(Memory.heapAllocated.testHasValue())

// Get snapshot
let snapshot = try! Memory.heapAllocated.testGetValue()

// Does the sum have the expected value?
XCTAssertEqual(11, snapshot.sum)

// Usually you don't know the exact memory values, but how many should have been recorded.
XCTAssertEqual(2, snapshot.count)

// Did this record a negative value?
XCTAssertEqual(1, Memory.heapAllocated.testGetNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

def allocate_memory(nbytes):
    # ...
    metrics.memory.heap_allocated.accumulate(nbytes / 1024)
</code></pre>
<p>There are test APIs available too.  For convenience, properties <code>sum</code> and <code>count</code> are exposed to facilitate validating that data was recorded correctly.</p>
<p>Continuing the <code>heapAllocated</code> example above, at this point the metric should have a <code>sum == 11</code> and a <code>count == 2</code>:</p>
<pre><code class="language-Python"># Was anything recorded?
assert metrics.memory.head_allocated.test_has_value()

# Get snapshot
snapshot = metrics.memory.heap_allocated.test_get_value()

# Does the sum have the expected value?
assert 11 == snapshot.sum

# Usually you don't know the exact memory values, but how many should have been recorded.
assert 2 == snapshot.count

# Did this record a negative value?
assert 1 == metrics.memory.heap_allocated.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Memory;

fun allocateMemory(ulong nbytes) {
    // ...
    Memory.heapAllocated.Accumulate(nbytes / 1024);
}
</code></pre>
<p>There are test APIs available too.  For convenience, properties <code>Sum</code> and <code>Count</code> are exposed to facilitate validating that data was recorded correctly.</p>
<p>Continuing the <code>heapAllocated</code> example above, at this point the metric should have a <code>Sum == 11</code> and a <code>Count == 2</code>:</p>
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Memory;

// Was anything recorded?
Assert.True(Memory.heapAllocated.TestHasValue());

// Get snapshot
var snapshot = Memory.heapAllocated.TestGetValue();

// Does the sum have the expected value?
Assert.Equal(11, snapshot.Sum);

// Usually you don't know the exact memory values, but how many should have been recorded.
Assert.Equal(2L, snapshot.Count);

// Did this record a negative value?
Assert.Equal(1, Memory.heapAllocated.TestGetNumRecordedErrors(ErrorType.InvalidValue));
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

fn allocate_memory(bytes: u64) {
    memory::heap_allocated.accumulate(bytes / 1024);
}
<span class="boring">}
</span></code></pre></pre>
<p>There are test APIs available too:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::{DistributionData, ErrorType};
use glean_metrics;

// Was anything recorded?
assert!(memory::heap_allocated.test_get_value(None).is_some());

// Is the sum as expected?
let data = memory::heap_allocated.test_get_value(None).unwrap();
assert_eq!(11, data.sum)
// The actual buckets and counts live in `data.values`.

// Were there any errors?
assert_eq!(1, memory::heap_allocated.test_get_num_recorded_errors(InvalidValue));

<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="C++" class="tab">
<blockquote>
<p><strong>Note</strong>: C++ APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::memory::heap_allocated.Accumulate(bytes / 1024);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Does it have the expected value?
ASSERT_EQ(11 * 1024, mozilla::glean::memory::heap_allocated.TestGetValue().value().sum);
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
<div data-lang="JS" class="tab">
<blockquote>
<p><strong>Note</strong>: JS APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-js">Glean.memory.heapAllocated.accumulate(bytes / 1024);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-js">const data = Glean.memory.heapAllocated.testGetValue();
Assert.equal(11 * 1024, data.sum);
// Does it have the right number of samples?
Assert.equal(1, Object.entries(data.values).reduce(([bucket, count], sum) =&gt; count + sum, 0));
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits-10" id="limits-10">Limits</a></h2>
<ul>
<li>The maximum memory size that can be recorded is 1 Terabyte (2<sup>40</sup> bytes). Larger sizes will be truncated to 1 Terabyte.</li>
</ul>
<h2><a class="header" href="#examples-9" id="examples-9">Examples</a></h2>
<ul>
<li>What is the distribution of the size of heap allocations?</li>
</ul>
<h2><a class="header" href="#recorded-errors-9" id="recorded-errors-9">Recorded errors</a></h2>
<ul>
<li><code>invalid_value</code>: If recording a negative memory size.</li>
<li><code>invalid_value</code>: If recording a size larger than 1TB.</li>
</ul>
<h2><a class="header" href="#reference-10" id="reference-10">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-memory-distribution-metric-type/index.html">Kotlin API docs</a></li>
<li><a href="reference/metrics/../../../swift/Classes/MemoryDistributionMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/timing_distribution.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/struct.MemoryDistributionMetric.html">Rust API docs</a></li>
</ul>
<h2><a class="header" href="#simulator-1" id="simulator-1">Simulator</a></h2>
<div id="custom-data-modal-overlay">
    <div id="custom-data-modal">
        <p>Please, insert your custom data below as a JSON array.</p>
        <textarea rows="30"></textarea>
    </div>
</div>
<div id="simulator-container">
    <div id="histogram-chart-container">
        <div id="histogram-chart"></div>
        <p id="histogram-chart-legend"><p>
    </div>
    <div id="data-options">
        <h3><a class="header" href="#data-options-1" id="data-options-1">Data options</a></h3>
        <div class="input-group">
            <label for="normally-distributed">Generate normally distributed data</label>
            <input name="data-options" value="normally-distributed" id="normally-distributed" type="radio" />
        </div>
        <div class="input-group">
            <label for="log-normally-distributed">Generate log-normally distributed data</label>
            <input name="data-options" value="log-normally-distributed" id="log-normally-distributed" type="radio" checked />
        </div>
        <div class="input-group">
            <label for="uniformly-distributed">Generate uniformly distributed data</label>
            <input name="data-options" value="uniformly-distributed" id="uniformly-distributed" type="radio" />
        </div>
        <div class="input-group" id="custom-data-input-group">
            <label for="custom">Use custom data</label>
            <input name="data-options" value="custom" id="custom" type="radio" />
        </div>
    </div>
    <div id="histogram-props">
        <h3><a class="header" href="#properties-1" id="properties-1">Properties</a></h3>
        <div class="input-group hide">
            <label for="kind">Histogram type</label>
            <select id="kind" name="kind" disabled>
                <option value="functional" selected>Functional</option>
            </select>
        </div>
        <div class="input-group hide">
            <label for="log-base">Log base</label>
            <input id="log-base" name="log-base" type="number" value="2" disabled />
        </div>
        <div class="input-group hide">
            <label for="buckets-per-magnitude">Buckets per magnitude</label>
            <input id="buckets-per-magnitude" name="buckets-per-magnitude" type="number" value="16" disabled />
        </div>
        <div class="input-group hide">
            <label for="maximum-value">Maximum value</label>
            <input id="maximum-value" name="maximum-value" type="number" value="1099511627776" disabled />
        </div>
        <div class="input-group">
            <label for="memory-unit">Memory unit (<code>memory_unit</code>)</label>
            <select id="memory-unit" name="memory-unit">
                <option value="byte" selected>Byte</option>
                <option value="kilobyte">Kilobyte</option>
                <option value="megabyte">Megabyte</option>
                <option value="gigabyte">Gigabyte</option>
            </select>
        </div>
    </div>
</div>
<blockquote>
<p><strong>Note</strong> The data <em>provided</em>, is assumed to be in the configured memory unit. The data <em>recorded</em>, on the other hand, is always in <strong>bytes</strong>.
This means that, if the configured memory unit is not <code>byte</code>, the data will be transformed before being recorded. Notice this, by using the select field above to change the memory unit and see the mean of the data recorded changing.</p>
</blockquote>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/memory_distribution.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#uuid" id="uuid">UUID</a></h1>
<p>UUIDs are used to record values that uniquely identify some entity, such as a client id.</p>
<h2><a class="header" href="#configuration-10" id="configuration-10">Configuration</a></h2>
<p>You first need to add an entry for it to the <code>metrics.yaml</code> file:</p>
<pre><code class="language-YAML">user:
  client_id:
    type: uuid
    description: &gt;
      A unique identifier for the client's profile
    lifetime: user
    ...
</code></pre>
<h2><a class="header" href="#api-11" id="api-11">API</a></h2>
<p>Now that the UUID is defined in <code>metrics.yaml</code>, you can use the metric to record values in the application's code.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.User

User.clientId.generateAndSet() // Generate a new UUID and record it
User.clientId.set(UUID.randomUUID())  // Set a UUID explicitly
</code></pre>
<p>There are test APIs available too.</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.User

// Was anything recorded?
assertTrue(User.clientId.testHasValue())
// Was it the expected value?
assertEquals(uuid, User.clientId.testGetValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.User;

User.INSTANCE.clientId.generateAndSet(); // Generate a new UUID and record it
User.INSTANCE.clientId.set(UUID.randomUUID());  // Set a UUID explicitly
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.User;

// Was anything recorded?
assertTrue(User.INSTANCE.clientId.testHasValue());
// Was it the expected value?
assertEquals(uuid, User.INSTANCE.clientId.testGetValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">User.clientId.generateAndSet() // Generate a new UUID and record it
User.clientId.set(UUID())  // Set a UUID explicitly
</code></pre>
<p>There are test APIs available too.</p>
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(User.clientId.testHasValue())
// Was it the expected value?
XCTAssertEqual(uuid, try User.clientId.testGetValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">import uuid

from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Generate a new UUID and record it
metrics.user.client_id.generate_and_set()
# Set a UUID explicitly
metrics.user.client_id.set(uuid.uuid4())
</code></pre>
<p>There are test APIs available too.</p>
<pre><code class="language-Python"># Was anything recorded?
assert metrics.user.client_id.test_has_value()
# Was it the expected value?
assert uuid == metrics.user.client_id.test_get_value()
</code></pre>
</div>
<div data-lang="C#" class="tab">
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.User;

User.clientId.GenerateAndSet(); // Generate a new UUID and record it
User.clientId.Set(System.Guid.NewGuid()); // Set a UUID explicitly
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.User;

// Was anything recorded?
Assert.True(User.clientId.TestHasValue());
// Was it the expected value?
Assert.Equal(uuid, User.clientId.TestGetValue());
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;
use uuid::Uuid;

user::client_id.generate_and_set(); // Generate a new UUID and record it
user::client_id.set(Uuid::new_v4()); // Set a UUID explicitly
<span class="boring">}
</span></code></pre></pre>
<p>There are test APIs available too:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

let u = Uuid::new_v4();
user::client_id.set(u);
// Was anything recorded?
assert!(user::client_id.test_get_value(None).is_some());
// Does it have the expected value?
assert_eq!(u, user::client_id.test_get_value(None).unwrap());
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="C++" class="tab">
<blockquote>
<p><strong>Note</strong>: C++ APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Generate a new UUID and record it.
mozilla::glean::user::client_id.GenerateAndSet();
// Set a specific value.
nsCString kUuid(&quot;decafdec-afde-cafd-ecaf-decafdecafde&quot;);
mozilla::glean::user::client_id.Set(kUuid);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Does it have an expected values?
ASSERT_STREQ(kUuid.get(), mozilla::glean::user::client_id.TestGetValue().value().get());
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
<div data-lang="JS" class="tab">
<blockquote>
<p><strong>Note</strong>: JS APIs are currently only available in Firefox Desktop.
General JavaScript support is coming soon via <a href="https://github.com/mozilla/glean.js/">the Glean.js project</a>.</p>
</blockquote>
<pre><code class="language-js">// Generate a new UUID and record it.
Glean.user.clientId.generateAndSet();
// Set a specific value.
const uuid = &quot;decafdec-afde-cafd-ecaf-decafdecafde&quot;;
Glean.user.clientId.set(uuid);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-js">Assert.equal(Glean.user.clientId.testGetValue(), uuid);
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits-11" id="limits-11">Limits</a></h2>
<ul>
<li>None.</li>
</ul>
<h2><a class="header" href="#examples-10" id="examples-10">Examples</a></h2>
<ul>
<li>A unique identifier for the client.</li>
</ul>
<h2><a class="header" href="#recorded-errors-10" id="recorded-errors-10">Recorded errors</a></h2>
<ul>
<li><code>invalid_value</code>: if the value is set to a string that is not a UUID (only applies for dynamically-typed languages, such as Python).</li>
</ul>
<h2><a class="header" href="#reference-11" id="reference-11">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-uuid-metric-type/index.html">Kotlin API docs</a>.</li>
<li><a href="reference/metrics/../../../swift/Classes/UuidMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/uuid.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/uuid/struct.UuidMetric.html">Rust API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/uuid.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#datetime" id="datetime">Datetime</a></h1>
<p>Datetimes are used to record an absolute date and time, for example the date and time that the application was first run.</p>
<p>The device's offset from UTC is recorded and sent with the Datetime value in the ping.</p>
<p>To record a single elapsed time, see <a href="reference/metrics/timespan.html">Timespan</a>. To measure the distribution of multiple timespans, see <a href="reference/metrics/timing_distribution.html">Timing Distributions</a>.</p>
<h2><a class="header" href="#configuration-11" id="configuration-11">Configuration</a></h2>
<p>Datetimes have a required <code>time_unit</code> parameter to specify the smallest unit of resolution that the metric will record. The allowed values for <code>time_unit</code> are:</p>
<ul>
<li><code>nanosecond</code></li>
<li><code>microsecond</code></li>
<li><code>millisecond</code></li>
<li><code>second</code></li>
<li><code>minute</code></li>
<li><code>hour</code></li>
<li><code>day</code></li>
</ul>
<p>Carefully consider the required resolution for recording your metric, and choose the coarsest resolution possible.</p>
<p>You first need to add an entry for it to the <code>metrics.yaml</code> file:</p>
<pre><code class="language-YAML">install:
  first_run:
    type: datetime
    time_unit: day
    description: &gt;
      Records the date when the application was first run
    lifetime: user
    ...
</code></pre>
<h2><a class="header" href="#api-12" id="api-12">API</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Install

Install.firstRun.set() // Records &quot;now&quot;
Install.firstRun.set(Calendar(2019, 3, 25)) // Records a custom datetime
</code></pre>
<p>There are test APIs available too.</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Install

// Was anything recorded?
assertTrue(Install.firstRun.testHasValue())
// Was it the expected value?
// NOTE: Datetimes always include a timezone offset from UTC, hence the
// &quot;-05:00&quot; suffix.
assertEquals(&quot;2019-03-25-05:00&quot;, Install.firstRun.testGetValueAsString())
// Was the value invalid?
assertEquals(0, Install.firstRun.testGetNumRecordedErrors(ErrorType.InvalidValue))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Install;

Install.INSTANCE.firstRun.set(); // Records &quot;now&quot;
Install.INSTANCE.firstRun.set(Calendar(2019, 3, 25)); // Records a custom datetime
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Install;

// Was anything recorded?
assertTrue(Install.INSTANCE.firstRun.testHasValue());
// Was it the expected value?
// NOTE: Datetimes always include a timezone offset from UTC, hence the
// &quot;-05:00&quot; suffix.
assertEquals(&quot;2019-03-25-05:00&quot;, Install.INSTANCE.firstRun.testGetValueAsString());
// Was the value invalid?
assertEquals(0, Install.INSTANCE.firstRun.testGetNumRecordedErrors(ErrorType.InvalidValue));
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Install.firstRun.set() // Records &quot;now&quot;

let dateComponents = DateComponents(
                        calendar: Calendar.current,
                        year: 2004, month: 12, day: 9, hour: 8, minute: 3, second: 29
                     )
Install.firstRun.set(dateComponents.date!) // Records a custom datetime
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(Install.firstRun.testHasValue())
// Does the datetime have the expected value?
XCTAssertEqual(6, try Install.firstRun.testGetValue())
// Was the value invalid?
XCTAssertEqual(0, Install.firstRun.getNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">import datetime

from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Records &quot;now&quot;
metrics.install.first_run.set()
# Records a custom datetime
metrics.install.first_run.set(datetime.datetime(2019, 3, 25))
</code></pre>
<p>There are test APIs available too.</p>
<pre><code class="language-Python"># Was anything recorded?
assert metrics.install.first_run.test_has_value()

# Was it the expected value?
# NOTE: Datetimes always include a timezone offset from UTC, hence the
# &quot;-05:00&quot; suffix.
assert &quot;2019-03-25-05:00&quot; == metrics.install.first_run.test_get_value_as_str()
# Was the value invalid?
assert 0 == metrics.install.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Install;

// Records &quot;now&quot;
Install.firstRun.Set();
// Records a custom datetime
Install.firstRun.Set(new DateTimeOffset(2018, 2, 25, 11, 10, 0, TimeZone.CurrentTimeZone.BaseUtcOffset));
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Install;

// Was anything recorded?
Assert.True(Install.firstRun.TestHasValue());
// Was it the expected value?
// NOTE: Datetimes always include a timezone offset from UTC, hence the
// &quot;-05:00&quot; suffix.
Assert.Equal(&quot;2019-03-25-05:00&quot;, Install.firstRun.TestGetValueAsString());
// Was the value invalid?
Assert.Equal(0, Install.firstRun.TestGetNumRecordedErrors(ErrorType.InvalidValue));
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean::ErrorType;
use glean_metrics;

use chrono::{FixedOffset, TimeZone};

// Records &quot;now&quot;
install::first_run.set(None);
// Records a custom datetime
let custom_date = FixedOffset::east(0).ymd(2019, 3, 25).and_hms(0, 0, 0);
install::first_run.set(Some(custom_date));
</code></pre>
<p>There are test APIs available too.</p>
<pre><code class="language-Rust">// Was anything recorded?
assert!(metrics.install.first_run.test_get_value(None).is_some());

// Was it the expected value?
let expected_date = FixedOffset::east(0).ymd(2019, 3, 25).and_hms(0, 0, 0);
assert_eq!(expected_date, metrics.install.first_run.test_get_value(None));
// Was the value invalid?
assert_eq!(0, install::first_run.test_get_num_recorded_errors(
    ErrorType::InvalidValue
));
</code></pre>
</div>
<div data-lang="C++" class="tab">
<blockquote>
<p><strong>Note</strong>: C++ APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

PRExplodedTime date = {0, 35, 10, 12, 6, 10, 2020, 0, 0, {5 * 60 * 60, 0}};
mozilla::glean::install::first_run.Set(&amp;date);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Does it have the expected value?
ASSERT_STREQ(
  mozilla::glean::install::first_run.TestGetValue().value(),
  &quot;2020-11-06T12:10:35+05:00&quot;_ns
);
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
<div data-lang="JS" class="tab">
<blockquote>
<p><strong>Note</strong>: JS APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-js">const value = new Date(&quot;2020-06-11T12:00:00&quot;);
Glean.install.firstRun.set(value.getTime() * 1000);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-js">Assert.ok(Glean.install.firstRun.testGetValue().startsWith(&quot;2020-06-11T12:00:00&quot;));
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits-12" id="limits-12">Limits</a></h2>
<ul>
<li>None.</li>
</ul>
<h2><a class="header" href="#examples-11" id="examples-11">Examples</a></h2>
<ul>
<li>When did the user first run the application?</li>
</ul>
<h2><a class="header" href="#recorded-errors-11" id="recorded-errors-11">Recorded errors</a></h2>
<ul>
<li><code>invalid_value</code>: Setting the date time to an invalid value.</li>
</ul>
<h2><a class="header" href="#reference-12" id="reference-12">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-datetime-metric-type/index.html">Kotlin API docs</a></li>
<li><a href="reference/metrics/../../../swift/Classes/DatetimeMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/datetime.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/struct.DatetimeMetric.html">Rust API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/datetime.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#events" id="events">Events</a></h1>
<p>Events allow recording of e.g. individual occurrences of user actions, say every time a view was open and from where.</p>
<p>Each event contains the following data:</p>
<ul>
<li>A timestamp, in milliseconds. The first event in any ping always has a value of <code>0</code>, and subsequent event timestamps are relative to it.</li>
<li>The name of the event.</li>
<li>A set of key-value pairs, where the keys are predefined in the <code>extra_keys</code> metric parameter, and the values are strings.</li>
</ul>
<blockquote>
<p><strong>Important:</strong> events are the most expensive metric type to record, transmit, store and analyze, so they should be used sparingly, and only when none of the other metric types are sufficient for answering your question.</p>
</blockquote>
<h2><a class="header" href="#configuration-12" id="configuration-12">Configuration</a></h2>
<p>Say you're adding a new event for when a view is shown. First you need to add an entry for the event to the <code>metrics.yaml</code> file:</p>
<pre><code class="language-YAML">views:
  login_opened:
    type: event
    description: &gt;
      Recorded when the login view is opened.
    ...
    extra_keys:
      source_of_login:
        description: The source from which the login view was opened, e.g. &quot;toolbar&quot;.
</code></pre>
<p>The <code>extra_keys</code> parameter enumerates the acceptable keys on the event. This is
an object mapping the key to an object containing metadata about the key. A
maximum of 10 extra keys is allowed. This metadata object has the following
keys:</p>
<ul>
<li><code>description</code>: <strong>Required.</strong> A description of the key.</li>
</ul>
<h2><a class="header" href="#api-13" id="api-13">API</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>Note that an <code>enum</code> has been generated for handling the <code>extra_keys</code>: it has the same name as the event metric, with <code>Keys</code> added.</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Views

Views.loginOpened.record(mapOf(Views.loginOpenedKeys.sourceOfLogin to &quot;toolbar&quot;))
</code></pre>
<p>There are test APIs available too, for example:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Views

// Was any event recorded?
assertTrue(Views.loginOpened.testHasValue())
// Get a List of the recorded events.
val snapshot = Views.loginOpened.testGetValue()
// Check that two events were recorded.
assertEquals(2, snapshot.size)
val first = snapshot.single()
assertEquals(&quot;login_opened&quot;, first.name)
// Check that no errors were recorded
assertEquals(0, Views.loginOpened.testGetNumRecordedErrors(ErrorType.InvalidOverflow))
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<p>Note that an <code>enum</code> has been generated for handling the <code>extra_keys</code>: it has the same name as the event metric, with <code>Keys</code> added.</p>
<pre><code class="language-Swift">Views.loginOpened.record(extra: [.sourceOfLogin: &quot;toolbar&quot;])
</code></pre>
<p>There are test APIs available too, for example:</p>
<pre><code class="language-Kotlin">@testable import Glean

// Was any event recorded?
XCTAssert(Views.loginOpened.testHasValue())
// Get a List of the recorded events.
val snapshot = try! Views.loginOpened.testGetValue()
// Check that two events were recorded.
XCTAssertEqual(2, snapshot.size)
val first = snapshot[0]
XCTAssertEqual(&quot;login_opened&quot;, first.name)
// Check that no errors were recorded
XCTAssertEqual(0, Views.loginOpened.testGetNumRecordedErrors(.invalidOverflow))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>Note that an <code>enum</code> has been generated for handling the <code>extra_keys</code>: it has the same name as the event metric, with <code>_keys</code> added.</p>
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.views.login_opened.record(
    {
        metrics.views.login_opened_keys.SOURCE_OF_LOGIN: &quot;toolbar&quot;
    }
)
</code></pre>
<p>There are test APIs available too, for example:</p>
<pre><code class="language-Python"># Was any event recorded?
assert metrics.views.login_opened.test_has_value()
# Get a List of the recorded events.
snapshot = metrics.views.login_opened.test_get_value()
# Check that two events were recorded.
assert 2 == len(snapshot)
first = snapshot[0]
assert &quot;login_opened&quot; == first.name
# Check that no errors were recorded
assert 0 == metrics.views.login_opened.test_get_num_recorded_errors(
    ErrorType.INVALID_OVERFLOW
)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<p>Note that an <code>enum</code> has been generated for handling the <code>extra_keys</code>: it has the same name as the event metric, with <code>Keys</code> added.</p>
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Views;

Views.loginOpened.Record(new Dictionary&lt;clickKeys, string&gt; {
    { Views.loginOpenedKeys.sourceOfLogin, &quot;toolbar&quot; }
});
</code></pre>
<p>There are test APIs available too, for example:</p>
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Views;

// Was any event recorded?
Assert.True(Views.loginOpened.TestHasValue());
// Get a List of the recorded events.
var snapshot = Views.loginOpened.TestGetValue();
// Check that two events were recorded.
Assert.Equal(2, snapshot.Length);
var first = snapshot.First();
Assert.Equal(&quot;login_opened&quot;, first.Name);
// Check that no errors were recorded
Assert.Equal(0, Views.loginOpened.TestGetNumRecordedErrors(ErrorType.InvalidOverflow));
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<p>Note that an <code>enum</code> has been generated for handling the <code>extra_keys</code>: it has the same name as the event metric, with <code>Keys</code> added.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use metrics::views;

let mut extra = HashMap::new();
extra.insert(views::LoginOpenedKeys::SourceOfLogin, &quot;toolbar&quot;.into());
views::login_opened.record(extra);
<span class="boring">}
</span></code></pre></pre>
<p>There are test APIs available too, for example:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use metrics::views;

// Was any event recorded?
assert!(views::login_opened.test_get_value(None).is_some());
// Get a List of the recorded events.
var snapshot = views::login_opened.test_get_value(None).unwrap();
// Check that two events were recorded.
assert_eq!(2, snapshot.len());
let first = &amp;snapshot[0];
assert_eq!(&quot;login_opened&quot;, first.name);
// Check that no errors were recorded
assert_eq!(0, views::login_opened.test_get_num_recorded_errors(ErrorType::InvalidOverflow, None));
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="C++" class="tab">
<blockquote>
<p><strong>Note</strong>: C++ APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

using mozilla::glean::views::LoginOpenedKeys;
nsTArray&lt;Tuple&lt;LoginOpenedKeys, nsCString&gt;&gt; extra;
nsCString source = &quot;toolbar&quot;_ns;
extra.AppendElement(MakeTuple(LoginOpenedKeys::SourceOfLogin, source));

mozilla::glean::views::login_opened.Record(std::move(extra))
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Does it have a value?
ASSERT_TRUE(mozilla::glean::views::login_opened.TestGetValue().isSome());
// Does it have the expected value?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1678567
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
<div data-lang="JS" class="tab">
<blockquote>
<p><strong>Note</strong>: JS APIs are only available in Firefox Desktop.</p>
</blockquote>
<pre><code class="language-js">let extra = { sourceOfLogin: &quot;toolbar&quot; };
Glean.views.loginOpened.record(extra);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-js">// Does it have the expected value?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1678567
// Did it run across any errors?
// TODO: https://bugzilla.mozilla.org/show_bug.cgi?id=1683171
</code></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits-13" id="limits-13">Limits</a></h2>
<ul>
<li>
<p>When 500 events are queued on the client an events ping is immediately sent.</p>
</li>
<li>
<p>The <code>extra_keys</code> allows for a maximum of 10 keys.</p>
</li>
<li>
<p>The keys in the <code>extra_keys</code> list must be in dotted snake case, with a maximum length of 40 bytes in UTF-8.</p>
</li>
<li>
<p>The values in the <code>extras</code> object have a maximum length of 50 in UTF-8.</p>
</li>
</ul>
<h2><a class="header" href="#examples-12" id="examples-12">Examples</a></h2>
<ul>
<li>Every time a new tab is opened.</li>
</ul>
<h2><a class="header" href="#recorded-errors-12" id="recorded-errors-12">Recorded errors</a></h2>
<ul>
<li><code>invalid_overflow</code>: if any of the values in the <code>extras</code> object are greater than 50 bytes in length.  (Prior to Glean 31.5.0, this recorded an <code>invalid_value</code>).</li>
</ul>
<h2><a class="header" href="#reference-13" id="reference-13">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-event-metric-type/index.html">Kotlin API docs</a></li>
<li><a href="reference/metrics/../../../swift/Classes/EventMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/event.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/event/struct.EventMetric.html">Rust API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/event.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#custom-distribution" id="custom-distribution">Custom Distribution</a></h1>
<p>Custom distributions are used to record the distribution of arbitrary values.</p>
<p>It should be used only when direct control over how the histogram buckets are computed is required.
Otherwise, look at the standard distribution metric types:</p>
<ul>
<li><a href="reference/metrics/timing_distribution.html">Timing Distributions</a></li>
<li><a href="reference/metrics/memory_distribution.html">Memory Distributions</a></li>
</ul>
<blockquote>
<p><strong>Note</strong>: Custom distributions are currently only allowed for GeckoView metrics (the <code>gecko_datapoint</code> parameter is present) and thus have only a Kotlin API.</p>
</blockquote>
<h2><a class="header" href="#configuration-13" id="configuration-13">Configuration</a></h2>
<p>Custom distributions have the following required parameters:</p>
<ul>
<li><code>range_min</code>: (Integer) The minimum value of the first bucket</li>
<li><code>range_max</code>: (Integer) The minimum value of the last bucket</li>
<li><code>bucket_count</code>: (Integer) The number of buckets</li>
<li><code>histogram_type</code>:
<ul>
<li><code>linear</code>: The buckets are evenly spaced</li>
<li><code>exponential</code>: The buckets follow a natural logarithmic distribution</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Note</strong> Check out how these bucketing algorithms would behave on the <a href="reference/metrics/custom_distribution.html#simulator">Custom distribution simulator</a></p>
</blockquote>
<p>In addition, the metric should specify:</p>
<ul>
<li><code>unit</code>: (String) The unit of the values in the metric. For documentation purposes only -- does not affect data collection.</li>
</ul>
<p>If you wanted to create a custom distribution of the peak number of pixels used during a checkerboard event, first you need to add an entry for it to the <code>metrics.yaml</code> file:</p>
<pre><code class="language-YAML">graphics:
  checkerboard_peak:
    type: custom_distribution
    description: &gt;
      Peak number of CSS pixels checkerboarded during a checkerboard event.
    range_min: 1
    range_max: 66355200
    bucket_count: 50
    histogram_type: exponential
    unit: pixels
    gecko_datapoint: CHECKERBOARD_PEAK
    ...
</code></pre>
<h2><a class="header" href="#api-14" id="api-14">API</a></h2>
<p>Now you can use the custom distribution from the application's code.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Graphics

Graphics.checkerboardPeak.accumulateSamples([23])
</code></pre>
<p>There are test APIs available too.  For convenience, properties <code>sum</code> and <code>count</code> are exposed to facilitate validating that data was recorded correctly.</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Graphics

// Was anything recorded?
assertTrue(Graphics.checkerboardPeak.testHasValue())

// Get snapshot
val snapshot = Graphics.checkerboardPeak.testGetValue()

// Does the sum have the expected value?
assertEquals(11, snapshot.sum)

// Usually you don't know the exact timing values, but how many should have been recorded.
assertEquals(2L, snapshot.count())

/// Did the metric receive a negative value?
assertEquals(1, Graphics.checkerboardPeak.testGetNumRecordedErrors(ErrorType.InvalidValue))
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

graphics::checkerboard_peak.accumulate_samples_signed(vec![23]);
<span class="boring">}
</span></code></pre></pre>
<p>There are test APIs available too.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;
use glean_metrics;

// Was anything recorded?
assert!(graphics::checkerboard_peak.test_get_value(None).is_some());
// Does it have the expected value?
assert_eq!(23, graphics::checkerboard_peak.test_get_value(None).unwrap().sum);

// Were any of the values negative and thus caused an error to be recorded?
assert_eq!(
    0,
    graphics::checkerboard_peak.test_get_num_recorded_errors(ErrorType::InvalidValue));
<span class="boring">}
</span></code></pre></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits-14" id="limits-14">Limits</a></h2>
<ul>
<li>
<p>The maximum value of <code>bucket_count</code> is 100.</p>
</li>
<li>
<p>Only non-negative values may be recorded.</p>
</li>
</ul>
<h2><a class="header" href="#recorded-errors-13" id="recorded-errors-13">Recorded errors</a></h2>
<ul>
<li><code>invalid_value</code>: If recording a negative value.</li>
</ul>
<h2><a class="header" href="#reference-14" id="reference-14">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-custom-distribution-metric-type/index.html">Kotlin API docs</a></li>
</ul>
<h2><a class="header" href="#simulator-2" id="simulator-2">Simulator</a></h2>
<div id="custom-data-modal-overlay">
    <div id="custom-data-modal">
        <p>Please, insert your custom data below as a JSON array.</p>
        <textarea rows="30"></textarea>
    </div>
</div>
<div id="simulator-container">
    <div id="histogram-chart-container">
        <div id="histogram-chart"></div>
        <p id="histogram-chart-legend"><p>
    </div>
    <div id="data-options">
        <h3><a class="header" href="#data-options-2" id="data-options-2">Data options</a></h3>
        <div class="input-group">
            <label for="normally-distributed">Generate normally distributed data</label>
            <input name="data-options" value="normally-distributed" id="normally-distributed" type="radio" />
        </div>
        <div class="input-group">
            <label for="log-normally-distributed">Generate log-normally distributed data</label>
            <input name="data-options" value="log-normally-distributed" id="log-normally-distributed" type="radio" checked />
        </div>
        <div class="input-group">
            <label for="uniformly-distributed">Generate uniformly distributed data</label>
            <input name="data-options" value="uniformly-distributed" id="uniformly-distributed" type="radio" />
        </div>
        <div class="input-group" id="custom-data-input-group">
            <label for="custom">Use custom data</label>
            <input name="data-options" value="custom" id="custom" type="radio" />
        </div>
    </div>
    <div id="histogram-props">
        <h3><a class="header" href="#properties-2" id="properties-2">Properties</a></h3>
        <div class="input-group">
            <label for="kind">Histogram type (<code>histogram_type</code>)</label>
            <select id="kind" name="kind">
                <option value="exponential" selected>Exponential</option>
                <option value="linear">Linear</option>
            </select>
        </div>
        <div class="input-group">
            <label for="lower-bound">Range minimum (<code>range_min</code>)</label>
            <input name="lower-bound" id="lower-bound" type="number" value="1" />
        </div>
        <div class="input-group">
            <label for="upper-bound">Range maximum (<code>range_max</code>)</label>
            <input name="upper-bound" id="upper-bound" type="number" value="500" />
        </div>
        <div class="input-group">
            <label for="bucket-count">Bucket count (<code>bucket_count</code>)</label>
            <input name="bucket-count" id="bucket-count" type="number" value="20" />
        </div>
    </div>
</div>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/custom_distribution.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#quantity" id="quantity">Quantity</a></h1>
<p>Used to record a single non-negative integer value or 0.
For example, the width of the display in pixels.</p>
<blockquote>
<p><strong>IMPORTANT</strong> If you need to <em>count</em> something (e.g. number of tabs open or number of times a button is pressed) prefer using the <a href="reference/metrics/./counter.html">Counter</a> metric type, which has a specific API for counting things and also takes care of resetting the count at the correct time.</p>
</blockquote>
<h2><a class="header" href="#configuration-14" id="configuration-14">Configuration</a></h2>
<p>Say you're adding a new quantity for the width of the display in pixels. First you need to add an entry for the quantity to the <code>metrics.yaml</code> file:</p>
<pre><code class="language-YAML">display:
  width:
    type: quantity
    description: &gt;
      The width of the display, in pixels.
    unit: pixels
    ...
</code></pre>
<p>Note that quantities have a required <code>unit</code> parameter, which is a free-form string for documentation purposes.</p>
<h2><a class="header" href="#api-15" id="api-15">API</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Display

Display.width.set(width)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Display

// Was anything recorded?
assertTrue(Display.width.testHasValue())
// Does the quantity have the expected value?
assertEquals(6, Display.width.testGetValue())
// Did it record an error due to a negative value?
assertEquals(1, Display.width.testGetNumRecordedErrors(ErrorType.InvalidValue))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Display;

Display.INSTANCE.width.set(width);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Display;

// Was anything recorded?
assertTrue(Display.INSTANCE.width.testHasValue());
// Does the quantity have the expected value?
assertEquals(6, Display.INSTANCE.width.testGetValue());
// Did the quantity record a negative value?
assertEquals(
    1, Display.INSTANCE.width.testGetNumRecordedErrors(ErrorType.InvalidValue)
);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Display.width.set(width)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(Display.width.testHasValue())
// Does the quantity have the expected value?
XCTAssertEqual(6, try Display.width.testGetValue())
// Did the quantity record a negative value?
XCTAssertEqual(1, Display.width.testGetNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.display.width.set(width)
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-Python"># Was anything recorded?
assert metrics.display.width.test_has_value()
# Does the quantity have the expected value?
assert 6 == metrics.display.width.test_get_value()
# Did the quantity record an negative value?
from glean.testing import ErrorType
assert 1 == metrics.display.width.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Display;

Display.width.Set(width);
</code></pre>
<p>There are test APIs available too:</p>
<pre><code class="language-C#">using static Mozilla.YourApplication.GleanMetrics.Display;

// Was anything recorded?
Assert.True(Display.width.TestHasValue());
// Does the counter have the expected value?
Assert.Equal(6, Display.width.TestGetValue());
// Did the counter record an negative value?
Assert.Equal(
    1, Display.width.TestGetNumRecordedErrors(ErrorType.InvalidValue)
);
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

display::width.set(width);
<span class="boring">}
</span></code></pre></pre>
<p>There are test APIs available too:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

// Was anything recorded?
assert!(display::width.test_get_value(None).is_some());
// Does it have the expected value?
assert_eq!(width, display::width.test_get_value(None).unwrap());
<span class="boring">}
</span></code></pre></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits-15" id="limits-15">Limits</a></h2>
<ul>
<li>Quantities must be non-negative integers or 0.</li>
</ul>
<h2><a class="header" href="#examples-13" id="examples-13">Examples</a></h2>
<ul>
<li>What is the width of the display, in pixels?</li>
</ul>
<h2><a class="header" href="#recorded-errors-14" id="recorded-errors-14">Recorded errors</a></h2>
<ul>
<li><code>invalid_value</code>: If a negative value is passed in.</li>
</ul>
<h2><a class="header" href="#reference-15" id="reference-15">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../javadoc/glean/mozilla.telemetry.glean.private/-quantity-metric-type/index.html">Kotlin API docs</a></li>
<li><a href="reference/metrics/../../../swift/Classes/QuantityMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/quantity.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/quantity/struct.QuantityMetric.html">Rust API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/quantity.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#rate" id="rate">Rate</a></h1>
<p>Used to count how often something happens relative to how often something else happens.
Like how many documents use a particular CSS Property,
or how many HTTP connections had an error.
You can think of it like a fraction, with a numerator and a denominator.</p>
<p>All rates start without a value.
A rate with a numerator of 0 is valid and will be sent to ensure we capture the
&quot;no errors happened&quot; or &quot;no use counted&quot; cases.</p>
<blockquote>
<p><strong>IMPORTANT:</strong> When using a rate metric, it is important to let the Glean metric do the counting.
Using your own variable for counting and setting the metric yourself could be problematic:
ping scheduling will make it difficult to ensure the metric is at the correct value at the correct time.
Instead, count to the numerator and denominator as you go.</p>
</blockquote>
<h2><a class="header" href="#configuration-15" id="configuration-15">Configuration</a></h2>
<p>Say you're adding a new rate for how often HTTP connections have errors.
First you need to add an entry for the rate to the <code>metrics.yaml</code> file:</p>
<pre><code class="language-YAML">network:
  http_connection_error:
    type: rate
    description: &gt;
      How many HTTP connections error out out of the total connections made.
    ...
</code></pre>
<h3><a class="header" href="#external-denominators" id="external-denominators">External Denominators</a></h3>
<p>If several rates share the same denominator
(from our example above, maybe there are multiple rates per total connections made)
then the denominator should be defined as a <code>counter</code> and shared between
<code>rates</code> using the <code>denominator_metric</code> property:</p>
<pre><code class="language-YAML">network:
  http_connections:
    type: counter
    description: &gt;
      Total number of http connections made.
    ...

  http_connection_error:
    type: rate
    description: &gt;
      How many HTTP connections error out out of the total connections made.
    denominator_metric: network.http_connections
    ...

  http_connection_slow:
    type: rate
    description: &gt;
      How many HTTP connections were slow, out of the total connections made.
    denominator_metric: network.http_connections
    ...
</code></pre>
<h2><a class="header" href="#api-16" id="api-16">API</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Rust" class="tab">
<p>Since a rate is two numbers, you add to each one individually:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics::*;

if connection_had_error {
    network::http_connection_error.add_to_numerator(1);
}

network::http_connection_error.add_to_denominator(1);
<span class="boring">}
</span></code></pre></pre>
<p>If the rate uses an external denominator,
adding to the denominator must be done through the denominator's
<code>counter</code> API:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

if connection_had_error {
    network::http_connection_error.add_to_numerator(1);
}
if connection_was_slow {
    network::http_connection_slow.add_to_numerator(1);
}

// network::http_connection_error has no `add_to_denominator` method.
network::http_connections.add(1);
<span class="boring">}
</span></code></pre></pre>
<p>There are test APIs available too.
Whether the rate has an external denominator or not,
you can use this API to get the current value:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;

use glean_metrics;

// Was anything recorded?
assert!(network::http_connection_error.test_get_value(None).is_some());
// Does it contain counter have the expected values?
assert_eq!((1, 1), network::http_connection_error.test_get_value(None).unwrap());
// Did the numerator or denominator ever have a negative value added?
assert_eq!(
  0,
  network::http_connection_error.test_get_num_recorded_errors(
    ErrorType::InvalidValue
  )
);
<span class="boring">}
</span></code></pre></pre>
</div>
</div>
</div>
<h2><a class="header" href="#limits-16" id="limits-16">Limits</a></h2>
<ul>
<li>Numerator and Denominator only increment.</li>
<li>Numerator and Denominator saturate at the largest value that can be represented as a 32-bit signed integer (<code>2147483647</code>).</li>
</ul>
<h2><a class="header" href="#examples-14" id="examples-14">Examples</a></h2>
<ul>
<li>How often did an HTTP connection error?</li>
<li>How many documents used a given CSS Property?</li>
</ul>
<h2><a class="header" href="#recorded-errors-15" id="recorded-errors-15">Recorded errors</a></h2>
<ul>
<li><code>invalid_value</code>: If either numerator or denominator is incremented by a negative value.</li>
</ul>
<h2><a class="header" href="#reference-16" id="reference-16">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../docs/glean/private/rate/struct.RateMetric.html">Rust API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/rate.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#android-specific-information" id="android-specific-information">Android-specific information</a></h1>
<p>The Glean SDK can be used in Android applications.
The integration into the build system for Android applications can be tuned to your needs.
See the following chapters for details.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/language-bindings/android/index.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#android-build-script-configuration-options" id="android-build-script-configuration-options">Android build script configuration options</a></h1>
<p>This chapter describes build configuration options that control the behavior of the Glean SDK's Gradle plugin.
These options are not usually required for normal use.</p>
<p>Options can be turned on by setting a variable on the Gradle <a href="https://docs.gradle.org/current/dsl/org.gradle.api.plugins.ExtraPropertiesExtension.html"><code>ext</code></a> object <em>before</em> applying the Glean Gradle plugin.</p>
<h2><a class="header" href="#allowmetricsfromaar" id="allowmetricsfromaar"><code>allowMetricsFromAAR</code></a></h2>
<p>Normally, the Glean SDK looks for <code>metrics.yaml</code> and <code>pings.yaml</code> files in the root directory of the Glean-using project.
However, in some cases, these files may need to ship inside the dependencies of the project.
For example, this is used in the <code>engine-gecko</code> component to grab the <code>metrics.yaml</code> from the <code>geckoview</code> AAR.</p>
<pre><code class="language-groovy">ext.allowMetricsFromAAR = true
</code></pre>
<p>When this flag is set, every direct dependency of your library will be searched for a <code>metrics.yaml</code> file, and those metrics will be treated as the metrics as if they were defined by your library.
That is, API wrappers accessible from your library will be generated for those metrics.</p>
<p>The <code>metrics.yaml</code> can be added to the dependency itself by calling this on each relevant build variant:</p>
<pre><code class="language-groovy">variant.packageLibraryProvider.get().from(&quot;${topsrcdir}/path/metrics.yaml&quot;)
</code></pre>
<h2><a class="header" href="#gleangeneratemarkdowndocs" id="gleangeneratemarkdowndocs"><code>gleanGenerateMarkdownDocs</code></a></h2>
<p>The Glean SDK can automatically generate Markdown documentation for metrics and pings defined in the registry files, in addition to the metrics API code.</p>
<pre><code class="language-groovy">ext.gleanGenerateMarkdownDocs = true
</code></pre>
<p>Flipping the feature to <code>true</code> will generate a <code>metrics.md</code> file in <code>$projectDir/docs</code> at build-time.</p>
<h2><a class="header" href="#gleandocsdirectory" id="gleandocsdirectory"><code>gleanDocsDirectory</code></a></h2>
<p>The <code>gleanDocsDirectory</code> can be used to customize the path of the documentation output directory.
If <code>gleanGenerateMarkdownDocs</code> is disabled, it does nothing.
Please note that only the <code>metrics.md</code> will be overwritten: any other file available in the target directory will be preserved.</p>
<pre><code class="language-groovy">ext.gleanDocsDirectory = &quot;$rootDir/docs/user/telemetry&quot;
</code></pre>
<h2><a class="header" href="#gleanyamlfiles" id="gleanyamlfiles"><code>gleanYamlFiles</code></a></h2>
<p>By default, the Glean Gradle plugin will look for <code>metrics.yaml</code> and <code>pings.yaml</code> files in the same directory that the plugin is included from in your application or library.
To override this, <code>ext.gleanYamlFiles</code> may be set to a list of explicit paths.</p>
<pre><code class="language-groovy">ext.gleanYamlFiles = [&quot;$rootDir/glean-core/metrics.yaml&quot;, &quot;$rootDir/glean-core/pings.yaml&quot;]
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/language-bindings/android/android-build-configuration-options.md">Edit this file on GitHub.</a></footer><h2><a class="header" href="#offline-builds-of-android-applications-that-use-glean" id="offline-builds-of-android-applications-that-use-glean">Offline builds of Android applications that use Glean</a></h2>
<p>The Glean SDK has basic support for building Android applications that use Glean in offline mode.</p>
<p>The Glean SDK uses a Python script, <a href="https://github.com/mozilla/glean_parser/"><code>glean_parser</code></a> to generate code for metrics from the <code>metrics.yaml</code> and <code>pings.yaml</code> files when Glean-using applications are built. When online, the pieces necessary to run this script are installed automatically.</p>
<p>For offline builds, the Python environment, and packages of <code>glean_parser</code> and its dependencies must be provided prior to building the Glean-using application.</p>
<p>To build a Glean-using application in offline mode, do the following:</p>
<ul>
<li>
<p>Install Python 3.6 or later and ensure it's on the <code>PATH</code>.</p>
<ul>
<li>
<p>On Linux, installing Python from your Linux distribution's package manager is usually sufficient.</p>
</li>
<li>
<p>On macOS, installing Python from <a href="https://brew.sh/"><code>homebrew</code></a> is known to work, but other package managers may also work.</p>
</li>
<li>
<p>On Windows, we recommend installing one of the official Python installers from <a href="https://python.org">python.org</a>.</p>
</li>
</ul>
</li>
<li>
<p>Determine the version of <code>glean_parser</code> required.</p>
<ul>
<li>
<p>It can be really difficult to manually determine the version of <code>glean_parser</code> that is required for a given application, since it needs to be tracked through <code>android-components</code>, to <code>glean-core</code> and finally to <code>glean_parser</code>. The required version of <code>glean_parser</code> can be determined by running the following at the top-level of the Glean-using application:</p>
<pre><code class="language-sh">$ ./gradlew | grep &quot;Requires glean_parser&quot;
Requires glean_parser==1.28.1
</code></pre>
</li>
</ul>
</li>
<li>
<p>Download packages for <code>glean_parser</code> and its dependencies:</p>
<ul>
<li>
<p>In the root directory of the Glean-using project, create a directory called <code>glean-wheels</code> and <code>cd</code> into it.</p>
</li>
<li>
<p>Download packages for <code>glean_parser</code> and its dependencies, replacing <code>X.Y.Z</code> with the correct version of <code>glean_parser</code>:</p>
<pre><code class="language-sh">$ python3 -m pip download glean_parser==X.Y.Z
</code></pre>
</li>
</ul>
</li>
<li>
<p>Build the Glean-using project using <code>./gradlew</code>, but passing in the <code>--offline</code> flag.</p>
</li>
</ul>
<p>There are a couple of environment variables that control offline building:</p>
<ul>
<li>
<p>To override the location of the Python interpreter to use, set the <code>GLEAN_PYTHON</code> environment variable. If unset, the first Python interpreter on the <code>PATH</code> will be used.</p>
</li>
<li>
<p>To override the location of the downloaded Python wheels, set the <code>GLEAN_PYTHON_WHEELS_DIR</code> environment variable.  If unset <code>${projectDir}/glean-wheels</code> will be used.</p>
</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/language-bindings/android/android-offline-builds.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#instrumenting-android-crashes-with-the-glean-sdk" id="instrumenting-android-crashes-with-the-glean-sdk">Instrumenting Android crashes with the Glean SDK</a></h1>
<p>One of the things that might be useful to collect data on in an Android application is crashes.  This guide will walk through a
basic strategy for instrumenting an Android application with crash telemetry using a custom ping.</p>
<p><strong>Note:</strong>  This is a <em>very</em> simple example of instrumenting crashes using the Glean SDK.  There will be challenges to
using this approach in a production application that should be considered.  For instance, when an app crashes it can be in an
unknown state and may not be able to do things like upload data to a server.  The recommended way of instrumenting crashes with
Android Components is called <a href="https://github.com/mozilla-mobile/android-components/tree/HEAD/components/lib/crash">lib-crash</a>, which takes into consideration things like multiple processes and persistence.</p>
<h2><a class="header" href="#before-you-start" id="before-you-start">Before You Start</a></h2>
<p>There are a few things that need to be installed in order to proceed, mainly <a href="https://developer.android.com/studio/">Android Studio</a>.  If you include the Android SDK,
Android Studio can take a little while to download and get installed.  This walk-through assumes some knowledge of Android
application development.  Knowing where to go to create a new project and how to add dependencies to a Gradle file will be
helpful in following this guide.</p>
<h2><a class="header" href="#setup-build-configuration" id="setup-build-configuration">Setup Build Configuration</a></h2>
<p>Please follow the instruction in the <a href="language-bindings/android/../../user/adding-glean-to-your-project.html">&quot;Adding Glean to your project&quot;</a> chapter in order to set up
Glean in an Android project.</p>
<h3><a class="header" href="#add-a-custom-metric" id="add-a-custom-metric">Add A Custom Metric</a></h3>
<p>Since crashes will be instrumented with some custom metrics, the next step will be to add a <code>metrics.yaml</code> file to define the
metrics used to record the crash information and a <code>pings.yaml</code> file to define a custom ping which will give some control over
the scheduling of the uploading.  See <a href="language-bindings/android/../../user/adding-new-metrics.html">&quot;Adding new metrics&quot;</a> for more information about adding metrics.</p>
<p>What metric type should be used to represent the crash data?  While this could be implemented several ways, an <a href="language-bindings/android/../../reference/metrics/event.html">event</a> is an
excellent choice, simply because events capture information in a nice concise way and they have a built-in way of passing
additional information using the <code>extras</code> field.  If it is necessary to pass along the cause of the exception or a few lines of
description, events let us do that easily (with <a href="language-bindings/android/../../reference/metrics/event.html#limits">some limitations</a>).</p>
<p>Now that a metric type has been chosen to represent the metric, the next step is creating the <code>metrics.yaml</code>.  Inside of the
root application folder of the Android Studio project create a new file named <code>metrics.yaml</code>.  After adding the schema
definition and event metric definition, the <code>metrics.yaml</code> should look like this:</p>
<pre><code class="language-YAML"># Required to indicate this is a `metrics.yaml` file
$schema: moz://mozilla.org/schemas/glean/metrics/2-0-0

crash:
  exception:
    type: event
    description: |
      Event to record crashes caused by unhandled exceptions
    notification_emails:
      - crashes@example.com
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1582479
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1582479
    expires:
      2021-01-01
    send_in_pings:
      - crash
    extra_keys:
      cause:
        description: The cause of the crash
      message:
        description: The exception message
</code></pre>
<p>As a brief explanation, this creates a metric called <code>exception</code> within a metric category called <code>crash</code>.  There is a text
<code>description</code> and the required <code>notification_emails</code>, <code>bugs</code>, <code>data_reviews</code>, and <code>expires</code> fields.  The <code>send_in_pings</code> field
is important to note here that it has a value of <code>- crash</code>.  This means that the crash event metric will be sent via a custom
ping named <code>crash</code> (which hasn't been created yet).  Finally, note the <code>extra_keys</code> field which has two keys defined, <code>cause</code>
and <code>message</code>.  This allows for sending additional information along with the event to be associated with these keys.</p>
<p><strong>Note:</strong>  For Mozilla applications, a mandatory <a href="https://github.com/mozilla/data-review/blob/HEAD/request.md">data review</a> is required in order to collect information with the Glean SDK.</p>
<h3><a class="header" href="#add-a-custom-ping" id="add-a-custom-ping">Add A Custom Ping</a></h3>
<p>Define the custom ping that will help control the upload scheduling by creating a <code>pings.yaml</code> file in the same directory as
the <code>metrics.yaml</code> file.  For more information about adding custom pings, see the section on <a href="language-bindings/android/../../user/pings/custom.html">custom pings</a>.<br />
The name of the ping will be <code>crash</code>, so the <code>pings.yaml</code> file should look like this:</p>
<pre><code class="language-YAML"># Required to indicate this is a `pings.yaml` file
$schema: moz://mozilla.org/schemas/glean/pings/2-0-0

crash:
  description: &gt;
    A ping to transport crash data
  include_client_id: true
  notification_emails:
    - crash@example.com
  bugs:
    - https://bugzilla.mozilla.org/show_bug.cgi?id=1582479
  data_reviews:
    - https://bugzilla.mozilla.org/show_bug.cgi?id=1582479
</code></pre>
<p>Before the newly defined metric or ping can be used, the application must first be built.  This will cause the <a href="https://github.com/mozilla/glean_parser/">glean_parser</a>
to execute and generate the API files that represent the metric and ping that were newly defined.</p>
<p><strong>Note:</strong> If changes to the YAML files aren't showing up in the project, try running the clean task on the project before
building any time one of the Glean YAML files has been modified.</p>
<p>It is recommended that Glean be initialized as early in the application startup as possible, which is why it's good to use a
custom <code>Application</code>, like the Glean Sample App <a href="https://github.com/mozilla/glean/blob/main/samples/android/app/src/main/java/org/mozilla/samples/glean/GleanApplication.kt"><code>GleanApplication.kt</code></a>.</p>
<p>Initializing Glean in the <code>Application.onCreate()</code> is ideal for this purpose.  Start by adding the import statement to allow
the usage of the custom ping that was created, adding the following to the top of the file:</p>
<pre><code class="language-Kotlin">import org.mozilla.gleancrashexample.GleanMetrics.Pings
</code></pre>
<p>Next, register the custom ping by calling <code>Glean.registerPings(Pings)</code> in the <code>onCreate()</code> function, preferably before calling
<code>Glean.initialize()</code>.  The completed function should look something like this:</p>
<pre><code class="language-Kotlin">override fun onCreate() {
  super.onCreate()

  // Register the application's custom pings.
  Glean.registerPings(Pings)

  // Initialize the Glean library
  Glean.initialize(applicationContext)
}

</code></pre>
<p>This completes the registration of the custom ping with the Glean SDK so that it knows about it and can manage the storage and
other important details of it like sending it when <code>send()</code> is called.</p>
<h3><a class="header" href="#instrument-the-app-to-record-the-event" id="instrument-the-app-to-record-the-event">Instrument The App To Record The Event</a></h3>
<p>In order to make the custom <code>Application</code> class handle uncaught exceptions, extend the class definition by adding
<code>Thread.UncaughtExceptionHandler</code> as an inherited class like this:</p>
<pre><code class="language-Kotlin">class MainActivity : AppCompatActivity(), Thread.UncaughtExceptionHandler {
    ...
}
</code></pre>
<p>As part of implementing the <code>Thread.UncaughtExceptionHandler</code> interface, the custom <code>Application</code> needs to implement the
override of the <code>uncaughtException()</code> function.  An example of this override that records data and sends the ping could look
something like this:</p>
<pre><code class="language-Kotlin">override fun uncaughtException(thread: Thread, exception: Throwable) {
    Crash.exception.record(
        mapOf(
            Crash.exceptionKeys.cause to exception.cause!!.toString(),
            Crash.exceptionKeys.message to exception.message!!
        )
    )
    Pings.crash.submit()
}
</code></pre>
<p>This records data to the <code>Crash.exception</code> metric from the <code>metrics.yaml</code>.  The category of the metric is <code>crash</code> and the name
is <code>exception</code> so it is accessed it by calling <code>record()</code> on the <code>Crash.exception</code> object.  The extra information for the
<code>cause</code> and the <code>message</code> is set as well.  Finally, calling <code>Pings.crash.submit()</code> forces the <code>crash</code> ping to be scheduled to be
sent.</p>
<p>The final step is to register the custom <code>Application</code> as the default uncaught exception handler by adding the following to the
<code>onCreate()</code> function after <code>Glean.initialize(this)</code>:</p>
<pre><code class="language-Kotlin">Thread.setDefaultUncaughtExceptionHandler(this)
</code></pre>
<h3><a class="header" href="#next-steps" id="next-steps">Next Steps</a></h3>
<p>This information didn't really get recorded by anything, as it would be rejected by the telemetry pipeline unless the
application was already known.  In order to collect telemetry from a new application, there is additional work that is
necessary that is beyond the scope of this example.  In order for data to be collected from your project, metadata must be
added to the <code>probe_scraper</code>.  The instructions for accomplishing this can be found in the <a href="https://github.com/mozilla/probe-scraper#adding-a-new-glean-repository"><code>probe_scraper</code> documentation</a>.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/language-bindings/android/instrument-android-crashes-example.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#glossary" id="glossary">Glossary</a></h1>
<p>A glossary with explanations and background for wording used in the Glean project.</p>
<h2><a class="header" href="#glean" id="glean">Glean</a></h2>
<p>According to the <a href="https://www.merriam-webster.com/dictionary/glean">dictionary</a> the word “glean” means:</p>
<blockquote>
<p>to gather information or material bit by bit</p>
</blockquote>
<p>Glean is the combination of the Glean SDK, the Glean pipeline &amp; Glean tools.</p>
<p>See also: <a href="https://docs.telemetry.mozilla.org/concepts/glean/glean.html">Glean - product analytics &amp; telemetry</a>.</p>
<h2><a class="header" href="#glean-pipeline" id="glean-pipeline">Glean Pipeline</a></h2>
<p>The general data pipeline is the infrastructure that collects, stores, and analyzes telemetry data from our products and logs from various services.
See <a href="https://docs.telemetry.mozilla.org/concepts/pipeline/gcp_data_pipeline.html">An overview of Mozilla’s Data Pipeline</a>.</p>
<p>The Glean pipeline additionally consists of</p>
<ul>
<li>the <a href="https://github.com/mozilla/probe-scraper#glean-metrics-data-files">Probe Info Service</a>,</li>
<li>the <a href="https://github.com/mozilla/mozilla-schema-generator/">schema generator</a>,</li>
<li>the <a href="https://github.com/mozilla/jsonschema-transpiler">JSON Schema transpiler</a>,</li>
<li>the <a href="https://github.com/mozilla-services/mozilla-pipeline-schemas">ping schemas</a>.</li>
</ul>
<h2><a class="header" href="#glean-sdk" id="glean-sdk">Glean SDK</a></h2>
<p>The Glean SDK is the bundle of libraries with support for different platforms.
The source code is available at <a href="https://github.com/mozilla/glean">https://github.com/mozilla/glean</a>.</p>
<h2><a class="header" href="#glean-sdk-book" id="glean-sdk-book">Glean SDK book</a></h2>
<p>This documentation.</p>
<h2><a class="header" href="#glean-tools" id="glean-tools">Glean tools</a></h2>
<p>Glean provides additional tools for its usage:</p>
<ul>
<li><a href="https://mozilla.github.io/glean_parser/">Glean parser</a> (Source code: <a href="https://github.com/mozilla/glean_parser/">https://github.com/mozilla/glean_parser/</a>)</li>
</ul>
<h2><a class="header" href="#metric" id="metric">Metric</a></h2>
<p>Metrics are the individual things being measured using Glean.
They are defined in <a href="https://mozilla.github.io/glean_parser/metrics-yaml.html">metrics.yaml</a> files, also known as <em>registry files</em>.</p>
<p>Glean itself provides <a href="appendix/../user/collected-metrics/metrics.html">some metrics out of the box</a>.</p>
<h2><a class="header" href="#ping" id="ping">Ping</a></h2>
<p>A ping is a bundle of related metrics, gathered in a payload to be transmitted.
The Glean SDK provides default pings and allows for custom ping, see <a href="appendix/../user/pings/index.html">Glean Pings</a>.</p>
<h2><a class="header" href="#submission" id="submission">Submission</a></h2>
<p>&quot;To submit&quot; means to collect &amp; to enqueue a ping for uploading.</p>
<p>The Glean SDK stores locally all the metrics set by it or by its clients.
Each ping has its own schedule to gather all its locally saved metrics and create a JSON payload with them. This is called &quot;collection&quot;.</p>
<p>Upon successful collection, the payload is queued for upload, which may not happen immediately or at all (in case network connectivity is not available).</p>
<p>Unless the user has defined their own custom pings, they don’t need to worry too much about submitting pings.</p>
<p>All the default pings have their scheduling and submission handled by the SDK.</p>
<h2><a class="header" href="#measurement-window" id="measurement-window">Measurement window</a></h2>
<p>The measurement window of a ping is the time frame in which metrics are being actively gathered for it.</p>
<p>The measurement window start time is the moment the previous ping is submitted. In the absence of a previous ping, this time will be the time the application process started.</p>
<p>The measurement window end time is the moment the current ping gets submitted. Any new metric recorded after submission will be part of the next ping, so this pings measurement window is over.</p>
<h2><a class="header" href="#this-week-in-glean-twig" id="this-week-in-glean-twig">This Week in Glean (TWiG)</a></h2>
<p><a href="appendix/twig.html">This Week in Glean</a> is a series of blog posts that the Glean Team at Mozilla is using to try to communicate better about our work.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/appendix/glossary.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#unreleased-changes" id="unreleased-changes">Unreleased changes</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v36.0.1...main">Full changelog</a></p>
<h1><a class="header" href="#v3601-2021-04-09" id="v3601-2021-04-09">v36.0.1 (2021-04-09)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v36.0.0...v36.0.1">Full changelog</a></p>
<ul>
<li>RLB
<ul>
<li>Provide an internal-use-only API to pass in raw samples for timing distributions (<a href="https://github.com/mozilla/glean/pull/1561">#1561</a>).</li>
<li>Expose Timespan's <code>set_raw</code> to Rust (<a href="https://github.com/mozilla/glean/pull/1578">#1578</a>).</li>
</ul>
</li>
<li>Android
<ul>
<li>BUGFIX: <code>TimespanMetricType.measure</code> and <code>TimingDistributionMetricType.measure</code> won't get inlined anymore (<a href="https://github.com/mozilla/glean/pull/1560">#1560</a>).
This avoids a potential bug where a <code>return</code> used inside the closure would end up not measuring the time.
Use <code>return@measure &lt;val&gt;</code> for early returns.</li>
</ul>
</li>
<li>Python
<ul>
<li>The Glean Python bindings now use rkv's safe mode backend. This should avoid intermittent segfaults in the LMDB backend.</li>
</ul>
</li>
<li>General
<ul>
<li>Attempt to upload a ping even in the face of IO Errors (<a href="https://github.com/mozilla/glean/pull/1576">#1576</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3600-2021-03-16" id="v3600-2021-03-16">v36.0.0 (2021-03-16)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v35.0.0...v36.0.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Introduce a new API <code>Ping#test_before_next_submit</code> to run a callback right before a custom ping is submitted (<a href="https://github.com/mozilla/glean/pull/1507">#1507</a>).
<ul>
<li>The new API exists for all language bindings (Kotlin, Swift, Rust, Python).</li>
</ul>
</li>
<li>Updated <code>glean_parser</code> version to 2.5.0</li>
<li>Change the <code>fmt-</code> and <code>lint-</code> make commands for consistency (<a href="https://github.com/mozilla/glean/pull/1526">#1526</a>)</li>
<li>The Glean SDK can now produce testing coverage reports for your metrics (<a href="https://github.com/mozilla/glean/pull/1482/files">#1482</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>Update minimal required version of <code>cffi</code> dependency to 1.13.0 (<a href="https://github.com/mozilla/glean/pull/1520">#1520</a>).</li>
<li>Ship wheels for arm64 macOS (<a href="https://github.com/mozilla/glean/pull/1534">#1534</a>).</li>
</ul>
</li>
<li>RLB
<ul>
<li>Added <code>rate</code> metric type (<a href="https://github.com/mozilla/glean/pull/1516">#1516</a>).</li>
<li>Set <code>internal_metrics::os_version</code> for MacOS, Windows and Linux (<a href="https://github.com/mozilla/glean/pull/1538">#1538</a>)</li>
<li>Expose a function <code>get_timestamp_ms</code> to get a timestamp from a monotonic clock on all supported operating systems, to be used for event timestamps (<a href="https://github.com/mozilla/glean/pull/1546">#1546</a>).</li>
<li>Expose a function to record events with an externally provided timestamp.</li>
</ul>
</li>
<li>iOS
<ul>
<li><strong>Breaking Change</strong>: Event timestamps are now correctly recorded in milliseconds (<a href="https://github.com/mozilla/glean/pull/1546">#1546</a>).
<ul>
<li>Since the first release event timestamps were erroneously recorded with nanosecond precision (<a href="https://github.com/mozilla/glean/pull/1549">#1549</a>).
This is now fixed and event timestamps are in milliseconds.
This is equivalent to how it works in all other language bindings.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3500-2021-02-22" id="v3500-2021-02-22">v35.0.0 (2021-02-22)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v34.1.0...v35.0.0">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li><code>Glean.initialize</code> can now take a <code>buildInfo</code> parameter to pass in build time version information, and avoid calling out to the Android package manager at runtime. A suitable instance is generated by <code>glean_parser</code> in <code>${PACKAGE_ROOT}.GleanMetrics.GleanBuildInfo.buildInfo</code> (<a href="https://github.com/mozilla/glean/pull/1495">#1495</a>). Not passing in a <code>buildInfo</code> object is still supported, but is deprecated.</li>
<li>The <code>testGetValue</code> APIs now include a message on the <code>NullPointerException</code> thrown when the value is missing.</li>
<li><strong>Breaking change:</strong> <code>LEGACY_TAG_PINGS</code> is removed from <code>GleanDebugActivity</code> (<a href="https://github.com/mozilla/glean/pull/1510">#1510</a>)</li>
</ul>
</li>
<li>RLB
<ul>
<li><strong>Breaking change:</strong> <code>Configuration.data_path</code> is now a <code>std::path::PathBuf</code>(<a href="https://github.com/mozilla/glean/pull/1493">#1493</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3410-2021-02-04" id="v3410-2021-02-04">v34.1.0 (2021-02-04)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v34.0.0...v34.1.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>A new metric <code>glean.validation.pings_submitted</code> tracks the number of pings sent. It is included in both the <code>metrics</code> and <code>baseline</code> pings.</li>
</ul>
</li>
<li>iOS
<ul>
<li>The metric <code>glean.validation.foreground_count</code> is now sent in the metrics ping (<a href="https://github.com/mozilla/glean/pull/1472">#1472</a>).</li>
<li>BUGFIX: baseline pings with reason <code>dirty_startup</code> are no longer sent if Glean did not full initialize in the previous run (<a href="https://github.com/mozilla/glean/pull/1476">#1476</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>Expose the client activity API (<a href="https://github.com/mozilla/glean/pull/1481">#1481</a>).</li>
<li>BUGFIX: Publish a macOS wheel again. The previous release failed to build a Python wheel for macOS platforms (<a href="https://github.com/mozilla/glean/pull/1471">#1471</a>).</li>
</ul>
</li>
<li>RLB
<ul>
<li>BUGFIX: baseline pings with reason <code>dirty_startup</code> are no longer sent if Glean did shutdown cleanly (<a href="https://github.com/mozilla/glean/pull/1483">#1483</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3400-2021-01-29" id="v3400-2021-01-29">v34.0.0 (2021-01-29)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.10.3...v34.0.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Other bindings detect when RLB is used and try to flush the RLB dispatcher to unblock the Rust API (<a href="https://github.com/mozilla/glean/pull/1442">#1442</a>).
<ul>
<li>This is detected automatically, no changes needed for consuming code.</li>
</ul>
</li>
<li>Add support for the client activity API (<a href="https://github.com/mozilla/glean/pull/1455">#1455</a>). This API is either automatically used or exposed by the language bindings.</li>
<li>Rename the reason <code>background</code> to <code>inactive</code> for both the <code>baseline</code> and <code>events</code> ping. Rename the reason <code>foreground</code> to <code>active</code> for the <code>baseline</code> ping.</li>
</ul>
</li>
<li>RLB
<ul>
<li>When the pre-init task queue overruns, this is now recorded in the metric <code>glean.error.preinit_tasks_overflow</code> (<a href="https://github.com/mozilla/glean/pull/1438">#1438</a>).</li>
<li>Expose the client activity API (<a href="https://github.com/mozilla/glean/pull/1455">#1455</a>).</li>
<li>Send the <code>baseline</code> ping with reason <code>dirty_startup</code>, if needed, at startup.</li>
<li>Expose all required types directly (<a href="https://github.com/mozilla/glean/pull/1452">#1452</a>).
<ul>
<li>Rust consumers will not need to depend on <code>glean-core</code> anymore.</li>
</ul>
</li>
</ul>
</li>
<li>Android
<ul>
<li>BUGFIX: Don't crash the ping uploader when throttled due to reading too large wait time values (<a href="https://github.com/mozilla/glean/pull/1454">#1454</a>).</li>
<li>Use the client activity API (<a href="https://github.com/mozilla/glean/pull/1455">#1455</a>).</li>
<li>Update <code>AndroidX</code> dependencies (<a href="https://github.com/mozilla/glean/pull/1441">#1441</a>).</li>
</ul>
</li>
<li>iOS
<ul>
<li>Use the client activity API (<a href="https://github.com/mozilla/glean/pull/1465">#1465</a>).
Note: this now introduces a baseline ping with reason <code>active</code> on startup.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v33103-2021-01-18" id="v33103-2021-01-18">v33.10.3 (2021-01-18)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.10.2...v33.10.3">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>Upgrade rkv to 0.17 (<a href="https://github.com/mozilla/glean/pull/1434">#1434</a>)</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v33102-2021-01-15" id="v33102-2021-01-15">v33.10.2 (2021-01-15)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.10.1...v33.10.2">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>A new metric <code>glean.error.io</code> has been added, counting the times an IO error happens when writing a pending ping to disk (<a href="https://github.com/mozilla/glean/pull/1428">#1428</a>)</li>
</ul>
</li>
<li>Android
<ul>
<li>A new metric <code>glean.validation.foreground_count</code> was added to the metrics ping (<a href="https://github.com/mozilla/glean/pull/1418">#1418</a>).</li>
</ul>
</li>
<li>Rust
<ul>
<li>BUGFIX: Fix lock order inversion in RLB Timing Distribution (<a href="https://github.com/mozilla/glean/pull/1431">#1431</a>).</li>
<li>Use RLB types instead of glean-core ones for RLB core metrics. (<a href="https://github.com/mozilla/glean/pull/1432">#1432</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v33101-2021-01-06" id="v33101-2021-01-06">v33.10.1 (2021-01-06)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.10.0...v33.10.1">Full changelog</a></p>
<p>No functional changes. v33.10.0 failed to generated iOS artifacts due to broken tests (<a href="https://github.com/mozilla/glean/pull/1421">#1421</a>).</p>
<h1><a class="header" href="#v33100-2021-01-06" id="v33100-2021-01-06">v33.10.0 (2021-01-06)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.9.1...v33.10.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>A new metric <code>glean.validation.first_run_hour</code>, analogous to the existing <code>first_run_date</code> but with hour resolution, has been added. Only clients running the app for the first time after this change will report this metric (<a href="https://github.com/mozilla/glean/pull/1403">#1403</a>).</li>
</ul>
</li>
<li>Rust
<ul>
<li>BUGFIX: Don't require mutable references in RLB traits (<a href="https://github.com/mozilla/glean/pull/1417">#1417</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>Building the Python package from source now works on musl-based Linux distributions, such as Alpine Linux (<a href="https://github.com/mozilla/glean/pull/1416">#1416</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3391-2020-12-17" id="v3391-2020-12-17">v33.9.1 (2020-12-17)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.9.0...v33.9.1">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>BUGFIX: Don't panic on shutdown and avoid running tasks if uninitialized (<a href="https://github.com/mozilla/glean/pull/1398">#1398</a>).</li>
<li>BUGFIX: Don't fail on empty database files (<a href="https://github.com/mozilla/glean/pull/1398">#1398</a>).</li>
<li>BUGFIX: Support ping registration before Glean initializes (<a href="https://github.com/mozilla/glean/pull/1393">#1393</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3390-2020-12-15" id="v3390-2020-12-15">v33.9.0 (2020-12-15)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.8.0...v33.9.0">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>Introduce the String List metric type in the RLB. (<a href="https://github.com/mozilla/glean/pull/1380">#1380</a>).</li>
<li>Introduce the <code>Datetime</code> metric type in the RLB (<a href="https://github.com/mozilla/glean/pull/1384">#1384</a>).</li>
<li>Introduce the <code>CustomDistribution</code> and <code>TimingDistribution</code> metric type in the RLB (<a href="https://github.com/mozilla/glean/pull/1394">#1394</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3380-2020-12-10" id="v3380-2020-12-10">v33.8.0 (2020-12-10)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.7.0...v33.8.0">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>Introduce the Memory Distribution metric type in the RLB. (<a href="https://github.com/mozilla/glean/pull/1376">#1376</a>).</li>
<li>Shut down Glean in tests before resetting to make sure they don't mistakenly init Glean twice in parallel (<a href="https://github.com/mozilla/glean/pull/1375">#1375</a>).</li>
<li>BUGFIX: Fixing 2 <code>lock-order-inversion</code> bugs found by TSan (<a href="https://github.com/mozilla/glean/pull/1378">#1378</a>).
<ul>
<li>TSan runs on mozilla-central tests, which found two (potential) bugs where 2 different locks were acquired in opposite order in different code paths,
which could lead to deadlocks in multi-threaded code. As RLB uses multiple threads (e.g. for init and the dispatcher) by default, this can easily become an actual issue.</li>
</ul>
</li>
</ul>
</li>
<li>Python
<ul>
<li>All log messages from the Glean SDK are now on the <code>glean</code> logger, obtainable through <code>logging.getLogger(&quot;glean&quot;)</code>.  (Prior to this, each module had its own logger, for example <code>glean.net.ping_upload_worker</code>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3370-2020-12-07" id="v3370-2020-12-07">v33.7.0 (2020-12-07)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.6.0...v33.7.0">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>Upgrade rkv to 0.16.0 (no functional changes) (<a href="https://github.com/mozilla/glean/pull/1355">#1355</a>).</li>
<li>Introduce the Event metric type in the RLB (<a href="https://github.com/mozilla/glean/pull/1361">#1361</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>Python Linux wheels no longer work on Linux distributions released before 2014 (they now use the manylinux2014 ABI) (<a href="https://github.com/mozilla/glean/pull/1353">#1353</a>).</li>
<li>Unbreak Python on non-Linux ELF platforms (BSD, Solaris/illumos) (<a href="https://github.com/mozilla/glean/pull/1363">#1363</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3360-2020-12-02" id="v3360-2020-12-02">v33.6.0 (2020-12-02)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.5.0...v33.6.0">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>BUGFIX: Negative timespans for the timespan metric now correctly record an <code>InvalidValue</code> error (<a href="https://github.com/mozilla/glean/pull/1347">#1347</a>).</li>
<li>Introduce the Timespan metric type in the RLB (<a href="https://github.com/mozilla/glean/pull/1347">#1347</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>BUGFIX: Network slowness or errors will no longer block the main dispatcher thread, leaving work undone on shutdown (<a href="https://github.com/mozilla/glean/pull/1350">#1350</a>).</li>
<li>BUGFIX: Lower sleep time on upload waits to avoid being stuck when the main process ends (<a href="https://github.com/mozilla/glean/pull/1349">#1349</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3350-2020-12-01" id="v3350-2020-12-01">v33.5.0 (2020-12-01)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.4.0...v33.5.0">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>Introduce the UUID metric type in the RLB.</li>
<li>Introduce the Labeled metric type in the RLB (<a href="https://github.com/mozilla/glean/pull/1327">#1327</a>).</li>
<li>Introduce the Quantity metric type in the RLB.</li>
<li>Introduce the <code>shutdown</code> API.</li>
<li>Add Glean debugging APIs.</li>
</ul>
</li>
<li>Python
<ul>
<li>BUGFIX: Setting a UUID metric to a value that is not in the expected UUID format will now record an error with the Glean error reporting system.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3340-2020-11-17" id="v3340-2020-11-17">v33.4.0 (2020-11-17)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.3.0...v33.4.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>When Rkv's safe mode is enabled (<code>features = [&quot;rkv-safe-mode&quot;]</code> on the <code>glean-core</code> crate) LMDB data is migrated at first start (<a href="https://github.com/mozilla/glean/pull/1322">#1322</a>).</li>
</ul>
</li>
<li>Rust
<ul>
<li>Introduce the Counter metric type in the RLB.</li>
<li>Introduce the String metric type in the RLB.</li>
<li>BUGFIX: Track the size of the database directory at startup (<a href="https://github.com/mozilla/glean/pull/1304">#1304</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>BUGFIX: Fix too-long sleep time in uploader due to unit mismatch (<a href="https://github.com/mozilla/glean/pull/1325">#1325</a>).</li>
</ul>
</li>
<li>Swift
<ul>
<li>BUGFIX: Fix too-long sleep time in uploader due to unit mismatch (<a href="https://github.com/mozilla/glean/pull/1325">#1325</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3330-2020-11-12" id="v3330-2020-11-12">v33.3.0 (2020-11-12)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.2.0...v33.3.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Do not require default-features on rkv and downgrade bincode (<a href="https://github.com/mozilla/glean/pull/1317">#1317</a>)</li>
</ul>
</li>
<li>Rust
<ul>
<li>Implement the experiments API (<a href="https://github.com/mozilla/glean/pull/1314">#1314</a>)</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3320-2020-11-10" id="v3320-2020-11-10">v33.2.0 (2020-11-10)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.1.2...v33.2.0">Full changelog</a></p>
<ul>
<li>Python
<ul>
<li>Fix building of Linux wheels (<a href="https://github.com/mozilla/glean/pull/1303">#1303</a>)
<ul>
<li>Python Linux wheels no longer work on Linux distributions released before 2010. (They now use the manylinux2010 ABI, rather than the manylinux1 ABI.)</li>
</ul>
</li>
</ul>
</li>
<li>Rust
<ul>
<li>Introduce the RLB <code>net</code> module (<a href="https://github.com/mozilla/glean/pull/1292">#1292</a>)</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3312-2020-11-04" id="v3312-2020-11-04">v33.1.2 (2020-11-04)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.1.1...v33.1.2">Full changelog</a></p>
<ul>
<li>No changes.  v33.1.1 was tagged incorrectly.</li>
</ul>
<h1><a class="header" href="#v3311-2020-11-04" id="v3311-2020-11-04">v33.1.1 (2020-11-04)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.1.0...v33.1.1">Full changelog</a></p>
<ul>
<li>No changes.  v33.1.0 was tagged incorrectly.</li>
</ul>
<h1><a class="header" href="#v3310-2020-11-04" id="v3310-2020-11-04">v33.1.0 (2020-11-04)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.0.4...v33.1.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Standardize throttle backoff time throughout all bindings. (<a href="https://github.com/mozilla/glean/pull/1240">#1240</a>)</li>
<li>Update <code>glean_parser</code> to 1.29.0
<ul>
<li>Generated code now includes a comment next to each metric containing the name of the metric in its original <code>snake_case</code> form.</li>
</ul>
</li>
<li>Expose the description of the metric types in glean_core using traits.</li>
</ul>
</li>
<li>Rust
<ul>
<li>Add the <code>BooleanMetric</code> type.</li>
<li>Add the <code>dispatcher</code> module (copied over from <a href="https://hg.mozilla.org/mozilla-central/rev/fbe0ea62f4bb50bfc5879a56667945697b2c90e7">mozilla-central</a>).</li>
<li>Allow consumers to specify a custom uploader.</li>
</ul>
</li>
<li>Android
<ul>
<li>Update the JNA dependency from 5.2.0 to 5.6.0</li>
<li>The <code>glean-gradle-plugin</code> now makes sure that only a single Miniconda installation will happen at the same time to avoid a race condition when multiple components within the same project are using Glean.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3304-2020-09-28" id="v3304-2020-09-28">v33.0.4 (2020-09-28)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.0.3...v33.0.4">Full changelog</a></p>
<p>Note: Previous 33.0.z releases were broken. This release now includes all changes from 33.0.0 to 33.0.3.</p>
<ul>
<li>General
<ul>
<li>Update <code>glean_parser</code> to 1.28.6
<ul>
<li>BUGFIX: Ensure Kotlin arguments are deterministically ordered</li>
</ul>
</li>
</ul>
</li>
<li>Android
<ul>
<li><strong>Breaking change:</strong> Updated to the Android Gradle Plugin v4.0.1 and Gradle 6.5.1. Projects using older versions of these components will need to update in order to use newer versions of the Glean SDK.</li>
<li>Update the Kotlin Gradle Plugin to version 1.4.10.</li>
<li>Fixed the building of <code>.aar</code> releases on Android so they include the Rust shared objects.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3303-2020-09-25" id="v3303-2020-09-25">v33.0.3 (2020-09-25)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.0.2...v33.0.3">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>v33.0.2 was tagged incorrectly. This release is just to correct that mistake.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3302-2020-09-25" id="v3302-2020-09-25">v33.0.2 (2020-09-25)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.0.1...v33.0.2">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>Fixed the building of <code>.aar</code> releases on Android so they include the Rust shared objects.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3301-2020-09-24" id="v3301-2020-09-24">v33.0.1 (2020-09-24)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.0.0...v33.0.1">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Update <code>glean_parser</code> to 1.28.6
<ul>
<li>BUGFIX: Ensure Kotlin arguments are deterministically ordered</li>
</ul>
</li>
</ul>
</li>
<li>Android
<ul>
<li>Update the Kotlin Gradle Plugin to version 1.4.10.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3300-2020-09-22" id="v3300-2020-09-22">v33.0.0 (2020-09-22)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.4.0...v33.0.0">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li><strong>Breaking change:</strong> Updated to the Android Gradle Plugin v4.0.1 and Gradle 6.5.1. Projects using older versions of these components will need to update in order to use newer versions of the Glean SDK.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3241-2020-10-01" id="v3241-2020-10-01">v32.4.1 (2020-10-01)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.4.0...v32.4.1">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Update <code>glean_parser</code> to 1.28.6
<ul>
<li>BUGFIX: Ensure Kotlin arguments are deterministically ordered</li>
</ul>
</li>
<li>BUGFIX: Transform ping directory size from bytes to kilobytes before accumulating to <code>glean.upload.pending_pings_directory_size</code> (<a href="https://github.com/mozilla/glean/pull/1236">#1236</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3240-2020-09-18" id="v3240-2020-09-18">v32.4.0 (2020-09-18)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.3.2...v32.4.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Allow using quantity metric type outside of Gecko (<a href="https://github.com/mozilla/glean/pull/1198">#1198</a>)</li>
<li>Update <code>glean_parser</code> to 1.28.5
<ul>
<li>The <code>SUPERFLUOUS_NO_LINT</code> warning has been removed from the glinter. It likely did more harm than good, and makes it hard to make metrics.yaml files that pass across different versions of <code>glean_parser</code>.</li>
<li>Expired metrics will now produce a linter warning, <code>EXPIRED_METRIC</code>.</li>
<li>Expiry dates that are more than 730 days (~2 years) in the future will produce a linter warning, <code>EXPIRATION_DATE_TOO_FAR</code>.</li>
<li>Allow using the Quantity metric type outside of Gecko.</li>
<li>New parser configs <code>custom_is_expired</code> and <code>custom_validate_expires</code> added. These are both functions that take the expires value of the metric and return a bool. (See <code>Metric.is_expired</code> and <code>Metric.validate_expires</code>). These will allow FOG to provide custom validation for its version-based <code>expires</code> values.</li>
</ul>
</li>
<li>Add a limit of 250 pending ping files. (<a href="https://github.com/mozilla/glean/pull/1217">#1217</a>).</li>
</ul>
</li>
<li>Android
<ul>
<li>Don't retry the ping uploader when waiting, sleep instead. This avoids a never-ending increase of the backoff time (<a href="https://github.com/mozilla/glean/pull/1217">#1217</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3232-2020-09-11" id="v3232-2020-09-11">v32.3.2 (2020-09-11)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.3.1...v32.3.2">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Track the size of the database file at startup (<a href="https://github.com/mozilla/glean/pull/1141">#1141</a>).</li>
<li>Submitting a ping with upload disabled no longer shows an error message (<a href="https://github.com/mozilla/glean/pull/1201">#1201</a>).</li>
<li>BUGFIX: scan the pending pings directories <strong>after</strong> dealing with upload status on initialization. This is important, because in case upload is disabled we delete any outstanding non-deletion ping file, and if we scan the pending pings folder before doing that we may end up sending pings that should have been discarded. (<a href="https://github.com/mozilla/glean/pull/1205">#1205</a>)</li>
</ul>
</li>
<li>iOS
<ul>
<li>Disabled code coverage in release builds (<a href="https://github.com/mozilla/glean/issues/1195">#1195</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>Glean now ships a source package to pip install on platforms where wheels aren't provided.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3231-2020-09-09" id="v3231-2020-09-09">v32.3.1 (2020-09-09)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.3.0...v32.3.1">Full changelog</a></p>
<ul>
<li>Python
<ul>
<li>Fixed the release process to generate all wheels (<a href="https://github.com/mozilla/glean/pull/1193">#1193</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3230-2020-08-27" id="v3230-2020-08-27">v32.3.0 (2020-08-27)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.2.0...v32.3.0">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>Handle ping registration off the main thread. This removes a potential blocking call (<a href="https://github.com/mozilla/glean/pull/1132">#1132</a>).</li>
</ul>
</li>
<li>iOS
<ul>
<li>Handle ping registration off the main thread. This removes a potential blocking call (<a href="https://github.com/mozilla/glean/pull/1132">#1132</a>).</li>
<li>Glean for iOS is now being built with Xcode 12.0.0 (Beta 5) (<a href="https://github.com/mozilla/glean/pull/1170">#1170</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3220-2020-08-25" id="v3220-2020-08-25">v32.2.0 (2020-08-25)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.1.1...v32.2.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Move logic to limit the number of retries on ping uploading &quot;recoverable failures&quot; to glean-core. (<a href="https://github.com/mozilla/glean/pull/1120">#1120</a>)
<ul>
<li>The functionality to limit the number of retries in these cases was introduced to the Glean SDK in <code>v31.1.0</code>. The work done now was to move that logic to the glean-core in order to avoid code duplication throughout the language bindings.</li>
</ul>
</li>
<li>Update <code>glean_parser</code> to <code>v1.28.3</code>
<ul>
<li>BUGFIX: Generate valid C# code when using Labeled metric types.</li>
<li>BUGFIX: Support <code>HashSet</code> and <code>Dictionary</code> in the C# generated code.</li>
</ul>
</li>
<li>Add a 10MB quota to the pending pings storage. (<a href="https://github.com/mozilla/glean/pull/1110">#1100</a>)</li>
</ul>
</li>
<li>C#
<ul>
<li>Add support for the String List metric type (<a href="https://github.com/mozilla/glean/pull/1108">#1108</a>).</li>
<li>Enable generating the C# APIs using the glean_parser (<a href="https://github.com/mozilla/glean/pull/1092">#1092</a>).</li>
<li>Add support for the <code>EventMetricType</code> in C# (<a href="https://github.com/mozilla/glean/pull/1129">#1129</a>).</li>
<li>Add support for the <code>TimingDistributionMetricType</code> in C# (<a href="https://github.com/mozilla/glean/pull/1131">#1131</a>).</li>
<li>Implement the experiments API in C# (<a href="https://github.com/mozilla/glean/pull/1145">#1145</a>).</li>
<li>This is the last release with C# language bindings changes. Reach out to the Glean SDK team if you want to use the C# bindings in a new product and require additional features.</li>
</ul>
</li>
<li>Python
<ul>
<li>BUGFIX: Limit the number of retries for 5xx server errors on ping uploads (<a href="https://github.com/mozilla/glean/pull/1120">#1120</a>).
<ul>
<li>This kinds of failures yield a &quot;recoverable error&quot;, which means the ping gets re-enqueued. That can cause infinite loops on the ping upload worker. For python we were incorrectly only limiting the number of retries for I/O errors, another type of &quot;recoverable error&quot;.</li>
</ul>
</li>
<li><code>kebab-case</code> ping names are now converted to <code>snake_case</code> so they are available on the object returned by <code>load_pings</code> (<a href="https://github.com/mozilla/glean/pull/1122">#1122</a>).</li>
<li>For performance reasons, the <code>glinter</code> is no longer run as part of <code>glean.load_metrics()</code>. We recommend running <code>glinter</code> as part of your project's continuous integration instead (<a href="https://github.com/mozilla/glean/pull/1124">#1124</a>).</li>
<li>A <code>measure</code> context manager for conveniently measuring runtimes has been added to <code>TimespanMetricType</code> and <code>TimingDistributionMetricType</code> (<a href="https://github.com/mozilla/glean/pull/1126">#1126</a>).</li>
<li>Networking errors have changed from <code>ERROR</code> level to <code>DEBUG</code> level so they aren't displayed by default (<a href="https://github.com/mozilla/glean/pull/1166">#1166</a>).</li>
</ul>
</li>
<li>iOS
<ul>
<li>Changed logging to use <a href="https://developer.apple.com/documentation/os/logging"><code>OSLog</code></a> rather than a mix of <code>NSLog</code> and <code>print</code>. (<a href="https://github.com/mozilla/glean/pull/1133">#1133</a>)</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3211-2020-08-24" id="v3211-2020-08-24">v32.1.1 (2020-08-24)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.1.0...v32.1.1">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>Support installing glean_parser in offline mode (<a href="https://github.com/mozilla/glean/pull/1065">#1065</a>).</li>
<li>Fix a startup crash on some Android 8 (SDK=25) devices, due to a <a href="https://issuetracker.google.com/issues/110848122#comment17">bug in the Java compiler</a> (<a href="https://github.com/mozilla/glean/pull/1135">#1135</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3210-2020-08-17" id="v3210-2020-08-17">v32.1.0 (2020-08-17)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.0.0...v32.1.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>The upload rate limiter has been changed from 10 pings per minute to 15 pings per minute.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3200-2020-08-03" id="v3200-2020-08-03">v32.0.0 (2020-08-03)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.6.0...v32.0.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Limit ping request body size to 1MB. (<a href="https://github.com/mozilla/glean/pull/1098">#1098</a>)</li>
</ul>
</li>
<li>iOS
<ul>
<li>Implement ping tagging (i.e. the <code>X-Source-Tags</code> header) through custom URL (<a href="https://github.com/mozilla/glean/pull/1100">#1100</a>).</li>
</ul>
</li>
<li>C#
<ul>
<li>Add support for Labeled Strings and Labeled Booleans.</li>
<li>Add support for the Counter metric type and Labeled Counter.</li>
<li>Add support for the <code>MemoryDistributionMetricType</code>.</li>
</ul>
</li>
<li>Python
<ul>
<li><strong>Breaking change:</strong> <code>data_dir</code> must always be passed to <code>Glean.initialize</code>. Prior to this, a missing value would store Glean data in a temporary directory.</li>
<li>Logging messages from the Rust core are now sent through Python's standard library <code>logging</code> module. Therefore all logging in a Python application can be controlled through the <code>logging</code> module interface.</li>
</ul>
</li>
<li>Android
<ul>
<li>BUGFIX: Require activities executed via <code>GleanDebugView</code> to be exported.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3160-2020-07-24" id="v3160-2020-07-24">v31.6.0 (2020-07-24)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.5.0...v31.6.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Implement JWE metric type (<a href="https://github.com/mozilla/glean/pull/1073">#1073</a>, <a href="https://github.com/mozilla/glean/pull/1062">#1062</a>).</li>
<li>DEPRECATION: <code>getUploadEnabled</code> is deprecated (respectively <code>get_upload_enabled</code> in Python) (<a href="https://github.com/mozilla/glean/pull/1046">#1046</a>)
<ul>
<li>Due to Glean's asynchronous initialization the return value can be incorrect.
Applications should not rely on Glean's internal state.
Upload enabled status should be tracked by the application and communicated to Glean if it changes.
Note: The method was removed from the C# and Python implementation.</li>
</ul>
</li>
<li>Update <code>glean_parser</code> to <code>v1.28.1</code>
<ul>
<li>The <code>glean_parser</code> linting was leading consumers astray by incorrectly suggesting that <code>deletion-request</code> be instead <code>deletion_request</code> when used for <code>send_in_pings</code>. This was causing metrics intended for the <code>deletion-request</code> ping to not be included when it was collected and submitted. Consumers that are sending metrics in the <code>deletion-request</code> ping will need to update the <code>send_in_pings</code> value in their metrics.yaml to correct this.</li>
<li>Fixes a bug in doc rendering.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3150-2020-07-22" id="v3150-2020-07-22">v31.5.0 (2020-07-22)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.4.1...v31.5.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Implement ping tagging (i.e. the <code>X-Source-Tags</code> header) (<a href="https://github.com/mozilla/glean/pull/1074">#1074</a>). Note that this is not yet implemented for iOS.</li>
<li>String values that are too long now record <code>invalid_overflow</code> rather than <code>invalid_value</code> through the Glean error reporting mechanism. This affects the string, event and string list metrics.</li>
<li><code>metrics.yaml</code> files now support a <code>data_sensitivity</code> field to all metrics for specifying the type of data collected in the field.</li>
</ul>
</li>
<li>Python
<ul>
<li>The Python unit tests no longer send telemetry to the production telemetry endpoint.</li>
<li>BUGFIX: If an <code>application_version</code> isn't provided to <code>Glean.initialize</code>, the <code>client_info.app_display_version</code> metric is set to <code>&quot;Unknown&quot;</code>, rather than resulting in invalid pings.</li>
</ul>
</li>
<li>Android
<ul>
<li>Allow defining which <code>Activity</code> to run next when using the <code>GleanDebugActivity</code>.</li>
</ul>
</li>
<li>iOS
<ul>
<li>BUGFIX: The memory unit is now correctly set on the <code>MemoryDistribution</code> metric type in Swift in generated metrics code.</li>
</ul>
</li>
<li>C#
<ul>
<li>Metrics can now be generated from the <code>metrics.yaml</code> files.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3141-2020-07-20" id="v3141-2020-07-20">v31.4.1 (2020-07-20)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.4.0...v31.4.1">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>BUGFIX: fix <code>int32</code> to <code>ErrorType</code> mapping. The <code>InvalidOverflow</code> had a value mismatch between glean-core and the bindings. This would only be a problem in unit tests. (<a href="https://github.com/mozilla/glean/pull/1063">#1063</a>)</li>
</ul>
</li>
<li>Android
<ul>
<li>Enable propagating options to the main product Activity when using the <code>GleanDebugActivity</code>.</li>
<li>BUGFIX: Fix the metrics ping collection for startup pings such as <code>reason=upgrade</code> to occur in the same thread/task as Glean initialize. Otherwise, it gets collected after the application lifetime metrics are cleared such as experiments that should be in the ping. (<a href="https://github.com/mozilla/glean/pull/1069">#1069</a>)</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3140-2020-07-16" id="v3140-2020-07-16">v31.4.0 (2020-07-16)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.3.0...v31.4.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Enable debugging features through environment variables. (<a href="https://github.com/mozilla/glean/pull/1058">#1058</a>)</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3130-2020-07-10" id="v3130-2020-07-10">v31.3.0 (2020-07-10)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.2.3...v31.3.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Remove locale from baseline ping. (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1609968">1609968</a>, <a href="https://github.com/mozilla/glean/pull/1016">#1016</a>)</li>
<li>Persist X-Debug-ID header on store ping. (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1605097">1605097</a>, <a href="https://github.com/mozilla/glean/pull/1042">#1042</a>)</li>
<li>BUGFIX: raise an error if Glean is initialized with an empty string as the <code>application_id</code> (<a href="https://github.com/mozilla/glean/pull/1043">#1043</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>BUGFIX: correctly set the <code>app_build</code> metric to the newly provided <code>application_build_id</code> initialization option (<a href="https://github.com/mozilla/glean/pull/1031">#1031</a>).</li>
<li>The Python bindings now report networking errors in the <code>glean.upload.ping_upload_failure</code> metric (like all the other bindings) (<a href="https://github.com/mozilla/glean/pull/1039">#1039</a>).</li>
<li>Python default upgraded to Python 3.8 (<a href="https://github.com/mozilla/glean/pull/995">#995</a>)</li>
</ul>
</li>
<li>iOS
<ul>
<li>BUGFIX: Make <code>LabeledMetric</code> subscript public, so consuming applications can actually access it (<a href="https://github.com/mozilla/glean/pull/1027">#1027</a>)</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3123-2020-06-29" id="v3123-2020-06-29">v31.2.3 (2020-06-29)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.2.2...v31.2.3">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Move debug view tag management to the Rust core. (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1640575">1640575</a>, <a href="https://github.com/mozilla/glean/pull/998">#998</a>)</li>
<li>BUGFIX: Fix mismatch in <code>event</code>s keys and values by using <code>glean_parser</code> version 1.23.0.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3122-2020-06-26" id="v3122-2020-06-26">v31.2.2 (2020-06-26)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.2.1...v31.2.2">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>BUGFIX: Compile dependencies with <code>NDEBUG</code> to avoid linking unavailable symbols.
This fixes a crash due to a missing <code>stderr</code> symbol on older Android (<a href="https://github.com/mozilla/glean/pull/1020">#1020</a>)</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3121-2020-06-25" id="v3121-2020-06-25">v31.2.1 (2020-06-25)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.2.0...v31.2.1">Full changelog</a></p>
<ul>
<li>Python
<ul>
<li>BUGFIX: Core metrics are now present in every ping, even if submit is called before initialize has a chance to complete. (<a href="https://github.com/mozilla/glean/pull/1012">#1012</a>)</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3120-2020-06-24" id="v3120-2020-06-24">v31.2.0 (2020-06-24)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.1.2...v31.2.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Add rate limiting capabilities to the upload manager. (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1543612">1543612</a>, <a href="https://github.com/mozilla/glean/pull/974">#974</a>)</li>
</ul>
</li>
<li>Android
<ul>
<li>BUGFIX: baseline pings with reason &quot;dirty startup&quot; are no longer sent if Glean did not full initialize in the previous run (<a href="https://github.com/mozilla/glean/pull/996">#996</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>Support for Python 3.5 was dropped (<a href="https://github.com/mozilla/glean/pull/987">#987</a>).</li>
<li>Python wheels are now shipped with Glean release builds, resulting in much smaller libraries (<a href="https://github.com/mozilla/glean/pull/1002">#1002</a>)</li>
<li>The Python bindings now use <code>locale.getdefaultlocale()</code> rather than <code>locale.getlocale()</code> to determine the locale (<a href="https://github.com/mozilla/glean/pull/1004">#1004</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3112-2020-06-23" id="v3112-2020-06-23">v31.1.2 (2020-06-23)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.1.1...v31.1.2">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>BUGFIX: Correctly format the date and time in the <code>Date</code> header (<a href="https://github.com/mozilla/glean/pull/993">#993</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>BUGFIX: Additional time is taken at shutdown to make sure pings are sent and telemetry is recorded. (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1646173">1646173</a>, <a href="https://github.com/mozilla/glean/pull/983">#983</a>)</li>
<li>BUGFIX: Glean will run on the main thread when running in a <code>multiprocessing</code> subprocess (<a href="https://github.com/mozilla/glean/pull/986">#986</a>).</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3111-2020-06-12" id="v3111-2020-06-12">v31.1.1 (2020-06-12)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.1.0...v31.1.1">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>Dropping the version requirement for lifecycle extensions down again. Upping the required version caused problems in A-C.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3110-2020-06-11" id="v3110-2020-06-11">v31.1.0 (2020-06-11)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.0.2...v31.1.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>The <code>regex</code> crate is no longer required, making the Glean binary smaller (<a href="https://github.com/mozilla/glean/pull/949">#949</a>)</li>
<li>Record upload failures into a new metric (<a href="https://github.com/mozilla/glean/pull/967">#967</a>)</li>
<li>Log FFI errors as actual errors (<a href="https://github.com/mozilla/glean/pull/935">#935</a>)</li>
<li>Limit the number of upload retries in all implementations (<a href="https://github.com/mozilla/glean/pull/953">#953</a>, <a href="https://github.com/mozilla/glean/pull/968">#968</a>)</li>
</ul>
</li>
<li>Python
<ul>
<li>Additional safety guarantees for applications that use Python <code>threading</code> (<a href="https://github.com/mozilla/glean/pull/962">#962</a>)</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3102-2020-05-29" id="v3102-2020-05-29">v31.0.2 (2020-05-29)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.0.1...v31.0.2">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>Fix list of included files in published crates</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3101-2020-05-29" id="v3101-2020-05-29">v31.0.1 (2020-05-29)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.0.0...v31.0.1">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>Relax version requirement for <code>flate2</code> for compatibility reasons</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3100-2020-05-28" id="v3100-2020-05-28">v31.0.0 (2020-05-28)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v30.1.0...v31.0.0">Full changelog</a></p>
<ul>
<li>
<p>General:</p>
<ul>
<li>The version of <code>glean_parser</code> has been upgraded to v1.22.0
<ul>
<li>A maximum of 10 <code>extra_keys</code> is now enforced for event metric types.</li>
<li><strong>Breaking change</strong>: (Swift only) Combine all metrics and pings into a single generated file Metrics.swift.
<ul>
<li>For Swift users this requires to change the list of output files for the <code>sdk_generator.sh</code> script.
It now only needs to include the single file <code>Generated/Metrics.swift</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Python:</p>
<ul>
<li>BUGFIX: <code>lifetime: application</code> metrics are no longer recorded as <code>lifetime: user</code>.</li>
<li>BUGFIX: glean-core is no longer crashing when calling <code>uuid.set</code> with invalid UUIDs.</li>
<li>Refactor the ping uploader to use the new upload mechanism and add gzip compression.</li>
<li>Most of the work in <code>Glean.initialize</code> happens on a worker thread and no longer blocks
the main thread.</li>
</ul>
</li>
<li>
<p>Rust:</p>
<ul>
<li>Expose <code>Datetime</code> types to Rust consumers.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3010-2020-05-22" id="v3010-2020-05-22">v30.1.0 (2020-05-22)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v30.0.0...v30.1.0">Full changelog</a></p>
<ul>
<li>Android &amp; iOS
<ul>
<li>Ping payloads are now compressed using gzip.</li>
</ul>
</li>
<li>iOS
<ul>
<li><code>Glean.initialize</code> is now a no-op if called from an embedded extension. This means that Glean will only run in the base application process in order to prevent extensions from behaving like separate applications with different client ids from the base application. Applications are responsible for ensuring that extension metrics are only collected within the base application.</li>
</ul>
</li>
<li>Python
<ul>
<li><code>lifetime: application</code> metrics are now cleared after the Glean-owned pings are sent,
after the product starts.</li>
<li>Glean Python bindings now build in a native Windows environment.</li>
<li>BUGFIX: <code>MemoryDistributionMetric</code> now parses correctly in <code>metrics.yaml</code> files.</li>
<li>BUGFIX: Glean will no longer crash if run as part of another library's coverage testing.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v3000-2020-05-13" id="v3000-2020-05-13">v30.0.0 (2020-05-13)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v29.1.0...v30.0.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>We completely replaced how the upload mechanism works.
glean-core (the Rust part) now controls all upload and coordinates the platform side with its own internals.
All language bindings implement ping uploading around a common API and protocol.
There is no change for users of Glean, the language bindings for Android and iOS have been adopted to the new mechanism already.</li>
<li>Expose <code>RecordedEvent</code> and <code>DistributionData</code> types to Rust consumers (<a href="https://github.com/mozilla/glean/pull/876">#876</a>)</li>
<li>Log crate version at initialize (<a href="https://github.com/mozilla/glean/pull/873">#873</a>)</li>
</ul>
</li>
<li>Android:
<ul>
<li>Refactor the ping uploader to use the new upload mechanism.</li>
</ul>
</li>
<li>iOS:
<ul>
<li>Refactor the ping uploader to use the new upload mechanism.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2912-2021-01-26" id="v2912-2021-01-26">v29.1.2 (2021-01-26)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v29.1.1...v29.1.2">Full changelog</a></p>
<p><strong>This is an iOS release only, built with Xcode 11.7</strong></p>
<p>Otherwise no functional changes.</p>
<ul>
<li>iOS
<ul>
<li>Build with Xcode 11.7 (<a href="https://github.com/mozilla/glean/pull/1457">#1457</a>)</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2911-2020-05-22" id="v2911-2020-05-22">v29.1.1 (2020-05-22)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v29.1.0...v29.1.1">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>BUGFIX: Fix a race condition that leads to a <code>ConcurrentModificationException</code>. <a href="https://bugzilla.mozilla.org/1635865">Bug 1635865</a></li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2910-2020-05-11" id="v2910-2020-05-11">v29.1.0 (2020-05-11)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v29.0.0...v29.1.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>The version of glean_parser has been upgraded to v1.20.4
<ul>
<li>BUGFIX: <code>yamllint</code> errors are now reported using the correct file name.</li>
</ul>
</li>
<li>The minimum and maximum values of a timing distribution can now be controlled by the <code>time_unit</code> parameter. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1630997">bug 1630997</a> for more details.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2900-2020-05-05" id="v2900-2020-05-05">v29.0.0 (2020-05-05)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v28.0.0...v29.0.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>The version of glean_parser has been upgraded to v1.20.2 (<a href="https://github.com/mozilla/glean/pull/827">#827</a>):
<ul>
<li><strong>Breaking change:</strong> glinter errors found during code generation will now return an error code.</li>
<li><code>glean_parser</code> now produces a linter warning when <code>user</code> lifetime metrics are set to expire. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1604854">bug 1604854</a> for additional context.</li>
</ul>
</li>
</ul>
</li>
<li>Android:
<ul>
<li>The <code>PingType.submit()</code> can now be called without a <code>null</code> by Java consumers (<a href="https://github.com/mozilla/glean/pull/853">#853</a>).</li>
</ul>
</li>
<li>Python:
<ul>
<li>BUGFIX: Fixed a race condition in the <code>atexit</code> handler, that would have resulted in the message &quot;No database found&quot; (<a href="https://github.com/mozilla/glean/pull/854">#854</a>).</li>
<li>The Glean FFI header is now parsed at build time rather than runtime. Relevant for packaging in <code>PyInstaller</code>, the wheel no longer includes <code>glean.h</code> and adds <code>_glean_ffi.py</code> (<a href="https://github.com/mozilla/glean/pull/852">#852</a>).</li>
<li>The minimum versions of many secondary dependencies have been lowered to make the Glean SDK compatible with more environments.</li>
<li>Dependencies that depend on the version of Python being used are now specified using the <a href="https://setuptools.readthedocs.io/en/latest/setuptools.html#declaring-platform-specific-dependencies">Declaring platform specific dependencies syntax in setuptools</a>. This means that more recent versions of dependencies are likely to be installed on Python 3.6 and later, and unnecessary backport libraries won't be installed on more recent Python versions.</li>
</ul>
</li>
<li>iOS:
<ul>
<li>Glean for iOS is now being built with Xcode 11.4.1 (<a href="https://github.com/mozilla/glean/pull/856">#856</a>)</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2800-2020-04-23" id="v2800-2020-04-23">v28.0.0 (2020-04-23)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v27.1.0...v28.0.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>The baseline ping is now sent when the application goes to foreground, in addition to background and dirty-startup.</li>
</ul>
</li>
<li>Python:
<ul>
<li>BUGFIX: The ping uploader will no longer display a trace back when the upload fails due to a failed DNS lookup, network outage, or related issues that prevent communication with the telemetry endpoint.</li>
<li>The dependency on <code>inflection</code> has been removed.</li>
<li>The Python bindings now use <code>subprocess</code> rather than <code>multiprocessing</code> to perform ping uploading in a separate process. This should be more compatible on all of the platforms Glean supports.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2710-2020-04-09" id="v2710-2020-04-09">v27.1.0 (2020-04-09)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v27.0.0...v27.1.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>BUGFIX: baseline pings sent at startup with the <code>dirty_startup</code> reason will now include application lifetime metrics (<a href="https://github.com/mozilla/glean/pull/810">#810</a>)</li>
</ul>
</li>
<li>iOS:
<ul>
<li><strong>Breaking change:</strong> Change Glean iOS to use Application Support directory <a href="https://github.com/mozilla/glean/pull/815">#815</a>. No migration code is included. This will reset collected data if integrated without migration. Please <a href="https://github.com/mozilla/glean#contact">contact the Glean SDK team</a> if this affects you.</li>
</ul>
</li>
<li>Python
<ul>
<li>BUGFIX: Fixed a race condition between uploading pings and deleting the temporary directory on shutdown of the process.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2700-2020-04-08" id="v2700-2020-04-08">v27.0.0 (2020-04-08)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v26.0.0...v27.0.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Glean will now detect when the upload enabled flag changes outside of the application, for example due to a change in a config file. This means that if upload is disabled while the application wasn't running (e.g. between the runs of a Python command using the Glean SDK), the database is correctly cleared and a deletion request ping is sent. See <a href="https://github.com/mozilla/glean/pull/791">#791</a>.</li>
<li>The <code>events</code> ping now includes a reason code: <code>startup</code>, <code>background</code> or <code>max_capacity</code>.</li>
</ul>
</li>
<li>iOS:
<ul>
<li>BUGFIX: A bug where the metrics ping is sent immediately at startup on the last day of the month has been fixed.</li>
<li>Glean for iOS is now being built with Xcode 11.4.0</li>
<li>The <code>measure</code> convenience function on timing distributions and time spans will now cancel the timing if the measured function throws, then rethrow the exception (<a href="https://github.com/mozilla/glean/pull/808">#808</a>)</li>
<li>Broken doc generation has been fixed (<a href="https://github.com/mozilla/glean/pull/805">#805</a>).</li>
</ul>
</li>
<li>Kotlin
<ul>
<li>The <code>measure</code> convenience function on timing distributions and time spans will now cancel the timing if the measured function throws, then rethrow the exception (<a href="https://github.com/mozilla/glean/pull/808">#808</a>)</li>
</ul>
</li>
<li>Python:
<ul>
<li>Glean will now wait at application exit for up to one second to let its worker thread complete.</li>
<li>Ping uploading now happens in a separate child process by default. This can be disabled with the <code>allow_multiprocessing</code> configuration option.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2600-2020-03-27" id="v2600-2020-03-27">v26.0.0 (2020-03-27)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v25.1.0...v26.0.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>The version of <code>glean_parser</code> has been updated to 1.19.0:
<ul>
<li><strong>Breaking change:</strong> The regular expression used to validate labels is
stricter and more correct.</li>
<li>Add more information about pings to markdown documentation:
<ul>
<li>State whether the ping includes client id;</li>
<li>Add list of data review links;</li>
<li>Add list of related bugs links.</li>
</ul>
</li>
<li><code>glean_parser</code> now makes it easier to write external translation functions for
different language targets.</li>
<li>BUGFIX: glean_parser now works on 32-bit Windows.</li>
</ul>
</li>
</ul>
</li>
<li>Android:
<ul>
<li><code>gradlew clean</code> will no longer remove the Miniconda installation in
<code>~/.gradle/glean</code>. Therefore <code>clean</code> can be used without reinstalling
Miniconda afterward every time.</li>
</ul>
</li>
<li>Python:
<ul>
<li><strong>Breaking Change</strong>: The <code>glean.util</code> and <code>glean.hardware</code> modules, which
were unintentionally public, have been made private.</li>
<li>Most Glean work and I/O is now done on its own worker thread. This brings the parallelism Python in line with the other platforms.</li>
<li>The timing distribution, memory distribution, string list, labeled boolean and labeled string metric types are now supported in Python (<a href="https://github.com/mozilla/glean/pull/762">#762</a>, <a href="https://github.com/mozilla/glean/pull/763">#763</a>, <a href="https://github.com/mozilla/glean/pull/765">#765</a>, <a href="https://github.com/mozilla/glean/pull/766">#766</a>)</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2510-2020-02-26" id="v2510-2020-02-26">v25.1.0 (2020-02-26)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v25.0.0...v25.1.0">Full changelog</a></p>
<ul>
<li>Python:
<ul>
<li>The Boolean, Datetime and Timespan metric types are now supported in Python (<a href="https://github.com/mozilla/glean/pull/731">#731</a>, <a href="https://github.com/mozilla/glean/pull/732">#732</a>, <a href="https://github.com/mozilla/glean/pull/737">#737</a>)</li>
<li>Make public, document and test the debugging features (<a href="https://github.com/mozilla/glean/pull/733">#733</a>)</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2500-2020-02-17" id="v2500-2020-02-17">v25.0.0 (2020-02-17)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v24.2.0...v25.0.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li><code>ping_type</code> is not included in the <code>ping_info</code> any more (<a href="https://github.com/mozilla/glean/pull/653">#653</a>), the pipeline takes the value from the submission URL.</li>
<li>The version of <code>glean_parser</code> has been upgraded to 1.18.2:
<ul>
<li><strong>Breaking Change (Java API)</strong> Have the metrics names in Java match the names in Kotlin.
See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1588060">Bug 1588060</a>.</li>
<li>The reasons a ping are sent are now included in the generated markdown documentation.</li>
</ul>
</li>
</ul>
</li>
<li>Android:
<ul>
<li>The <code>Glean.initialize</code> method runs mostly off the main thread (<a href="https://github.com/mozilla/glean/pull/672">#672</a>).</li>
<li>Labels in labeled metrics now have a correct, and slightly stricter, regular expression.
See <a href="https://mozilla.github.io/glean/user/metrics/index.html#label-format">label format</a> for more information.</li>
</ul>
</li>
<li>iOS:
<ul>
<li>The baseline ping will now include <code>reason</code> codes that indicate why it was
submitted. If an unclean shutdown is detected (e.g. due to force-close), this
ping will be sent at startup with <code>reason: dirty_startup</code>.</li>
<li>Per <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1614785">Bug 1614785</a>, the
clearing of application lifetime metrics now occurs after the metrics ping is
sent in order to preserve values meant to be included in the startup metrics
ping.</li>
<li><code>initialize()</code> now performs most of its work in a background thread.</li>
</ul>
</li>
<li>Python:
<ul>
<li>When the pre-init task queue overruns, this is now recorded in the metric
<code>glean.error.preinit_tasks_overflow</code>.</li>
<li>glinter warnings are printed to <code>stderr</code> when loading <code>metrics.yaml</code> and
<code>pings.yaml</code> files.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2420-2020-02-11" id="v2420-2020-02-11">v24.2.0 (2020-02-11)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v24.1.0...v24.2.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>Add <code>locale</code> to <code>client_info</code> section.</li>
<li><strong>Deprecation Warning</strong> Since <code>locale</code> is now in the <code>client_info</code> section, the one
in the baseline ping (<a href="https://github.com/mozilla/glean/blob/c261205d6e84d2ab39c50003a8ffc3bd2b763768/glean-core/metrics.yaml#L28-L42"><code>glean.baseline.locale</code></a>)
is redundant and will be removed by the end of the quarter.</li>
<li>Drop the Glean handle and move state into glean-core (<a href="https://github.com/mozilla/glean/pull/664">#664</a>)</li>
<li>If an experiment includes no <code>extra</code> fields, it will no longer include <code>{&quot;extra&quot;: null}</code> in the JSON payload.</li>
<li>Support for ping <code>reason</code> codes was added.</li>
<li>The metrics ping will now include <code>reason</code> codes that indicate why it was
submitted.</li>
<li>The version of <code>glean_parser</code> has been upgraded to 1.17.3</li>
</ul>
</li>
<li>Android:
<ul>
<li>Collections performed before initialization (preinit tasks) are now dispatched off
the main thread during initialization.</li>
<li>The baseline ping will now include <code>reason</code> codes that indicate why it was
submitted. If an unclean shutdown is detected (e.g. due to force-close), this
ping will be sent at startup with <code>reason: dirty_startup</code>.</li>
</ul>
</li>
<li>iOS:
<ul>
<li>Collections performed before initialization (preinit tasks) are now dispatched off
the main thread and not awaited during initialization.</li>
<li>Added recording of <code>glean.error.preinit_tasks_overflow</code> to report when
the preinit task queue overruns, leading to data loss. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1609734">bug
1609734</a></li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2410-2020-01-16" id="v2410-2020-01-16">v24.1.0 (2020-01-16)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v24.0.0...v24.1.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>Stopping a non started measurement in a timing distribution will now be reported
as an <code>invalid_state</code> error.</li>
</ul>
</li>
<li>Android:
<ul>
<li>A new metric <code>glean.error.preinit_tasks_overflow</code> was added to report when
the preinit task queue overruns, leading to data loss. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1609482">bug
1609482</a></li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2400-2020-01-14" id="v2400-2020-01-14">v24.0.0 (2020-01-14)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v23.0.1...v24.0.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li><strong>Breaking Change</strong> An <code>enableUpload</code> parameter has been added to the <code>initialize()</code>
function. This removes the requirement to call <code>setUploadEnabled()</code> prior to calling
the <code>initialize()</code> function.</li>
</ul>
</li>
<li>Android:
<ul>
<li>The metrics ping scheduler will now only send metrics pings while the
application is running. The application will no longer &quot;wake up&quot; at 4am
using the Work Manager.</li>
<li>The code for migrating data from Glean SDK before version 19 was removed.</li>
<li>When using the <code>GleanTestLocalServer</code> rule in instrumented tests, pings are
immediately flushed by the <code>WorkManager</code> and will reach the test endpoint as
soon as possible.</li>
</ul>
</li>
<li>Python:
<ul>
<li>The Python bindings now support Python 3.5 - 3.7.</li>
<li>The Python bindings are now distributed as a wheel on Linux, macOS and
Windows.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2301-2020-01-08" id="v2301-2020-01-08">v23.0.1 (2020-01-08)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v23.0.0...v23.0.1">Full changelog</a></p>
<ul>
<li>Android:
<ul>
<li>BUGFIX: The Glean Gradle plugin will now work if an app or library doesn't
have a metrics.yaml or pings.yaml file.</li>
</ul>
</li>
<li>iOS:
<ul>
<li>The released iOS binaries are now built with Xcode 11.3.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2300-2020-01-07" id="v2300-2020-01-07">v23.0.0 (2020-01-07)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v22.1.0...v23.0.0">Full changelog</a></p>
<ul>
<li>Python bindings:
<ul>
<li>Support for events and UUID metrics was added.</li>
</ul>
</li>
<li>Android:
<ul>
<li>The Glean Gradle Plugin correctly triggers docs and API updates when registry files
change, without requiring them to be deleted.</li>
<li><code>parseISOTimeString</code> has been made 4x faster. This had an impact on Glean
migration and initialization.</li>
<li>Metrics with <code>lifetime: application</code> are now cleared when the application is started,
after startup Glean SDK pings are generated.</li>
</ul>
</li>
<li>All platforms:
<ul>
<li>The public method <code>PingType.send()</code> (in all platforms) have been deprecated
and renamed to <code>PingType.submit()</code>.</li>
<li>Rename <code>deletion_request</code> ping to <code>deletion-request</code> ping after glean_parser update</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2210-2019-12-17" id="v2210-2019-12-17">v22.1.0 (2019-12-17)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v22.0.0...v22.1.0">Full changelog</a></p>
<ul>
<li>Add <code>InvalidOverflow</code> error to <code>TimingDistribution</code>s (<a href="https://github.com/mozilla/glean/pull/583">#583</a>)</li>
</ul>
<h1><a class="header" href="#v2200-2019-12-05" id="v2200-2019-12-05">v22.0.0 (2019-12-05)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v21.3.0...v22.0.0">Full changelog</a></p>
<ul>
<li>Add option to defer ping lifetime metric persistence (<a href="https://github.com/mozilla/glean/pull/530">#530</a>)</li>
<li>Add a crate for the nice control API (<a href="https://github.com/mozilla/glean/pull/542">#542</a>)</li>
<li>Pending <code>deletion_request</code> pings are resent on start (<a href="https://github.com/mozilla/glean/pull/545">#545</a>)</li>
</ul>
<h1><a class="header" href="#v2130-2019-12-03" id="v2130-2019-12-03">v21.3.0 (2019-12-03)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v21.2.0...v21.3.0">Full changelog</a></p>
<ul>
<li>Timers are reset when disabled. That avoids recording timespans across disabled/enabled toggling (<a href="https://github.com/mozilla/glean/pull/495">#495</a>).</li>
<li>Add a new flag to pings: <code>send_if_empty</code> (<a href="https://github.com/mozilla/glean/pull/528">#528</a>)</li>
<li>Upgrade <code>glean_parser</code> to v1.12.0</li>
<li>Implement the deletion request ping in Glean (<a href="https://github.com/mozilla/glean/pull/526">#526</a>)</li>
</ul>
<h1><a class="header" href="#v2120-2019-11-21" id="v2120-2019-11-21">v21.2.0 (2019-11-21)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v21.1.1...v21.2.0">Full changelog</a></p>
<ul>
<li>
<p>All platforms</p>
<ul>
<li>
<p>The experiments API is no longer ignored before the Glean SDK initialized. Calls are
recorded and played back once the Glean SDK is initialized.</p>
</li>
<li>
<p>String list items were being truncated to 20, rather than 50, bytes when using
<code>.set()</code> (rather than <code>.add()</code>). This has been corrected, but it may result
in changes in the sent data if using string list items longer than 20 bytes.</p>
</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2111-2019-11-20" id="v2111-2019-11-20">v21.1.1 (2019-11-20)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v21.1.0...v21.1.1">Full changelog</a></p>
<ul>
<li>
<p>Android:</p>
<ul>
<li>Use the <code>LifecycleEventObserver</code> interface, rather than the <code>DefaultLifecycleObserver</code>
interface, since the latter isn't compatible with old SDK targets.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2110-2019-11-20" id="v2110-2019-11-20">v21.1.0 (2019-11-20)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v21.0.0...v21.1.0">Full changelog</a></p>
<ul>
<li>
<p>Android:</p>
<ul>
<li>
<p>Two new metrics were added to investigate sending of metrics and baseline pings.
See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1597980">bug 1597980</a> for more information.</p>
</li>
<li>
<p>Glean's two lifecycle observers were refactored to avoid the use of reflection.</p>
</li>
</ul>
</li>
<li>
<p>All platforms:</p>
<ul>
<li>Timespans will now not record an error if stopping after setting upload enabled to false.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2100-2019-11-18" id="v2100-2019-11-18">v21.0.0 (2019-11-18)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v20.2.0...v21.0.0">Full changelog</a></p>
<ul>
<li>
<p>Android:</p>
<ul>
<li>
<p>The <code>GleanTimerId</code> can now be accessed in Java and is no longer a <code>typealias</code>.</p>
</li>
<li>
<p>Fixed a bug where the metrics ping was getting scheduled twice on startup.</p>
</li>
</ul>
</li>
<li>
<p>All platforms</p>
<ul>
<li>Bumped <code>glean_parser</code> to version 1.11.0.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#v2020-2019-11-11" id="v2020-2019-11-11">v20.2.0 (2019-11-11)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v20.1.0...v20.2.0">Full changelog</a></p>
<ul>
<li>In earlier 20.x.x releases, the version of glean-ffi was incorrectly built
against the wrong version of glean-core.</li>
</ul>
<h1><a class="header" href="#v2010-2019-11-11" id="v2010-2019-11-11">v20.1.0 (2019-11-11)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v20.0.0...v20.1.0">Full changelog</a></p>
<ul>
<li>
<p>The version of Glean is included in the Glean Gradle plugin.</p>
</li>
<li>
<p>When constructing a ping, events are now sorted by their timestamp. In practice,
it rarely happens that event timestamps are unsorted to begin with, but this
guards against a potential race condition and incorrect usage of the lower-level
API.</p>
</li>
</ul>
<h1><a class="header" href="#v2000-2019-11-11" id="v2000-2019-11-11">v20.0.0 (2019-11-11)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v19.1.0...v20.0.0">Full changelog</a></p>
<ul>
<li>
<p>Glean users should now use a Gradle plugin rather than a Gradle script. (#421)
See <a href="https://mozilla.github.io/glean/book/user/adding-glean-to-your-project.html#integrating-with-the-build-system">integrating with the build system docs</a> for more information.</p>
</li>
<li>
<p>In Kotlin, metrics that can record errors now have a new testing method,
<code>testGetNumRecordedErrors</code>. (#401)</p>
</li>
</ul>
<h1><a class="header" href="#v1910-2019-10-29" id="v1910-2019-10-29">v19.1.0 (2019-10-29)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v19.0.0...v19.1.0">Full changelog</a></p>
<ul>
<li>Fixed a crash calling <code>start</code> on a timing distribution metric before Glean is initialized.
Timings are always measured, but only recorded when upload is enabled (<a href="https://github.com/mozilla/glean/pull/400">#400</a>)</li>
<li>BUGFIX: When the Debug Activity is used to log pings, each ping is now logged only once (<a href="https://github.com/mozilla/glean/pull/407">#407</a>)</li>
<li>New <code>invalid state</code> error, used in timespan recording (<a href="https://github.com/mozilla/glean/pull/230">#230</a>)</li>
<li>Add an Android crash instrumentation walk-through (<a href="https://github.com/mozilla/glean/pull/399">#399</a>)</li>
<li>Fix crashing bug by avoiding assert-printing in LMDB (<a href="https://github.com/mozilla/glean/pull/422">#422</a>)</li>
<li>Upgrade dependencies, including rkv (<a href="https://github.com/mozilla/glean/pull/416">#416</a>)</li>
</ul>
<h1><a class="header" href="#v1900-2019-10-22" id="v1900-2019-10-22">v19.0.0 (2019-10-22)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v0.0.1-TESTING6...v19.0.0">Full changelog</a></p>
<p>First stable release of Glean in Rust (aka glean-core).
This is a major milestone in using a cross-platform implementation of Glean on the Android platform.</p>
<ul>
<li>Fix round-tripping of timezone offsets in dates (<a href="https://github.com/mozilla/glean/pull/392">#392</a>)</li>
<li>Handle dynamic labels in coroutine tasks (<a href="https://github.com/mozilla/glean/pull/384">#394</a>)</li>
</ul>
<h1><a class="header" href="#v001-testing6-2019-10-18" id="v001-testing6-2019-10-18">v0.0.1-TESTING6 (2019-10-18)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v0.0.1-TESTING5...v0.0.1-TESTING6">Full changelog</a></p>
<ul>
<li>Ignore dynamically stored labels if Glean is not initialized (<a href="https://github.com/mozilla/glean/pull/374">#374</a>)</li>
<li>Make sure ProGuard doesn't remove Glean classes from the app (<a href="https://github.com/mozilla/glean/pull/380">#380</a>)</li>
<li>Keep track of pings in all modes (<a href="https://github.com/mozilla/glean/pull/378">#378</a>)</li>
<li>Add <code>jnaTest</code> dependencies to the <code>forUnitTest</code> JAR (<a href="https://github.com/mozilla/glean/pull/382">#382</a>)</li>
</ul>
<h1><a class="header" href="#v001-testing5-2019-10-10" id="v001-testing5-2019-10-10">v0.0.1-TESTING5 (2019-10-10)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v0.0.1-TESTING4...v0.0.1-TESTING5">Full changelog</a></p>
<ul>
<li>Upgrade to NDK r20 (<a href="https://github.com/mozilla/glean/pull/365">#365</a>)</li>
</ul>
<h1><a class="header" href="#v001-testing4-2019-10-09" id="v001-testing4-2019-10-09">v0.0.1-TESTING4 (2019-10-09)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v0.0.1-TESTING3...v0.0.1-TESTING4">Full changelog</a></p>
<ul>
<li>Take DST into account when converting a calendar into its items (<a href="https://github.com/mozilla/glean/pull/359">#359</a>)</li>
<li>Include a macOS library in the <code>forUnitTests</code> builds (<a href="https://github.com/mozilla/glean/pull/358">#358</a>)</li>
<li>Keep track of all registered pings in test mode (<a href="https://github.com/mozilla/glean/pull/363">#363</a>)</li>
</ul>
<h1><a class="header" href="#v001-testing3-2019-10-08" id="v001-testing3-2019-10-08">v0.0.1-TESTING3 (2019-10-08)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v0.0.1-TESTING2...v0.0.1-TESTING3">Full changelog</a></p>
<ul>
<li>Allow configuration of Glean through the <code>GleanTestRule</code></li>
<li>Bump <code>glean_parser</code> version to 1.9.2</li>
</ul>
<h1><a class="header" href="#v001-testing2-2019-10-07" id="v001-testing2-2019-10-07">v0.0.1-TESTING2 (2019-10-07)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v0.0.1-TESTING1...v0.0.1-TESTING2">Full changelog</a></p>
<ul>
<li>Include a Windows library in the <code>forUnitTests</code> builds</li>
</ul>
<h1><a class="header" href="#v001-testing1-2019-10-02" id="v001-testing1-2019-10-02">v0.0.1-TESTING1 (2019-10-02)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/95b6bcc03616c8d7c3e3e64e99ee9953aa06a474...v0.0.1-TESTING1">Full changelog</a></p>
<h3><a class="header" href="#general" id="general">General</a></h3>
<p>First testing release.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/appendix/changelog.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#this-week-in-glean-twig-1" id="this-week-in-glean-twig-1">This Week in Glean (TWiG)</a></h1>
<p>“This Week in Glean” is a series of blog posts that the Glean Team at Mozilla is using to try to communicate better about our work.
They could be release notes, documentation, hopes, dreams, or whatever: so long as it is inspired by Glean.</p>
<h2><a class="header" href="#blog-posts" id="blog-posts">Blog posts</a></h2>
<ul>
<li>2019-10-17: <a href="https://chuttenblog.wordpress.com/2019/10/17/this-week-in-glean-glean-on-desktop-project-fog/">Glean on Desktop (Project FOG)</a></li>
<li>2019-10-24: <a href="https://fnordig.de/2019/10/24/this-week-in-glean/">A Release</a></li>
<li>2019-11-01: <a href="http://droettboom.com/blog/2019/11/01/this-week-in-glean-november-1-2019/">A detective story</a></li>
<li>2019-11-08: <a href="https://blogoftravis.wordpress.com/2019/11/08/this-week-in-glean-2019-11-08/">Instrumenting Android Crashes with Glean</a></li>
<li>2019-11-19: <a href="https://www.a2p.it/wordpress/tech-stuff/mozilla/geckoview-glean-fenix-performance-metrics/">GeckoView + Glean = Fenix performance metrics</a></li>
<li>2019-11-21: <a href="https://dianaciufo.wordpress.com/2019/10/11/glean-graphic-identity-for-mozilla-firefox/">What is the Glean logo about?</a></li>
<li>2019-11-22: <a href="https://chuttenblog.wordpress.com/2019/11/22/this-week-in-glean-glean-in-private/">Glean in Private</a></li>
<li>2019-11-29: <a href="https://fnordig.de/2019/11/29/this-week-in-glean/">Differences</a></li>
<li>2019-12-06: <a href="https://brizental.github.io/2019/12/06/this-week-in-glean-migrations.html">Migrations</a></li>
<li>2020-01-10: <a href="https://brizental.github.io/2020/01/10/this-week-in-glean-glossary.html">Glossary</a></li>
<li>2020-02-03: <a href="https://fnordig.de/2020/02/03/this-week-in-glean/">Cargo features - an investigation</a></li>
<li>2020-02-14: <a href="https://www.a2p.it/wordpress/tech-stuff/mozilla/extending-glean-build-re-usable-types-for-new-use-cases/">Extending Glean: build re-usable types for new use-cases</a></li>
<li>2020-02-21: <a href="https://chuttenblog.wordpress.com/2020/02/21/this-week-in-glean-a-distributed-team-echoes-distributed-workflow/">A Distributed Team Echoes Distributed Workflow</a></li>
<li>2020-02-28: <a href="https://wlach.github.io/blog/2020/02/this-week-in-glean-special-guest-post-mozregression-telemetry-part-1/">mozregression telemetry (part 1)</a></li>
<li>2020-03-09: <a href="https://blog.mozilla.org/data/2020/03/09/this-week-in-glean-metric-lifetimes/">Metric lifetimes</a></li>
<li>2020-03-13: <a href="https://blog.mozilla.org/data/2020/03/13/this-week-in-glean-adding-support-for-glam-on-glean/">Adding support for GLAM on Glean</a></li>
<li>2020-03-25: <a href="https://blog.mozilla.org/data/2020/03/25/this-week-in-glean-comparing-apples-to-oranges/">Comparing Apples to Oranges</a></li>
<li>2020-04-15: <a href="https://chuttenblog.wordpress.com/2020/04/15/this-week-in-glean-how-much-does-that-data-cost/">How Much Does That Data Cost</a></li>
<li>2020-04-27: <a href="https://blog.mozilla.org/data/2020/04/27/this-week-in-glean-glean-for-python-on-windows/">Glean for Python on Windows</a></li>
<li>2020-05-04: <a href="https://fnordig.de/2020/05/04/this-week-in-glean/">Bytes in Memory (on Android)</a></li>
<li>2020-05-08: <a href="https://wlach.github.io/blog/2020/05/this-week-in-glean-mozregression-telemetry-part-2/">mozregression telemetry (part 2)</a></li>
<li>2020-05-26: <a href="https://blog.mozilla.org/data/2020/05/26/how-does-the-glean-sdk-send-gzipped-pings/">How does the Glean SDK send gzipped pings</a></li>
<li>2020-06-03: <a href="https://blog.mozilla.org/data/2020/06/03/this-week-in-glean-the-glean-sdk-and-ios-application-extensions-or-a-tale-of-two-sandboxes/">The Glean SDK and iOS Application Extensions, or a Tale of Two Sandboxes</a></li>
<li>2020-06-12: <a href="https://blog.mozilla.org/data/2020/06/12/this-week-in-glean-project-fog-update-end-of-h12020/">Project FOG Update, end of H12020</a></li>
<li>2020-07-16: <a href="https://blog.mozilla.org/data/2020/07/16/mozilla-telemetry-in-2020-from-just-firefox-to-a-galaxy-of-data/">Mozilla Telemetry in 2020: From “Just Firefox” to a “Galaxy of Data”</a></li>
<li>2020-07-24: <a href="https://blog.mozilla.org/data/2020/07/24/this-week-in-glean-automated-end-to-end-tests-for-glean/">Automated end-to-end tests for Glean</a></li>
<li>2020-08-06: <a href="https://blog.mozilla.org/data/2020/08/06/experimental-integration-glean-with-unity-applications/">Experimental integration Glean with Unity applications</a></li>
<li>2020-09-01: <a href="https://blog.mozilla.org/data/2020/09/01/twig-leveraging-rust/">Leveraging Rust to build cross-platform mobile libraries</a></li>
<li>2020-09-25: <a href="https://blog.mozilla.org/data/2020/09/25/this-week-in-glean-glean-core-to-wasm-experiment/">glean-core to Wasm experiment</a></li>
<li>2020-10-06: <a href="https://blog.mozilla.org/data/2020/10/06/this-week-in-glean-fog-progress-report/">FOG Progress report</a></li>
<li>2020-10-21: <a href="https://blog.mozilla.org/data/2020/10/21/this-week-in-glean-cross-platform-language-binding-generation-with-rust-and-uniffi/">Cross-Platform Language Binding Generation with Rust and “uniffi”</a></li>
<li>2020-11-02: <a href="https://blog.mozilla.org/data/2020/11/02/this-week-in-glean-glean-js/">Glean.js</a></li>
<li>2020-11-19: <a href="https://blog.mozilla.org/data/2020/11/19/this-week-in-glean-fantastic-facts-and-where-to-find-them/">Fantastic Facts and Where To Find Them</a></li>
<li>2020-12-01: <a href="https://blog.mozilla.org/data/2020/12/01/this-week-in-glean-glean-is-frictionless-data-collection/">Glean is Frictionless Data Collection</a></li>
<li>2020-12-18: <a href="https://fnordig.de/2020/12/18/glean-in-2021/">Glean in 2021</a></li>
<li>2021-01-15: <a href="https://blog.mozilla.org/data/2021/01/15/this-week-in-glean-proposals-for-asynchronous-design/">Proposals for Asynchronous Design</a></li>
<li>2021-01-28: <a href="https://blog.mozilla.org/data/2021/01/27/this-week-in-glean-the-glean-dictionary/">The Glean Dictionary</a></li>
<li>2021-02-24: <a href="https://blog.mozilla.org/data/2021/02/24/this-week-in-glean-boring-monitoring/">Boring Monitoring</a></li>
<li>2021-03-16: <a href="https://blog.mozilla.org/data/2021/03/16/this-week-in-glean-reducing-release-friction/">Reducing Release Friction</a></li>
<li>2021-04-07: <a href="https://blog.mozilla.org/data/2021/04/07/this-week-in-glean-publishing-glean-js/">Publishing Glean.js or “How I configured an npm package that has multiple entry points”</a></li>
<li>2021-04-16: <a href="https://blog.mozilla.org/data/2021/04/16/this-week-in-glean-rustc-ios-and-an-m1/">rustc, iOS and an M1</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/appendix/twig.md">Edit this file on GitHub.</a></footer><h1><a class="header" href="#contribution-guidelines" id="contribution-guidelines">Contribution Guidelines</a></h1>
<p>There are two important questions to answer before adding new content to this book:</p>
<ul>
<li>Where to include this content?</li>
<li>In which format to present it?</li>
</ul>
<p>This guide aims to provide context for answering both questions.</p>
<h2><a class="header" href="#table-of-contents-2" id="table-of-contents-2">Table of contents</a></h2>
<ul>
<li><a href="appendix/contribution-guidelines.html#where-to-add-new-content">Where to add new content?</a>
<ul>
<li><a href="appendix/contribution-guidelines.html#overview">Overview</a></li>
<li><a href="appendix/contribution-guidelines.html#user-guides">User Guides</a></li>
<li><a href="appendix/contribution-guidelines.html#api-reference">API Reference</a></li>
<li><a href="appendix/contribution-guidelines.html#language-binding-information">Language Binding Information</a></li>
<li><a href="appendix/contribution-guidelines.html#appendix">Appendix</a></li>
</ul>
</li>
<li><a href="appendix/contribution-guidelines.html#in-which-format-to-present-content">In which format to present content?</a>
<ul>
<li><a href="appendix/contribution-guidelines.html#general-guidelines">General guidelines</a>
<ul>
<li><a href="appendix/contribution-guidelines.html#link-to-other-internal-pages-and-sections-whenever-that-is-possible">Link to other internal pages and sections whenever that is possible</a></li>
<li><a href="appendix/contribution-guidelines.html#prefer-using-headers-whenever-a-new-topic-is-introduced">Prefer using headers whenever a new topic is introduced</a></li>
<li><a href="appendix/contribution-guidelines.html#favor-creating-new-pages-instead-of-adding-unrelated-content-to-an-already-existing-page">Favor creating new pages, instead of adding unrelated content to an already existing page</a></li>
</ul>
</li>
<li><a href="appendix/contribution-guidelines.html#custom-elements">Custom elements</a>
<ul>
<li><a href="appendix/contribution-guidelines.html#tabs">Tabs</a></li>
<li><a href="appendix/contribution-guidelines.html#custom-block-quotes">Custom block quotes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><a class="header" href="#where-to-add-new-content" id="where-to-add-new-content">Where to add new content?</a></h2>
<p>This book is divided in five different sections. Each section contains pages that are of a specific
type. New content will fit in one of these section. Following is an explanation on what kind of content
fits in each section.</p>
<h3><a class="header" href="#overview" id="overview">Overview</a></h3>
<p><em>Is the content you want to add an essay or high level explanation on some aspect of Glean?</em></p>
<p>The overview section is the place to provide important higher level context for
users of Glean. This section may include essays about Glean’s views, principles,
data practices, etc. It also contains primers on information such as what is the Glean
SDK and Glean.js.</p>
<h3><a class="header" href="#user-guides" id="user-guides">User Guides</a></h3>
<p><em>Is the content you want to add a general purpose guide on a Glean aspect or feature?</em></p>
<p>This section is the place for Glean SDK user guides. Pages under this section
contain prose format guides on how to include Glean in a project, how to add metrics,
how to create pings, and so on.</p>
<p>Pages on this section may link to the API Reference pages, but should not
themselves be API References.</p>
<p>Guides can be quite long, thus we should favor having one page per language binding instead
of using tabs.</p>
<h3><a class="header" href="#api-reference" id="api-reference">API Reference</a></h3>
<p><em>Is the content you want to add a developer reference on a specific Glean API?</em></p>
<p>This section of the book contains reference for all of Glean’s user APIs.
Its pages follow a strict structure.</p>
<p>Each API description contains:</p>
<ul>
<li>A title with the name of the API.
<ul>
<li>It’s important to use titles, because they automatically generate links to that API.</li>
</ul>
</li>
<li>A brief description of what the API does.</li>
<li>Tabs with examples for using that API in each language binding.
<ul>
<li>Even if a certain language binding do not contain a given API, the tab will be included in
the tabs bar in the disabled state.</li>
</ul>
</li>
</ul>
<p>The API Reference pages should not contain any guides in prose format, they should all be linked from the User’s Guide when convenient.</p>
<h3><a class="header" href="#language-binding-information" id="language-binding-information">Language Binding Information</a></h3>
<p><em>Is the content you want to add a language binding specific guide on a Glean feature?</em></p>
<p>Language bindings may require some dedicated pages, these section contains these pages.
Each language binding has a top level section under this section, specific pages live
under these titles.</p>
<h3><a class="header" href="#appendix-1" id="appendix-1">Appendix</a></h3>
<p><em>Is the content you want to add support content for the rest of the content on book?</em></p>
<p>The appendix contains support information related to the Glean SDK or the content of this book.</p>
<h2><a class="header" href="#in-which-format-to-present-content" id="in-which-format-to-present-content">In which format to present content?</a></h2>
<h3><a class="header" href="#general-guidelines" id="general-guidelines">General guidelines</a></h3>
<h4><a class="header" href="#link-to-other-internal-pages-and-sections-whenever-that-is-possible" id="link-to-other-internal-pages-and-sections-whenever-that-is-possible">Link to other internal pages and sections whenever that is possible</a></h4>
<p>Each page of the book should be written as if it were the first page a user is visiting ever.
There should be links to other pages of the book wherever there is missing context in the
current page. This is important, because documentations are first and foremost reference books,
manuals. They should not be expected to be read in order.</p>
<h4><a class="header" href="#prefer-using-headers-whenever-a-new-topic-is-introduced" id="prefer-using-headers-whenever-a-new-topic-is-introduced">Prefer using headers whenever a new topic is introduced</a></h4>
<p><a href="https://rust-lang.github.io/mdBook/index.html">mdbook</a> (the tool used to build this book) turns
all headers into links. Which is useful to refer to specific documentation sections.</p>
<h4><a class="header" href="#favor-creating-new-pages-instead-of-adding-unrelated-content-to-an-already-existing-page" id="favor-creating-new-pages-instead-of-adding-unrelated-content-to-an-already-existing-page">Favor creating new pages, instead of adding unrelated content to an already existing page</a></h4>
<p>This makes it easier to find content through the Summary.</p>
<h3><a class="header" href="#custom-elements" id="custom-elements">Custom elements</a></h3>
<h4><a class="header" href="#tabs" id="tabs">Tabs</a></h4>
<p>Tabs are useful for providing small code examples of Glean's APIs for each language binding.
A tabs section starts with the <code>tab_header</code> <a href="https://rust-lang.github.io/mdBook/format/mdbook.html#including-files">include</a> and ends with the <code>tab_footer</code> <a href="https://rust-lang.github.io/mdBook/format/mdbook.html#including-files">include</a>.
Each tab is declared in between these <a href="https://rust-lang.github.io/mdBook/format/mdbook.html#including-files">include</a> statements.</p>
<p>Each tab content is placed inside an html <code>div</code> tag with the <code>data-lang</code> and <code>class=&quot;tab&quot;</code> attributes.
The <code>data-lang</code> attribute contains the title of the tab. Titles must match for different tabs on the
same language binding. Whenever a user clicks in a tab with a specific title, all tabs with that same
title will be opened by default, until the user clicks in a tab with a different title.</p>
<p>Every tab section contains tabs for each Glean language binding, even that language binding does not
provide the API in question. In this case, the tab div is still there without any inner HTML. When
that is the case that tab will be rendered in a disabled state.</p>
<p>Each tab section contains tabs for the following language bindings:</p>
<ul>
<li>Kotlin</li>
<li>Java</li>
<li>Swift</li>
<li>Python</li>
<li>Rust</li>
<li>Javascript</li>
<li>Firefox Desktop</li>
</ul>
<p>Finally, here is an example code for a tabs sections:</p>
<pre><code class="language-html">{{#include ../../shared/tab_header.md}}
&lt;div data-lang=&quot;Kotlin&quot; class=&quot;tab&quot;&gt;
  Kotlin information...
&lt;/div&gt;
&lt;div data-lang=&quot;Java&quot; class=&quot;tab&quot;&gt;
  Java information...
&lt;/div&gt;
&lt;div data-lang=&quot;Swift&quot; class=&quot;tab&quot;&gt;
  Swift information...
&lt;/div&gt;
&lt;div data-lang=&quot;Python&quot; class=&quot;tab&quot;&gt;
  Python information...`
&lt;/div&gt;
&lt;div data-lang=&quot;Rust&quot; class=&quot;tab&quot;&gt;
  Rust information...
&lt;/div&gt;
&lt;!--
  In this example, Javascript and Firefox Desktop
  would show up as disabled in the final page.
--&gt;
&lt;div data-lang=&quot;Javascript&quot; class=&quot;tab&quot;&gt;&lt;/div&gt;
&lt;div data-lang=&quot;Firefox Desktop&quot; class=&quot;tab&quot;&gt;&lt;/div&gt;
{{#include ../../shared/tab_footer.md}}
</code></pre>
<p>And this is how those tabs will look like:</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
  Kotlin information...
</div>
<div data-lang="Java" class="tab">
  Java information...
</div>
<div data-lang="Swift" class="tab">
  Swift information...
</div>
<div data-lang="Python" class="tab">
  Python information...`
</div>
<div data-lang="Rust" class="tab">
  Rust information...
</div>
<div data-lang="Javascript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h4><a class="header" href="#custom-block-quotes" id="custom-block-quotes">Custom block quotes</a></h4>
<p>Sometimes it is necessary to bring attention to a special piece of information, or simply to provide
extra context related to the a given text.</p>
<p>In order to do that, there are three custom block quote formats available.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5><a class="header" href="#info-quote" id="info-quote">Info quote</a></h5>
<blockquote>
<p>An information block quote format, to provide useful extra context for a given text.</p>
</blockquote>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5><a class="header" href="#warning-quote" id="warning-quote">Warning quote</a></h5>
<blockquote>
<p>A warning block quote format, to provide useful warning related to a given text.</p>
</blockquote>
<div class="special-quote special-quote-stop fa fa-ban"></div>
<h5><a class="header" href="#stop-quote" id="stop-quote">Stop quote</a></h5>
<blockquote>
<p>A stronger warning block quote format, to provide useful warning related to a given text in
a more emphatic format. Use these sparingly.</p>
</blockquote>
<p>To include such quotes, again you can use mdbook <a href="https://rust-lang.github.io/mdBook/format/mdbook.html#including-files">include</a> statements.</p>
<p>For the above quotes, this is the corresponding code.</p>
<pre><code class="language-markdown">{{#include ../../shared/blockquote-info.html}}

##### Info quote

&gt; An information blockquote format, to provide useful extra context for a given text.

{{#include ../../shared/blockquote-warning.html}}

##### Warning quote

&gt; A warning blockquote format, to provide useful warning related to a given text.

{{#include ../../shared/blockquote-stop.html}}

##### Stop quote

&gt; A stronger warning blockquote format, to provide useful warning related to a given text in a
&gt; more emphatic format. Use these sparingly.
</code></pre>
<p>It is possible to use any level header with these special block quotes
and also no header at all.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/appendix/contribution-guidelines.md">Edit this file on GitHub.</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="../shared/tabs.js"></script>
        
        <script type="text/javascript" src="../shared/mermaid.min.js"></script>
        
        <script type="text/javascript" src="../shared/mermaid-init.js"></script>
        
        <script type="text/javascript" src="chart.min.js"></script>
        
        <script type="text/javascript" src="chart-distributions.js"></script>
        
        <script type="text/javascript" src="chart-distributions-ui.js"></script>
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
        
        

    </body>
</html>
